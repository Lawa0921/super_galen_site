---
layout: default
---

<div class="posts-page-container">
    <div class="posts-main-content">
        <header class="posts-header">
            <h1 class="posts-title">{{ page.title | default: "日誌" }}</h1>
            {% if page.description %}
            <p class="posts-description">{{ page.description }}</p>
            {% endif %}
        </header>

        <div class="posts-search">
            <input type="text" id="search-input" placeholder="搜尋文章..." class="search-box">
            <div class="search-filters">
                <select id="category-filter" class="filter-select">
                    <option value="">所有分類</option>
                    {% assign categories = site.posts | map: 'categories' | join: ',' | split: ',' | uniq %}
                    {% for category in categories %}
                    <option value="{{ category }}">{{ category }}</option>
                    {% endfor %}
                </select>
                <select id="tag-filter" class="filter-select">
                    <option value="">所有標籤</option>
                    {% assign tags = site.posts | map: 'tags' | join: ',' | split: ',' | uniq %}
                    {% for tag in tags %}
                    <option value="{{ tag }}">{{ tag }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="posts-list" id="posts-list">
            {% for post in site.posts %}
            <article class="post-item" data-categories="{{ post.categories | join: ',' }}" data-tags="{{ post.tags | join: ',' }}">
                <h2 class="post-item-title">
                    <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
                </h2>
                <div class="post-item-meta">
                    <time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: "%Y年%m月%d日" }}</time>
                    {% if post.categories %}
                    <span class="post-item-category">{{ post.categories | first }}</span>
                    {% endif %}
                </div>
                {% if post.excerpt %}
                <div class="post-item-excerpt">
                    {{ post.excerpt | strip_html | truncate: 150 }}
                </div>
                {% endif %}
                {% if post.tags %}
                <div class="post-item-tags">
                    {% for tag in post.tags %}
                    <span class="tag-small">#{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </article>
            {% endfor %}
        </div>

        <div id="no-results" class="no-results" style="display: none;">
            <p>沒有找到符合條件的文章</p>
        </div>
    </div>

    <aside class="posts-sidebar">
        <!-- 關於本站 -->
        <div class="sidebar-widget about-widget">
            <h3 class="widget-title">關於本站</h3>
            <div class="about-content">
                <p>這是 SuperGalen 的個人部落格，分享技術文章、開發心得和生活隨筆。</p>
                <div class="site-stats">
                    <div class="stat-item">
                        <span class="stat-value">{{ site.posts | size }}</span>
                        <span class="stat-label">篇文章</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ site.categories | size }}</span>
                        <span class="stat-label">個分類</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 文章分類 -->
        <div class="sidebar-widget categories-widget">
            <h3 class="widget-title">文章分類</h3>
            <ul class="categories-list">
                {% assign categories = site.posts | map: 'categories' | join: ',' | split: ',' | uniq %}
                {% for category in categories %}
                {% assign cat_posts = site.posts | where: 'categories', category %}
                <li>
                    <a href="#{{ category }}" class="category-link" data-category="{{ category }}">
                        <span class="category-name">{{ category }}</span>
                        <span class="category-count">{{ cat_posts | size }}</span>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- 標籤雲 -->
        <div class="sidebar-widget tags-widget">
            <h3 class="widget-title">標籤雲</h3>
            <div class="tag-cloud">
                {% assign tags = site.posts | map: 'tags' | join: ',' | split: ',' | uniq %}
                {% for tag in tags %}
                <a href="#{{ tag }}" class="tag-cloud-item" data-tag="{{ tag }}">{{ tag }}</a>
                {% endfor %}
            </div>
        </div>

        <!-- 最新文章 -->
        <div class="sidebar-widget recent-posts-widget">
            <h3 class="widget-title">最新文章</h3>
            <ul class="recent-posts">
                {% for post in site.posts limit:5 %}
                <li>
                    <a href="{{ post.url | relative_url }}">
                        <span class="recent-post-date">{{ post.date | date: "%Y/%m/%d" }}</span>
                        {{ post.title | truncate: 25 }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- 文章存檔 -->
        <div class="sidebar-widget archive-widget">
            <h3 class="widget-title">文章存檔</h3>
            <ul class="archive-list">
                {% assign postsByYearMonth = site.posts | group_by_exp: "post", "post.date | date: '%Y年%m月'" %}
                {% for yearMonth in postsByYearMonth %}
                <li>
                    <a href="#{{ yearMonth.name }}" class="archive-link">
                        <span class="archive-date">{{ yearMonth.name }}</span>
                        <span class="archive-count">{{ yearMonth.size }}</span>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </aside>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const categoryFilter = document.getElementById('category-filter');
    const tagFilter = document.getElementById('tag-filter');
    const postsList = document.getElementById('posts-list');
    const noResults = document.getElementById('no-results');
    const posts = postsList.querySelectorAll('.post-item');

    function filterPosts() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedCategory = categoryFilter.value.toLowerCase();
        const selectedTag = tagFilter.value.toLowerCase();
        let visibleCount = 0;

        posts.forEach(post => {
            const title = post.querySelector('.post-item-title').textContent.toLowerCase();
            const excerpt = post.querySelector('.post-item-excerpt') ?
                          post.querySelector('.post-item-excerpt').textContent.toLowerCase() : '';
            const categories = post.dataset.categories.toLowerCase();
            const tags = post.dataset.tags.toLowerCase();

            const matchesSearch = !searchTerm ||
                                 title.includes(searchTerm) ||
                                 excerpt.includes(searchTerm);
            const matchesCategory = !selectedCategory ||
                                  categories.includes(selectedCategory);
            const matchesTag = !selectedTag ||
                             tags.includes(selectedTag);

            if (matchesSearch && matchesCategory && matchesTag) {
                post.style.display = 'block';
                visibleCount++;
            } else {
                post.style.display = 'none';
            }
        });

        noResults.style.display = visibleCount === 0 ? 'block' : 'none';
    }

    searchInput.addEventListener('input', filterPosts);
    categoryFilter.addEventListener('change', filterPosts);
    tagFilter.addEventListener('change', filterPosts);

    // 側邊欄分類點擊
    document.querySelectorAll('.category-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const category = this.dataset.category;
            categoryFilter.value = category;
            filterPosts();
        });
    });

    // 側邊欄標籤點擊
    document.querySelectorAll('.tag-cloud-item').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const tag = this.dataset.tag;
            tagFilter.value = tag;
            filterPosts();
        });
    });

    // 檢查 URL hash 中的搜尋參數
    if (window.location.hash) {
        const hash = window.location.hash.substring(1);
        if (hash.startsWith('search:')) {
            const keyword = decodeURIComponent(hash.substring(7));
            searchInput.value = keyword;
            filterPosts();
        }
    }
});
</script>