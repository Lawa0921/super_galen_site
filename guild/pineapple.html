<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é³³æ¢¨è€å¸« Pineapple Teacher | Solarpunk Math World</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC:wght@300;400;700&family=Fredoka:wght@300;600&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Three.js -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        :root {
            --bg-color: #FFF9C4; /* Light Yellow */
            --accent-primary: #FFD700; /* Gold */
            --accent-secondary: #FF6B6B; /* Solarpunk Orange */
            --accent-tertiary: #4DB6AC; /* Teal for contrast */
            --text-color: #3E2723; /* Dark Brown */
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.9);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'LXGW WenKai TC', sans-serif;
            color: var(--text-color);
            background-color: var(--bg-color);
            overflow-x: hidden;
            width: 100vw;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        /* --- UI Overlay --- */
        .overlay {
            position: relative;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 10;
            pointer-events: none; /* Let clicks pass to 3D */
        }

        section {
            height: 100vh;
            width: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
        }

        /* Enable pointer events for actual content */
        .card, .btn, .social-link {
            pointer-events: auto;
        }

        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid var(--glass-border);
            border-radius: 30px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transform: translateY(50px);
            opacity: 0;
            transition: all 0.5s ease-out;
            text-align: center;
        }

        section.visible .card {
            transform: translateY(0);
            opacity: 1;
        }

        h1, h2 {
            font-family: 'Fredoka', sans-serif;
            color: var(--accent-secondary);
            margin-bottom: 1rem;
        }

        h1 { font-size: 4rem; text-shadow: 2px 2px 0px #fff; }
        h2 { font-size: 2.5rem; }
        p { font-size: 1.2rem; line-height: 1.8; margin-bottom: 1rem; font-weight: 500;}

        .highlight {
            color: var(--accent-tertiary);
            font-weight: bold;
            background: rgba(77, 182, 172, 0.2);
            padding: 0 5px;
            border-radius: 5px;
        }

        /* --- Navigation --- */
        .nav-home {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: white;
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            color: var(--text-color);
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            pointer-events: auto;
        }
        .nav-home:hover { transform: scale(1.1); }

        /* --- HUD Elements --- */
        .explore-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
            background: var(--accent-primary);
            color: var(--text-color);
            padding: 15px 30px;
            border-radius: 50px;
            border: none;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
            pointer-events: auto;
            transition: all 0.3s;
        }
        .explore-btn:hover {
            transform: scale(1.1) rotate(-2deg);
            background: var(--accent-secondary);
            color: white;
        }

        .scroll-indicator {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 90;
            animation: bounce 2s infinite;
            color: var(--text-color);
            font-size: 2rem;
            pointer-events: none;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);}
            40% {transform: translateX(-50%) translateY(-20px);}
            60% {transform: translateX(-50%) translateY(-10px);}
        }

        /* --- Specific Section Styles --- */
        #section-hero { align-items: flex-end; padding-bottom: 15vh; }
        #section-bio { align-items: center; justify-content: flex-start; padding-left: 10vw; }
        #section-math { align-items: center; justify-content: flex-end; padding-right: 10vw; }
        #section-gallery { align-items: flex-start; padding-top: 15vh; }

        /* Loading Screen */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s;
        }
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--accent-secondary);
            border-top: 5px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Social Icons */
        .social-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .social-link {
            font-size: 2rem;
            color: var(--text-color);
            transition: color 0.3s;
        }
        .social-link:hover { color: var(--accent-secondary); }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            h1 { font-size: 3rem; }
            .card { padding: 1.5rem; width: 95%; }
            #section-bio, #section-math { justify-content: center; padding: 0; }
            #section-hero { align-items: center; padding-bottom: 0; }
        }

    </style>
</head>
<body>

    <a href="/guild/" class="nav-home"><i class="fas fa-arrow-left"></i> Guild</a>
    <button class="explore-btn" id="explore-btn">EXPLORE 3D</button>
    <div class="scroll-indicator"><i class="fas fa-chevron-down"></i></div>

    <div id="loader">
        <div class="loader-spinner"></div>
        <h2 style="margin-top: 20px; font-size: 1.5rem;">Loading World...</h2>
    </div>

    <div id="canvas-container"></div>

    <div class="overlay">
        <!-- Section 1: Hero -->
        <section id="section-hero" class="visible">
            <div class="card" style="background: rgba(255,255,255,0.4);">
                <h1>æˆ‘æ˜¯é³³æ¢¨è€å¸«ğŸ</h1>
                <p>çµ¦äºˆï¼Œæ˜¯ä¸€ç”Ÿæœ€æœ‰æ„ç¾©çš„äº‹ã€‚</p>
            </div>
        </section>

        <!-- Section 2: Bio / Origin -->
        <section id="section-bio">
            <div class="card">
                <h2>æˆ‘çš„æ•…äº‹</h2>
                <p>å…¥è¡Œ 7 å¹´ï¼Œæˆ‘æ˜¯ä¸€ä½è£œç¿’ç­æ•¸å­¸è€å¸«ã€å®‰è¦ªç­è€å¸«ï¼Œä¹Ÿæ˜¯æ¡ŒéŠå°å¸«ã€‚</p>
                <p>ä½œç‚ºä¸€å<span class="highlight">å”‡é¡è£‚æ‚£è€…</span>ï¼Œæˆ‘å¾å°æ¥å—éè¨±å¤šå¹«åŠ©ã€‚é€™ä»½ç¶“æ­·è®“æˆ‘æ±ºå®šæŠ•èº«æ•™è‚²ï¼Œå›é¥‹ç¤¾æœƒã€‚</p>
                <p>å°æˆ‘ä¾†èªªï¼Œé€™ä¸åƒ…æ˜¯å·¥ä½œï¼Œæ›´æ˜¯æˆ‘çš„ä½¿å‘½ã€‚</p>
            </div>
        </section>

        <!-- Section 3: Math & Logic -->
        <section id="section-math">
            <div class="card">
                <h2>æ•¸å­¸èˆ‡é‚è¼¯</h2>
                <p>æˆ‘å¸Œæœ›å­©å­å€‘ä¸æ‡¼æ€•æ•¸å­¸ï¼Œç”šè‡³æ„›ä¸Šå®ƒï¼</p>
                <p>ç›®å‰æˆ‘å¸¶é ˜å­¸ç”ŸåƒåŠ <span class="highlight">å¥§æ—åŒ¹å…‹æ•¸å­¸åœ˜é«”ç«¶è³½</span>ï¼Œå·²ç²å¾—éŠ€çå’ŒéŠ…ççš„ä½³ç¸¾ã€‚</p>
                <p>é¢¨æ ¼ï¼š#é³³æ¢¨ #é‚è¼¯ #æº«æš– #é–‹æœ—</p>
            </div>
        </section>

        <!-- Section 4: Gallery & Footer -->
        <section id="section-gallery">
            <div class="card">
                <h2>ç²¾å½©æ™‚åˆ»</h2>
                <p>ç´€éŒ„æ•™å­¸è»Œè·¡ï¼Œè¦‹è­‰å­©å­çš„æˆé•·ã€‚</p>
                <!-- Image will be in 3D, this is just text context -->
                <div class="social-row">
                    <a href="https://www.threads.com/@a_l_w_a_y_s_joy" target="_blank" class="social-link"><i class="fa-brands fa-threads"></i></a>
                    <a href="https://www.instagram.com/a_l_w_a_y_s_joy/" target="_blank" class="social-link"><i class="fa-brands fa-instagram"></i></a>
                </div>
                <p style="margin-top: 10px; font-size: 0.9rem;">Made with ğŸ’› by SuperGalen's Dungeon</p>
            </div>
        </section>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- Configuration ---
        const config = {
            colors: {
                bg: 0xFFF9C4,
                pineappleBody: 0xFFD700,
                pineappleLeaves: 0x4CAF50,
                pineappleGlasses: 0x3E2723,
                particles: [0xFF6B6B, 0x4DB6AC, 0xFFA726, 0x29B6F6]
            }
        };

        // --- Scene Setup ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(config.colors.bg);
        scene.fog = new THREE.Fog(config.colors.bg, 10, 50);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 0, 15);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.SoftShadowMap;
        container.appendChild(renderer.domElement);

        // --- Controls (Restricted initially) ---
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.enableZoom = false;
        controls.enablePan = false;
        controls.enabled = false; // Enable only in explore mode

        // --- Lighting ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(5, 10, 7);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 1024;
        dirLight.shadow.mapSize.height = 1024;
        scene.add(dirLight);

        // --- Character: Pineapple Teacher ---
        const pineappleGroup = new THREE.Group();
        scene.add(pineappleGroup);

        // Body (Low Poly Sphere)
        const bodyGeo = new THREE.IcosahedronGeometry(1.5, 1); // Radius 1.5, Detail 1 (Low Poly)
        const bodyMat = new THREE.MeshStandardMaterial({
            color: config.colors.pineappleBody,
            flatShading: true,
            roughness: 0.4,
            metalness: 0.1
        });
        const body = new THREE.Mesh(bodyGeo, bodyMat);
        body.castShadow = true;
        body.receiveShadow = true;
        pineappleGroup.add(body);

        // Leaves (Cones)
        const leavesGroup = new THREE.Group();
        const leafGeo = new THREE.ConeGeometry(0.3, 1.5, 4); // Low poly cone
        const leafMat = new THREE.MeshStandardMaterial({
            color: config.colors.pineappleLeaves,
            flatShading: true
        });

        for (let i = 0; i < 5; i++) {
            const leaf = new THREE.Mesh(leafGeo, leafMat);
            leaf.position.y = 1.2;
            leaf.rotation.x = (Math.random() - 0.5) * 0.5;
            leaf.rotation.z = (Math.random() - 0.5) * 0.5;
            leaf.rotation.y = (i / 5) * Math.PI * 2;
            leaf.position.x = Math.sin((i / 5) * Math.PI * 2) * 0.2;
            leaf.position.z = Math.cos((i / 5) * Math.PI * 2) * 0.2;
            leavesGroup.add(leaf);
        }
        pineappleGroup.add(leavesGroup);

        // Glasses (Torus)
        const glassGeo = new THREE.TorusGeometry(0.3, 0.05, 8, 20);
        const glassMat = new THREE.MeshLambertMaterial({ color: config.colors.pineappleGlasses });
        const glassesL = new THREE.Mesh(glassGeo, glassMat);
        const glassesR = new THREE.Mesh(glassGeo, glassMat);
        glassesL.position.set(-0.35, 0.2, 1.2);
        glassesR.position.set(0.35, 0.2, 1.2);

        // Bridge
        const bridgeGeo = new THREE.CylinderGeometry(0.04, 0.04, 0.2);
        const bridge = new THREE.Mesh(bridgeGeo, glassMat);
        bridge.rotation.z = Math.PI / 2;
        bridge.position.set(0, 0.2, 1.2);

        const glassesGroup = new THREE.Group();
        glassesGroup.add(glassesL, glassesR, bridge);
        pineappleGroup.add(glassesGroup);

        // Mouth (Torus segment)
        const mouthGeo = new THREE.TorusGeometry(0.3, 0.04, 8, 20, Math.PI);
        const mouth = new THREE.Mesh(mouthGeo, glassMat);
        mouth.position.set(0, -0.3, 1.15);
        mouth.rotation.x = 0; // Happy smile
        pineappleGroup.add(mouth);

        // --- Photo Gallery (3D Plane) ---
        const textureLoader = new THREE.TextureLoader();
        const photoTexture = textureLoader.load('../assets/img/guild/pineapple/gallery_7.webp');
        const photoGeo = new THREE.PlaneGeometry(3, 2.25); // 4:3 aspect ratio approx
        const photoMat = new THREE.MeshBasicMaterial({
            map: photoTexture,
            side: THREE.DoubleSide,
            transparent: true,
            opacity: 0 // Start invisible
        });
        const photoMesh = new THREE.Mesh(photoGeo, photoMat);
        photoMesh.position.set(0, -10, 0); // Hide initially
        photoMesh.rotation.y = -Math.PI / 6;
        scene.add(photoMesh);

        // Border for photo
        const borderGeo = new THREE.PlaneGeometry(3.2, 2.45);
        const borderMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
        const photoBorder = new THREE.Mesh(borderGeo, borderMat);
        photoBorder.position.z = -0.01;
        photoMesh.add(photoBorder);


        // --- Particles (Math Symbols / Shapes) ---
        const particleCount = 100;
        const particleGroup = new THREE.Group();
        scene.add(particleGroup);

        const geos = [
            new THREE.TetrahedronGeometry(0.3),
            new THREE.BoxGeometry(0.3, 0.3, 0.3),
            new THREE.OctahedronGeometry(0.3)
        ];

        const particles = [];

        for (let i = 0; i < particleCount; i++) {
            const geo = geos[Math.floor(Math.random() * geos.length)];
            const mat = new THREE.MeshStandardMaterial({
                color: config.colors.particles[Math.floor(Math.random() * config.colors.particles.length)],
                flatShading: true
            });
            const mesh = new THREE.Mesh(geo, mat);

            // Random spread
            mesh.position.set(
                (Math.random() - 0.5) * 30,
                (Math.random() - 0.5) * 30,
                (Math.random() - 0.5) * 20 - 5
            );

            mesh.userData = {
                speedX: (Math.random() - 0.5) * 0.02,
                speedY: (Math.random() - 0.5) * 0.02,
                rotSpeed: (Math.random() - 0.5) * 0.05
            };

            particleGroup.add(mesh);
            particles.push(mesh);
        }

        // --- Floating Heart (Bio Section) ---
        const heartShape = new THREE.Shape();
        const x = 0, y = 0;
        heartShape.moveTo(x + 0.5, y + 0.5);
        heartShape.bezierCurveTo(x + 0.5, y + 0.5, x + 0.4, y, x, y);
        heartShape.bezierCurveTo(x - 0.6, y, x - 0.6, y + 0.7,x - 0.6, y + 0.7);
        heartShape.bezierCurveTo(x - 0.6, y + 1.1, x - 0.3, y + 1.54, x + 0.5, y + 1.9);
        heartShape.bezierCurveTo(x + 1.2, y + 1.54, x + 1.6, y + 1.1, x + 1.6, y + 0.7);
        heartShape.bezierCurveTo(x + 1.6, y + 0.7, x + 1.6, y, x + 1.0, y);
        heartShape.bezierCurveTo(x + 0.7, y, x + 0.5, y + 0.5, x + 0.5, y + 0.5);

        const heartGeo = new THREE.ExtrudeGeometry(heartShape, { depth: 0.2, bevelEnabled: true, bevelSegments: 2, steps: 2, bevelSize: 0.1, bevelThickness: 0.1 });
        const heartMat = new THREE.MeshStandardMaterial({ color: 0xE91E63, roughness: 0.2, metalness: 0.5 });
        const heartMesh = new THREE.Mesh(heartGeo, heartMat);
        heartMesh.scale.set(0.5, 0.5, 0.5);
        heartMesh.rotation.z = Math.PI; // Flip it upright
        heartMesh.position.set(-3, 0, 0);
        heartMesh.visible = false;
        scene.add(heartMesh);


        // --- Scrollytelling State Management ---
        const sections = document.querySelectorAll('section');
        let currentSection = 0;

        function updateScroll() {
            const scrollY = window.scrollY;
            const scrollHeight = document.body.scrollHeight - window.innerHeight;
            const progress = Math.min(Math.max(scrollY / scrollHeight, 0), 1);

            // Update UI Sections Visibility
            sections.forEach((sec, idx) => {
                const rect = sec.getBoundingClientRect();
                if (rect.top < window.innerHeight * 0.6 && rect.bottom > window.innerHeight * 0.4) {
                    sec.classList.add('visible');
                    currentSection = idx;
                } else {
                    sec.classList.remove('visible');
                }
            });

            // Camera & Object Choreography based on Progress
            // Section 1 (0.0 - 0.2): Center
            // Section 2 (0.2 - 0.5): Bio (Pan Right, Character Looks Left)
            // Section 3 (0.5 - 0.8): Math (Particles Form Shape?)
            // Section 4 (0.8 - 1.0): Gallery (Show Photo)

            if (progress < 0.25) {
                // Hero
                gsap.to(camera.position, { x: 0, y: 0, z: 12, duration: 1 });
                gsap.to(pineappleGroup.position, { x: 0, y: 0, duration: 1 });
                gsap.to(pineappleGroup.rotation, { y: Math.sin(Date.now() * 0.001) * 0.2, duration: 0.5 });

                heartMesh.visible = false;
                photoMesh.material.opacity = 0;

            } else if (progress < 0.5) {
                // Bio
                gsap.to(camera.position, { x: 3, y: 0, z: 12, duration: 1 });
                gsap.to(pineappleGroup.position, { x: 0, y: 0, duration: 1 });
                gsap.to(pineappleGroup.rotation, { y: -0.5, duration: 1 }); // Look at Heart

                heartMesh.visible = true;
                heartMesh.rotation.y += 0.02;
                gsap.to(heartMesh.position, { x: -2, y: Math.sin(Date.now() * 0.002) * 0.5, duration: 0.5 });

                photoMesh.material.opacity = 0;

            } else if (progress < 0.75) {
                // Math
                gsap.to(camera.position, { x: -3, y: 0, z: 12, duration: 1 });
                gsap.to(pineappleGroup.rotation, { y: 0.5, duration: 1 });

                heartMesh.visible = false;
                photoMesh.material.opacity = 0;

                // Speed up particles
                particles.forEach(p => {
                    p.userData.speedX *= 1.01;
                });

            } else {
                // Gallery
                gsap.to(camera.position, { x: 0, y: -2, z: 14, duration: 1 });
                gsap.to(pineappleGroup.position, { x: 3, y: 1, duration: 1 });
                gsap.to(pineappleGroup.rotation, { y: -0.5, duration: 1 });

                photoMesh.position.set(-2, 0, 5);
                photoMesh.rotation.y = 0.2;
                gsap.to(photoMesh.material, { opacity: 1, duration: 1 });
            }
        }

        // --- Interaction & Physics ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.addEventListener('mousemove', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            // Parallax
            if (!controls.enabled) {
                camera.position.x += (mouse.x - camera.position.x) * 0.05 * 0.2; // Tiny follow
                camera.position.y += (mouse.y - camera.position.y) * 0.05 * 0.2;
            }
        });

        window.addEventListener('click', (event) => {
            if (controls.enabled) return; // Don't squash if exploring

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects([body], true);

            if (intersects.length > 0) {
                // Squash and Stretch
                gsap.to(pineappleGroup.scale, { x: 1.3, y: 0.7, z: 1.3, duration: 0.1, yoyo: true, repeat: 1 });

                // Shockwave effect (simplified as particle burst)
                particles.forEach(p => {
                    p.position.add(new THREE.Vector3((Math.random()-0.5)*2, (Math.random()-0.5)*2, 0));
                });
            }
        });

        // Explore Mode
        const exploreBtn = document.getElementById('explore-btn');
        let exploreMode = false;

        exploreBtn.addEventListener('click', () => {
            exploreMode = !exploreMode;
            controls.enabled = exploreMode;

            if (exploreMode) {
                exploreBtn.innerText = "EXIT EXPLORE";
                document.querySelector('.overlay').style.opacity = 0;
                gsap.to(camera.position, { z: 20, duration: 1 });
            } else {
                exploreBtn.innerText = "EXPLORE 3D";
                document.querySelector('.overlay').style.opacity = 1;
                // Reset camera handled by scroll loop
            }
        });

        // --- Animation Loop ---
        const clock = new THREE.Clock();

        // Import GSAP for simple tweens if not already globally loaded
        // We'll assume the script tag in head loaded it, but for module safety:
        // (Actually, the head script is standard JS, not module. We can access window.gsap)

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // Pineapple Breathing
            if (!exploreMode) {
                pineappleGroup.scale.y = 1 + Math.sin(time * 2) * 0.02;
                pineappleGroup.scale.x = 1 - Math.sin(time * 2) * 0.01;
                pineappleGroup.scale.z = 1 - Math.sin(time * 2) * 0.01;
            }

            // Particles Update
            particles.forEach((p, i) => {
                p.rotation.x += p.userData.rotSpeed;
                p.rotation.y += p.userData.rotSpeed;

                p.position.x += p.userData.speedX + Math.sin(time + i) * 0.005;
                p.position.y += p.userData.speedY + Math.cos(time + i) * 0.005;

                // Loop
                if (p.position.y > 15) p.position.y = -15;
                if (p.position.y < -15) p.position.y = 15;
                if (p.position.x > 20) p.position.x = -20;
                if (p.position.x < -20) p.position.x = 20;
            });

            // Heart Animation
            if (heartMesh.visible) {
                heartMesh.rotation.y = Math.sin(time) * 0.5 + Math.PI; // Gentle sway
            }

            controls.update();
            renderer.render(scene, camera);
        }

        // --- Resize ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- Scroll Listener ---
        window.addEventListener('scroll', updateScroll);

        // --- Init ---
        // Hide loader
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loader').style.opacity = 0;
                setTimeout(() => document.getElementById('loader').remove(), 500);
            }, 1000);
        });

        animate();
    </script>

    <!-- GSAP (CDN for non-module usage in scroll logic) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

</body>
</html>
