<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é³³æ¢¨è€å¸« Pineapple Teacher | Solarpunk Math World</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC:wght@400;700&family=Fredoka:wght@400;600;700&family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Three.js & GSAP -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --bg-color: #FFF9C4;
            --accent-primary: #FFD700;
            --accent-secondary: #FF6B6B;
            --accent-tertiary: #4DB6AC;
            --text-color: #3E2723;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'LXGW WenKai TC', sans-serif;
            color: var(--text-color);
            background-color: var(--bg-color);
            overflow-x: hidden;
            width: 100vw;
        }

        /* --- 3D Background --- */
        #canvas-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none; /* Pass through to scroll */
        }

        /* --- Book Wrapper (The Scrollable Area) --- */
        #book-viewport {
            width: 100vw;
            height: 500vh; /* 5 Pages * 100vh */
            position: relative;
            z-index: 10;
        }

        /* --- The Book itself --- */
        .book-stage {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 2000px;
            pointer-events: none;
        }

        .book-spine {
            width: 90vw;
            height: 85vh;
            position: relative;
            transform-style: preserve-3d;
            max-width: 1200px;
        }

        .page {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 4rem;
            transform-origin: left center; /* Key for flip */
            backface-visibility: hidden; /* Hide back when flipped */
            box-shadow: 0 10px 30px rgba(62, 39, 35, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            pointer-events: auto;
            border: 2px solid #FFF;
            transition: box-shadow 0.3s;
        }

        /* Mobile Adjustments for Pages */
        @media (max-width: 768px) {
            .page {
                padding: 2rem;
                align-items: center;
                text-align: center;
                background: rgba(255, 255, 255, 0.85);
            }
            .book-spine { width: 95vw; height: 90vh; }
        }

        /* Typography */
        h1 {
            font-family: 'Fredoka', sans-serif;
            font-size: 6rem;
            color: var(--accent-secondary);
            line-height: 1;
            text-shadow: 4px 4px 0px #FFD700;
            margin-bottom: 2rem;
        }
        h2 {
            font-family: 'Zen Maru Gothic', sans-serif;
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            color: var(--accent-tertiary);
        }
        p {
            font-size: 1.8rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            max-width: 60ch;
        }
        .tagline {
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-color);
            background: #FFD700;
            padding: 5px 15px;
            border-radius: 10px;
            display: inline-block;
            transform: rotate(-2deg);
            margin-bottom: 2rem;
        }

        /* Content Layouts */
        .page-content {
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            align-items: center;
        }
        .full-center {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%; height: 100%;
        }

        /* Avatar */
        .avatar-frame {
            width: 350px;
            height: 350px;
            border-radius: 50%;
            border: 10px solid #fff;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            overflow: hidden;
            transform: rotate(3deg);
            background: #eee;
        }
        .avatar-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Gallery Grid */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            width: 100%;
        }
        .gallery-item {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            border: 5px solid #fff;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .gallery-item:hover { transform: scale(1.05); }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; }

        /* Socials */
        .social-btns {
            display: flex;
            gap: 20px;
            margin-top: 2rem;
        }
        .social-btn {
            background: var(--text-color);
            color: #fff;
            width: 60px; height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center; justify-content: center;
            font-size: 1.5rem;
            text-decoration: none;
            transition: transform 0.2s, background 0.2s;
        }
        .social-btn:hover {
            transform: scale(1.1) rotate(10deg);
            background: var(--accent-secondary);
        }

        /* Navigation */
        .nav-home {
            position: fixed;
            top: 30px; left: 30px;
            z-index: 1000;
            background: white;
            padding: 10px 20px;
            border-radius: 30px;
            text-decoration: none;
            color: var(--text-color);
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Mobile specific fixes */
        @media (max-width: 768px) {
            .page-content { grid-template-columns: 1fr; text-align: center; }
            h1 { font-size: 4rem; }
            h2 { font-size: 2.5rem; }
            p { font-size: 1.2rem; }
            .avatar-frame { width: 200px; height: 200px; margin: 0 auto; }
            .gallery-grid { grid-template-columns: repeat(2, 1fr); }
        }

        /* Loading */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color);
            z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            font-size: 2rem; color: var(--text-color); font-family: 'Fredoka', sans-serif;
            transition: opacity 0.5s;
        }

    </style>
</head>
<body>

    <a href="/guild/" class="nav-home"><i class="fas fa-arrow-left"></i> Guild</a>
    <div id="loader">Loading World...</div>

    <!-- 3D Canvas Background -->
    <div id="canvas-container"></div>

    <!-- Content / "The Book" -->
    <div id="book-viewport"></div> <!-- Height setter -->

    <div class="book-stage">
        <div class="book-spine">

            <!-- Page 1: Cover -->
            <div class="page" id="page-1" style="z-index: 5;">
                <div class="page-content">
                    <div style="padding-left: 2rem;">
                        <h1>é³³æ¢¨è€å¸«<br>Pineapple<br>Teacher</h1>
                        <div class="tagline">Solarpunk Math World</div>
                        <p>æ­¡è¿ä¾†åˆ°æˆ‘çš„æ•¸å­¸éŠæ¨‚å ´ï¼<br>é€™è£¡å……æ»¿äº†é‚è¼¯ã€æº«æš–èˆ‡ä¸€é»é»çš„ç˜‹ç‹‚ã€‚</p>
                        <i class="fas fa-arrow-down" style="font-size: 2rem; margin-top: 2rem; animation: bounce 2s infinite;"></i>
                    </div>
                    <!-- Right side is empty for 3D Pineapple -->
                </div>
            </div>

            <!-- Page 2: Bio & Avatar -->
            <div class="page" id="page-2" style="z-index: 4;">
                <div class="page-content">
                    <div style="order: 2; padding-left: 2rem;"> <!-- Text Right -->
                        <h2>æˆ‘æ˜¯é³³æ¢¨è€å¸« ğŸ</h2>
                        <p>ä¸€ä½å…¥è¡Œ 7 å¹´çš„<span style="color:var(--accent-secondary)">æ•¸å­¸æ•™è‚²è€…</span>ã€‚</p>
                        <p>è£œç¿’ç­ / å®‰è¦ªç­ / æ¡ŒéŠ / åœ‹å°å¥§æ•¸</p>
                        <p>é¢¨æ ¼ï¼š#é‚è¼¯ #æº«æš– #é–‹æœ— #å¥§æ•¸</p>
                    </div>
                    <div style="order: 1; display:flex; justify-content:center;"> <!-- Image Left -->
                        <div class="avatar-frame">
                            <img src="../assets/img/guild/pineapple/avatar.webp" alt="Pineapple Teacher">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page 3: Mission -->
            <div class="page" id="page-3" style="z-index: 3;">
                <div class="full-center" style="text-align: center;">
                    <h2>ã€Œçµ¦äºˆï¼Œæ˜¯ä¸€ç”Ÿæœ€æœ‰æ„ç¾©çš„äº‹ã€‚ã€</h2>
                    <br>
                    <p>æˆ‘æ˜¯ä¸€ä½<span style="color:var(--accent-secondary); font-weight:bold;">å”‡é¡è£‚æ‚£è€…</span>ã€‚</p>
                    <p>å¾å°ï¼Œæˆ‘æ¥å—äº†ç„¡æ•¸äººçš„å¹«åŠ©ã€‚<br>é€™ä»½æº«æš–è®“æˆ‘æ±ºå®šæŠ•èº«æ•™è‚²ï¼Œå›é¥‹ç¤¾æœƒã€‚</p>
                    <p>å°æˆ‘ä¾†èªªï¼Œé€™å·²ä¸åƒ…åƒ…æ˜¯å·¥ä½œï¼Œè€Œæ˜¯<span style="border-bottom: 3px solid var(--accent-primary);">æˆ‘çš„ä½¿å‘½</span>ã€‚</p>
                </div>
            </div>

            <!-- Page 4: Math -->
            <div class="page" id="page-4" style="z-index: 2;">
                <div class="page-content">
                    <div>
                        <h2>å¿«æ¨‚å­¸æ•¸å­¸</h2>
                        <p>æˆ‘è‡´åŠ›æ–¼è®“å­©å­å€‘ä¸æ‡¼æ€•æ•¸å­¸ï¼Œç”šè‡³æ„›ä¸Šæ€è€ƒã€‚</p>
                        <p>ç›®å‰æ­£åŸ¹è¨“å­©å­åƒåŠ <br><strong>å¥§æ—åŒ¹å…‹æ•¸å­¸åœ˜é«”ç«¶è³½</strong><br>å­¸ç”Ÿå·²ç²å¾—å€‹äººè³½ <span style="color:#C0C0C0">éŠ€ç</span> èˆ‡ <span style="color:#CD7F32">éŠ…ç</span> ä½³ç¸¾ï¼</p>
                    </div>
                    <!-- Right side for floating math particles -->
                </div>
            </div>

            <!-- Page 5: Gallery & Footer -->
            <div class="page" id="page-5" style="z-index: 1;">
                <div class="full-center">
                    <h2>ç²¾å½©æ™‚åˆ»</h2>
                    <div class="gallery-grid">
                        <!-- We use some of the other images here -->
                        <div class="gallery-item"><img src="../assets/img/guild/pineapple/gallery_1.webp" loading="lazy"></div>
                        <div class="gallery-item"><img src="../assets/img/guild/pineapple/gallery_2.webp" loading="lazy"></div>
                        <div class="gallery-item"><img src="../assets/img/guild/pineapple/gallery_3.webp" loading="lazy"></div>
                    </div>
                    <div class="social-btns">
                        <a href="https://www.threads.com/@a_l_w_a_y_s_joy" target="_blank" class="social-btn"><i class="fa-brands fa-threads"></i></a>
                        <a href="https://www.instagram.com/a_l_w_a_y_s_joy/" target="_blank" class="social-btn"><i class="fa-brands fa-instagram"></i></a>
                    </div>
                    <p style="margin-top: 2rem; font-size: 1rem;">Made with ğŸ’› by SuperGalen's Dungeon</p>
                </div>
            </div>

        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';

        // --- Config ---
        const config = {
            colors: {
                bg: 0xFFF9C4,
                pineappleBody: 0xFFD700,
                pineappleLeaves: 0x4CAF50,
                pineappleGlasses: 0x3E2723,
                particles: [0xFF6B6B, 0x4DB6AC, 0xFFA726, 0x29B6F6]
            }
        };

        // --- Three.js Setup ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(config.colors.bg);
        // Add subtle fog to blend the "floor"
        scene.fog = new THREE.FogExp2(config.colors.bg, 0.02);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 0, 15);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.SoftShadowMap;
        container.appendChild(renderer.domElement);

        // --- Lighting ---
        const ambLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
        dirLight.position.set(5, 10, 5);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 1024;
        dirLight.shadow.mapSize.height = 1024;
        scene.add(dirLight);

        // --- Procedural Pineapple Character ---
        const pineappleGroup = new THREE.Group();
        scene.add(pineappleGroup);

        // Body
        const bodyGeo = new THREE.IcosahedronGeometry(1.8, 1);
        const bodyMat = new THREE.MeshStandardMaterial({ color: config.colors.pineappleBody, flatShading: true });
        const body = new THREE.Mesh(bodyGeo, bodyMat);
        body.castShadow = true; body.receiveShadow = true;
        pineappleGroup.add(body);

        // Leaves
        const leafGeo = new THREE.ConeGeometry(0.3, 1.8, 4);
        const leafMat = new THREE.MeshStandardMaterial({ color: config.colors.pineappleLeaves, flatShading: true });
        for(let i=0; i<6; i++){
            const leaf = new THREE.Mesh(leafGeo, leafMat);
            leaf.position.y = 1.4;
            leaf.rotation.y = (i/6)*Math.PI*2;
            leaf.rotation.x = (Math.random()-0.5)*0.5;
            leaf.rotation.z = (Math.random()-0.5)*0.5;
            leaf.position.x = Math.sin((i/6)*Math.PI*2)*0.3;
            leaf.position.z = Math.cos((i/6)*Math.PI*2)*0.3;
            pineappleGroup.add(leaf);
        }

        // Face (Glasses & Smile)
        const faceGroup = new THREE.Group();
        const glassGeo = new THREE.TorusGeometry(0.35, 0.05, 8, 16);
        const glassMat = new THREE.MeshLambertMaterial({ color: config.colors.pineappleGlasses });
        const gL = new THREE.Mesh(glassGeo, glassMat); gL.position.set(-0.4, 0.2, 1.4); gL.lookAt(-0.4, 0.2, 2);
        const gR = new THREE.Mesh(glassGeo, glassMat); gR.position.set(0.4, 0.2, 1.4); gR.lookAt(0.4, 0.2, 2);
        const bridge = new THREE.Mesh(new THREE.CylinderGeometry(0.04, 0.04, 0.3), glassMat);
        bridge.rotation.z = Math.PI/2; bridge.position.set(0, 0.2, 1.45);
        const smile = new THREE.Mesh(new THREE.TorusGeometry(0.3, 0.04, 8, 16, Math.PI), glassMat);
        smile.position.set(0, -0.3, 1.4); smile.rotation.y = Math.PI; // Face forward? No, face back to match torus logic?
        // Torus default lies on XY.
        smile.rotation.x = 0; // Check
        faceGroup.add(gL, gR, bridge, smile);
        pineappleGroup.add(faceGroup);
        faceGroup.position.z = 0.1; // Push out slightly

        // Initial Position
        pineappleGroup.position.set(4, -1, 0);
        pineappleGroup.rotation.y = -0.5;


        // --- Math Particles ---
        const particleGroup = new THREE.Group();
        scene.add(particleGroup);
        const pGeos = [
            new THREE.TetrahedronGeometry(0.4),
            new THREE.BoxGeometry(0.4, 0.4, 0.4),
            new THREE.OctahedronGeometry(0.4)
        ];
        const particles = [];
        for(let i=0; i<50; i++){
            const mesh = new THREE.Mesh(
                pGeos[Math.floor(Math.random()*pGeos.length)],
                new THREE.MeshStandardMaterial({ color: config.colors.particles[i%4], flatShading: true })
            );
            mesh.position.set((Math.random()-0.5)*30, (Math.random()-0.5)*30, (Math.random()-0.5)*10 - 5);
            mesh.userData = { vel: { x: (Math.random()-0.5)*0.03, y: (Math.random()-0.5)*0.03 } };
            particleGroup.add(mesh);
            particles.push(mesh);
        }

        // --- Animations Loop ---
        const clock = new THREE.Clock();
        function animate() {
            requestAnimationFrame(animate);
            const t = clock.getElapsedTime();

            // Pineapple Idle
            pineappleGroup.position.y += Math.sin(t*2)*0.005;
            pineappleGroup.scale.y = 1 + Math.sin(t*3)*0.02;

            // Particles
            particles.forEach(p => {
                p.rotation.x += 0.02; p.rotation.y += 0.02;
                p.position.x += p.userData.vel.x;
                p.position.y += p.userData.vel.y;
                if(p.position.y > 15) p.position.y = -15;
                if(p.position.y < -15) p.position.y = 15;
                if(p.position.x > 25) p.position.x = -25;
                if(p.position.x < -25) p.position.x = 25;
            });

            renderer.render(scene, camera);
        }
        animate();

        // --- Resize ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- GSAP Scrollytelling Logic ---
        gsap.registerPlugin(ScrollTrigger);

        // 1. Page Flip Logic
        // We want to flip pages as we scroll down.
        // There are 5 pages. We scroll 500vh.

        const pages = gsap.utils.toArray('.page');

        // We pin the book stage for the entire duration
        ScrollTrigger.create({
            trigger: "#book-viewport",
            start: "top top",
            end: "bottom bottom",
            scrub: 1, // Smooth scrubbing
            onUpdate: (self) => {
                // Determine which page we are on based on progress
                // 0 - 0.25: Page 1 -> 2
                // 0.25 - 0.5: Page 2 -> 3
                // 0.5 - 0.75: Page 3 -> 4
                // 0.75 - 1.0: Page 4 -> 5

                const p = self.progress;

                // Rotation Logic:
                // Page 1 rotates from 0 to -180 as p goes 0 -> 0.2
                // Page 2 rotates from 0 to -180 as p goes 0.25 -> 0.45

                // Helper to map range
                const flip = (start, end, val) => {
                    let norm = (val - start) / (end - start);
                    if (norm < 0) norm = 0;
                    if (norm > 1) norm = 1;
                    return -180 * norm;
                };

                // Apply rotations
                // Note: Page 5 never flips, it's the back cover.

                gsap.set("#page-1", { rotationY: flip(0.0, 0.2, p) });
                gsap.set("#page-2", { rotationY: flip(0.25, 0.45, p) });
                gsap.set("#page-3", { rotationY: flip(0.5, 0.7, p) });
                gsap.set("#page-4", { rotationY: flip(0.75, 0.95, p) });

                // 2. Three.js Choreography based on same progress
                // Page 1 (0-0.2): Pineapple on Right
                // Page 2 (0.2-0.5): Pineapple jumps to Left (to look at text on right)
                // Page 3 (0.5-0.75): Pineapple Center? Or gone?

                if (p < 0.1) {
                    // Start
                    gsap.to(pineappleGroup.position, { x: 4, y: -1, z: 0, duration: 0.5, overwrite: true });
                    gsap.to(pineappleGroup.rotation, { y: -0.5, duration: 0.5 });
                } else if (p > 0.15 && p < 0.35) {
                    // P2: Avatar is on Left, Text on Right. Pineapple should be... maybe behind?
                    // Let's put pineapple on top right floating
                    gsap.to(pineappleGroup.position, { x: 5, y: 3, z: -2, duration: 0.5, overwrite: true });
                    gsap.to(pineappleGroup.rotation, { y: -0.8, duration: 0.5 });
                } else if (p > 0.4 && p < 0.6) {
                    // P3: Center text. Pineapple peeking from bottom
                    gsap.to(pineappleGroup.position, { x: 0, y: -4, z: 2, duration: 0.5, overwrite: true });
                    gsap.to(pineappleGroup.rotation, { y: 0, duration: 0.5 });
                } else if (p > 0.65 && p < 0.85) {
                    // P4: Math. Pineapple Right, big.
                    gsap.to(pineappleGroup.position, { x: 5, y: 0, z: 2, duration: 0.5, overwrite: true });
                } else if (p > 0.9) {
                    // P5: Gallery. Pineapple Left corner
                    gsap.to(pineappleGroup.position, { x: -6, y: -3, z: 0, duration: 0.5, overwrite: true });
                }
            }
        });

        // Hide loader
        window.addEventListener('load', () => {
            gsap.to("#loader", { opacity: 0, duration: 0.5, onComplete: () => document.getElementById("loader").remove() });
        });

    </script>
</body>
</html>
