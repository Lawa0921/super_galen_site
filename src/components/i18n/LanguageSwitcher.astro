---
/**
 * LanguageSwitcher.astro
 * èªè¨€åˆ‡æ›å™¨çµ„ä»¶ - å…è¨±ç”¨æˆ¶åœ¨ä¸åŒèªè¨€ç‰ˆæœ¬ä¹‹é–“åˆ‡æ›
 */
import { languages, type Language, getLocalizedPath } from '@i18n/index';

interface Props {
  currentLang: Language;
  currentPath?: string;
}

const { currentLang, currentPath = '/' } = Astro.props;

// å–å¾—ç•¶å‰è·¯å¾‘ï¼ˆä¸å«èªè¨€å‰ç¶´ï¼‰
// åªåŒ¹é…å¯¦éš›çš„èªè¨€ä»£ç¢¼ï¼šzh-TW, zh-CN, en, ja, ko
const langCodes = Object.keys(languages).join('|');
const langPrefixRegex = new RegExp(`^\\/(${langCodes})(\\/|$)`);
const pathWithoutLang = currentPath.replace(langPrefixRegex, '/');

// èªè¨€å°æ‡‰çš„åœ‹æ—— emoji
const flags: Record<string, string> = {
  'zh-TW': 'ğŸ‡¹ğŸ‡¼',
  'zh-CN': 'ğŸ‡¨ğŸ‡³',
  'en': 'ğŸ‡ºğŸ‡¸',
  'ja': 'ğŸ‡¯ğŸ‡µ',
  'ko': 'ğŸ‡°ğŸ‡·',
};
---

<div class="language-switcher" id="language-switcher">
  <button class="language-current" id="language-current" aria-label="é¸æ“‡èªè¨€">
    <i class="fas fa-globe"></i>
    <span class="language-name" id="current-language-name">{languages[currentLang]}</span>
    <i class="fas fa-chevron-down"></i>
  </button>
  <div class="language-dropdown" id="language-dropdown">
    {Object.entries(languages).map(([code, name]) => (
      <a
        href={getLocalizedPath(pathWithoutLang, code as Language)}
        class:list={['language-option', { active: code === currentLang }]}
        hreflang={code}
        data-lang={code}
      >
        <span class="lang-flag">{flags[code] || 'ğŸŒ'}</span>
        <span class="lang-name">{name}</span>
      </a>
    ))}
  </div>
</div>

<!-- èªè¨€åˆ‡æ›å™¨äº’å‹•ç”± i18n-manager.js è™•ç†ï¼Œèˆ‡ Jekyll ä¿æŒä¸€è‡´ -->
<!-- ä½¿ç”¨å…¨å±€ _language-switcher.scss æ¨£å¼ -->
