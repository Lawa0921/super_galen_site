---
/**
 * NewsletterSubscribe.astro
 * RPG é¢¨æ ¼é›»å­å ±è¨‚é–±çµ„ä»¶ - å«æµ®å‹•æŒ‰éˆ•å’Œæ¨¡æ…‹æ¡†
 */
import { type Language, useTranslations } from '@i18n/index';

interface Props {
  lang: Language;
}

const { lang } = Astro.props;
const { all: trans } = useTranslations(lang);
---

<!-- ===== RPG é¢¨æ ¼ FollowIt è¨‚é–±æ¨¡çµ„ ===== -->
<div class="newsletter-container rpg-style" id="newsletterContainer">
  <!-- è¨‚é–±æ²è»¸è§¸ç™¼æŒ‰éˆ• -->
  <button class="newsletter-scroll-button" id="newsletterToggle" aria-label="è¨‚é–±é›»å­å ±">
    <!-- å¤§é ­è²¼èƒŒæ™¯åœ–ç”± CSS è™•ç† -->
  </button>

  <!-- è¨‚é–±è¡¨å–®æ¨¡æ…‹æ¡† -->
  <div class="newsletter-modal" id="newsletterModal">
    <div class="modal-backdrop" id="newsletterBackdrop"></div>

    <div class="modal-content rpg-panel">
      <!-- é—œé–‰æŒ‰éˆ• -->
      <button class="close-button" id="closeNewsletter" aria-label="é—œé–‰">
        Ã—
      </button>

      <!-- æ¨™é¡Œå€ -->
      <div class="modal-header">
        <h2 class="modal-title" data-i18n="newsletter.title">
          ğŸ“œ è¨‚é–±å†’éšªæ—¥èªŒ
        </h2>
      </div>

      <!-- æè¿°å€ -->
      <div class="modal-description">
        <p data-i18n="newsletter.description">
          åŠ å…¥å†’éšªè€…è¡Œåˆ—ï¼Œæ¥æ”¶æœ€æ–°çš„æŠ€è¡“æ–‡ç« ã€å€å¡Šéˆè¦‹è§£å’Œ RPG éŠæˆ²æ›´æ–°ï¼
        </p>
        <ul class="benefits-list">
          <li data-i18n="newsletter.benefit_1">âš”ï¸ æ¯é€±ç²¾é¸æŠ€è¡“æ–‡ç« </li>
          <li data-i18n="newsletter.benefit_2">ğŸ¯ ç¨å®¶ Web3 é–‹ç™¼æ•™å­¸</li>
          <li data-i18n="newsletter.benefit_3">ğŸ® éŠæˆ²åŒ–å­¸ç¿’æŒ‘æˆ°</li>
          <li data-i18n="newsletter.benefit_4">ğŸ† æ¶å…ˆé«”é©—æ–°åŠŸèƒ½</li>
        </ul>
      </div>

      <!-- FollowIt è¡¨å–®å®¹å™¨ -->
      <div class="newsletter-form-container">
        <div class="followit--follow-form-container" attr-a attr-b attr-c attr-d attr-e attr-f>
          <form
            action="https://api.follow.it/subscription-form/UGNmLzVxMUk2YjhtVWxPV0N1VWJRa1BNMTRRb21sQmlvRHA0MXdtT3RvQUk3VTljREdKVVh3ckE1QS83ZDlCM1dobzl1eUk0UFArTDVOUFNGTjhVL3h5M21sbzkxa0djNkJ0YXlybVV5cVQ1MkU4RDY4UzMyQjl3a3BPbTNhZWt8ZmRJMEN4ckZFV1NIZFVocW5OVU03SCt6cGVEWFFvM2FscnVyRS9GMjQ0Yz0=/8"
            method="post"
            class="rpg-newsletter-form"
            id="followitForm"
            target="_blank"
          >
            <!-- è‡ªè¨‚ RPG é¢¨æ ¼è¡¨å–® -->
            <div class="form-group">
              <label for="newsletter-email" class="form-label">
                <span data-i18n="newsletter.email_label">é›»å­éƒµä»¶</span>
                <span class="required-mark">*</span>
              </label>
              <input
                type="email"
                name="email"
                id="newsletter-email"
                class="form-input rpg-input"
                placeholder="your@email.com"
                required
                aria-required="true"
              />
            </div>

            <button type="submit" class="submit-button rpg-button">
              <span data-i18n="newsletter.submit_button">åŠ å…¥å†’éšª</span>
            </button>

            <div class="form-message" id="formMessage" role="alert" aria-live="polite"></div>
          </form>

          <a href="https://follow.it" class="powered-by-line" target="_blank" rel="noopener noreferrer">
            Powered by <img src="https://follow.it/images/colored-logo.svg" alt="follow.it" height="17px"/>
          </a>
        </div>
      </div>

      <!-- éš±ç§è²æ˜ -->
      <div class="privacy-notice">
        <p data-i18n="newsletter.privacy_notice">
          ğŸ”’ æˆ‘å€‘å°Šé‡ä½ çš„éš±ç§ï¼Œçµ•ä¸æœƒåˆ†äº«ä½ çš„é›»å­éƒµä»¶ã€‚éš¨æ™‚å¯ä»¥å–æ¶ˆè¨‚é–±ã€‚
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  // Newsletter æ¨¡æ…‹æ¡†æ§åˆ¶
  document.addEventListener('DOMContentLoaded', function() {
    const newsletterToggle = document.getElementById('newsletterToggle');
    const newsletterModal = document.getElementById('newsletterModal');
    const newsletterBackdrop = document.getElementById('newsletterBackdrop');
    const closeNewsletter = document.getElementById('closeNewsletter');
    const followitForm = document.getElementById('followitForm');
    const formMessage = document.getElementById('formMessage');

    // é–‹å•Ÿæ¨¡æ…‹æ¡†
    function openNewsletterModal() {
      newsletterModal?.classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    // é—œé–‰æ¨¡æ…‹æ¡†
    function closeNewsletterModal() {
      newsletterModal?.classList.remove('show');
      document.body.style.overflow = '';
    }

    // äº‹ä»¶ç›£è½å™¨
    newsletterToggle?.addEventListener('click', openNewsletterModal);
    closeNewsletter?.addEventListener('click', closeNewsletterModal);
    newsletterBackdrop?.addEventListener('click', closeNewsletterModal);

    // ESC éµé—œé–‰
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && newsletterModal?.classList.contains('show')) {
        closeNewsletterModal();
      }
    });

    // è¡¨å–®æäº¤è™•ç†
    followitForm?.addEventListener('submit', function(e) {
      setTimeout(function() {
        if (formMessage) {
          formMessage.textContent = 'âœ… å·²åœ¨æ–°åˆ†é é–‹å•Ÿè¨‚é–±é é¢ï¼Œè«‹å®Œæˆç¢ºèªï¼';
          formMessage.classList.add('success');
          formMessage.style.display = 'block';

          setTimeout(function() {
            formMessage.style.display = 'none';
            formMessage.classList.remove('success');
            followitForm.reset();
          }, 5000);
        }
      }, 300);
    });
  });
</script>

<!-- æ¨£å¼ç”±å…¨å±€ _newsletter.scss æä¾› -->
