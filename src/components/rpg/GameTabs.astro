---
/**
 * GameTabs.astro
 * RPG 遊戲頁籤導航
 */
import { type Language, useTranslations } from '@i18n/index';

interface Props {
  lang: Language;
  activeTab?: string;
}

const { lang, activeTab = 'status' } = Astro.props;
const { all: trans } = useTranslations(lang);

const tabs = [
  { id: 'status', icon: 'fa-user', label: trans.navigation?.status || '狀態' },
  { id: 'skills', icon: 'fa-code', label: trans.navigation?.skills || '技能' },
  { id: 'story', icon: 'fa-book', label: trans.navigation?.story || '故事' },
  { id: 'inventory', icon: 'fa-briefcase', label: trans.navigation?.inventory || '物品' },
  { id: 'achievements', icon: 'fa-trophy', label: trans.navigation?.achievements || '成就' },
  { id: 'party', icon: 'fa-users', label: trans.navigation?.party || '夥伴' },
  { id: 'purchase', icon: 'fa-shopping-cart', label: trans.navigation?.purchase || '購買' },
];

// 外部連結頁籤
const externalTabs = [
  { href: `/${lang}/guild/`, icon: 'fa-shield-alt', label: trans.navigation?.guild || '公會' },
  { href: `/${lang}/blog/`, icon: 'fa-book-open', label: trans.navigation?.journal || '日誌' },
];
---

<nav class="game-tabs">
  {tabs.map((tab) => (
    <button
      class:list={['tab-btn', { active: tab.id === activeTab }]}
      data-tab={tab.id}
      type="button"
    >
      <i class={`fas ${tab.icon}`}></i>
      <span class="tab-name">{tab.label}</span>
    </button>
  ))}

  {externalTabs.map((tab) => (
    <a href={tab.href} class="tab-btn external-link">
      <i class={`fas ${tab.icon}`}></i>
      <span class="tab-name">{tab.label}</span>
    </a>
  ))}
</nav>

<script>
  // Tab 切換邏輯
  document.addEventListener('DOMContentLoaded', () => {
    const tabButtons = document.querySelectorAll('.tab-btn[data-tab]');
    const tabPanels = document.querySelectorAll('.tab-panel');

    tabButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const tabId = btn.getAttribute('data-tab');
        if (!tabId) return;

        // 更新按鈕狀態
        tabButtons.forEach((b) => b.classList.remove('active'));
        btn.classList.add('active');

        // 更新面板顯示
        tabPanels.forEach((panel) => {
          if (panel.id === `${tabId}-tab`) {
            panel.classList.add('active');
          } else {
            panel.classList.remove('active');
          }
        });

        // 觸發自定義事件（供其他模組使用）
        document.dispatchEvent(
          new CustomEvent('tabChanged', {
            detail: { tabId },
          })
        );
      });
    });
  });
</script>

<style>
  .game-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    padding: 0.5rem 1rem;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 215, 0, 0.3);
  }

  .tab-btn {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.6rem 1rem;
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 4px 4px 0 0;
    color: #888;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s ease;
    text-decoration: none;
  }

  .tab-btn:hover {
    background: rgba(255, 215, 0, 0.1);
    color: #ffd700;
    border-color: rgba(255, 215, 0, 0.4);
  }

  .tab-btn.active {
    background: rgba(255, 215, 0, 0.15);
    color: #ffd700;
    border-color: #ffd700;
    border-bottom-color: transparent;
  }

  .tab-btn i {
    font-size: 0.9rem;
  }

  .tab-name {
    white-space: nowrap;
  }

  .external-link {
    margin-left: auto;
    border-color: rgba(100, 149, 237, 0.3);
    color: #6495ed;
  }

  .external-link:hover {
    border-color: #6495ed;
    background: rgba(100, 149, 237, 0.1);
  }

  @media (max-width: 768px) {
    .game-tabs {
      padding: 0.5rem;
      justify-content: center;
    }

    .tab-btn {
      padding: 0.5rem 0.75rem;
      font-size: 0.8rem;
    }

    .tab-name {
      display: none;
    }

    .tab-btn i {
      font-size: 1rem;
    }

    .external-link {
      margin-left: 0;
    }
  }
</style>
