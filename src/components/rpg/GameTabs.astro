---
/**
 * GameTabs.astro
 * RPG 遊戲頁籤導航
 */
import { type Language, useTranslations } from '@i18n/index';

interface Props {
  lang: Language;
  activeTab?: string;
}

const { lang, activeTab = 'status' } = Astro.props;
const { all: trans } = useTranslations(lang);

const tabs = [
  { id: 'status', icon: 'fa-user', label: trans.navigation?.status || '狀態' },
  { id: 'skills', icon: 'fa-code', label: trans.navigation?.skills || '技能' },
  { id: 'story', icon: 'fa-book', label: trans.navigation?.story || '故事' },
  { id: 'inventory', icon: 'fa-briefcase', label: trans.navigation?.inventory || '物品' },
  { id: 'achievements', icon: 'fa-trophy', label: trans.navigation?.achievements || '成就' },
  { id: 'party', icon: 'fa-users', label: trans.navigation?.party || '夥伴' },
  { id: 'purchase', icon: 'fa-shopping-cart', label: trans.navigation?.purchase || '購買' },
];

// 外部連結頁籤
const externalTabs = [
  { href: `/${lang}/guild/`, icon: 'fa-shield-alt', label: trans.navigation?.guild || '公會' },
  { href: `/${lang}/blog/`, icon: 'fa-book-open', label: trans.navigation?.journal || '日誌' },
];
---

<nav class="game-tabs">
  {tabs.map((tab) => (
    <button
      class:list={['tab-btn', { active: tab.id === activeTab }]}
      data-tab={tab.id}
      type="button"
    >
      <i class={`fas ${tab.icon}`}></i>
      <span class="tab-name">{tab.label}</span>
    </button>
  ))}

  {externalTabs.map((tab) => (
    <a href={tab.href} class="tab-btn external-link">
      <i class={`fas ${tab.icon}`}></i>
      <span class="tab-name">{tab.label}</span>
    </a>
  ))}
</nav>

<script>
  // Tab 切換邏輯
  document.addEventListener('DOMContentLoaded', () => {
    const tabButtons = document.querySelectorAll('.tab-btn[data-tab]');
    const tabPanels = document.querySelectorAll('.tab-panel');

    tabButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const tabId = btn.getAttribute('data-tab');
        if (!tabId) return;

        // 更新按鈕狀態
        tabButtons.forEach((b) => b.classList.remove('active'));
        btn.classList.add('active');

        // 更新面板顯示
        tabPanels.forEach((panel) => {
          if (panel.id === `${tabId}-tab`) {
            panel.classList.add('active');
          } else {
            panel.classList.remove('active');
          }
        });

        // 觸發自定義事件（供其他模組使用）
        document.dispatchEvent(
          new CustomEvent('tabChanged', {
            detail: { tabId },
          })
        );
      });
    });
  });
</script>

<!-- 樣式由全局 _game-tabs.scss 提供，使用 3x3 網格布局 -->
