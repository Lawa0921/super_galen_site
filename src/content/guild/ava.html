<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>房產小蜜 Ava | The Visual Storyteller</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&family=Orbitron:wght@400;700;900&family=Caveat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
    <script>
        gsap.registerPlugin(ScrollTrigger);
    </script>

    <style>
        :root {
            --c-bg: #F5E6CA; /* Warm Beige */
            --c-text: #3E3E3E; /* Dark Grey */
            --c-accent: #FFD700; /* Goose Yellow / Gold */
            --c-highlight: #8B0000; /* Wine Red */
            --c-white: #ffffff;

            --f-serif: 'Noto Serif TC', serif;
            --f-tech: 'Orbitron', sans-serif;
            --f-hand: 'Caveat', cursive;
        }

        body {
            margin: 0;
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: var(--f-serif);
            overflow-x: hidden;
            cursor: none; /* Custom cursor */
        }

        /* --- Loader --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: var(--c-bg); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--c-highlight);
        }
        .loader-text {
            font-family: var(--f-tech); font-size: 1.5rem; letter-spacing: 2px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        /* --- Canvas Layers --- */
        #webgl-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0; }
        #p5-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 100; pointer-events: none; mix-blend-mode: multiply; }

        /* --- Custom Cursor --- */
        #cursor-follower {
            position: fixed; top: 0; left: 0; width: 60px; height: 60px;
            border: 2px solid var(--c-highlight); border-radius: 50%;
            pointer-events: none; z-index: 10001; transform: translate(-50%, -50%);
            transition: width 0.2s, height 0.2s, border-color 0.2s;
            mix-blend-mode: difference;
            display: flex; align-items: center; justify-content: center;
        }
        #cursor-follower::after {
            content: ''; width: 100%; height: 1px; background: var(--c-highlight); position: absolute;
        }
        #cursor-follower::before {
            content: ''; height: 100%; width: 1px; background: var(--c-highlight); position: absolute;
        }
        #cursor-dot {
            position: fixed; top: 0; left: 0; width: 6px; height: 6px;
            background: var(--c-accent); border-radius: 50%;
            pointer-events: none; z-index: 10002; transform: translate(-50%, -50%);
        }

        /* --- UI Elements --- */
        .back-btn {
            position: fixed; top: 20px; left: 20px; z-index: 101;
            color: var(--c-text); text-decoration: none; font-family: var(--f-tech);
            font-size: 0.9rem; border: 1px solid var(--c-text); padding: 5px 15px;
            background: rgba(245, 230, 202, 0.8); backdrop-filter: blur(5px);
            transition: 0.3s;
        }
        .back-btn:hover {
            background: var(--c-highlight); color: var(--c-bg); border-color: var(--c-highlight);
        }

        /* --- Layout --- */
        .scroller { position: relative; z-index: 10; height: 800vh; /* Long scroll for story */ }

        /* Sections are fixed/sticky overlays that fade in/out */
        .story-section {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100vh;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            pointer-events: none; opacity: 0;
            padding: 2rem; box-sizing: border-box;
            /* text-shadow removed for clean look */
        }

        .story-content {
            background: rgba(255, 255, 255, 0.85); /* Light glass */
            backdrop-filter: blur(8px);
            padding: 2.5rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.5);
            max-width: 600px;
            text-align: center;
            transform: translateY(30px);
            pointer-events: auto; /* Allow interaction with links/text */
        }

        h1 {
            font-family: var(--f-serif); font-size: clamp(3rem, 6vw, 5rem);
            color: var(--c-highlight); margin: 0 0 1rem; line-height: 1.1;
        }
        h2 {
            font-family: var(--f-tech); font-size: 1.2rem; color: #666;
            margin: 0 0 2rem; letter-spacing: 3px; text-transform: uppercase;
        }
        h3 {
            font-family: var(--f-serif); font-size: 2rem; color: var(--c-highlight);
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--c-accent);
            display: inline-block;
            padding-bottom: 0.5rem;
        }
        p {
            font-size: 1.1rem; line-height: 1.8; color: var(--c-text); margin-bottom: 1.5rem;
            text-align: justify;
        }

        .highlight { color: var(--c-highlight); font-weight: bold; background: rgba(255, 215, 0, 0.2); padding: 0 5px; }

        /* Section Specific Styles */
        .hero-title { font-size: clamp(4rem, 8vw, 6rem); color: var(--c-highlight); opacity: 1; }

        .polaroid-stack {
            display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;
        }
        .polaroid {
            background: white; padding: 10px 10px 40px 10px;
            color: #333; font-family: var(--f-hand); font-size: 1.2rem;
            transform: rotate(-5deg); transition: transform 0.3s;
            width: 150px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .polaroid:hover { transform: scale(1.1) rotate(0deg); z-index: 10; }
        .polaroid-img { width: 100%; height: 150px; background: #eee; object-fit: cover; }

        .gear-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem; margin-top: 2rem; width: 100%;
        }
        .gear-item {
            border: 1px dashed var(--c-text); padding: 1rem; text-align: center;
            transition: 0.3s; background: rgba(255,255,255,0.5);
        }
        .gear-item:hover { background: var(--c-white); border-color: var(--c-highlight); border-style: solid; transform: translateY(-5px); }
        .gear-icon { font-size: 2rem; margin-bottom: 0.5rem; color: var(--c-highlight); }

        /* Blur Text Effect Class */
        .blur-in { filter: blur(10px); opacity: 0; transition: filter 1s, opacity 1s; }
        .blur-in.active { filter: blur(0); opacity: 1; }

        .footer-links {
            display: flex; gap: 2rem; justify-content: center; margin-top: 2rem;
        }
        .footer-link {
            font-size: 2rem; color: var(--c-highlight); transition: 0.3s;
        }
        .footer-link:hover { transform: scale(1.2); color: var(--c-accent); }

    </style>
</head>
<body>

    <div id="loader">
        <div class="loader-text">WARMING UP LENS...</div>
    </div>

    <!-- Custom Cursor -->
    <div id="cursor-follower"></div>
    <div id="cursor-dot"></div>

    <a href="/guild" class="back-btn"><i class="fa-solid fa-arrow-left"></i> Guild Hall</a>

    <div id="webgl-container"></div>
    <div id="p5-container"></div>

    <!-- Scroll Container -->
    <div class="scroller"></div>

    <!-- Fixed Sections (Revealed by Scroll Progress) -->

    <!-- 1. Hero -->
    <section class="story-section" id="sec-hero">
        <div class="story-content" style="background: transparent; border: none; backdrop-filter: none; box-shadow: none;">
            <div style="width: 150px; height: 150px; margin: 0 auto 2rem; border-radius: 50%; overflow: hidden; border: 4px solid var(--c-highlight); box-shadow: 0 0 20px rgba(139,0,0,0.2);">
                <img src="/assets/img/guild/ava/avatar.webp" style="width:100%; height:100%; object-fit:cover;">
            </div>
            <h1 class="hero-title blur-in">AVA</h1>
            <h2 class="blur-in" style="transition-delay: 0.2s">The Storyteller's Lens</h2>
            <p class="blur-in" style="transition-delay: 0.4s; text-align: center; font-style: italic; color: #555;">"Capturing the Soul of Space with Warmth"</p>
        </div>
    </section>

    <!-- 2. The Past (Biker) -->
    <section class="story-section" id="sec-biker">
        <div class="story-content blur-in">
            <h3><i class="fa-solid fa-motorcycle"></i> Chasing Horizons</h3>
            <p>
                7 years of administrative precision, but a lifetime of adventure.
                I used to be a <span class="highlight">Heavy Bike Rider</span>, leading groups into the unknown at 100km/h.
            </p>
            <p>
                From running a beverage shop to managing a B&B, I've lived many lives.
                Back then, I saw the world in a blur of speed and freedom. But the passion remains.
            </p>
        </div>
    </section>

    <!-- 3. The Pivot (Micro-Travel) -->
    <section class="story-section" id="sec-travel">
        <div class="story-content blur-in">
            <h3><i class="fa-solid fa-map-location-dot"></i> Micro-Travels</h3>
            <p>
                Motherhood changed my speed, not my spirit. Now, I explore with my "crew" (my two kids).
                We wear Bluetooth headsets, riding through Tanaka's alleys.
            </p>
            <p>
                "Mom, look!" — Their perspective became my new map. We find the stories others miss in the slow lane.
            </p>
            <div class="polaroid-stack">
                <div class="polaroid">
                    <img src="/assets/img/guild/ava/avatar.webp" class="polaroid-img" style="filter: sepia(0.3) contrast(1.1);">
                    <div>Little Crew</div>
                </div>
                <div class="polaroid">
                    <div class="polaroid-img" style="display:flex;align-items:center;justify-content:center;font-size:2rem;color:#ccc;"><i class="fa-solid fa-ice-cream" style="color:pink"></i></div>
                    <div>Sweet Stops</div>
                </div>
            </div>
        </div>
    </section>

    <!-- 4. The Profession (Real Estate) -->
    <section class="story-section" id="sec-work">
        <div class="story-content blur-in">
            <h3><i class="fa-solid fa-camera-retro"></i> Framing Value</h3>
            <p>
                I don't just list properties; I tell their stories.
                Specializing in <span class="highlight">Tanaka & High Speed Rail Zone</span>, I use video to let the property speak.
            </p>
            <p>
                It's not about big production; it's about <span class="highlight">Temperature</span>.
                A warm corner, a sunlit window — I capture the feeling of "Home".
            </p>
        </div>
    </section>

    <!-- 5. The Toolkit & Contact -->
    <section class="story-section" id="sec-contact">
        <div class="story-content blur-in">
            <h3>My Toolkit</h3>
            <div class="gear-grid">
                <div class="gear-item">
                    <div class="gear-icon"><i class="fa-solid fa-mobile-screen"></i></div>
                    <div>Mobile Video</div>
                    <div style="font-size:0.8rem; opacity:0.7">Authentic Feel</div>
                </div>
                <div class="gear-item">
                    <div class="gear-icon"><i class="fa-solid fa-plane-up"></i></div>
                    <div>Aerial Drone</div>
                    <div style="font-size:0.8rem; opacity:0.7">God's Eye View</div>
                </div>
                <div class="gear-item">
                    <div class="gear-icon"><i class="fa-regular fa-file-lines"></i></div>
                    <div>Admin Magic</div>
                    <div style="font-size:0.8rem; opacity:0.7">Precision</div>
                </div>
            </div>

            <div style="margin-top: 3rem;">
                <h2>Let's Frame It</h2>
                <div class="footer-links">
                    <a href="https://www.threads.net/@ava332266" target="_blank" class="footer-link"><i class="fa-brands fa-threads"></i></a>
                    <a href="https://www.instagram.com/chhsr_bee" target="_blank" class="footer-link"><i class="fa-brands fa-instagram"></i></a>
                </div>
                <p style="margin-top: 1rem; opacity: 0.5; font-size: 0.8rem;">Made by SuperGalen's Dungeon</p>
            </div>
        </div>
    </section>

    <!-- P5.js Overlay (Focus Peaking) -->
    <script>
        const sketch = (p) => {
            p.setup = () => {
                const canvas = p.createCanvas(p.windowWidth, p.windowHeight);
                canvas.parent('p5-container');
                p.noCursor();
            };

            p.draw = () => {
                p.clear();

                // Remove Grain - Keeping it clean for light theme

                // Focus Peaking Effect (Wine Red outline around mouse)
                p.noFill();
                p.stroke(139, 0, 0, 150); // Wine Red
                p.strokeWeight(2);

                // Draw a "Focus Zone" around cursor
                const mx = p.mouseX;
                const my = p.mouseY;
                const s = 80;

                // Animated broken brackets
                const t = p.millis() * 0.002;
                const offset = p.map(p.sin(t), -1, 1, 0, 10);

                p.arc(mx, my, s, s, -p.PI/4 + offset*0.01, p.PI/4 - offset*0.01);
                p.arc(mx, my, s, s, p.PI*3/4 + offset*0.01, p.PI*5/4 - offset*0.01);

                // Center point
                p.fill(139, 0, 0);
                p.circle(mx, my, 4);

                // Add "REC" indicator in corner occasionally blinking
                if (Math.floor(p.millis() / 1000) % 2 === 0) {
                    p.fill(255, 0, 0);
                    p.circle(30, 30, 10);
                    p.fill(50);
                    p.noStroke();
                    p.textSize(12);
                    p.text("REC", 45, 34);
                }
            };

            // Global click listener for flash effect
            p.setup = () => {
                const canvas = p.createCanvas(p.windowWidth, p.windowHeight);
                canvas.parent('p5-container');
                p.noCursor();

                window.addEventListener('click', () => {
                    // Flash effect
                    const flash = document.createElement('div');
                    flash.style.position = 'fixed';
                    flash.style.top = '0'; flash.style.left = '0';
                    flash.style.width = '100vw'; flash.style.height = '100vh';
                    flash.style.background = 'white';
                    flash.style.zIndex = '99999';
                    flash.style.pointerEvents = 'none';
                    document.body.appendChild(flash);

                    gsap.to(flash, { opacity: 0, duration: 0.5, onComplete: () => flash.remove() });
                });
            };

            p.windowResized = () => {
                p.resizeCanvas(p.windowWidth, p.windowHeight);
            };
        };
        new p5(sketch);
    </script>

    <!-- Three.js Background -->
    <script type="module">
        import * as THREE from 'three';

        // --- Setup ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        // Warm/Beige Fog
        scene.fog = new THREE.FogExp2(0xF5E6CA, 0.03);
        scene.background = new THREE.Color(0xF5E6CA);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- Helper: Create Text Texture (Light Mode) ---
        function createTextTexture(text, bgColor) {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 512;
            const ctx = canvas.getContext('2d');

            // Background - Polaroids style (White with shadow/border)
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, 512, 512);

            // Inner color box
            ctx.fillStyle = bgColor; // Pastel color
            ctx.fillRect(40, 40, 432, 350); // Photo area

            // Border (simulating frame)
            ctx.strokeStyle = '#eee';
            ctx.lineWidth = 10;
            ctx.strokeRect(0, 0, 512, 512);

            // Text
            ctx.fillStyle = '#333';
            ctx.font = 'bold 60px sans-serif'; // Noto Serif fallback
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            // Text below the "photo"
            ctx.fillText(text, 256, 450);

            const texture = new THREE.CanvasTexture(canvas);
            return texture;
        }

        // --- Objects ---

        // 1. The Film Ribbon (CatmullRomCurve)
        const curvePoints = [];
        // Create a spiral/rollercoaster path
        for (let i = 0; i < 50; i++) {
            const angle = i * 0.5;
            const radius = 8 + Math.sin(i * 0.3) * 4; // Wider radius for airy feel
            const height = -i * 2.5; // Going down/forward

            curvePoints.push(new THREE.Vector3(
                Math.cos(angle) * radius,
                Math.sin(angle) * radius,
                -i * 5
            ));
        }
        const curve = new THREE.CatmullRomCurve3(curvePoints);

        // Tube Geometry for the ribbon
        const tubeGeo = new THREE.TubeGeometry(curve, 200, 0.5, 4, false); // Thinner line
        const tubeMat = new THREE.MeshBasicMaterial({
            color: 0x8B0000, // Wine Red Line
            wireframe: false,
            transparent: true,
            opacity: 0.3
        });
        const ribbon = new THREE.Mesh(tubeGeo, tubeMat);
        scene.add(ribbon);

        // 2. Film Frames (Planes along the curve)
        const framesGroup = new THREE.Group();
        scene.add(framesGroup);

        const frameData = [
            { t: 0.1, text: "BIKER", color: "#FFD700" }, // Gold
            { t: 0.3, text: "SPEED", color: "#8B0000" }, // Red
            { t: 0.5, text: "FAMILY", color: "#F5E6CA" }, // Beige
            { t: 0.7, text: "TRAVEL", color: "#FFD700" }, // Gold
            { t: 0.9, text: "HOME", color: "#8B0000" }  // Red
        ];

        frameData.forEach(data => {
            const geo = new THREE.PlaneGeometry(4, 4); // Square-ish
            const tex = createTextTexture(data.text, data.color);
            const mat = new THREE.MeshBasicMaterial({ map: tex, side: THREE.DoubleSide });
            const mesh = new THREE.Mesh(geo, mat);

            // Position on curve
            const pos = curve.getPoint(data.t);
            const tangent = curve.getTangent(data.t);

            mesh.position.copy(pos);
            mesh.lookAt(pos.clone().add(tangent)); // Face along path
            mesh.rotateY(Math.PI / 2); // Rotate to face side of path (like film strip)

            // Add some random sway/rotation for "floating in wind" feel
            mesh.rotation.z += (Math.random() - 0.5) * 0.5;

            framesGroup.add(mesh);
        });

        // 3. Floating Particles (Sun Motes)
        const particlesCount = 300;
        const pGeo = new THREE.BufferGeometry();
        const pPos = new Float32Array(particlesCount * 3);

        for(let i=0; i<particlesCount; i++) {
            pPos[i*3] = (Math.random() - 0.5) * 60;
            pPos[i*3+1] = (Math.random() - 0.5) * 60;
            pPos[i*3+2] = -Math.random() * 200;
        }
        pGeo.setAttribute('position', new THREE.BufferAttribute(pPos, 3));
        const pMat = new THREE.PointsMaterial({ color: 0xFFD700, size: 0.2, transparent: true, opacity: 0.6 }); // Gold motes
        const particles = new THREE.Points(pGeo, pMat);
        scene.add(particles);

        // --- Animation ---

        function animate() {
            requestAnimationFrame(animate);
            particles.rotation.z += 0.0002;
            // Gentle sway for frames
            framesGroup.children.forEach((f, i) => {
                f.rotation.x += Math.sin(Date.now() * 0.001 + i) * 0.001;
            });
            renderer.render(scene, camera);
        }
        animate();

        // --- Scroll Integration ---
        const scrollProxy = { progress: 0 };

        // Master Timeline linked to scroll
        gsap.to(scrollProxy, {
            progress: 1,
            ease: "none",
            scrollTrigger: {
                trigger: ".scroller",
                start: "top top",
                end: "bottom bottom",
                scrub: 1 // Slower scrub for smoother feel
            },
            onUpdate: () => {
                // Move Camera along curve
                const t = scrollProxy.progress * 0.95;
                const pos = curve.getPoint(t);
                const lookAtPos = curve.getPoint(Math.min(t + 0.05, 1));

                camera.position.copy(pos);
                // Offset camera slightly to "ride" the ribbon
                camera.position.y += 2;
                camera.lookAt(lookAtPos);
            }
        });

        // Section Reveals (Fade In/Blur Out based on scroll position)
        const sections = [
            { id: "#sec-hero", start: 0, end: 0.15 },
            { id: "#sec-biker", start: 0.2, end: 0.35 },
            { id: "#sec-travel", start: 0.4, end: 0.55 },
            { id: "#sec-work", start: 0.6, end: 0.75 },
            { id: "#sec-contact", start: 0.8, end: 1.0 }
        ];

        sections.forEach(sec => {
            const el = document.querySelector(sec.id);
            const content = el.querySelector('.story-content');

            // Fade In
            ScrollTrigger.create({
                trigger: ".scroller",
                start: `${sec.start * 100}% top`,
                end: `${(sec.start + 0.05) * 100}% top`,
                scrub: true,
                onUpdate: (self) => {
                    el.style.opacity = self.progress;
                    // Blur effect
                    if (self.progress > 0.8) {
                        el.querySelectorAll('.blur-in').forEach(b => b.classList.add('active'));
                    } else {
                        el.querySelectorAll('.blur-in').forEach(b => b.classList.remove('active'));
                    }
                }
            });

            // Fade Out
            ScrollTrigger.create({
                trigger: ".scroller",
                start: `${(sec.end - 0.05) * 100}% top`,
                end: `${sec.end * 100}% top`,
                scrub: true,
                onUpdate: (self) => {
                    el.style.opacity = 1 - self.progress;
                }
            });
        });

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Loader
        window.addEventListener('load', () => {
            const loader = document.getElementById('loader');
            gsap.to(loader, {
                opacity: 0,
                duration: 1,
                onComplete: () => loader.remove()
            });
        });

        // Cursor Logic
        const cursorFollower = document.getElementById('cursor-follower');
        const cursorDot = document.getElementById('cursor-dot');

        document.addEventListener('mousemove', (e) => {
            gsap.to(cursorFollower, {
                x: e.clientX,
                y: e.clientY,
                duration: 0.2
            });
            gsap.to(cursorDot, {
                x: e.clientX,
                y: e.clientY,
                duration: 0
            });
        });

    </script>
</body>
</html>