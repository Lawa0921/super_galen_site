<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BÃ¨bÃ¨ Liu | The Adventure Map ğŸ—ºï¸</title>
    <meta name="description" content="BÃ¨bÃ¨ Liu - Illustrator, Designer, & Life Explorer.">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --bg-color: #e0f7fa;
            --text-primary: #263238;
            --text-secondary: #546e7a;
            --accent-color: #ff7043; /* Orange for adventure */
            --glass-panel: rgba(255, 255, 255, 0.9);
            --card-border: rgba(255, 255, 255, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
        }

        /* Canvas */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            background: linear-gradient(to bottom, #81d4fa 0%, #e0f7fa 100%);
        }

        /* Loader */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: 'Fredoka', sans-serif;
        }

        .loader-text {
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .loader-bar {
            width: 200px;
            height: 6px;
            background: #eee;
            border-radius: 3px;
            overflow: hidden;
        }

        .loader-progress {
            width: 0%;
            height: 100%;
            background: var(--accent-color);
            transition: width 0.3s;
        }

        /* Scroll Layout */
        .scroll-wrapper {
            position: relative;
            width: 100%;
            height: 600vh; /* Long scroll journey */
        }

        .section {
            position: absolute;
            width: 100%;
            min-height: 100vh;
            display: flex;
            padding: 2rem;
            pointer-events: none;
            justify-content: center;
            align-items: center;
        }

        /* Section Positioning */
        .section:nth-child(1) { top: 0; }
        .section:nth-child(2) { top: 100vh; justify-content: flex-start; padding-left: 10%; }
        .section:nth-child(3) { top: 200vh; justify-content: flex-end; padding-right: 10%; }
        .section:nth-child(4) { top: 300vh; justify-content: center; } /* Wide card */
        .section:nth-child(5) { top: 400vh; justify-content: flex-start; padding-left: 10%; }
        .section:nth-child(6) { top: 500vh; justify-content: center; padding-bottom: 10vh;}

        /* Cards */
        .card {
            background: var(--glass-panel);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid #fff;
            pointer-events: auto;
            opacity: 0;
            transform: translateY(50px) scale(0.95);
        }

        .card.wide {
            max-width: 800px;
        }

        /* Typography */
        h1 {
            font-family: 'Fredoka', sans-serif;
            font-size: 3rem;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }

        h2 {
            font-family: 'Fredoka', sans-serif;
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        h3 {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.2rem;
            color: #00bcd4;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 0.5rem;
        }

        p {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        /* Avatar */
        .avatar-container {
            width: 180px;
            height: 180px;
            margin: 0 auto 2rem;
            position: relative;
        }

        .avatar-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid #fff;
            box-shadow: 0 8px 20px rgba(255, 112, 67, 0.3);
            position: relative;
            z-index: 2;
        }

        .avatar-blob {
            position: absolute;
            top: -10%;
            left: -10%;
            width: 120%;
            height: 120%;
            background: var(--accent-color);
            border-radius: 50%;
            z-index: 1;
            opacity: 0.3;
            animation: blob-pulse 3s infinite ease-in-out;
        }

        @keyframes blob-pulse {
            0% { transform: scale(1); border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
            50% { transform: scale(1.1); border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; }
            100% { transform: scale(1); border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
        }

        /* Tags */
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .tag {
            background: #e1f5fe;
            color: #0288d1;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .activity-item {
            background: rgba(255,255,255,0.5);
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
        }

        .activity-icon {
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
        }

        /* Socials */
        .social-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .social-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #fff;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .social-btn:hover {
            transform: translateY(-5px) rotate(10deg);
            background: var(--accent-color);
            color: #fff;
        }

        /* Mobile */
        @media (max-width: 768px) {
            h1 { font-size: 2.2rem; }
            .section { padding: 1rem; justify-content: center !important; }
            .card { padding: 1.5rem; max-width: 100%; margin: 0; }
            .grid-2 { grid-template-columns: 1fr; }
        }

        /* HUD */
        .hud {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 10;
            background: rgba(255,255,255,0.8);
            padding: 10px 20px;
            border-radius: 30px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            color: var(--text-primary);
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>

    <div id="loader">
        <div class="loader-text">PACKING GEAR...</div>
        <div class="loader-bar"><div class="loader-progress" id="progress"></div></div>
    </div>

    <div id="canvas-container"></div>

    <div class="hud">
        <i class="fa-solid fa-compass fa-spin" style="--fa-animation-duration: 3s;"></i>
        <span>EXPLORING</span>
    </div>

    <div class="scroll-wrapper">

        <!-- 1. Intro -->
        <div class="section">
            <div class="card" style="text-align: center;">
                <div class="avatar-container">
                    <div class="avatar-blob"></div>
                    <img src="/assets/img/guild/bebe_liu/avatar.jpg" alt="BÃ¨bÃ¨ Liu" class="avatar-img">
                </div>
                <h3>Hello World!</h3>
                <h1>æˆ‘æ˜¯ BÃ¨bÃ¨ Liu</h1>
                <p>è‡ªç”±æ¥æ¡ˆè€… | ç”Ÿæ´»é«”é©—å®¶</p>
                <div class="tags" style="justify-content: center;">
                    <span class="tag">#å¹³é¢è¨­è¨ˆ</span>
                    <span class="tag">#ç¶²é è¨­è¨ˆ</span>
                    <span class="tag">#æ’ç•«</span>
                    <span class="tag">#è‡ªåª’é«”</span>
                </div>
                <p style="font-size: 0.9rem; color: #888;">
                    <i class="fa-solid fa-gamepad"></i> æ­£åœ¨åœ°çƒ Online è³ºå–éŠæˆ²é‡‘å¹£ä¸­ ğŸ’°
                </p>
            </div>
        </div>

        <!-- 2. The Artist -->
        <div class="section">
            <div class="card">
                <h3>The Creator</h3>
                <h2>é—œæ–¼ç•«ç•«èˆ‡å¿ƒæµ</h2>
                <p>
                    å–œæ­¡ç•«ç•«ï¼Œæ›¾è·‘éå°åŒ—å„å¤§å¸‚é›†æ“ºæ”¤ç•«ä¼¼é¡ç¹ªï¼Œä¹Ÿèˆ‰è¾¦éå°å‹çš„ç•«å±•ã€‚
                </p>
                <p>
                    <strong style="color: var(--accent-color);">ã€Œèƒ½è®“äººå»¢å¯¢å¿˜é£Ÿåœ°æŒçºŒåšè‘—ï¼Œå°±æœƒæ˜¯æˆ‘ä¸€ç›´æŒçºŒåšçš„äº‹ã€‚ã€</strong>
                </p>
                <p>
                    ç•«ç•«å¸¶çµ¦æˆ‘çš„å¿ƒæµé«”é©—ï¼Œæ˜¯æ”¯æŒæˆ‘å‰µä½œçš„æœ€å¤§å‹•åŠ›ã€‚é‡è³ªä¸é‡é‡ï¼Œæˆ‘åªæƒ³æŠŠæ¡æ¯ä¸€å€‹ç•¶ä¸‹ï¼Œå‰µé€ å‡ºè®“äººæœƒå¿ƒä¸€ç¬‘çš„ä½œå“ã€‚
                </p>
            </div>
        </div>

        <!-- 3. The Explorer -->
        <div class="section">
            <div class="card">
                <h3>The Adventurer</h3>
                <h2>æ“æŠ±æœªçŸ¥</h2>
                <p>
                    å–œæ­¡å†’éšªèˆ‡æ¢ç´¢ï¼Œå®³æ€•æœªçŸ¥åˆæœŸå¾…å®ƒå¸¶çµ¦æˆ‘çš„é©šå–œï¼Œæˆ‘æƒ³äººç”Ÿä¹Ÿæ˜¯å¦‚æ­¤ã€‚
                </p>
                <p>
                    ç†±æ„›é–±è®€ï¼Œä¹Ÿå–œæ­¡èˆ‡äººæ·±åº¦è«‡è©±ï¼Œå°ä¸–ç•Œæ„Ÿåˆ°å¥½å¥‡ã€‚æ—…è¡Œèƒ½å¸¶çµ¦æˆ‘ç”Ÿå‘½åŠ›ï¼Œè®“æˆ‘ä¸è«–å¹¾æ­²éƒ½èƒ½é–ƒé–ƒç™¼å…‰ âœ¨
                </p>
            </div>
        </div>

        <!-- 4. Outdoors (Grid) -->
        <div class="section">
            <div class="card wide">
                <h3>The Great Outdoors</h3>
                <h2>å±±èˆ‡æµ·çš„å‘¼å–š</h2>
                <p>å–œæ­¡å±±èˆ‡æµ·çš„æˆ¶å¤–æ´»å‹•ï¼Œä¸ç™¼å‹•æ…‹çš„æ—¥å­éƒ½åœ¨å¥½å¥½ç”Ÿæ´»ã€‚</p>
                <div class="grid-2">
                    <div class="activity-item">
                        <div class="activity-icon"><i class="fa-solid fa-mountain"></i></div>
                        <h4>Mountain</h4>
                        <p style="font-size: 0.8rem; margin:0;">çˆ¬å±±ã€éœ²ç‡Ÿã€é‡ç‡Ÿ</p>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon"><i class="fa-solid fa-water"></i></div>
                        <h4>Ocean</h4>
                        <p style="font-size: 0.8rem; margin:0;">SUPã€è¡æµªã€æ½›æ°´</p>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon"><i class="fa-solid fa-camera-retro"></i></div>
                        <h4>Create</h4>
                        <p style="font-size: 0.8rem; margin:0;">æ‹ç…§ã€å‰ªçŸ­å½±éŸ³</p>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon"><i class="fa-solid fa-dog"></i></div>
                        <h4>Life</h4>
                        <p style="font-size: 0.8rem; margin:0;">ç©ç©ç‹—å‹¾ ğŸ¶</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. Philosophy -->
        <div class="section">
            <div class="card">
                <h3>Game of Life</h3>
                <h2>éŠæˆ²äººç”Ÿ</h2>
                <p>
                    ç¹¼çºŒæŠ±æŒè‘—ç†±æƒ…ï¼Œåœ¨åœ°çƒä¸Šå¯¦è¡ŒéŠæˆ²äººç”Ÿã€‚
                </p>
                <p>
                    æˆ‘æ˜¯ä¸€å€‹æ‹ç…§ã€å‰ªç‰‡ã€å¶çˆ¾ç•«ç•«çš„å‰µä½œè€…ã€‚æˆ‘æƒ³æŠŠé€™å€‹ä¸–ç•Œçš„ç¾å¥½ï¼Œé€éæˆ‘çš„çœ¼ç›å’Œæ‰‹ï¼Œå‚³éçµ¦æ¯ä¸€å€‹é‡è¦‹çš„äººã€‚
                </p>
            </div>
        </div>

        <!-- 6. Connect -->
        <div class="section">
            <div class="card" style="text-align: center;">
                <h3>Connect</h3>
                <h2>ä¸€èµ·å†’éšªå§ï¼</h2>
                <p>å¦‚æœä½ ä¹Ÿå–œæ­¡æˆ‘çš„ä½œå“ï¼Œæˆ–è€…æƒ³ä¸€èµ·å»æ¢ç´¢ä¸–ç•Œï¼Œæ­¡è¿è¿½è¹¤æˆ‘ï¼</p>
                <div class="social-links">
                    <a href="https://www.threads.com/@kewpiebay" target="_blank" class="social-btn" title="Threads">
                        <i class="fa-brands fa-threads"></i>
                    </a>
                    <a href="https://www.instagram.com/kewpiebay/" target="_blank" class="social-btn" title="Instagram">
                        <i class="fa-brands fa-instagram"></i>
                    </a>
                </div>
            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { SimplexNoise } from 'three/addons/math/SimplexNoise.js'; // Note: SimplexNoise might not be in standard addons in 0.160, checking docs or using custom implementation.
        // Actually SimplexNoise is often just a separate lib or found in math utils.
        // Let's use basic Math.sin/cos for procedural generation to avoid dependency issues.

        // --- Config ---
        const config = {
            skyColorTop: 0x81d4fa,
            skyColorBottom: 0xe0f7fa,
            mountainColor: 0x8d6e63, // Earthy
            forestColor: 0x66bb6a, // Green
            waterColor: 0x29b6f6, // Blue
            sandColor: 0xffe0b2, // Sand
        };

        // --- Setup ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.Fog(config.skyColorBottom, 20, 100);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- Lights ---
        const hemiLight = new THREE.HemisphereLight(0xffffff, 0xffffff, 0.6);
        scene.add(hemiLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(50, 100, 50);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // --- World Generation ---

        // 1. Path (Curve)
        // We want a path that goes: High Mountain -> Forest Valley -> River -> Ocean Beach
        const points = [
            new THREE.Vector3(0, 30, 0),    // Start (High)
            new THREE.Vector3(10, 20, 50),  // Descent
            new THREE.Vector3(-5, 5, 100),  // Forest
            new THREE.Vector3(5, 2, 150),   // River bank
            new THREE.Vector3(0, 1, 220),   // Beach
            new THREE.Vector3(0, 1, 300)    // Ocean view
        ];
        const pathCurve = new THREE.CatmullRomCurve3(points);

        // Visual Path (Road/Trail)
        const tubeGeo = new THREE.TubeGeometry(pathCurve, 100, 0.5, 8, false);
        const tubeMat = new THREE.MeshStandardMaterial({ color: 0xd7ccc8, roughness: 1 }); // Dirt road
        const tube = new THREE.Mesh(tubeGeo, tubeMat);
        scene.add(tube);


        // 2. Terrain Chunks
        // We'll create custom meshes for different biomes along the path

        function createLowPolyTerrain(width, length, color, heightFunc, zOffset) {
            const segW = 20;
            const segL = 40;
            const geo = new THREE.PlaneGeometry(width, length, segW, segL);
            const pos = geo.attributes.position;

            for(let i=0; i<pos.count; i++){
                const x = pos.getX(i);
                const y = pos.getY(i); // This is actually Z in world space before rotation

                // Height generation
                let z = heightFunc(x, y);

                pos.setZ(i, z);
            }
            geo.computeVertexNormals();

            const mat = new THREE.MeshStandardMaterial({
                color: color,
                flatShading: true,
                roughness: 0.8
            });
            const mesh = new THREE.Mesh(geo, mat);
            mesh.rotation.x = -Math.PI / 2;
            mesh.position.z = zOffset + length/2;
            return mesh;
        }

        // Biome 1: Mountains (Z: 0 to 60)
        const mountainMesh = createLowPolyTerrain(100, 80, config.mountainColor, (x, y) => {
            // High peaks on sides, path in middle
            const distFromCenter = Math.abs(x);
            let h = (Math.random() * 2) + Math.pow(distFromCenter, 1.5) * 0.2;
            return h;
        }, -10);
        mountainMesh.position.y = 15; // Lift up
        scene.add(mountainMesh);

        // Biome 2: Forest (Z: 60 to 140)
        const forestMesh = createLowPolyTerrain(100, 80, config.forestColor, (x, y) => {
            // Rolling hills
            return Math.sin(x * 0.2) * 2 + Math.cos(y * 0.2) * 2 + Math.random();
        }, 70);
        forestMesh.position.y = 2;
        scene.add(forestMesh);

        // Biome 3: Water/Beach (Z: 140 to 300)
        const beachMesh = createLowPolyTerrain(100, 160, config.sandColor, (x, y) => {
            return Math.random() * 0.5; // Flat sand
        }, 150);
        beachMesh.position.y = 0;
        scene.add(beachMesh);

        // Water Plane
        const waterGeo = new THREE.PlaneGeometry(200, 200);
        const waterMat = new THREE.MeshStandardMaterial({
            color: config.waterColor,
            transparent: true,
            opacity: 0.8,
            roughness: 0.1
        });
        const water = new THREE.Mesh(waterGeo, waterMat);
        water.rotation.x = -Math.PI / 2;
        water.position.set(0, 0.5, 250);
        scene.add(water);

        // --- Props (Decorations) ---

        // Tree Function
        function createTree(x, z) {
            const group = new THREE.Group();
            const trunkGeo = new THREE.CylinderGeometry(0.2, 0.4, 1.5, 6);
            const trunkMat = new THREE.MeshStandardMaterial({ color: 0x5d4037 });
            const trunk = new THREE.Mesh(trunkGeo, trunkMat);
            trunk.position.y = 0.75;

            const leavesGeo = new THREE.ConeGeometry(1.5, 3, 6);
            const leavesMat = new THREE.MeshStandardMaterial({ color: 0x2e7d32, flatShading: true });
            const leaves = new THREE.Mesh(leavesGeo, leavesMat);
            leaves.position.y = 2.5;

            group.add(trunk);
            group.add(leaves);
            group.position.set(x, 0, z);

            // Random Scale
            const s = 0.8 + Math.random()*0.5;
            group.scale.set(s,s,s);
            return group;
        }

        // Add Trees to Forest
        for(let i=0; i<30; i++) {
            const x = (Math.random() - 0.5) * 60;
            // Clear path
            if(Math.abs(x) < 5) continue;
            const z = 70 + Math.random() * 80;
            const tree = createTree(x, z);
            // Adjust Y based on biome approximation (or just Raycast, but approximation is faster)
            tree.position.y = 2 + Math.sin(x * 0.2) * 2; // Match forest terrain roughly
            scene.add(tree);
        }

        // Add Rocks to Mountain
        function createRock(x, z) {
            const geo = new THREE.DodecahedronGeometry(Math.random() + 0.5);
            const mat = new THREE.MeshStandardMaterial({ color: 0x757575, flatShading: true });
            const rock = new THREE.Mesh(geo, mat);
            rock.position.set(x, 15 + Math.pow(Math.abs(x), 1.5)*0.2, z);
            return rock;
        }
        for(let i=0; i<20; i++) {
            const x = (Math.random() - 0.5) * 50;
            if(Math.abs(x) < 4) continue;
            const z = Math.random() * 60;
            scene.add(createRock(x, z));
        }

        // Campfire Prop (Section 2)
        const campfireGroup = new THREE.Group();
        campfireGroup.position.set(5, 4, 100);
        // Logs
        const logGeo = new THREE.CylinderGeometry(0.1, 0.1, 1);
        const logMat = new THREE.MeshStandardMaterial({ color: 0x4e342e });
        const log1 = new THREE.Mesh(logGeo, logMat); log1.rotation.z = Math.PI/2;
        const log2 = new THREE.Mesh(logGeo, logMat); log2.rotation.x = Math.PI/2;
        campfireGroup.add(log1, log2);
        // Fire Light
        const fireLight = new THREE.PointLight(0xff5722, 2, 10);
        fireLight.position.y = 1;
        campfireGroup.add(fireLight);
        scene.add(campfireGroup);

        // Surfboard Prop (Section 4)
        const boardGeo = new THREE.BoxGeometry(1, 3, 0.2);
        const boardMat = new THREE.MeshStandardMaterial({ color: 0xffeb3b });
        const board = new THREE.Mesh(boardGeo, boardMat);
        board.position.set(-3, 1, 220);
        board.rotation.x = -Math.PI/4;
        board.rotation.y = Math.PI/8;
        scene.add(board);

        // --- Particles (Explosive Effect) ---
        // Fireflies in forest
        const particlesGeo = new THREE.BufferGeometry();
        const pCount = 100;
        const pPos = new Float32Array(pCount * 3);
        for(let i=0; i<pCount; i++) {
            pPos[i*3] = (Math.random()-0.5) * 40;
            pPos[i*3+1] = 2 + Math.random() * 5;
            pPos[i*3+2] = 80 + Math.random() * 60; // Forest area
        }
        particlesGeo.setAttribute('position', new THREE.BufferAttribute(pPos, 3));
        const particlesMat = new THREE.PointsMaterial({ color: 0xffeb3b, size: 0.3, transparent: true, opacity: 0.8 });
        const fireflies = new THREE.Points(particlesGeo, particlesMat);
        scene.add(fireflies);


        // --- Animation Logic ---

        gsap.registerPlugin(ScrollTrigger);

        // Loader
        window.onload = () => {
            gsap.to("#progress", { width: "100%", duration: 1, ease: "power2.out", onComplete: () => {
                gsap.to("#loader", { opacity: 0, duration: 0.5, onComplete: () => document.getElementById("loader").style.display = "none" });
            }});
        };

        // Scroll Content Reveal
        const sections = document.querySelectorAll('.card');
        sections.forEach((card) => {
            gsap.to(card, {
                scrollTrigger: {
                    trigger: card.parentElement,
                    start: "top 75%",
                    end: "top 25%",
                    toggleActions: "play none none reverse"
                },
                opacity: 1,
                y: 0,
                duration: 0.8,
                ease: "back.out(1.7)"
            });
        });

        // Main Loop
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // 1. Camera Movement along Path
            const scrollMax = document.body.scrollHeight - window.innerHeight;
            const scrollY = window.scrollY;
            const scrollPct = Math.max(0, Math.min(1, scrollY / scrollMax));

            // Get point on curve
            const camPos = pathCurve.getPointAt(scrollPct);
            const lookPos = pathCurve.getPointAt(Math.min(1, scrollPct + 0.05)); // Look slightly ahead

            // Camera smoothing
            camera.position.lerp(new THREE.Vector3(camPos.x, camPos.y + 2, camPos.z), 0.1);

            // LookAt smoothing
            const targetLook = new THREE.Vector3(lookPos.x, lookPos.y, lookPos.z);
            // We can just lookAt directly for now, or use a dummy object for smoothing if needed
            camera.lookAt(targetLook);


            // 2. Animations
            // Fireflies float
            const pArr = fireflies.geometry.attributes.position.array;
            for(let i=0; i<pCount; i++) {
                pArr[i*3+1] += Math.sin(time + i) * 0.02;
            }
            fireflies.geometry.attributes.position.needsUpdate = true;

            // Campfire flicker
            fireLight.intensity = 2 + Math.sin(time * 10) * 0.5;

            // Surfboard bobbing
            board.position.y = 1 + Math.sin(time) * 0.1;

            renderer.render(scene, camera);
        }

        animate();

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
