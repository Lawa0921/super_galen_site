<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G-Heart | The Weaver</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Marcellus&family=Noto+Serif+TC:wght@300;700&display=swap" rel="stylesheet">

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        /* Base Styles - Cozy Palette */
        :root {
            --c-bg: #fdfbf7; /* Off-white/Cream */
            --c-text: #5e4b35; /* Dark Walnut */
            --c-accent: #d68c6d; /* Warm Terracotta */
            --c-thread: #e3d2b4; /* Raw Linen */
            --c-green: #9fb089; /* Sage */
        }

        body {
            margin: 0;
            overflow-x: hidden;
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: 'Noto Serif TC', serif;
            overscroll-behavior: none;
        }

        /* Canvas Container */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 1;
        }

        /* Content Overlay */
        .content-layer {
            position: relative;
            z-index: 10;
            pointer-events: none;
        }

        .scroll-section {
            height: 120vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* Text Styling */
        .text-card {
            background: rgba(253, 251, 247, 0.85);
            backdrop-filter: blur(5px);
            padding: 2.5rem;
            max-width: 500px;
            width: 85%;
            border-left: 4px solid var(--c-accent); /* Stitching detail */
            box-shadow: 10px 10px 0px rgba(214, 140, 109, 0.1); /* Hard shadow, stylized */
            pointer-events: auto;
            opacity: 0;
            transform: translateY(30px);
        }

        h1, h2, h3 {
            font-family: 'Marcellus', serif;
            font-weight: 400;
            margin: 0 0 1rem 0;
            color: var(--c-text);
            letter-spacing: 0.05em;
        }

        h1 {
            font-size: clamp(3rem, 8vw, 5rem);
            color: var(--c-accent);
        }

        h2 { font-size: clamp(1.8rem, 4vw, 2.5rem); border-bottom: 1px dashed var(--c-accent); display: inline-block; padding-bottom: 0.5rem; }

        p {
            font-size: 1.1rem;
            line-height: 1.9;
            color: var(--c-text);
            font-weight: 400;
        }

        .highlight { color: var(--c-accent); font-weight: 700; }

        /* Loader */
        #loader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--c-bg);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .loader-thread {
            width: 60px; height: 60px;
            border: 4px dashed var(--c-accent);
            border-radius: 50%;
            animation: spin 3s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Section Layouts */
        #sec-hero .text-card { background: transparent; box-shadow: none; border: none; text-align: center; }

        #sec-intro { justify-content: flex-start; padding-left: 10%; }
        #sec-connect { justify-content: flex-end; padding-right: 10%; text-align: right; }
        #sec-connect .text-card { border-left: none; border-right: 4px solid var(--c-accent); box-shadow: -10px 10px 0px rgba(214, 140, 109, 0.1); }

        #sec-dream { justify-content: center; text-align: center; }
        #sec-dream .text-card { border: none; border-top: 4px solid var(--c-accent); }

        /* Finale */
        #sec-finale {
            height: 100vh;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .profile-img {
            width: 200px; height: 200px;
            border-radius: 50%;
            object-fit: cover;
            border: 8px solid var(--c-bg);
            box-shadow: 0 0 0 2px var(--c-accent), 0 10px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            position: relative;
            z-index: 2;
        }

        .social-btn {
            display: inline-block;
            margin: 0.5rem;
            padding: 0.8rem 2rem;
            border: 1px solid var(--c-accent);
            color: var(--c-accent);
            text-decoration: none;
            transition: all 0.3s;
            font-family: 'Marcellus', serif;
            font-weight: 600;
            background: transparent;
        }
        .social-btn:hover {
            background: var(--c-accent);
            color: white;
        }

        .scroll-hint {
            position: fixed;
            bottom: 2rem;
            width: 100%;
            text-align: center;
            color: var(--c-text);
            font-size: 0.9rem;
            letter-spacing: 2px;
            animation: bounce 2s infinite;
            opacity: 0.5;
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        @media (max-width: 768px) {
            #sec-intro, #sec-connect { padding: 0; justify-content: center; text-align: center; }
            .text-card { width: 90%; padding: 1.5rem; border: none !important; border-top: 4px solid var(--c-accent) !important; box-shadow: 0 10px 20px rgba(0,0,0,0.05) !important;}
        }

    </style>
</head>
<body>

    <div id="loader">
        <div class="loader-thread"></div>
    </div>

    <div id="canvas-container"></div>
    <div class="scroll-hint">UNRAVEL THE STORY</div>

    <div class="content-layer">

        <section id="sec-hero" class="scroll-section">
            <div class="text-card">
                <h1>G-Heart</h1>
                <p>WEAVING STORIES, <span class="highlight">THREAD BY THREAD</span></p>
            </div>
        </section>

        <section id="sec-intro" class="scroll-section">
            <div class="text-card">
                <h2>Artisan Soul</h2>
                <p>餐飲系畢業的手作人。<br>
                在木工與美食之間尋找平衡，<br>
                工作之餘，我努力編織屬於自己的世界。</p>
            </div>
        </section>

        <section id="sec-connect" class="scroll-section">
            <div class="text-card">
                <h2>Inner Quiet</h2>
                <p>我是個大 I 人。<br>
                不擅長面對面，卻渴望深刻的連結。<br>
                透過網路，讓有趣又實用的作品替我說話。</p>
            </div>
        </section>

        <section id="sec-works" class="scroll-section" style="height: 150vh;">
            <!-- Works displayed in 3D -->
        </section>

        <section id="sec-dream" class="scroll-section">
            <div class="text-card">
                <h2>The Dream</h2>
                <p>期許未來當個有自知之明的老人，<br>
                搬到有山有海的地方獨居，<br>
                熱愛大自然的一切，嚮往一個人的自由。</p>
            </div>
        </section>

        <section id="sec-finale" class="scroll-section">
            <div style="text-align:center;">
                <img src="/assets/images/guild/gheart/profile.webp" alt="G-Heart" class="profile-img">
                <h2>G-Heart</h2>
                <p style="margin-bottom: 2rem;">WOOD · SEA · HERBS · STARS</p>
                <div>
                    <a href="https://www.threads.com/@gheart1982" target="_blank" class="social-btn">Threads</a>
                    <a href="https://www.instagram.com/gheart1982/" target="_blank" class="social-btn">Instagram</a>
                </div>
            </div>
        </section>

    </div>

    <script type="module">
        import * as THREE from 'three';

        // --- Setup ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xfdfbf7); // Warm Cream
        scene.fog = new THREE.Fog(0xfdfbf7, 10, 40);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 0, 20);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- Lighting ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.9);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffecd1, 0.5);
        dirLight.position.set(5, 10, 10);
        scene.add(dirLight);

        // --- "The Loom" (Many Threads) ---
        // We will create thousands of vertical threads using InstancedMesh
        const threadCount = 400;
        const threadHeight = 60;

        // Use a thin cylinder for each thread
        const threadGeo = new THREE.CylinderGeometry(0.02, 0.02, threadHeight, 5);
        const threadMat = new THREE.MeshStandardMaterial({
            color: 0xd68c6d, // Base terracotta
            roughness: 0.9,
        });

        const threads = new THREE.InstancedMesh(threadGeo, threadMat, threadCount);
        scene.add(threads);

        const dummy = new THREE.Object3D();
        const colors = [];
        const baseColor = new THREE.Color(0xd68c6d);
        const altColor = new THREE.Color(0xe3d2b4); // Linen
        const sageColor = new THREE.Color(0x9fb089); // Sage

        // Attribute for random sway offset
        const phaseOffsets = new Float32Array(threadCount);

        for(let i=0; i<threadCount; i++) {
            // Position: Spread widely in X, layered in Z
            const x = (Math.random() - 0.5) * 50;
            const z = (Math.random() - 0.5) * 15 - 5; // Behind camera mostly
            const y = 0; // Center vertical

            dummy.position.set(x, y, z);
            // Random slight rotation for natural look
            dummy.rotation.z = (Math.random() - 0.5) * 0.05;
            dummy.updateMatrix();
            threads.setMatrixAt(i, dummy.matrix);

            // Color variation
            const r = Math.random();
            if(r > 0.6) threads.setColorAt(i, baseColor);
            else if (r > 0.3) threads.setColorAt(i, altColor);
            else threads.setColorAt(i, sageColor);

            phaseOffsets[i] = Math.random() * Math.PI * 2;
        }

        threads.instanceColor.needsUpdate = true;

        // --- Horizontal "Weft" Ribbons ---
        // Curves that weave through the scene
        const ribbonGroup = new THREE.Group();
        scene.add(ribbonGroup);

        function createRibbon(yPos, color) {
            const points = [];
            for(let i=0; i<=10; i++) {
                points.push(new THREE.Vector3(
                    (i - 5) * 4, // x span
                    yPos + (Math.random()-0.5)*2,
                    (Math.sin(i)*2) // weave depth
                ));
            }
            const curve = new THREE.CatmullRomCurve3(points);
            const geo = new THREE.TubeGeometry(curve, 64, 0.1, 8, false);
            const mat = new THREE.MeshStandardMaterial({ color: color, roughness: 1 });
            return new THREE.Mesh(geo, mat);
        }

        const ribbon1 = createRibbon(5, 0xd68c6d);
        const ribbon2 = createRibbon(-5, 0x9fb089);
        const ribbon3 = createRibbon(0, 0xe3d2b4);

        ribbonGroup.add(ribbon1, ribbon2, ribbon3);

        // --- Hanging Gallery ---
        // Images hanging from "strings"
        const galleryGroup = new THREE.Group();
        scene.add(galleryGroup);

        const textureLoader = new THREE.TextureLoader();
        const workImages = [
            textureLoader.load('/assets/images/guild/gheart/work1.webp'),
            textureLoader.load('/assets/images/guild/gheart/work2.webp'),
            textureLoader.load('/assets/images/guild/gheart/work3.webp')
        ];

        workImages.forEach((tex, i) => {
            const group = new THREE.Group();

            // Photo
            const imgGeo = new THREE.PlaneGeometry(6, 4.5);
            const imgMat = new THREE.MeshBasicMaterial({ map: tex });
            const mesh = new THREE.Mesh(imgGeo, imgMat);
            group.add(mesh);

            // String holding it
            const stringGeo = new THREE.CylinderGeometry(0.02, 0.02, 20);
            const stringMat = new THREE.MeshBasicMaterial({ color: 0x5e4b35 });
            const string = new THREE.Mesh(stringGeo, stringMat);
            string.position.y = 10 + 2.25; // Above image
            group.add(string);

            // "Clips" or Knots
            const clipGeo = new THREE.SphereGeometry(0.2);
            const clip1 = new THREE.Mesh(clipGeo, stringMat);
            clip1.position.set(-2, 2.25, 0);
            const clip2 = new THREE.Mesh(clipGeo, stringMat);
            clip2.position.set(2, 2.25, 0);
            // V-strings to main string
            // Simplified: just one central string for now, looks like a mobile

            group.position.set(
                (i - 1) * 7, // Spread horizontal
                -30, // Start hidden below
                0
            );

            // Random tilt
            group.rotation.z = (Math.random()-0.5) * 0.1;

            galleryGroup.add(group);
        });

        // --- Animation Loop ---
        const clock = new THREE.Clock();

        function animate() {
            const time = clock.getElapsedTime();

            // Sway Threads (Vertex shader simulation on CPU for compatibility)
            // Ideally we'd use a custom shader material for InstancedMesh to do this on GPU
            // But for ~400 instances, we can update the matrix array
            // Optimization: Only update visible threads or simple sway
            // Let's just sway the ribbons and gallery for movement

            ribbonGroup.position.x = Math.sin(time * 0.5) * 1;

            galleryGroup.children.forEach((g, i) => {
                g.rotation.z = Math.sin(time + i) * 0.05; // Gentle wind
                g.position.y += Math.sin(time * 1.5 + i) * 0.005;
            });

            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }
        animate();

        // --- GSAP Scroll ---
        gsap.registerPlugin(ScrollTrigger);

        // Camera Pan Down (Simulate falling/unraveling)
        // Move from top of threads down

        camera.position.y = 15;

        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: "body",
                start: "top top",
                end: "bottom bottom",
                scrub: 1
            }
        });

        tl.to(camera.position, { y: -10, duration: 10, ease: "none" });

        // Gallery Pull Up
        // When we hit Works section, pull gallery up into view
        gsap.to(galleryGroup.position, {
            y: 0, // Center
            ease: "back.out(1)", // Bouncy pull
            scrollTrigger: {
                trigger: "#sec-works",
                start: "top bottom",
                end: "center center",
                scrub: 1
            }
        });

        // Spread Gallery
        // Make them come closer to camera as we pass
        gsap.to(galleryGroup.position, {
            z: 5,
            scrollTrigger: {
                trigger: "#sec-works",
                start: "center center",
                end: "bottom top",
                scrub: 1
            }
        });

        // Text Reveals
        gsap.utils.toArray('.text-card').forEach(card => {
            gsap.to(card, {
                opacity: 1, y: 0,
                duration: 1,
                scrollTrigger: {
                    trigger: card.parentElement,
                    start: "top 70%",
                    end: "top 40%",
                    scrub: 1
                }
            });
        });

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        window.onload = () => {
             gsap.to("#loader", { opacity: 0, duration: 1, onComplete: () => {
                document.getElementById('loader').style.display = 'none';
            }});
        };

    </script>
</body>
</html>