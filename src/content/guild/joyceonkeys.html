<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JoyceOnKeys | Áê¥Èçµ‰∏äÁöÑÈùàÈ≠ÇÂ∞çË©±</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Caveat:wght@400;600&family=Noto+Serif+TC:wght@400;500;600&family=LXGW+WenKai+TC:wght@400;700&family=Dancing+Script:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style"
        onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    </noscript>

    <style>
        :root {
            --piano-black: #0a0a0a;
            --piano-dark: #1a1a1a;
            --piano-charcoal: #2d2d2d;
            --ivory: #fffef0;
            --ivory-soft: #f5f5dc;
            --cream: #faf3e3;
            --gold: #d4af37;
            --gold-dark: #c9a227;
            --gold-light: #e8c547;
            --coral: #e07a5f;
            --burgundy: #722f37;
            --burgundy-light: #8b3a42;
            --purple-deep: #4a1942;

            --font-display: 'Playfair Display', Georgia, serif;
            --font-body: 'Cormorant Garamond', Georgia, serif;
            --font-chinese: 'LXGW WenKai TC', 'Noto Serif TC', serif;
            --font-accent: 'Dancing Script', 'Caveat', cursive;

            /* Modal ÊñáÂ≠óÁµ±‰∏ÄÂ∞∫ÂØ∏ */
            --modal-text-base: 1.25rem;
            --modal-text-large: 1.4rem;
            --modal-title-size: 1.8rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background: var(--piano-black);
            color: var(--ivory);
            font-family: var(--font-body);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* ===== ENTRY GATE ===== */
        .entry-gate {
            position: fixed;
            inset: 0;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: transparent;
            cursor: pointer;
            overflow: hidden;
        }

        .entry-gate.hidden {
            pointer-events: none;
        }

        /* Curtain left side */
        .entry-gate::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg,
                    var(--piano-black) 0%,
                    var(--burgundy) 80%,
                    #4a1528 100%);
            transition: transform 1.2s cubic-bezier(0.65, 0, 0.35, 1);
            z-index: -1;
            box-shadow: 5px 0 30px rgba(0, 0, 0, 0.5);
        }

        /* Curtain right side */
        .entry-gate::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 50%;
            height: 100%;
            background: linear-gradient(270deg,
                    var(--piano-black) 0%,
                    var(--burgundy) 80%,
                    #4a1528 100%);
            transition: transform 1.2s cubic-bezier(0.65, 0, 0.35, 1);
            z-index: -1;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.5);
        }

        /* Curtain fabric texture overlay */
        .entry-gate .curtain-texture {
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(90deg,
                    transparent 0px,
                    transparent 3px,
                    rgba(0, 0, 0, 0.15) 3px,
                    rgba(0, 0, 0, 0.15) 6px);
            pointer-events: none;
            z-index: 1;
        }

        /* Hidden state - curtains open */
        .entry-gate.hidden::before {
            transform: translateX(-100%);
        }

        .entry-gate.hidden::after {
            transform: translateX(100%);
        }

        .entry-gate.hidden .curtain-texture,
        .entry-gate.hidden .spotlight,
        .entry-gate.hidden .gate-piano,
        .entry-gate.hidden .gate-title,
        .entry-gate.hidden .gate-subtitle,
        .entry-gate.hidden .gate-notes,
        .entry-gate.hidden .gate-hint {
            opacity: 0;
            visibility: hidden;
            animation: none;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            pointer-events: none;
        }

        .spotlight {
            position: absolute;
            width: 400px;
            height: 600px;
            background: radial-gradient(ellipse at center,
                    rgba(212, 175, 55, 0.15) 0%,
                    rgba(212, 175, 55, 0.05) 40%,
                    transparent 70%);
            animation: spotlightSway 4s ease-in-out infinite;
        }

        @keyframes spotlightSway {

            0%,
            100% {
                transform: translateX(-30px) rotate(-5deg);
            }

            50% {
                transform: translateX(30px) rotate(5deg);
            }
        }

        .gate-piano {
            position: relative;
            width: 200px;
            height: 120px;
            margin-bottom: 40px;
        }

        .piano-body {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 60px;
            background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
            border-radius: 0 80px 5px 5px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), inset 0 2px 0 rgba(255, 255, 255, 0.1);
        }

        .piano-lid {
            position: absolute;
            bottom: 55px;
            left: 50%;
            transform: translateX(-50%) rotateX(20deg);
            transform-origin: bottom center;
            width: 170px;
            height: 40px;
            background: linear-gradient(180deg, #3a3a3a 0%, #2a2a2a 100%);
            border-radius: 0 60px 0 0;
            animation: lidBreathe 3s ease-in-out infinite;
        }

        @keyframes lidBreathe {

            0%,
            100% {
                transform: translateX(-50%) rotateX(20deg);
            }

            50% {
                transform: translateX(-50%) rotateX(25deg);
            }
        }

        .gate-keys {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1px;
        }

        .gate-key {
            width: 8px;
            height: 25px;
            background: linear-gradient(180deg, var(--ivory) 0%, #ddd 100%);
            border-radius: 0 0 2px 2px;
        }

        .gate-key.black {
            width: 5px;
            height: 16px;
            background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
            margin: 0 -3px;
            z-index: 1;
            border-radius: 0 0 1px 1px;
        }

        .gate-title {
            font-family: var(--font-display);
            font-size: 3.5rem;
            font-weight: 400;
            color: var(--gold);
            letter-spacing: 8px;
            text-shadow: 0 0 40px rgba(212, 175, 55, 0.5);
            margin-bottom: 15px;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            0% {
                text-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            }

            100% {
                text-shadow: 0 0 40px rgba(212, 175, 55, 0.6), 0 0 80px rgba(212, 175, 55, 0.3);
            }
        }

        .gate-subtitle {
            font-family: var(--font-accent);
            font-size: 1.5rem;
            color: var(--ivory-soft);
            letter-spacing: 3px;
            margin-bottom: 50px;
            opacity: 0.9;
        }

        .gate-hint {
            font-family: var(--font-body);
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 2px;
            animation: hintPulse 2s ease-in-out infinite;
        }

        @keyframes hintPulse {

            0%,
            100% {
                opacity: 0.3;
            }

            50% {
                opacity: 0.7;
            }
        }

        .gate-notes {
            position: absolute;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .gate-note {
            position: absolute;
            font-size: 2rem;
            color: var(--gold);
            opacity: 0;
            animation: noteFloat 8s ease-in-out infinite;
        }

        .gate-note:nth-child(1) {
            left: 10%;
            animation-delay: 0s;
        }

        .gate-note:nth-child(2) {
            left: 25%;
            animation-delay: 1.5s;
        }

        .gate-note:nth-child(3) {
            left: 40%;
            animation-delay: 3s;
        }

        .gate-note:nth-child(4) {
            left: 60%;
            animation-delay: 4.5s;
        }

        .gate-note:nth-child(5) {
            left: 75%;
            animation-delay: 6s;
        }

        .gate-note:nth-child(6) {
            left: 90%;
            animation-delay: 7.5s;
        }

        @keyframes noteFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.6;
            }

            90% {
                opacity: 0.6;
            }

            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* ===== MAIN CONTAINER ===== */
        .main-container {
            position: relative;
            z-index: 5;
            opacity: 0;
            transition: opacity 1s ease 0.5s;
        }

        .main-container.visible {
            opacity: 1;
        }

        /* ===== NAVIGATION ===== */
        .nav-back {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
        }

        .nav-back a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            font-family: var(--font-body);
            font-size: 1.1rem;
            color: var(--ivory);
            text-decoration: none;
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid var(--gold);
            border-radius: 30px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-back a:hover {
            background: var(--gold);
            color: var(--piano-black);
            transform: translateX(-5px);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.4);
        }

        /* ===== COLLECTION PROGRESS ===== */
        .collection-progress {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid var(--gold);
            border-radius: 15px;
            padding: 15px 25px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .collection-progress:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
        }

        .progress-label {
            font-family: var(--font-accent);
            font-size: 1rem;
            color: var(--gold);
            margin-bottom: 8px;
            text-align: center;
        }

        .progress-bar {
            width: 150px;
            height: 8px;
            background: rgba(212, 175, 55, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold) 0%, var(--coral) 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-count {
            font-family: var(--font-body);
            font-size: 0.9rem;
            color: var(--ivory-soft);
            text-align: center;
            margin-top: 5px;
        }

        /* ===== HERO HEADER ===== */
        .hero-header {
            position: relative;
            padding: 80px 20px 40px;
            text-align: center;
            background: linear-gradient(180deg,
                    rgba(114, 47, 55, 0.2) 0%,
                    transparent 100%);
        }

        .avatar-wrapper {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }

        .avatar-vinyl {
            position: absolute;
            inset: -20px;
            border-radius: 50%;
            background: repeating-radial-gradient(circle at center,
                    #1a1a1a 0px, #1a1a1a 2px,
                    #2a2a2a 2px, #2a2a2a 4px);
            animation: vinylSpin 8s linear infinite;
            box-shadow: 0 0 0 3px var(--gold), 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .avatar-vinyl::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30%;
            height: 30%;
            border-radius: 50%;
            background: var(--burgundy);
        }

        @keyframes vinylSpin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .avatar {
            position: relative;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--gold);
            z-index: 2;
        }

        .hero-name {
            font-family: var(--font-display);
            font-size: 3rem;
            color: var(--gold);
            letter-spacing: 6px;
            margin-bottom: 10px;
        }

        .hero-subtitle {
            font-family: var(--font-accent);
            font-size: 1.5rem;
            color: var(--ivory-soft);
            margin-bottom: 20px;
        }


        /* ===== MUSIC SCORE CONTAINER ===== */
        .music-score-container {
            position: relative;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px 100px;
        }

        .score-title {
            text-align: center;
            font-family: var(--font-display);
            font-size: 2rem;
            font-style: italic;
            color: var(--gold);
            margin-bottom: 40px;
            letter-spacing: 4px;
        }

        .score-title::before,
        .score-title::after {
            content: '‚ô™';
            margin: 0 15px;
            opacity: 0.5;
        }

        /* ===== STAFF SYSTEM ===== */
        .staff-system {
            position: relative;
            background: linear-gradient(180deg,
                    rgba(250, 243, 227, 0.03) 0%,
                    rgba(250, 243, 227, 0.01) 100%);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 20px;
            padding: 60px 80px;
            margin-bottom: 40px;
        }

        /* Treble Clef */
        .treble-clef {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 8rem;
            color: var(--gold);
            opacity: 0.25;
            line-height: 1;
            pointer-events: none;
        }

        /* Five Staff Lines */
        .staff-lines-bg {
            position: absolute;
            left: 80px;
            right: 40px;
            top: 50%;
            transform: translateY(-50%);
            height: 120px;
            pointer-events: none;
        }

        .staff-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(212, 175, 55, 0.15);
        }

        .staff-line:nth-child(1) {
            top: 0;
        }

        .staff-line:nth-child(2) {
            top: 25%;
        }

        .staff-line:nth-child(3) {
            top: 50%;
        }

        .staff-line:nth-child(4) {
            top: 75%;
        }

        .staff-line:nth-child(5) {
            top: 100%;
        }

        /* Notes Container */
        .notes-container {
            position: relative;
            display: flex;
            justify-content: space-around;
            align-items: center;
            min-height: 200px;
            padding: 40px 0;
        }

        /* Individual Note */
        .music-note {
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .music-note:hover {
            transform: scale(1.15) translateY(-5px);
            z-index: 20;
        }

        .music-note.collected {
            opacity: 0.5;
        }

        .music-note.collected .note-glow {
            display: none;
        }

        /* Note Head */
        .note-head {
            width: 50px;
            height: 40px;
            background: linear-gradient(135deg, var(--burgundy) 0%, var(--burgundy-light) 100%);
            border-radius: 50%;
            transform: rotate(-20deg);
            box-shadow:
                0 4px 15px rgba(114, 47, 55, 0.5),
                inset 0 2px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .music-note:hover .note-head {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            box-shadow:
                0 8px 25px rgba(212, 175, 55, 0.5),
                inset 0 2px 0 rgba(255, 255, 255, 0.3);
        }

        .music-note.collected .note-head {
            background: linear-gradient(135deg, #555 0%, #777 100%);
        }

        /* Note Symbol inside head */
        .note-symbol {
            font-size: 1rem;
            color: var(--ivory);
            transform: rotate(20deg);
            font-weight: bold;
        }

        /* Note Stem */
        .note-stem {
            position: absolute;
            width: 3px;
            height: 60px;
            background: var(--gold);
            right: 0;
            bottom: 50%;
            transform-origin: bottom right; /* ‰øÆÊ≠£ÊóãËΩâËª∏ÂøÉÔºåÁ¢∫‰øùÁ∑äË≤ºÂè≥ÂÅ¥ */
            border-radius: 2px;
            transform: rotate(20deg); /* ÊäµÊ∂àÈü≥Á¨¶È†≠ÈÉ®ÁöÑÊóãËΩâÔºå‰ΩøÁ¨¶Ê°øÂûÇÁõ¥ */
        }

        @media (min-width: 769px) {
            .music-note[data-pitch="A4"] .note-stem,
            .music-note[data-pitch="B4"] .note-stem,
            .music-note[data-pitch="C5"] .note-stem,
            .music-note[data-pitch="D5"] .note-stem,
            .music-note[data-pitch="E5"] .note-stem {
                right: auto;
                left: 0;
                bottom: auto;
                top: 50%;
                transform-origin: top left; /* ‰øÆÊ≠£ÊóãËΩâËª∏ÂøÉÔºåÁ¢∫‰øùÁ∑äË≤ºÂ∑¶ÂÅ¥ */
            }

            /* Ê®ôÁ±§ÁßªËá≥‰∏äÊñπ */
            .music-note[data-pitch="A4"] .note-label,
            .music-note[data-pitch="B4"] .note-label,
            .music-note[data-pitch="C5"] .note-label,
            .music-note[data-pitch="D5"] .note-label,
            .music-note[data-pitch="E5"] .note-label {
                top: auto;
                bottom: calc(100% + 15px);
            }
        }

        /* Note Flag */
        .note-flag {
            position: absolute;
            right: -12px;
            top: 0;
            width: 15px;
            height: 25px;
            border-right: 3px solid var(--gold);
            border-radius: 0 0 15px 0;
        }

        @media (min-width: 769px) {
            .music-note[data-pitch="A4"] .note-flag,
            .music-note[data-pitch="B4"] .note-flag,
            .music-note[data-pitch="C5"] .note-flag,
            .music-note[data-pitch="D5"] .note-flag,
            .music-note[data-pitch="E5"] .note-flag {
                top: auto;
                bottom: 0;
                border-radius: 0 15px 0 0;
            }
        }

        /* Glowing effect */
        .note-glow {
            position: absolute;
            inset: -15px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.3) 0%, transparent 70%);
            animation: noteGlow 2s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes noteGlow {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.5;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        /* Note Label */
        .note-label {
            position: absolute;
            top: calc(100% + 15px);
            left: 50%;
            transform: translateX(-50%);
            font-family: var(--font-accent);
            font-size: 1rem;
            color: var(--gold);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .music-note:hover .note-label {
            opacity: 1;
        }

        /* Position notes at different heights on staff */
        .music-note[data-pitch="C4"] {
            margin-top: 80px;
        }

        .music-note[data-pitch="D4"] {
            margin-top: 60px;
        }

        .music-note[data-pitch="E4"] {
            margin-top: 40px;
        }

        .music-note[data-pitch="F4"] {
            margin-top: 20px;
        }

        .music-note[data-pitch="G4"] {
            margin-top: 0;
        }

        .music-note[data-pitch="A4"] {
            margin-top: -20px;
        }

        .music-note[data-pitch="B4"] {
            margin-top: -40px;
        }

        .music-note[data-pitch="C5"] {
            margin-top: -60px;
        }

        .music-note[data-pitch="D5"] {
            margin-top: -80px;
        }

        .music-note[data-pitch="E5"] {
            margin-top: -100px;
        }

        /* Bar lines */
        .bar-line {
            width: 2px;
            height: 120px;
            background: rgba(212, 175, 55, 0.2);
            margin: 0 10px;
        }

        .bar-line.double {
            width: 8px;
            background: linear-gradient(90deg,
                    rgba(212, 175, 55, 0.3) 0%,
                    rgba(212, 175, 55, 0.3) 30%,
                    transparent 30%,
                    transparent 70%,
                    rgba(212, 175, 55, 0.5) 70%,
                    rgba(212, 175, 55, 0.5) 100%);
        }

        /* ===== MODAL SYSTEM ===== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(10, 10, 10, 0.92);
            backdrop-filter: blur(15px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
            padding: 20px;
            perspective: 1200px;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Floating particles in overlay */
        .modal-overlay::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(2px 2px at 20% 30%, rgba(212, 175, 55, 0.3) 50%, transparent 50%),
                radial-gradient(2px 2px at 40% 70%, rgba(212, 175, 55, 0.2) 50%, transparent 50%),
                radial-gradient(2px 2px at 60% 20%, rgba(212, 175, 55, 0.25) 50%, transparent 50%),
                radial-gradient(2px 2px at 80% 60%, rgba(212, 175, 55, 0.2) 50%, transparent 50%);
            animation: particleFloat 8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes particleFloat {

            0%,
            100% {
                transform: translateY(0);
                opacity: 0.5;
            }

            50% {
                transform: translateY(-20px);
                opacity: 1;
            }
        }

        .modal-content {
            position: relative;
            max-width: 880px;
            width: 95%;
            max-height: 85vh;
            overflow-y: auto;
            overflow-x: hidden;
            border-radius: 20px;
            transform-style: preserve-3d;
        }

        /* Custom scrollbar for modal */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 4px;
        }

        /* ===== LAYOUT VARIANTS ===== */
        /* Side-by-side layout for portrait images */
        .modal-layout-side {
            display: grid;
            grid-template-columns: minmax(280px, 35%) 1fr;
            gap: 30px;
            align-items: start;
        }

        .modal-layout-side .modal-image-side {
            width: 100%;
            height: auto;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-layout-side .modal-text-side {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* Image on right side */
        .modal-layout-side.image-right {
            grid-template-columns: 1fr minmax(280px, 35%);
        }

        .modal-layout-side.image-right .modal-image-side {
            order: 2;
        }

        .modal-layout-side.image-right .modal-text-side {
            order: 1;
        }

        /* Square image layout */
        .modal-layout-square {
            display: grid;
            grid-template-columns: minmax(240px, 30%) 1fr;
            gap: 25px;
            align-items: start;
        }

        .modal-layout-square .modal-image-square {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-layout-square.image-right {
            grid-template-columns: 1fr minmax(240px, 30%);
        }

        .modal-layout-square.image-right .modal-image-square {
            order: 2;
        }

        /* Landscape image at bottom */
        .modal-layout-bottom-image {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .modal-layout-bottom-image .modal-image-bottom {
            width: 100%;
            height: auto;
            max-height: 50vh;
            object-fit: contain;
            order: 2;
        }

        .modal-layout-bottom-image .modal-text-content {
            order: 1;
        }

        /* Text-only layout - no image */
        .modal-layout-text-only {
            text-align: center;
        }

        .modal-layout-text-only p {
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
        }

        /* Multi-image gallery layout */
        .modal-multi-gallery {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .modal-multi-gallery.three-images {
            grid-template-columns: repeat(3, 1fr);
        }

        .modal-multi-gallery img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            border-radius: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .modal-multi-gallery img:hover {
            transform: scale(1.03);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 600px) {

            .modal-layout-side,
            .modal-layout-side.image-right,
            .modal-layout-square,
            .modal-layout-square.image-right {
                grid-template-columns: 1fr;
            }

            .modal-layout-side .modal-image-side,
            .modal-layout-square .modal-image-square {
                max-width: 100%;
                margin: 0 auto 15px;
            }

            .modal-layout-side.image-right .modal-image-side,
            .modal-layout-side.image-right .modal-text-side,
            .modal-layout-square.image-right .modal-image-square {
                order: unset;
            }

            .modal-multi-gallery {
                grid-template-columns: 1fr;
            }

            .modal-multi-gallery.three-images {
                grid-template-columns: 1fr;
            }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 44px;
            height: 44px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: var(--ivory);
            font-size: 1.4rem;
            cursor: pointer;
            z-index: 10;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-close:hover {
            background: var(--coral);
            border-color: var(--coral);
            transform: rotate(180deg) scale(1.1);
            box-shadow: 0 0 20px rgba(224, 122, 95, 0.5);
        }

        /* Close button pulse animation */
        .modal-close::after {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 2px solid var(--gold);
            opacity: 0;
            animation: closePulse 2s ease-in-out infinite;
        }

        @keyframes closePulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 0;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.5;
            }
        }


        /* ===== MODAL STYLE: MODERN ===== */
        .modal-modern {
            background: linear-gradient(180deg,
                    var(--piano-dark) 0%,
                    var(--piano-charcoal) 100%);
            color: var(--ivory);
            border: 1px solid var(--gold);
            box-shadow:
                0 0 0 1px rgba(212, 175, 55, 0.3),
                0 25px 80px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            /* Glitch entrance animation */
            animation: modernGlitchIn 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
            overflow: hidden;
        }

        .modal-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
            animation: scanLine 1.5s ease-in-out infinite;
        }

        .modal-modern::after {
            content: '';
            position: absolute;
            inset: -2px;
            border: 1px solid var(--gold);
            border-radius: inherit;
            opacity: 0;
            animation: borderPulse 2s ease-in-out infinite 0.6s;
        }

        @keyframes modernGlitchIn {
            0% {
                clip-path: polygon(0 0, 0 0, 0 100%, 0 100%);
                filter: hue-rotate(90deg) brightness(2);
            }

            20% {
                clip-path: polygon(0 0, 30% 0, 30% 100%, 0 100%);
            }

            40% {
                clip-path: polygon(0 0, 60% 0, 60% 100%, 0 100%);
                filter: hue-rotate(45deg) brightness(1.5);
            }

            60% {
                clip-path: polygon(0 0, 85% 0, 85% 100%, 0 100%);
            }

            80% {
                clip-path: polygon(0 0, 95% 0, 95% 100%, 0 100%);
                filter: hue-rotate(0deg) brightness(1);
            }

            100% {
                clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
                filter: none;
            }
        }

        @keyframes scanLine {
            0% {
                left: -100%;
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            100% {
                left: 100%;
                opacity: 0;
            }
        }

        @keyframes borderPulse {

            0%,
            100% {
                opacity: 0;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.02);
            }
        }

        .modal-modern .modal-header {
            padding: 30px 40px 20px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
            animation: fadeSlideDown 0.5s ease 0.3s both;
        }

        .modal-modern .modal-title {
            font-family: var(--font-display);
            font-size: var(--modal-title-size);
            color: var(--gold);
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
        }

        .modal-modern .modal-body {
            padding: 25px 40px 30px;
            font-family: var(--font-chinese);
            font-size: var(--modal-text-base);
            line-height: 1.8;
        }

        .modal-modern .modal-body p {
            animation: typewriterFade 0.4s ease both;
            margin-bottom: 15px;
        }

        .modal-modern .modal-body p:nth-child(1) {
            animation-delay: 0.4s;
        }

        .modal-modern .modal-body p:nth-child(2) {
            animation-delay: 0.5s;
        }

        .modal-modern .modal-body p:nth-child(3) {
            animation-delay: 0.6s;
        }

        @keyframes typewriterFade {
            from {
                opacity: 0;
                transform: translateX(-10px);
                filter: blur(4px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
                filter: blur(0);
            }
        }

        @keyframes fadeSlideDown {
            from {
                opacity: 0;
                transform: translateY(-15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-modern .modal-image {
            border-radius: 10px;
            border: 2px solid rgba(212, 175, 55, 0.3);
            max-height: 45vh;
            background: rgba(0, 0, 0, 0.3);
            animation: imageReveal 0.6s ease 0.5s both;
        }

        @keyframes imageReveal {
            from {
                opacity: 0;
                transform: scale(1.1);
                filter: grayscale(1) brightness(2);
            }

            to {
                opacity: 1;
                transform: scale(1);
                filter: grayscale(0) brightness(1);
            }
        }

        /* ===== MODAL STYLE: HANDWRITTEN ===== */
        .modal-handwritten {
            background:
                repeating-linear-gradient(transparent 0px,
                    transparent 28px,
                    rgba(100, 149, 237, 0.08) 28px,
                    rgba(100, 149, 237, 0.08) 29px),
                linear-gradient(180deg, #fefefe 0%, #f5f5f0 100%);
            color: #333;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.4),
                inset 0 0 0 1px rgba(0, 0, 0, 0.1);
            transform-origin: top center;
            /* Paper falling animation */
            animation: paperFall 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        @keyframes paperFall {
            0% {
                opacity: 0;
                transform: translateY(-100px) rotateX(45deg) rotateZ(-5deg);
            }

            40% {
                transform: translateY(20px) rotateX(-5deg) rotateZ(2deg);
            }

            70% {
                transform: translateY(-5px) rotateX(2deg) rotateZ(-1deg);
            }

            100% {
                opacity: 1;
                transform: translateY(0) rotateX(0) rotateZ(0);
            }
        }

        .modal-handwritten::before {
            content: '';
            position: absolute;
            left: 50px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255, 100, 100, 0.3);
            animation: redLineAppear 0.3s ease 0.5s both;
        }

        @keyframes redLineAppear {
            from {
                transform: scaleY(0);
                transform-origin: top;
            }

            to {
                transform: scaleY(1);
            }
        }

        .modal-handwritten::after {
            content: '‚úé';
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 1.5rem;
            color: rgba(100, 100, 100, 0.3);
            animation: pencilWobble 2s ease-in-out infinite;
        }

        @keyframes pencilWobble {

            0%,
            100% {
                transform: rotate(-10deg);
            }

            50% {
                transform: rotate(10deg);
            }
        }

        .modal-handwritten .modal-header {
            padding: 30px 40px 20px 65px;
        }

        .modal-handwritten .modal-title {
            font-family: var(--font-accent);
            font-size: var(--modal-title-size);
            color: #2c5aa0;
            opacity: 0;
            animation: handwriteIn 0.6s ease 0.3s forwards;
        }

        @keyframes handwriteIn {
            0% {
                opacity: 0;
                clip-path: inset(0 100% 0 0);
            }

            100% {
                opacity: 1;
                clip-path: inset(0 0 0 0);
            }
        }

        .modal-handwritten .modal-body {
            padding: 20px 40px 30px 65px;
            font-family: var(--font-accent);
            font-size: var(--modal-text-large);
            line-height: 2;
            color: #444;
        }

        .modal-handwritten .modal-body p {
            opacity: 0;
            animation: writeText 0.5s ease forwards;
            margin-bottom: 15px;
        }

        .modal-handwritten .modal-body p:nth-child(1) {
            animation-delay: 0.5s;
        }

        .modal-handwritten .modal-body p:nth-child(2) {
            animation-delay: 0.7s;
        }

        .modal-handwritten .modal-body p:nth-child(3) {
            animation-delay: 0.9s;
        }

        @keyframes writeText {
            from {
                opacity: 0;
                transform: translateX(-5px);
                filter: blur(2px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
                filter: blur(0);
            }
        }

        .modal-handwritten .modal-image {
            border: 3px solid #ddd;
            border-radius: 8px;
            transform: rotate(1deg);
            box-shadow: 3px 3px 15px rgba(0, 0, 0, 0.2);
            max-height: 45vh;
            background: #f5f5f0;
            animation: photoStick 0.4s ease 0.8s both;
        }

        @keyframes photoStick {
            from {
                opacity: 0;
                transform: rotate(-10deg) scale(0.8);
            }

            to {
                opacity: 1;
                transform: rotate(1deg) scale(1);
            }
        }

        /* ===== MODAL STYLE: POLAROID ===== */
        .modal-polaroid {
            background: linear-gradient(145deg, #1a1a1a 0%, #2d2d2d 100%);
            color: var(--ivory);
            padding: 0;
            box-shadow:
                0 25px 80px rgba(0, 0, 0, 0.6),
                0 0 0 1px rgba(212, 175, 55, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            /* Polaroid eject animation */
            animation: polaroidEject 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            max-width: 400px;
        }

        @keyframes polaroidEject {
            0% {
                opacity: 0;
                transform: translateY(100%) scale(0.6) rotate(-5deg);
            }

            50% {
                transform: translateY(-10px) scale(1.02) rotate(2deg);
            }

            100% {
                opacity: 1;
                transform: translateY(0) scale(1) rotate(0deg);
            }
        }

        /* Decorative corner accents */
        .modal-polaroid::before {
            content: 'üì∑';
            position: absolute;
            top: -15px;
            right: -15px;
            font-size: 2.5rem;
            transform: rotate(15deg);
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
            z-index: 10;
            animation: cameraShake 0.5s ease-out forwards;
        }

        @keyframes cameraShake {

            0%,
            100% {
                transform: rotate(15deg) scale(1);
            }

            25% {
                transform: rotate(20deg) scale(1.1);
            }

            50% {
                transform: rotate(10deg) scale(1.05);
            }

            75% {
                transform: rotate(18deg) scale(1);
            }
        }

        .modal-polaroid .modal-header {
            display: none;
        }

        .modal-polaroid .modal-body {
            padding: 0;
            position: relative;
        }

        .modal-polaroid .modal-image {
            width: 100%;
            max-height: 55vh;
            object-fit: contain;
            background: #1a1a1a;
            border: none;
            border-radius: 0;
            display: block;
            /* Photo developing effect */
            animation: photoDevelop 1.5s ease-out 0.3s both;
        }

        @keyframes photoDevelop {
            0% {
                filter: brightness(1.5) contrast(0.5) sepia(0.5) saturate(0.5);
            }

            100% {
                filter: brightness(1) contrast(1) sepia(0) saturate(1);
            }
        }

        /* Caption area with gradient background */
        .modal-polaroid .polaroid-caption {
            font-family: var(--font-chinese);
            font-size: var(--modal-text-large);
            font-weight: 500;
            color: var(--ivory);
            text-align: center;
            padding: 25px 20px 10px;
            line-height: 1.6;
            background: linear-gradient(180deg,
                    rgba(26, 26, 26, 0.95) 0%,
                    rgba(45, 45, 45, 0.98) 100%);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            opacity: 1;
            animation: captionSlideUp 0.5s ease 0.8s both;
        }

        @keyframes captionSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-polaroid .polaroid-date {
            font-family: var(--font-accent);
            font-size: 1rem;
            color: var(--gold);
            text-align: center;
            padding: 8px 20px 25px;
            background: linear-gradient(180deg,
                    rgba(45, 45, 45, 0.98) 0%,
                    rgba(26, 26, 26, 1) 100%);
            letter-spacing: 2px;
            opacity: 1;
            animation: captionSlideUp 0.5s ease 1s both;
        }

        /* Gold accent line between image and text */
        .modal-polaroid .modal-image+.polaroid-caption::before {
            content: '';
            position: absolute;
            top: 0;
            left: 20px;
            right: 20px;
            height: 2px;
            background: linear-gradient(90deg,
                    transparent 0%,
                    var(--gold) 20%,
                    var(--gold) 80%,
                    transparent 100%);
        }


        /* ===== MODAL STYLE: MUSIC SHEET ===== */
        .modal-musicsheet {
            background: linear-gradient(180deg,
                    #f8f4e8 0%,
                    #f0ead6 100%);
            color: #2a2a2a;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.4),
                inset 0 0 100px rgba(212, 175, 55, 0.05);
            position: relative;
            /* Music sheet unfold animation */
            animation: sheetUnfold 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards;
            transform-origin: center top;
        }

        @keyframes sheetUnfold {
            0% {
                opacity: 0;
                transform: scaleY(0.1) rotateX(60deg);
                filter: brightness(1.5);
            }

            40% {
                transform: scaleY(0.8) rotateX(10deg);
            }

            70% {
                transform: scaleY(1.05) rotateX(-5deg);
            }

            100% {
                opacity: 1;
                transform: scaleY(1) rotateX(0);
                filter: brightness(1);
            }
        }

        .modal-musicsheet::before {
            content: '';
            position: absolute;
            inset: 15px;
            background: repeating-linear-gradient(transparent 0px,
                    transparent 16px,
                    rgba(0, 0, 0, 0.04) 16px,
                    rgba(0, 0, 0, 0.04) 18px);
            pointer-events: none;
            opacity: 0;
            animation: staffLinesAppear 0.5s ease 0.4s forwards;
        }

        @keyframes staffLinesAppear {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Floating notes decoration */
        .modal-musicsheet::after {
            content: '‚ô™ ‚ô´ ‚ô© ‚ô¨';
            position: absolute;
            top: -30px;
            right: 20px;
            font-size: 1.2rem;
            color: var(--gold);
            letter-spacing: 8px;
            animation: notesFloat 3s ease-in-out infinite;
            opacity: 0.6;
        }

        @keyframes notesFloat {

            0%,
            100% {
                transform: translateY(0) rotate(-5deg);
            }

            50% {
                transform: translateY(-10px) rotate(5deg);
            }
        }

        .modal-musicsheet .modal-header {
            padding: 30px 40px 20px;
            position: relative;
        }

        .modal-musicsheet .modal-header::before {
            content: 'ùÑû';
            position: absolute;
            left: 30px;
            top: 20px;
            font-size: 2.5rem;
            color: rgba(0, 0, 0, 0.12);
            animation: trebleClefDraw 1s ease 0.3s both;
        }

        @keyframes trebleClefDraw {
            from {
                opacity: 0;
                transform: scale(0.5) rotate(-30deg);
            }

            to {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        .modal-musicsheet .modal-title {
            font-family: var(--font-display);
            font-size: var(--modal-title-size);
            font-style: italic;
            color: #333;
            padding-left: 50px;
            opacity: 0;
            animation: titleSlideIn 0.5s ease 0.5s forwards;
        }

        @keyframes titleSlideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .modal-musicsheet .modal-body {
            padding: 25px 40px 30px;
            font-family: var(--font-chinese);
            font-size: var(--modal-text-base);
            line-height: 1.8;
            position: relative;
        }

        .modal-musicsheet .modal-body p {
            opacity: 0;
            animation: measureReveal 0.4s ease both;
            margin-bottom: 15px;
        }

        .modal-musicsheet .modal-body p:nth-child(1) {
            animation-delay: 0.6s;
        }

        .modal-musicsheet .modal-body p:nth-child(2) {
            animation-delay: 0.8s;
        }

        .modal-musicsheet .modal-body p:nth-child(3) {
            animation-delay: 1.0s;
        }

        @keyframes measureReveal {
            from {
                opacity: 0;
                transform: translateY(15px);
                filter: blur(3px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
                filter: blur(0);
            }
        }

        .modal-musicsheet .modal-image {
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            max-height: 45vh;
            background: #f8f5e8;
            animation: imageNoteIn 0.5s ease 0.7s both;
        }

        @keyframes imageNoteIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* ===== MODAL COMMON ===== */
        .modal-image {
            width: 100%;
            max-height: 45vh;
            object-fit: contain;
            margin: 15px 0;
            display: block;
            border-radius: 8px;
        }

        .modal-gallery {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .modal-gallery img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .modal-gallery img:hover {
            transform: scale(1.05);
        }

        .modal-highlight {
            color: var(--coral);
            font-weight: 600;
        }

        .modal-tag {
            display: inline-block;
            padding: 6px 16px;
            background: rgba(212, 175, 55, 0.2);
            border-radius: 20px;
            font-size: 1.05rem;
            margin: 5px 5px 5px 0;
        }


        /* ===== DISABLE ENTRANCE ANIMATIONS FOR ALREADY COLLECTED NOTES ===== */
        /* Using high specificity selectors to override animations without !important */
        .modal-content.no-entrance-animation.modal-modern,
        .modal-content.no-entrance-animation.modal-handwritten,
        .modal-content.no-entrance-animation.modal-polaroid,
        .modal-content.no-entrance-animation.modal-musicsheet {
            animation: none;
            opacity: 1;
            transform: none;
            filter: none;
        }

        .modal-content.no-entrance-animation .modal-header,
        .modal-content.no-entrance-animation .modal-title,
        .modal-content.no-entrance-animation .modal-body,
        .modal-content.no-entrance-animation .modal-body p,
        .modal-content.no-entrance-animation .modal-image,
        .modal-content.no-entrance-animation .polaroid-caption,
        .modal-content.no-entrance-animation .polaroid-date {
            animation: none;
            opacity: 1;
            transform: none;
            filter: none;
        }

        /* Polaroid specific - higher specificity to override animation fill-mode */
        .modal-content.no-entrance-animation.modal-polaroid .polaroid-caption,
        .modal-content.no-entrance-animation.modal-polaroid .polaroid-date,
        .modal-content.no-entrance-animation.modal-polaroid .modal-image {
            animation: none;
            opacity: 1;
            transform: none;
            filter: none;
        }

        .modal-content.no-entrance-animation::before,
        .modal-content.no-entrance-animation::after,
        .modal-content.no-entrance-animation .modal-header::before {
            animation: none;
            opacity: 1;
        }

        /* Hide camera emoji on re-open for polaroid */
        .modal-content.no-entrance-animation.modal-polaroid::before {
            animation: none;
            transform: rotate(15deg);
        }

        /* Preserve necessary transforms for collected modals */
        .modal-content.no-entrance-animation.modal-handwritten .modal-image {
            transform: rotate(1deg);
        }

        .modal-handwritten .modal-tag {
            background: rgba(44, 90, 160, 0.1);
            color: #2c5aa0;
        }

        /* ===== COMPLETION CELEBRATION ===== */
        .celebration-overlay {
            position: fixed;
            inset: 0;
            z-index: 2000;
            background: rgba(10, 10, 10, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .celebration-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .celebration-content {
            text-align: center;
            transform: scale(0.8);
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .celebration-overlay.active .celebration-content {
            transform: scale(1);
        }

        .celebration-icon {
            font-size: 6rem;
            margin-bottom: 30px;
            animation: celebrateFloat 2s ease-in-out infinite;
        }

        @keyframes celebrateFloat {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .celebration-title {
            font-family: var(--font-display);
            font-size: 3rem;
            color: var(--gold);
            margin-bottom: 20px;
            text-shadow: 0 0 40px rgba(212, 175, 55, 0.5);
        }

        .celebration-subtitle {
            font-family: var(--font-chinese);
            font-size: 1.3rem;
            color: var(--ivory-soft);
            margin-bottom: 40px;
            line-height: 1.8;
        }

        .celebration-close {
            padding: 15px 40px;
            font-family: var(--font-body);
            font-size: 1.2rem;
            color: var(--piano-black);
            background: var(--gold);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .celebration-close:hover {
            background: var(--gold-light);
            transform: scale(1.05);
            box-shadow: 0 10px 40px rgba(212, 175, 55, 0.4);
        }

        /* Confetti particles */
        .confetti {
            position: absolute;
            top: -20px;
            width: 10px;
            height: 10px;
            background: var(--gold);
            animation: confettiFall 3s linear infinite;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(calc(100vh + 40px)) rotate(720deg);
                opacity: 0;
            }
        }

        /* ===== SOCIAL LINKS ===== */
        .social-section {
            text-align: center;
            padding: 60px 20px;
            border-top: 1px solid rgba(212, 175, 55, 0.2);
        }

        .social-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--gold);
            margin-bottom: 30px;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 20px 40px;
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid var(--gold);
            border-radius: 35px;
            color: var(--ivory);
            text-decoration: none;
            font-family: var(--font-body);
            font-size: 1.3rem;
            transition: all 0.3s ease;
        }

        .social-link:hover {
            background: var(--gold);
            color: var(--piano-black);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
        }

        .social-link i {
            font-size: 1.6rem;
            color: var(--ivory);
        }

        /* Threads @ icon - consistent with other guild pages */
        .social-link.threads .threads-icon {
            font-size: 1.8rem;
            font-weight: bold;
            font-family: Arial, sans-serif;
            color: var(--ivory);
            transition: color 0.3s ease;
        }

        .social-link.threads:hover .threads-icon {
            color: var(--piano-black);
        }

        /* ===== FLYING BIRDS ===== */
        .flying-birds {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 100;
            overflow: hidden;
        }

        .bird {
            position: absolute;
            font-size: 2rem;
            cursor: pointer;
            pointer-events: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            opacity: 0.8;
            transition: filter 0.3s ease;
            /* JS will control position, only add wing flap animation */
            animation: wingFlap 0.3s ease-in-out infinite;
        }

        .bird:hover {
            filter: drop-shadow(0 4px 8px rgba(212, 175, 55, 0.5));
            animation: wingFlap 0.15s ease-in-out infinite;
        }

        /* Wing flapping effect using scaleY */
        @keyframes wingFlap {

            0%,
            100% {
                transform: scaleY(1) rotate(0deg);
            }

            50% {
                transform: scaleY(0.85) rotate(3deg);
            }
        }

        /* Bird perching state - slower wing flap and slight bounce */
        .bird.perching {
            animation: wingFlapSlow 1s ease-in-out infinite, perchBounce 2s ease-in-out infinite;
        }

        @keyframes wingFlapSlow {

            0%,
            100% {
                transform: scaleY(1) rotate(0deg);
            }

            50% {
                transform: scaleY(0.92) rotate(2deg);
            }
        }

        @keyframes perchBounce {

            0%,
            100% {
                margin-top: 0;
            }

            50% {
                margin-top: -5px;
            }
        }

        /* Flying bird - faster wing flap */
        .bird.flying {
            animation: wingFlap 0.25s ease-in-out infinite;
        }

        /* Bird facing direction */
        .bird.facing-left {
            transform: scaleX(-1);
        }

        /* Bird following cursor state */
        .bird.following {
            animation:
                wingFlap 0.2s ease-in-out infinite,
                orbitCursor 2s ease-in-out infinite;
            z-index: 200;
            opacity: 1;
            filter: drop-shadow(0 4px 12px rgba(212, 175, 55, 0.6));
        }

        @keyframes orbitCursor {

            0%,
            100% {
                transform: translate(0, 0) scaleY(1) rotate(-5deg);
            }

            25% {
                transform: translate(30px, -20px) scaleY(0.85) rotate(5deg);
            }

            50% {
                transform: translate(0, -35px) scaleY(1) rotate(-3deg);
            }

            75% {
                transform: translate(-30px, -15px) scaleY(0.85) rotate(8deg);
            }
        }

        /* Bird chirp animation */
        .bird.chirping {
            animation:
                wingFlap 0.1s ease-in-out infinite,
                birdChirp 0.4s ease forwards;
        }

        @keyframes birdChirp {

            0%,
            100% {
                transform: scale(1) rotate(0deg);
            }

            25% {
                transform: scale(1.2) rotate(-15deg);
            }

            50% {
                transform: scale(1.3) rotate(15deg);
            }

            75% {
                transform: scale(1.2) rotate(-10deg);
            }
        }

        /* Bird flying away animation */
        .bird.flying-away {
            animation: flyAway 1.5s ease-in forwards;
            pointer-events: none;
        }

        @keyframes flyAway {
            0% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.8;
                transform: scale(1.2) translateY(-50px) rotate(-10deg);
            }

            100% {
                opacity: 0;
                transform: scale(0.5) translateY(-150px) translateX(100px) rotate(20deg);
            }
        }

        /* Tooltip for bird */
        .bird::after {
            content: 'ÈªûÊàëÔºÅ';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gold);
            color: var(--piano-dark);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-family: var(--font-chinese);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .bird:hover::after {
            opacity: 1;
        }

        .bird.following::after {
            content: 'ÂïæÂïæÔΩû';
            opacity: 1;
        }

        /* ===== SITE FOOTER ===== */
        .site-footer {
            text-align: center;
            padding: 60px 20px 80px;
            border-top: 1px solid rgba(212, 175, 55, 0.2);
            background: linear-gradient(180deg,
                    transparent 0%,
                    rgba(10, 10, 10, 0.5) 100%);
            margin-top: 60px;
        }

        .footer-symbol {
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
        }

        .footer-text {
            font-family: var(--font-body);
            color: var(--ivory-soft);
            font-size: 0.95rem;
            letter-spacing: 1px;
            opacity: 0.8;
            margin-bottom: 20px;
        }

        .footer-link {
            color: var(--gold);
            text-decoration: none;
            transition: all 0.3s ease;
            border-bottom: 1px solid transparent;
        }

        .footer-link:hover {
            color: var(--coral);
            border-bottom-color: var(--coral);
            text-shadow: 0 0 10px rgba(224, 122, 95, 0.5);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .avatar {
                width: 160px;
                height: 160px;
            }

            .gate-title {
                font-size: 2rem;
                letter-spacing: 4px;
            }

            .hero-name {
                font-size: 2rem;
            }

            .collection-progress {
                top: auto;
                bottom: 20px;
                right: 20px;
                padding: 10px 20px;
            }

            .staff-system {
                padding: 15px 10px;
                border-radius: 15px;
                min-height: auto;
            }

            /* Hide original treble clef and staff lines */
            .treble-clef,
            .staff-lines-bg {
                display: none;
            }

            /* Two-row layout with CSS Grid */
            .notes-container {
                display: grid;
                grid-template-columns: repeat(5, 1fr);
                grid-template-rows: 90px 90px;
                gap: 30px 5px;
                padding: 15px 10px 15px 28px;
                min-height: auto;
                position: relative;
                align-items: center;
                justify-items: center;
            }

            /* Staff lines using pseudo-elements positioned to each row */
            .notes-container::before,
            .notes-container::after {
                content: '';
                position: absolute;
                left: 22px;
                right: 5px;
                height: 40px;
                background: repeating-linear-gradient(to bottom,
                        rgba(139, 69, 19, 0.45) 0px,
                        rgba(139, 69, 19, 0.45) 2px,
                        transparent 2px,
                        transparent 8px);
                pointer-events: none;
                z-index: 0;
            }

            /* First staff - row 1: 15px to 105px, center at 60px */
            .notes-container::before {
                top: 40px;
            }

            /* Second staff - row 2: 135px to 225px, center at 180px */
            .notes-container::after {
                top: 160px;
            }

            .music-note {
                margin: 0;
                z-index: 1;
                position: relative;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }

            /* Add treble clef to first note of each row */
            /* Child 1 = Note 1, Child 9 = Note 6 (counting bar-lines) */
            .music-note:nth-child(1)::after,
            .music-note:nth-child(9)::after {
                content: 'ùÑû';
                position: absolute;
                left: -22px;
                top: 50%;
                transform: translateY(-50%);
                font-size: 1.8rem;
                color: var(--gold);
                opacity: 0.8;
            }

            .note-head {
                width: 32px;
                height: 26px;
                position: relative;
            }

            /* Stem directly attached to note head */
            .note-stem {
                position: absolute;
                height: 32px; /* Â¢ûÂä†Èï∑Â∫¶‰ª•Ë£úÂÑüËµ∑ÂßãÈªû‰∏ãÁßª */
                width: 2px;
                right: 0;
                left: auto;
                margin: 0;
                bottom: 9px; /* ÂæûÈü≥Á¨¶È†≠ÈÉ®‰∏≠ÈñìÂÅè‰∏ã‰ΩçÁΩÆÈñãÂßã (26px height) */
                transform-origin: bottom right; /* Á¢∫‰øùÊâãÊ©üÁâàÂêë‰∏äÁ¨¶Ê°øÁ∑äË≤ºÂè≥ÂÅ¥ */
            }



            .note-flag {
                position: absolute;
                right: -6px;
                top: 2px;
                width: 8px;
                height: 12px;
                border-right: 2px solid var(--gold);
                border-radius: 0 0 8px 0;
            }

            .music-note:nth-child(n) .note-flag {
                top: 2px;
                bottom: auto;
                border-radius: 0 0 8px 0;
            }

            /* Downward stems for 2nd row notes (A4-E5) */
            .music-note[data-pitch="A4"] .note-stem,
            .music-note[data-pitch="B4"] .note-stem,
            .music-note[data-pitch="C5"] .note-stem,
            .music-note[data-pitch="D5"] .note-stem,
            .music-note[data-pitch="E5"] .note-stem {
                top: 12px; /* Ëµ∑ÈªûÂêë‰∏äÁßªËá≥Èü≥Á¨¶‰∏ªÈ´îÂÖßÔºåÊ∂àÈô§ÈñìÈöô */
                bottom: auto;
                left: 0;
                margin: 0;
                right: auto;
                height: 32px; /* Â¢ûÂä†Èï∑Â∫¶Ë£úÂÑüÈáçÁñäÈÉ®ÂàÜ */
                transform: rotate(20deg); /* ‰øùÊåÅÂûÇÁõ¥ */
                transform-origin: top left; /* Á¢∫‰øùÊâãÊ©üÁâàÂêë‰∏ãÁ¨¶Ê°øÁ∑äË≤ºÂ∑¶ÂÅ¥ */
            }

            .music-note[data-pitch="A4"] .note-flag,
            .music-note[data-pitch="B4"] .note-flag,
            .music-note[data-pitch="C5"] .note-flag,
            .music-note[data-pitch="D5"] .note-flag,
            .music-note[data-pitch="E5"] .note-flag {
                top: auto;
                bottom: 0;
                border-radius: 0 8px 0 0;
            }

            /* ÊâãÊ©üÁâàÊ®ôÁ±§ÁßªËá≥‰∏äÊñπ */
            .music-note[data-pitch="A4"] .note-label,
            .music-note[data-pitch="B4"] .note-label,
            .music-note[data-pitch="C5"] .note-label,
            .music-note[data-pitch="D5"] .note-label,
            .music-note[data-pitch="E5"] .note-label {
                order: -1;
                margin-top: 0;
                margin-bottom: 3px;
            }

            .note-label {
                font-size: 0.7rem;
                margin-top: 3px;
                position: static;
                order: 3;
                color: var(--gold);
            }

            /* Hide bar lines on mobile */
            .bar-line {
                display: none;
            }

            .modal-content {
                max-height: 90vh;
            }

            .modal-modern .modal-header,
            .modal-modern .modal-body,
            .modal-musicsheet .modal-header,
            .modal-musicsheet .modal-body {
                padding-left: 30px;
                padding-right: 30px;
            }

            .modal-handwritten .modal-header,
            .modal-handwritten .modal-body {
                padding-left: 55px;
                padding-right: 30px;
            }

            .modal-handwritten::before {
                left: 30px;
            }

            .celebration-title {
                font-size: 2rem;
            }

            .social-links {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>

<body>
    <!-- Entry Gate -->
    <div class="entry-gate" id="entryGate">
        <div class="curtain-texture"></div>
        <div class="spotlight"></div>
        <div class="gate-notes">
            <span class="gate-note">‚ô™</span>
            <span class="gate-note">‚ô´</span>
            <span class="gate-note">‚ô©</span>
            <span class="gate-note">‚ô¨</span>
            <span class="gate-note">‚ô™</span>
            <span class="gate-note">‚ô´</span>
        </div>
        <div class="gate-piano">
            <div class="piano-lid"></div>
            <div class="piano-body"></div>
            <div class="gate-keys">
                <div class="gate-key"></div>
                <div class="gate-key black"></div>
                <div class="gate-key"></div>
                <div class="gate-key black"></div>
                <div class="gate-key"></div>
                <div class="gate-key"></div>
                <div class="gate-key black"></div>
                <div class="gate-key"></div>
                <div class="gate-key black"></div>
                <div class="gate-key"></div>
                <div class="gate-key black"></div>
                <div class="gate-key"></div>
            </div>
        </div>
        <h1 class="gate-title">JoyceOnKeys</h1>
        <p class="gate-subtitle">Áê¥Èçµ‰∏äÁöÑÈùàÈ≠ÇÂ∞çË©±</p>
        <p class="gate-hint">‚Äî ÈªûÊìäÈÄ≤ÂÖ•Èü≥Ê®Ç‰∏ñÁïå ‚Äî</p>
    </div>

    <!-- Flying Birds -->
    <div class="flying-birds">
        <span class="bird">üê¶‚Äç‚¨õ</span>
        <span class="bird">üê¶‚Äç‚¨õ</span>
        <span class="bird">üê¶‚Äç‚¨õ</span>
    </div>

    <!-- Main Container -->
    <div class="main-container" id="mainContainer">
        <!-- Navigation -->
        <nav class="nav-back">
            <a href="/guild/">
                <i class="fas fa-arrow-left"></i>
                <span>ÂõûÂà∞ÂÖ¨ÊúÉ</span>
            </a>
        </nav>

        <!-- Collection Progress -->
        <div class="collection-progress">
            <div class="progress-label">‚ô™ Èü≥Á¨¶Êî∂ÈõÜ ‚ô™</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-count"><span id="collectedCount">0</span> / <span id="totalCount">10</span></div>
        </div>

        <!-- Hero Header -->
        <header class="hero-header">
            <div class="avatar-wrapper">
                <div class="avatar-vinyl"></div>
                <img src="/assets/img/guild/joyceonkeys/avatar.webp" alt="JoyceOnKeys" class="avatar">
            </div>
            <h1 class="hero-name">JoyceOnKeys</h1>
            <p class="hero-subtitle">Áê¥Èçµ‰∏äÁöÑÈùàÈ≠ÇÂ∞çË©±Â∏´</p>
        </header>

        <!-- Music Score Container -->
        <section class="music-score-container">
            <h2 class="score-title">Joyce's Symphony</h2>

            <!-- Staff System -->
            <div class="staff-system">
                <span class="treble-clef">ùÑû</span>
                <div class="staff-lines-bg">
                    <div class="staff-line"></div>
                    <div class="staff-line"></div>
                    <div class="staff-line"></div>
                    <div class="staff-line"></div>
                    <div class="staff-line"></div>
                </div>

                <div class="notes-container">
                    <!-- Note 1: Â∫èÊõ≤ - C4 -->
                    <div class="music-note" data-pitch="C4" data-note="1" data-style="musicsheet">
                        <div class="note-glow"></div>
                        <div class="note-head">
                            <span class="note-symbol">C</span>
                            <div class="note-stem">
                                <div class="note-flag"></div>
                            </div>
                        </div>
                        <span class="note-label">Â∫èÊõ≤</span>
                    </div>

                    <div class="bar-line"></div>

                    <!-- Note 2: ÈùàÈ≠ÇÂ∞çË©±Â∏´ - D4 -->
                    <div class="music-note" data-pitch="D4" data-note="2" data-style="handwritten">
                        <div class="note-glow"></div>
                        <div class="note-head">
                            <span class="note-symbol">D</span>
                            <div class="note-stem">
                                <div class="note-flag"></div>
                            </div>
                        </div>
                        <span class="note-label">Â§©Ë≥¶</span>
                    </div>

                    <!-- Note 3: ÂéüÁ•ñÊñúÊßì - E4 -->
                    <div class="music-note" data-pitch="E4" data-note="3" data-style="musicsheet">
                        <div class="note-glow"></div>
                        <div class="note-head">
                            <span class="note-symbol">E</span>
                            <div class="note-stem">
                                <div class="note-flag"></div>
                            </div>
                        </div>
                        <span class="note-label">ÊñúÊßì‰∫∫</span>
                    </div>

                    <div class="bar-line"></div>

                    <!-- Note 4: ÊàëÁöÑÁê¥Êàø - F4 -->
                    <div class="music-note" data-pitch="F4" data-note="4" data-style="modern">
                        <div class="note-glow"></div>
                        <div class="note-head">
                            <span class="note-symbol">F</span>
                            <div class="note-stem">
                                <div class="note-flag"></div>
                            </div>
                        </div>
                        <span class="note-label">Áê¥Êàø</span>
                    </div>

                    <!-- Note 5: Ë™ûË®ÄÂ§©Ë≥¶ - G4 -->
                    <div class="music-note" data-pitch="G4" data-note="5" data-style="handwritten">
                        <div class="note-glow"></div>
                        <div class="note-head">
                            <span class="note-symbol">G</span>
                            <div class="note-stem">
                                <div class="note-flag"></div>
                            </div>
                        </div>
                        <span class="note-label">Ë™ûË®Ä</span>
                    </div>

                    <div class="bar-line"></div>

                    <!-- Note 6: ÊñáÈ≥•ÂÆ∂Êóè - A4 -->
                    <div class="music-note" data-pitch="A4" data-note="6" data-style="polaroid">
                        <div class="note-glow"></div>
                        <div class="note-head">
                            <span class="note-symbol">A</span>
                            <div class="note-stem">
                                <div class="note-flag"></div>
                            </div>
                        </div>
                        <span class="note-label">ÊñáÈ≥•</span>
                    </div>

                    <!-- Note 7: ÊïôÂ≠∏ÂìÅÁâå - B4 -->
                    <div class="music-note" data-pitch="B4" data-note="7" data-style="modern">
                        <div class="note-glow"></div>
                        <div class="note-head">
                            <span class="note-symbol">B</span>
                            <div class="note-stem">
                                <div class="note-flag"></div>
                            </div>
                        </div>
                        <span class="note-label">ÂìÅÁâå</span>
                    </div>

                    <div class="bar-line"></div>

                    <!-- Note 8: Ââµ‰Ωú - C5 -->
                    <div class="music-note" data-pitch="C5" data-note="8" data-style="musicsheet">
                        <div class="note-glow"></div>
                        <div class="note-head">
                            <span class="note-symbol">C'</span>
                            <div class="note-stem">
                                <div class="note-flag"></div>
                            </div>
                        </div>
                        <span class="note-label">Ââµ‰Ωú</span>
                    </div>

                    <!-- Note 9: AIÂ≠∏ÁøíËÄÖ - D5 -->
                    <div class="music-note" data-pitch="D5" data-note="9" data-style="modern">
                        <div class="note-glow"></div>
                        <div class="note-head">
                            <span class="note-symbol">D'</span>
                            <div class="note-stem">
                                <div class="note-flag"></div>
                            </div>
                        </div>
                        <span class="note-label">AI</span>
                    </div>

                    <div class="bar-line double"></div>

                    <!-- Note 10: ÊàëÁöÑÊÖãÂ∫¶ - E5 -->
                    <div class="music-note" data-pitch="E5" data-note="10" data-style="polaroid">
                        <div class="note-glow"></div>
                        <div class="note-head">
                            <span class="note-symbol">E'</span>
                            <div class="note-stem">
                                <div class="note-flag"></div>
                            </div>
                        </div>
                        <span class="note-label">‰ΩõÁ≥ª</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Social Links -->
        <section class="social-section">
            <div class="social-links">
                <a href="https://www.threads.com/@joyceonkeys" target="_blank" rel="noopener"
                    class="social-link threads">
                    <span class="threads-icon">@</span>
                    <span>Threads</span>
                </a>
                <a href="https://open.spotify.com/show/2a1xT2OC7dfQW3lJJfFHYq" target="_blank" rel="noopener"
                    class="social-link">
                    <i class="fab fa-spotify"></i>
                    <span>Podcast</span>
                </a>
            </div>
        </section>

        <!-- Site Footer -->
        <footer class="site-footer">
            <p class="footer-text">
                Made with ‚ô™ by <a href="/guild/" class="footer-link">SuperGalen's Guild</a>
            </p>
        </footer>
    </div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content" id="modalContent">
            <button class="modal-close" id="modalClose">&times;</button>
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle"></h3>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- Celebration Overlay -->
    <div class="celebration-overlay" id="celebrationOverlay">
        <div class="celebration-content">
            <div class="celebration-icon">üéπ‚ú®üéµ</div>
            <h2 class="celebration-title">ÊÅ≠ÂñúÂÆåÊàêÊºîÂ•èÔºÅ</h2>
            <p class="celebration-subtitle">
                ‰Ω†Â∑≤Á∂ìÊî∂ÈõÜ‰∫Ü Joyce ÁöÑÊâÄÊúâÊïÖ‰∫ãÈü≥Á¨¶<br>
                ÊÑüË¨ù‰Ω†ËÅÜËÅΩÈÄôÊÆµÈü≥Ê®Ç‰πãÊóÖ
            </p>
            <button class="celebration-close" id="celebrationClose">ÁπºÁ∫åÊ¨£Ë≥û</button>
        </div>
    </div>

    <script>
        // ===== PIANO SOUND ENGINE (Web Audio API) =====
        class PianoSound {
            constructor() {
                this.audioContext = null;
                this.frequencies = {
                    'C4': 261.63,
                    'D4': 293.66,
                    'E4': 329.63,
                    'F4': 349.23,
                    'G4': 392.00,
                    'A4': 440.00,
                    'B4': 493.88,
                    'C5': 523.25,
                    'D5': 587.33,
                    'E5': 659.25
                };
            }

            init() {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
            }

            play(pitch) {
                this.init();

                const frequency = this.frequencies[pitch];
                if (!frequency) return;

                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);

                const now = this.audioContext.currentTime;
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(0.15, now + 0.02);  // Attack (lowered)
                gainNode.gain.linearRampToValueAtTime(0.08, now + 0.1);   // Decay
                gainNode.gain.linearRampToValueAtTime(0.08, now + 0.5);   // Sustain
                gainNode.gain.linearRampToValueAtTime(0, now + 1.5);      // Release

                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                oscillator.start(now);
                oscillator.stop(now + 1.5);
            }

            playChord(pitches) {
                pitches.forEach((pitch, index) => {
                    setTimeout(() => this.play(pitch), index * 100);
                });
            }

            playCelebration() {
                const melody = ['C4', 'E4', 'G4', 'C5', 'E5', 'G4', 'C5'];
                melody.forEach((pitch, index) => {
                    setTimeout(() => this.play(pitch), index * 150);
                });
            }
        }

        // ===== BIRD SOUND =====
        class BirdSound {
            constructor() {
                this.audioContext = null;
            }

            init() {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
            }

            chirp() {
                if (!this.audioContext) this.init();

                // Create a bird-like chirp using frequency modulation
                const now = this.audioContext.currentTime;

                // Main chirp oscillator
                const osc1 = this.audioContext.createOscillator();
                const osc2 = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                // High-pitched chirp frequencies (like a finch)
                osc1.type = 'sine';
                osc2.type = 'sine';

                // Frequency sweep for natural chirp sound
                osc1.frequency.setValueAtTime(2800, now);
                osc1.frequency.linearRampToValueAtTime(3200, now + 0.05);
                osc1.frequency.linearRampToValueAtTime(2600, now + 0.1);
                osc1.frequency.linearRampToValueAtTime(3000, now + 0.15);

                osc2.frequency.setValueAtTime(3200, now);
                osc2.frequency.linearRampToValueAtTime(2800, now + 0.08);
                osc2.frequency.linearRampToValueAtTime(3400, now + 0.12);

                // Quick attack and decay envelope
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(0.08, now + 0.01);
                gainNode.gain.linearRampToValueAtTime(0.05, now + 0.05);
                gainNode.gain.linearRampToValueAtTime(0.07, now + 0.1);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.2);

                osc1.connect(gainNode);
                osc2.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                osc1.start(now);
                osc2.start(now);
                osc1.stop(now + 0.2);
                osc2.stop(now + 0.2);
            }

            // Play multiple chirps
            chirpSequence() {
                const delays = [0, 150, 250, 450];
                delays.forEach(delay => {
                    setTimeout(() => this.chirp(), delay);
                });
            }
        }

        // ===== COLLECTION MANAGER =====
        // Session-only collection (no localStorage persistence)
        class CollectionManager {
            constructor() {
                this.collected = [];
                this.totalNotes = 10;
            }

            add(noteId) {
                if (!this.collected.includes(noteId)) {
                    this.collected.push(noteId);
                    return true;
                }
                return false;
            }

            isCollected(noteId) {
                return this.collected.includes(noteId);
            }

            getCount() {
                return this.collected.length;
            }

            isComplete() {
                return this.collected.length >= this.totalNotes;
            }

            reset() {
                this.collected = [];
            }
        }

        // ===== MODAL CONTENT BUILDER =====
        // Using DOM methods to build modal content safely (no innerHTML with external data)
        const ModalBuilder = {
            createImage(src, alt, className) {
                const img = document.createElement('img');
                img.src = src;
                img.alt = alt;
                img.className = className || 'modal-image';
                return img;
            },

            createParagraph(text, highlights) {
                const p = document.createElement('p');
                if (highlights && highlights.length > 0) {
                    let html = text;
                    highlights.forEach(h => {
                        html = html.replace(h.text, `<span class="modal-highlight">${h.text}</span>`);
                    });
                    p.innerHTML = html;
                } else {
                    p.textContent = text;
                }
                return p;
            },

            createTag(text) {
                const span = document.createElement('div');
                span.className = 'modal-tag';
                span.textContent = text;
                return span;
            },

            createTagsContainer(tags) {
                const container = document.createElement('div');
                container.className = 'modal-tags-container';
                container.style.cssText = 'display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px;';
                tags.forEach(tag => container.appendChild(this.createTag(tag)));
                return container;
            },

            createGallery(images) {
                const gallery = document.createElement('div');
                gallery.className = 'modal-gallery';
                images.forEach(img => {
                    const imgEl = this.createImage(img.src, img.alt);
                    gallery.appendChild(imgEl);
                });
                return gallery;
            },

            createMultiGallery(images, columns = 2) {
                const gallery = document.createElement('div');
                gallery.className = 'modal-multi-gallery';
                if (columns === 3) gallery.classList.add('three-images');
                images.forEach(img => {
                    const imgEl = this.createImage(img.src, img.alt);
                    imgEl.style.cssText = 'width: 100%; height: 180px; object-fit: cover; border-radius: 10px;';
                    gallery.appendChild(imgEl);
                });
                return gallery;
            },

            // Create side-by-side layout for portrait images
            createSideLayout(imageSrc, imageAlt, imageRight = false) {
                const layout = document.createElement('div');
                layout.className = 'modal-layout-side';
                if (imageRight) layout.classList.add('image-right');

                const img = document.createElement('img');
                img.src = imageSrc;
                img.alt = imageAlt;
                img.className = 'modal-image modal-image-side';

                const textContainer = document.createElement('div');
                textContainer.className = 'modal-text-side';

                layout.appendChild(img);
                layout.appendChild(textContainer);

                return { layout, textContainer };
            },

            // Create square image layout
            createSquareLayout(imageSrc, imageAlt, imageRight = false) {
                const layout = document.createElement('div');
                layout.className = 'modal-layout-square';
                if (imageRight) layout.classList.add('image-right');

                const img = document.createElement('img');
                img.src = imageSrc;
                img.alt = imageAlt;
                img.className = 'modal-image modal-image-square';

                const textContainer = document.createElement('div');
                textContainer.className = 'modal-text-side';

                layout.appendChild(img);
                layout.appendChild(textContainer);

                return { layout, textContainer };
            },

            // Create bottom image layout for landscape images
            createBottomImageLayout(imageSrc, imageAlt) {
                const layout = document.createElement('div');
                layout.className = 'modal-layout-bottom-image';

                const img = document.createElement('img');
                img.src = imageSrc;
                img.alt = imageAlt;
                img.className = 'modal-image modal-image-bottom';

                const textContainer = document.createElement('div');
                textContainer.className = 'modal-text-content';

                layout.appendChild(textContainer);
                layout.appendChild(img);

                return { layout, textContainer };
            },

            createPolaroidCaption(text) {
                const p = document.createElement('p');
                p.className = 'polaroid-caption';
                p.textContent = text;
                return p;
            },

            createPolaroidDate(text) {
                const p = document.createElement('p');
                p.className = 'polaroid-date';
                p.textContent = text;
                return p;
            }
        };

        // ===== NOTE CONTENT DEFINITIONS =====
        const noteContents = {
            1: {
                title: 'üéπ Â∫èÊõ≤ÔºöÊàëÁöÑÈü≥Ê®ÇËµ∑Èªû',
                style: 'musicsheet',  // ËàáÂâµ‰ΩúÁõ∏ÂêåÈ¢®Ê†º
                build: (container) => {
                    // photo_05 (1179x1176 ÊñπÂΩ¢) - ÂúñÊñá‰∏¶ÊéíÔºåÂúñÁâáÂú®Âè≥
                    const { layout, textContainer } = ModalBuilder.createSquareLayout(
                        '/assets/img/guild/joyceonkeys/photo_05.webp',
                        'Á´•Âπ¥ÈãºÁê¥',
                        true  // ÂúñÁâáÂú®Âè≥ÂÅ¥
                    );
                    textContainer.appendChild(ModalBuilder.createParagraph('Êàë‰æÜËá™ÊïôËÇ≤‰∏ñÂÆ∂ÔºåÂæûÂ∞èÂ∞±ËàáÈãºÁê¥Áµê‰∏ã‰∏çËß£‰πãÁ∑£„ÄÇ'));
                    textContainer.appendChild(ModalBuilder.createParagraph('ÈÄôÂºµÊ≥õÈªÉÁöÑËÄÅÁÖßÁâáÔºåË®òÈåÑ‰∫ÜÂ∞èÊôÇÂÄôÁöÑÊàëÂùêÂú®ÈãºÁê¥ÂâçÁöÑÊ®°Ê®£‚Äî‚ÄîÈÇ£ÊôÇÂÄôÈÇÑ‰∏çÁü•ÈÅìÔºåÈÄôÂè∞Ê®ÇÂô®Â∞áÊàêÁÇ∫Êàë‰∏ÄÁîüÁöÑÂ§•‰º¥„ÄÇ'));
                    const p3 = document.createElement('p');
                    p3.innerHTML = 'ÂæûÂ≠∏Áê¥Âà∞ÊïôÁê¥ÔºåÊàëËµ∞ÈÅé‰∫ÜÊº´Èï∑ÁöÑÈü≥Ê®ÇÊóÖÁ®ã„ÄÇÁèæÂú®ÁöÑÊàëÔºå‰∏çÂè™ÊòØÂÇ≥ÊéàÊäÄÂ∑ßÁöÑËÄÅÂ∏´ÔºåÊõ¥Â∏åÊúõÁî®Áê¥ÈçµÈñãÂïüÂ≠∏ÁîüÂøÉÈñÄÔºåÊàêÁÇ∫‰ªñÂÄëÁöÑ<span class="modal-highlight">ÈùàÈ≠ÇÂ∞çË©±Â∏´</span>„ÄÇ';
                    textContainer.appendChild(p3);
                    container.appendChild(layout);
                    container.appendChild(ModalBuilder.createTagsContainer(['üéπ ÈãºÁê¥ËÄÅÂ∏´', 'üë®‚Äçüë©‚Äçüëß ÊïôËÇ≤‰∏ñÂÆ∂']));
                }
            },
            2: {
                title: 'üí¨ Á¨¨‰∏ÄÊ®ÇÁ´†ÔºöËÅäÂ§©ÁöÑÂ§©Ë≥¶',
                style: 'handwritten',
                build: (container) => {
                    // ËÅöÁÑ¶„ÄåËÅäÂ§©Â§©Ë≥¶„ÄçÈÄôÂÄãÁâπË≥™
                    container.appendChild(ModalBuilder.createParagraph('ÊïôÁê¥‰πãÈ§òÔºåÊàëÊõ¥ÊÑõËßÄÂØü‰∫∫ÂøÉ„ÄÅÊÄùËÄÉ‰∫∫Áîü„ÄÇ'));
                    const p1 = document.createElement('p');
                    p1.innerHTML = 'ÈõñÁÑ∂‰∏çÊòØÂ∞àÊ•≠Ë´ÆÂïÜÂ∏´Ôºå‰ΩÜÂ≠∏Áîü„ÄÅÂÆ∂Èï∑„ÄÅÊúãÂèãÈÉΩÊÑõÊâæÊàëËÅäÂ§©ÔºåÂ∏∏Â∏∏‰∏ÄËÅäÂ∞±Êää<span class="modal-highlight">ÂïèÈ°åÁêÜÊ∏Ö‰∫Ü</span>„ÄÇ';
                    container.appendChild(p1);
                    const p2 = document.createElement('p');
                    p2.innerHTML = 'ÈÄôËÆìÊàëÁôºÁèæ‚Äî‚ÄîËá™Â∑±ÂèØËÉΩÊúâÈªû<span class="modal-highlight">ËÅäÂ§©ÁöÑÂ§©Ë≥¶</span>ÂêßÔºü';
                    container.appendChild(p2);
                    container.appendChild(ModalBuilder.createParagraph('Èü≥Ê®ÇÊòØË°®ÈÅîÊÉÖÊÑüÁöÑË™ûË®ÄÔºåËÄåÂÇæËÅΩÂâáÊòØÂè¶‰∏ÄÁ®ÆÊºîÂ•è„ÄÇüéµ'));
                    container.appendChild(ModalBuilder.createTagsContainer(['üí¨ ÂÇæËÅΩËÄÖ', 'ü§ù ÂïèÈ°åÈáêÊ∏ÖÂ∏´', '‚òï ËÅäÂ§©ÊôÇÂÖâ']));
                }
            },
            3: {
                title: 'üîÄ ÈñìÂ•èÊõ≤ÔºöÂéüÁ•ñÊñúÊßì‰∫∫',
                style: 'musicsheet',  // ËàáÂâµ‰ΩúÁõ∏ÂêåÈ¢®Ê†º
                build: (container) => {
                    // Á¥îÊñáÂ≠óÊ®°Âºè - ÊñúÊßìÁ≤æÁ•û‰∏çÈúÄË¶ÅÁâπÂÆöÂúñÁâá
                    container.appendChild(ModalBuilder.createParagraph('Âú®„ÄåÊñúÊßì„ÄçÈÄôÂÄãË©ûÈÇÑÊ≤íÊúâÊµÅË°å‰πãÂâçÔºåÊàëÂ∞±Â∑≤Á∂ìÊñúÂà∞‰∏çË°å‰∫Ü„ÄÇ'));
                    const p2 = document.createElement('p');
                    p2.innerHTML = 'ÊõæÁ∂ìÂÅöÈÅé<span class="modal-highlight">Ë®±Â§öË∑üÈü≥Ê®ÇÁÑ°ÈóúÁöÑÂ∑•‰Ωú</span>‚Äî‚ÄîÊØè‰∏Ä‰ªΩÁ∂ìÊ≠∑ÈÉΩÊàêÁÇ∫ÊàëË±êÂØå‰∫∫ÁîüÁöÑÈ§äÂàÜ„ÄÇ';
                    container.appendChild(p2);
                    container.appendChild(ModalBuilder.createParagraph('Ê≠£ÊòØÈÄô‰∫õÂ§öÂÖÉÁöÑÊ≠∑Á∑¥ÔºåËÆìÊàëËÉΩÂ§†ÁêÜËß£‰∏çÂêåËÉåÊôØÁöÑÂ≠∏ÁîüÔºåÁî®ÂêÑÁ®ÆËßíÂ∫¶‰æÜÂºïÂ∞é‰ªñÂÄë„ÄÇ'));
                    container.appendChild(ModalBuilder.createParagraph('‰∫∫Áîü‰∏çÊòØÂè™Êúâ‰∏ÄÊ¢ùË∑ØÔºåËÄåÊòØ‰∏ÄÈ¶ñÊúâÂæàÂ§öËÆäÂ•èÁöÑÊ®ÇÊõ≤„ÄÇüéµ'));
                    container.appendChild(ModalBuilder.createTagsContainer(['üé≠ Â§öÂÖÉÁ∂ìÊ≠∑', '‚ú® ÊñúÊßìÂÖàÈ©Ö']));
                }
            },
            4: {
                title: 'üè† Á¨¨‰∫åÊ®ÇÁ´†ÔºöÊàëÁöÑÁê¥Êàø‰∏ñÁïå',
                style: 'modern',
                build: (container) => {
                    // photo_09 (1440x1920 Áõ¥Âºè) - ÂúñÊñáÂ∑¶Âè≥‰∏¶Êéí
                    const { layout, textContainer } = ModalBuilder.createSideLayout(
                        '/assets/img/guild/joyceonkeys/photo_09.webp',
                        'Áê¥Êàø'
                    );
                    textContainer.appendChild(ModalBuilder.createParagraph('ÊàëÁöÑÁê¥ÊàøÊòØ‰∏ÄÂÄãÂÖÖÊªøÊïÖ‰∫ãÁöÑÁ©∫Èñì„ÄÇ'));
                    const p2 = document.createElement('p');
                    p2.innerHTML = 'ÂÆ∂Ë£°Êî∂Ëóè‰∫Ü<span class="modal-highlight">Â§öÂè∞ÈãºÁê¥</span>„ÄÅ<span class="modal-highlight">‰∏âÂè∞Áé©ÂÖ∑ÈãºÁê¥</span>„ÄÅ<span class="modal-highlight">ÂÖ©Âè∞Êï∏‰ΩçÈãºÁê¥</span>‚Äî‚ÄîÊØè‰∏ÄÂè∞ÈÉΩÊúâÂÆÉÁç®ÁâπÁöÑÈü≥Ëâ≤ËàáË®òÊÜ∂„ÄÇ';
                    textContainer.appendChild(p2);
                    textContainer.appendChild(ModalBuilder.createParagraph('ËßíËêΩË£°ÈÇÑÊúâÈô™‰º¥Â§öÂπ¥ÁöÑ SnoopyÔºåË¶ãË≠âËëóÁÑ°Êï∏Â≠∏ÁîüÁöÑÊàêÈï∑„ÄÇ'));
                    textContainer.appendChild(ModalBuilder.createParagraph('ÈÄô‰∏çÂè™ÊòØÊïôÂ≠∏ÁöÑÂ†¥ÊâÄÔºåÊõ¥ÊòØÂ§¢ÊÉ≥ÈñãÂßãÁöÑÂú∞Êñπ„ÄÇ'));
                    container.appendChild(layout);
                    container.appendChild(ModalBuilder.createTagsContainer(['üéπ ÈãºÁê¥Êî∂Ëóè', 'üè° Ê∫´ÊöñÁ©∫Èñì']));
                }
            },
            5: {
                title: 'üó£Ô∏è ËÆäÂ•èÊõ≤ÔºöË™ûË®ÄËÆäËâ≤Èæç',
                style: 'handwritten',
                build: (container) => {
                    // Á¥îÊñáÂ≠óÊ®°Âºè - Ë™ûË®ÄÂ§©Ë≥¶Áî®ÊñáÂ≠óË°®ÈÅîÊõ¥ÊúâÈ≠ÖÂäõ
                    container.appendChild(ModalBuilder.createParagraph('ÊàëÂñúÊ≠°Ë¨õËã±ÊñáÔºåÊ≠£Âú®Ë™çÁúüÂïÉÊó•Êñá„ÄÇ'));
                    const p2 = document.createElement('p');
                    p2.innerHTML = 'ÊúÄÊúâË∂£ÁöÑÊòØÔºåÊàëÊúÉ<span class="modal-highlight">‰∏çËá™Ë¶∫Ê®°‰ªøËÅäÂ§©Â∞çË±°ÁöÑÂè£Èü≥</span>ÔºÅ';
                    container.appendChild(p2);
                    container.appendChild(ModalBuilder.createParagraph('ÈÄôÁ®ÆË™ûË®ÄÂ§©Ë≥¶ÔºåËÆìÊàëËÉΩÂ§†Áî®ÊúÄËá™ÁÑ∂ÁöÑÊñπÂºèËàá‰∫∫‰∫§ÊµÅÔºåÊâìÁ†¥ÈöîÈñ°„ÄÇ'));
                    container.appendChild(ModalBuilder.createParagraph('Â∞±ÂÉèÈü≥Ê®ÇÊòØ‰∏ñÁïåÂÖ±ÈÄöÁöÑË™ûË®ÄÔºåÊàëÁî®ÂêÑÁ®ÆÊñπÂºèËàá‰∏ñÁïåÂ∞çË©±„ÄÇ'));
                    container.appendChild(ModalBuilder.createTagsContainer(['üá¨üáß Ëã±Ë™û', 'üáØüáµ Êó•Ë™ûÂ≠∏Áøí‰∏≠', 'üé≠ Ê®°‰ªøÈÅî‰∫∫']));
                }
            },
            6: {
                title: 'üê¶‚Äç‚¨õ Á¨¨‰∏âÊ®ÇÁ´†ÔºöÊàëÁöÑÈªëÊñáÈ≥•',
                style: 'polaroid',
                build: (container) => {
                    // photo_02 (1440x1920 Áõ¥Âºè) - Polaroid È¢®Ê†ºÈÅ©ÂêàÊ≠§ÁÖßÁâá
                    container.appendChild(ModalBuilder.createImage('/assets/img/guild/joyceonkeys/photo_02.webp', 'ÊñáÈ≥•ÂÄë'));
                    container.appendChild(ModalBuilder.createPolaroidCaption('Ê®ôÊ∫ñË£ùÂÇôÔºöÂÆ∂Êúâ 5 ÈöªÈªëÊñáÈ≥•Èô™ÊàëÂêµÈ¨ß üê¶‚Äç‚¨õüê¶‚Äç‚¨õüê¶‚Äç‚¨õüê¶‚Äç‚¨õüê¶‚Äç‚¨õ'));
                    container.appendChild(ModalBuilder.createPolaroidDate("My Daily Life"));
                }
            },
            7: {
                title: 'üéì Á¨¨ÂõõÊ®ÇÁ´†ÔºöÁ∑ö‰∏äÈãºÁê¥ÊïôÂ≠∏',
                style: 'modern',
                build: (container) => {
                    // photo_04 (1024x1024 ÊñπÂΩ¢) - ÂúñÊñá‰∏¶ÊéíÔºåÂúñÁâáÂú®Â∑¶
                    const { layout, textContainer } = ModalBuilder.createSquareLayout(
                        '/assets/img/guild/joyceonkeys/photo_04.webp',
                        'Online Piano Lesson'
                    );
                    textContainer.appendChild(ModalBuilder.createParagraph("Ms. Joyce's Online Piano Lesson ‚Äî‚Äî ÈÄôÊòØÊàëÁöÑÊïôÂ≠∏ÂìÅÁâå„ÄÇ"));
                    textContainer.appendChild(ModalBuilder.createParagraph('ÊâìÁ†¥Âú∞ÂüüÈôêÂà∂ÔºåÁî®Á∂≤Ë∑ØÂ∞áÈü≥Ê®ÇÂ∏∂Áµ¶Êõ¥Â§ö‰∫∫„ÄÇ'));
                    textContainer.appendChild(ModalBuilder.createParagraph('‰∏çÁÆ°‰Ω†Âú®‰∏ñÁïåÁöÑÂì™ÂÄãËßíËêΩÔºåÈÉΩÊ≠°ËøéË∑üÊàë‰∏ÄËµ∑Êé¢Á¥¢ÈãºÁê¥ÁöÑÁæéÂ¶ôÔºÅ'));
                    container.appendChild(layout);
                    container.appendChild(ModalBuilder.createTagsContainer(['üíª Á∑ö‰∏äÊïôÂ≠∏', 'üåç ÁÑ°ÂúãÁïåÈü≥Ê®Ç']));
                }
            },
            8: {
                title: '‚úçÔ∏è Á¨¨‰∫îÊ®ÇÁ´†ÔºöÂâµ‰Ωú‰πãË∑Ø',
                style: 'musicsheet',
                build: (container) => {
                    // Â§öÂºµÂâµ‰ΩúÁõ∏ÈóúÁÖßÁâá - Áπ™Êú¨ÂíåÊïôÊùê (ÊñπÂΩ¢ÂúñÁâá)
                    container.appendChild(ModalBuilder.createMultiGallery([
                        { src: '/assets/img/guild/joyceonkeys/photo_10.webp', alt: 'Â∞èÁ¥ÖÂ∏ΩÂÖíÁ´•Èü≥Ê®ÇÂäá' },
                        { src: '/assets/img/guild/joyceonkeys/photo_06.webp', alt: 'DO RE MI' }
                    ], 2));
                    const p1 = document.createElement('p');
                    p1.innerHTML = 'ÊàëÂØ´ÈÅé<span class="modal-highlight">ÂÖ©Êú¨ÈõªÂ≠êÊõ∏</span>ÔºåÂá∫ÁâàÈÅé<span class="modal-highlight">ÂπæÊú¨Èü≥Ê®ÇÊïôÊùê</span>Âíå<span class="modal-highlight">ÂπæÈ¶ñÊ≠åÊõ≤</span>„ÄÇ';
                    container.appendChild(p1);
                    container.appendChild(ModalBuilder.createParagraph('„ÄåÂ∞èÁ¥ÖÂ∏Ω„ÄçÂÖíÁ´•Èü≥Ê®ÇÂäá„ÄÅÂèØÊÑõÁöÑÂ∞èË±¨ DO RE MI ÂêâÁ••Áâ©...ÊØè‰∏ÄÂÄã‰ΩúÂìÅÈÉΩÊâøËºâËëóÊàëÁöÑÂâµÊÑèËàáÁÜ±ÊÉÖ„ÄÇ'));
                    container.appendChild(ModalBuilder.createParagraph('Ââµ‰ΩúÔºåÊòØÂè¶‰∏ÄÁ®ÆÂΩ¢ÂºèÁöÑÊºîÂ•è„ÄÇ'));
                    container.appendChild(ModalBuilder.createTagsContainer(['üìö ÈõªÂ≠êÊõ∏‰ΩúÂÆ∂', 'üéº Èü≥Ê®ÇÊïôÊùê', 'üé≠ ÂÖíÁ´•Èü≥Ê®ÇÂäá']));
                }
            },
            9: {
                title: 'ü§ñ Â∞æÂ•èÔºöAI Â≠∏Áøí‰πãÊóÖ',
                style: 'modern',
                build: (container) => {
                    // photo_11 (1179x989 Ê©´Âºè) - ÂúñÁâáÊîæÂ∫ïÈÉ®
                    const { layout, textContainer } = ModalBuilder.createBottomImageLayout(
                        '/assets/img/guild/joyceonkeys/photo_11.webp',
                        'Joyce'
                    );

                    const p1 = document.createElement('p');
                    p1.innerHTML = 'ÈõñÁÑ∂ÁèæÂú®Â∑≤Á∂ìÊúâÈªûÂπ¥Á¥Ä‰∫ÜÔºåÊàëÂçªÈÇÑÂÉèÂÄãÂ≠©Â≠ê‰∏ÄÊ®£ÔºåÂú®Â≠∏Áøí AI ÁöÑ‰∏ñÁïåË£°<span class="modal-highlight">Áé©Âæó‰∏ç‰∫¶Ê®Ç‰πé</span>ÔºÅ';
                    textContainer.appendChild(p1);
                    textContainer.appendChild(ModalBuilder.createParagraph('‰øùÊåÅÂ•ΩÂ•áÂøÉÔºåÊ∞∏ÈÅ†‰∏çÂÅúÊ≠¢Â≠∏Áøí‚Äî‚ÄîÈÄôÂ∞±ÊòØÊàëÁöÑ‰∫∫ÁîüÊÖãÂ∫¶„ÄÇ'));
                    textContainer.appendChild(ModalBuilder.createParagraph('Èü≥Ê®Ç‰∫∫ÊìÅÊä±ÁßëÊäÄÔºåÁî® AI ÁÇ∫ÊïôÂ≠∏Ê≥®ÂÖ•Êñ∞ÁöÑÂèØËÉΩÊÄß„ÄÇ'));
                    textContainer.appendChild(ModalBuilder.createTagsContainer(['ü§ñ AI Â≠∏ÁøíËÄÖ', 'üåü ÁµÇË∫´Â≠∏Áøí', 'üí´ Á´•ÂøÉÊú™Ê≥Ø']));

                    container.appendChild(layout);
                }
            },
            10: {
                title: "üå∏ ÁµÇÁ´†ÔºöËä±Ëã•ÁõõÈñãÔºåËù¥Ëù∂Ëá™‰æÜ",
                style: 'polaroid',
                build: (container) => {
                    // Ë™ûÈåÑÁÖßÁâá - ËàáÂÖßÂÆπÂÆåÂÖ®Áõ∏Èóú
                    container.appendChild(ModalBuilder.createImage('/assets/img/guild/joyceonkeys/photo_03.webp', 'Ë™ûÈåÑ'));
                    container.appendChild(ModalBuilder.createPolaroidCaption("Ëä±Ëã•ÁõõÈñãÔºåËù¥Ëù∂Ëá™‰æÜÔºõ‰Ω†Ëã•‰∏ç‰æÜÔºåÊàëÂéªÈ§äÈ≥• üê¶‚Äç‚¨õ"));
                    container.appendChild(ModalBuilder.createPolaroidDate("‰ΩõÁ≥ªÁ∂ìÁáü ¬∑ My Philosophy"));
                }
            }
        };

        // ===== MAIN APPLICATION =====
        document.addEventListener('DOMContentLoaded', () => {
            const pianoSound = new PianoSound();
            const collectionManager = new CollectionManager();

            // Prevent duplicate triggers when modal is already open
            let isModalOpen = false;
            // Track if celebration should trigger on modal close
            let shouldCelebrate = false;

            const entryGate = document.getElementById('entryGate');
            const mainContainer = document.getElementById('mainContainer');
            const modalOverlay = document.getElementById('modalOverlay');
            const modalContent = document.getElementById('modalContent');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            const modalClose = document.getElementById('modalClose');
            const progressFill = document.getElementById('progressFill');
            const collectedCount = document.getElementById('collectedCount');
            const celebrationOverlay = document.getElementById('celebrationOverlay');
            const celebrationClose = document.getElementById('celebrationClose');

            function updateProgress() {
                const count = collectionManager.getCount();
                const percentage = (count / collectionManager.totalNotes) * 100;

                progressFill.style.width = percentage + '%';
                collectedCount.textContent = count;

                document.querySelectorAll('.music-note').forEach(note => {
                    const noteId = parseInt(note.dataset.note);
                    if (collectionManager.isCollected(noteId)) {
                        note.classList.add('collected');
                    }
                });
            }

            function showModal(noteId) {
                const content = noteContents[noteId];
                if (!content) return;

                // Check if this note was already collected (for animation control)
                const wasCollected = collectionManager.isCollected(noteId);

                // Reset modal content class and force reflow for fresh animation
                modalContent.className = 'modal-content';
                void modalContent.offsetWidth; // Force reflow

                // Add style class - skip entrance animation if already collected
                if (wasCollected) {
                    modalContent.classList.add('modal-' + content.style, 'no-entrance-animation');
                } else {
                    modalContent.classList.add('modal-' + content.style);
                }

                modalTitle.textContent = content.title;

                // Clear and rebuild modal body using safe DOM methods
                modalBody.textContent = '';
                content.build(modalBody);

                modalOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';

                const isNew = collectionManager.add(noteId);
                updateProgress();

                // Mark for celebration when user closes this modal
                if (isNew && collectionManager.isComplete()) {
                    shouldCelebrate = true;
                }
            }

            function closeModal() {
                modalOverlay.classList.remove('active');
                document.body.style.overflow = '';
                isModalOpen = false;

                // Trigger celebration after closing the 10th modal
                if (shouldCelebrate) {
                    shouldCelebrate = false;
                    setTimeout(() => showCelebration(), 300);
                }
            }

            function showCelebration() {
                celebrationOverlay.classList.add('active');
                pianoSound.playCelebration();
                createConfetti();
            }

            function createConfetti() {
                const colors = ['#d4af37', '#e07a5f', '#722f37', '#fffef0', '#c9a227'];
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    confetti.style.animationDuration = (2 + Math.random() * 2) + 's';
                    celebrationOverlay.appendChild(confetti);
                }
            }

            entryGate.addEventListener('click', () => {
                pianoSound.init();
                pianoSound.playChord(['C4', 'E4', 'G4']);
                entryGate.classList.add('hidden');
                mainContainer.classList.add('visible');
            });

            document.querySelectorAll('.music-note').forEach(note => {
                note.addEventListener('click', () => {
                    // Block if modal is already open
                    if (isModalOpen) return;

                    const noteId = parseInt(note.dataset.note);
                    const pitch = note.dataset.pitch;

                    pianoSound.play(pitch);
                    isModalOpen = true;
                    showModal(noteId);
                });
            });

            modalClose.addEventListener('click', closeModal);
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    closeModal();
                }
            });

            celebrationClose.addEventListener('click', () => {
                celebrationOverlay.classList.remove('active');
                celebrationOverlay.querySelectorAll('.confetti').forEach(c => c.remove());
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                    celebrationOverlay.classList.remove('active');
                }
            });

            // ===== BIRD FLIGHT SYSTEM =====
            const birdSound = new BirdSound();
            const birds = document.querySelectorAll('.bird');
            let followingBird = null;
            let followTimeout = null;
            let mouseX = 0;
            let mouseY = 0;

            // Bird state management
            const birdStates = [];
            const BOUNDARY_MARGIN = 50;
            const PERCH_DURATION_MIN = 3000;
            const PERCH_DURATION_MAX = 8000;

            // Initialize bird states
            birds.forEach((bird, index) => {
                const state = {
                    element: bird,
                    x: Math.random() * (window.innerWidth - 100) + 50,
                    y: Math.random() * (window.innerHeight * 0.6) + 50,
                    vx: (Math.random() - 0.5) * 3,
                    vy: (Math.random() - 0.5) * 2,
                    speed: 1 + Math.random() * 1.5,
                    isPerching: false,
                    isFollowing: false,
                    perchTimeout: null,
                    targetX: null,
                    targetY: null
                };
                birdStates.push(state);

                // Set initial position
                bird.style.left = state.x + 'px';
                bird.style.top = state.y + 'px';
                bird.classList.add('flying');
                updateBirdDirection(state);
            });

            function updateBirdDirection(state) {
                if (state.vx < 0) {
                    state.element.classList.add('facing-left');
                } else {
                    state.element.classList.remove('facing-left');
                }
            }

            function getRandomEdgePosition() {
                const edge = Math.floor(Math.random() * 4);
                const margin = BOUNDARY_MARGIN;
                const w = window.innerWidth;
                const h = window.innerHeight;

                switch (edge) {
                    case 0: // Top
                        return { x: Math.random() * (w - margin * 2) + margin, y: margin };
                    case 1: // Right
                        return { x: w - margin, y: Math.random() * (h * 0.7) + margin };
                    case 2: // Bottom (only upper portion)
                        return { x: Math.random() * (w - margin * 2) + margin, y: h * 0.7 };
                    case 3: // Left
                        return { x: margin, y: Math.random() * (h * 0.7) + margin };
                }
            }

            function startPerching(state) {
                state.isPerching = true;
                state.vx = 0;
                state.vy = 0;
                state.element.classList.remove('flying');
                state.element.classList.add('perching');

                // Perch for random duration then fly again
                const perchTime = PERCH_DURATION_MIN + Math.random() * (PERCH_DURATION_MAX - PERCH_DURATION_MIN);
                state.perchTimeout = setTimeout(() => {
                    if (!state.isFollowing) {
                        startFlying(state);
                    }
                }, perchTime);
            }

            function startFlying(state) {
                state.isPerching = false;
                state.element.classList.remove('perching');
                state.element.classList.add('flying');

                // Pick a new random direction
                const angle = Math.random() * Math.PI * 2;
                state.vx = Math.cos(angle) * state.speed;
                state.vy = Math.sin(angle) * state.speed;
                updateBirdDirection(state);

                // Optionally set a target position (boundary)
                if (Math.random() > 0.5) {
                    const target = getRandomEdgePosition();
                    state.targetX = target.x;
                    state.targetY = target.y;
                } else {
                    state.targetX = null;
                    state.targetY = null;
                }
            }

            function updateBirdPosition(state) {
                if (state.isFollowing || state.isPerching) return;

                const w = window.innerWidth;
                const h = window.innerHeight;
                const margin = BOUNDARY_MARGIN;

                // If has target, move towards it
                if (state.targetX !== null && state.targetY !== null) {
                    const dx = state.targetX - state.x;
                    const dy = state.targetY - state.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist < 30) {
                        // Reached target, perch
                        state.x = state.targetX;
                        state.y = state.targetY;
                        state.targetX = null;
                        state.targetY = null;
                        startPerching(state);
                        return;
                    }

                    // Steer towards target
                    state.vx = (dx / dist) * state.speed;
                    state.vy = (dy / dist) * state.speed;
                    updateBirdDirection(state);
                }

                // Update position
                state.x += state.vx;
                state.y += state.vy;

                // Add slight randomness to movement
                state.vx += (Math.random() - 0.5) * 0.1;
                state.vy += (Math.random() - 0.5) * 0.1;

                // Clamp velocity
                const maxSpeed = state.speed * 1.5;
                const currentSpeed = Math.sqrt(state.vx * state.vx + state.vy * state.vy);
                if (currentSpeed > maxSpeed) {
                    state.vx = (state.vx / currentSpeed) * maxSpeed;
                    state.vy = (state.vy / currentSpeed) * maxSpeed;
                }

                // Boundary detection - bounce or perch
                let hitBoundary = false;

                if (state.x <= margin) {
                    state.x = margin;
                    state.vx = Math.abs(state.vx);
                    hitBoundary = true;
                } else if (state.x >= w - margin) {
                    state.x = w - margin;
                    state.vx = -Math.abs(state.vx);
                    hitBoundary = true;
                }

                if (state.y <= margin) {
                    state.y = margin;
                    state.vy = Math.abs(state.vy);
                    hitBoundary = true;
                } else if (state.y >= h * 0.7) {
                    state.y = h * 0.7;
                    state.vy = -Math.abs(state.vy);
                    hitBoundary = true;
                }

                // Random chance to perch when hitting boundary
                if (hitBoundary && Math.random() > 0.6) {
                    startPerching(state);
                    return;
                }

                updateBirdDirection(state);
                state.element.style.left = state.x + 'px';
                state.element.style.top = state.y + 'px';
            }

            // Animation loop for birds
            function animateBirds() {
                birdStates.forEach(state => {
                    if (!state.isFollowing) {
                        updateBirdPosition(state);
                    }
                });
                requestAnimationFrame(animateBirds);
            }

            animateBirds();

            // Track mouse position
            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;

                // Update following bird position
                if (followingBird) {
                    const state = birdStates.find(s => s.element === followingBird);
                    if (state && !followingBird.classList.contains('flying-away')) {
                        state.x = mouseX - 15;
                        state.y = mouseY - 40;
                        followingBird.style.left = state.x + 'px';
                        followingBird.style.top = state.y + 'px';
                    }
                }
            });

            function releaseBird(bird, playSound = true) {
                if (!bird) return;

                const state = birdStates.find(s => s.element === bird);
                if (!state) return;

                // Clear any pending timeout
                if (followTimeout) {
                    clearTimeout(followTimeout);
                    followTimeout = null;
                }

                // Play farewell chirp
                if (playSound) {
                    birdSound.chirp();
                }

                // Release immediately - no fade animation
                bird.classList.remove('following');
                state.isFollowing = false;
                startFlying(state);

                followingBird = null;
            }

            birds.forEach((bird, index) => {
                bird.addEventListener('click', (e) => {
                    e.stopPropagation();

                    const state = birdStates[index];

                    // If this bird is already following, release it in place (no fade animation)
                    if (followingBird === bird) {
                        if (followTimeout) {
                            clearTimeout(followTimeout);
                            followTimeout = null;
                        }
                        birdSound.chirp();
                        bird.classList.remove('following');
                        state.isFollowing = false;
                        startFlying(state);
                        followingBird = null;
                        return;
                    }

                    // If another bird is following, release it first
                    if (followingBird) {
                        releaseBird(followingBird, false);
                    }

                    // Clear perch timeout if perching
                    if (state.perchTimeout) {
                        clearTimeout(state.perchTimeout);
                        state.perchTimeout = null;
                    }

                    // Play chirp sound
                    birdSound.chirpSequence();

                    // Mark as following
                    state.isFollowing = true;
                    state.isPerching = false;

                    // Add chirping animation briefly
                    bird.classList.remove('flying', 'perching');
                    bird.classList.add('chirping');

                    setTimeout(() => {
                        bird.classList.remove('chirping');

                        // Start following cursor
                        bird.classList.add('following');
                        state.x = mouseX - 15;
                        state.y = mouseY - 40;
                        bird.style.left = state.x + 'px';
                        bird.style.top = state.y + 'px';
                        followingBird = bird;

                        // Auto fly away after 5 seconds
                        followTimeout = setTimeout(() => {
                            if (followingBird === bird) {
                                birdSound.chirp();
                                releaseBird(bird, false);
                            }
                        }, 5000);
                    }, 400);
                });
            });

            // Clicking elsewhere makes bird fly away immediately
            document.addEventListener('click', (e) => {
                if (followingBird && !e.target.classList.contains('bird')) {
                    releaseBird(followingBird);
                }
            });

            updateProgress();
        });
    </script>
</body>

</html>