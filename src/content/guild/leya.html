<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leya | The Prism Core</title>
    <meta name="description" content="A brave heart drifting in the universe. Rational yet emotional.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;500;700&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --bg-color: #020205;
            --text-color: #f0f0f0;
            --accent-gold: #FFD700;
            --hologram-cyan: #00f3ff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Noto Serif TC', serif;
            overflow-x: hidden;
            width: 100vw;
            scrollbar-width: none;
        }
        body::-webkit-scrollbar { display: none; }

        /* --- Canvas Wrapper --- */
        #webgl-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* --- Scroll Spacer --- */
        #scroll-spacer {
            height: 1000vh; /* Extended for more sections */
            width: 100%;
            position: absolute;
            top: 0; left: 0;
            z-index: -1;
            pointer-events: none;
            display: none;
        }

        /* --- Icon Layer --- */
        #icon-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
            pointer-events: none;
            perspective: 1000px;
        }
        .float-icon {
            position: absolute;
            color: rgba(255, 255, 255, 0.1);
            font-size: 4rem; /* Larger */
            animation: float 10s ease-in-out infinite;
        }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-20px) rotate(5deg); } }

        /* --- Content Layer --- */
        .content-section {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 10;
            opacity: 0;
            display: flex;
            padding: 5vw;
            transition: opacity 0.5s ease;
        }

        .content-section.active {
            pointer-events: auto;
            opacity: 1;
        }

        /* Layouts - Alternating for interest */
        #sec-hero { justify-content: center; align-items: center; text-align: center; }
        #sec-drift { justify-content: flex-start; align-items: center; padding-left: 5vw; }
        #sec-return { justify-content: flex-end; align-items: flex-end; padding-right: 5vw; padding-bottom: 10vh; }
        #sec-core { justify-content: center; align-items: center; }
        #sec-value { justify-content: flex-start; align-items: flex-start; padding-top: 15vh; padding-left: 5vw; }
        #sec-services { justify-content: flex-end; align-items: center; padding-right: 5vw; }
        #sec-message { justify-content: center; align-items: flex-end; padding-bottom: 15vh; }
        #sec-roadmap { justify-content: center; align-items: center; padding-bottom: 5vh; }

        /* --- Holographic Cards (Larger) --- */
        .holo-card {
            background: rgba(0, 5, 10, 0.6);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 243, 255, 0.2);
            padding: 5rem; /* Larger padding */
            max-width: 900px; /* Much Wider */
            width: 100%;
            border-radius: 4px;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.15);
            transform-origin: center;
        }

        .holo-card::before, .holo-card::after {
            content: ''; position: absolute; width: 30px; height: 30px;
            border: 4px solid var(--hologram-cyan); /* Thicker border */
        }
        .holo-card::before { top: -2px; left: -2px; border-right: none; border-bottom: none; }
        .holo-card::after { bottom: -2px; right: -2px; border-left: none; border-top: none; }

        h1, h2, h3 { font-family: 'Cinzel', serif; letter-spacing: 0.1em; }

        .hero-title {
            font-size: clamp(6rem, 20vw, 15rem); /* Massive Title */
            color: #fff;
            text-shadow: 0 0 60px rgba(0, 243, 255, 0.6);
            margin-bottom: 2rem;
            line-height: 0.9;
            mix-blend-mode: overlay;
        }

        .hero-subtitle {
            font-size: 2.5rem; /* Larger */
            color: var(--accent-gold);
            letter-spacing: 0.5em;
            text-transform: uppercase;
            margin-bottom: 5rem;
        }

        .section-title {
            font-size: 4rem; /* Larger */
            color: var(--hologram-cyan);
            margin-bottom: 3rem;
            text-transform: uppercase;
            border-bottom: 3px solid rgba(0, 243, 255, 0.3);
            display: inline-block;
        }

        p {
            font-size: 1.6rem; /* Significantly Larger */
            font-weight: 500;
            line-height: 2;
            margin-bottom: 2rem;
            color: #fff; /* Brighter */
            text-align: justify;
        }

        .highlight { color: var(--accent-gold); font-weight: 700; text-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }

        #start-btn {
            background: rgba(0, 0, 0, 0.5);
            color: #fff;
            border: 3px solid var(--hologram-cyan);
            padding: 2rem 5rem;
            font-family: 'Cinzel'; font-size: 2rem; letter-spacing: 0.2em;
            cursor: pointer; transition: 0.3s; pointer-events: auto; position: relative; overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.2);
        }
        #start-btn:hover { background: rgba(0, 243, 255, 0.15); box-shadow: 0 0 30px var(--hologram-cyan); }

        /* Images in Cards */
        .card-gallery {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 2rem;
        }
        .card-img {
            width: 100%; height: 250px; object-fit: cover;
            border: 1px solid rgba(255,255,255,0.3);
            cursor: zoom-in; transition: transform 0.3s;
        }
        .card-img:hover { transform: scale(1.05); border-color: var(--accent-gold); }

        /* --- Site Footer --- */
        .site-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 100;
            text-align: center;
            padding: 1rem;
            color: #666;
            font-size: 0.75rem;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            font-family: 'Cinzel', serif;
            opacity: 0; /* Hidden initially, revealed by GSAP */
            pointer-events: none;
        }

        .site-footer .heart {
            color: var(--accent-gold);
            animation: heartbeat 1s ease-in-out infinite;
            display: inline-block;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .site-footer .footer-link {
            color: var(--hologram-cyan);
            text-decoration: none;
            transition: color 0.3s;
        }

        .site-footer .footer-link:hover {
            color: var(--accent-gold);
        }

        /* Finale Banner */
        #sec-finale {
            position: relative;
            width: 100%;
            height: 80vh; /* Increased height */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 10;
            background: linear-gradient(to bottom, transparent, #000 80%); /* Deeper gradient */
            pointer-events: none;
            opacity: 0;
        }
        .finale-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            gap: 0.5rem;
        }
        .finale-avatar-container {
            width: 150px; height: 150px;
            border-radius: 50%;
            padding: 3px;
            background: linear-gradient(45deg, var(--accent-gold), var(--hologram-cyan));
            margin-bottom: 2rem;
            box-shadow: 0 0 60px rgba(0, 243, 255, 0.2);
        }
        .finale-avatar {
            width: 100%; height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #000;
            filter: grayscale(0.2);
        }
        .finale-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(3rem, 6vw, 6rem);
            color: #fff;
            letter-spacing: 0.2em;
            margin: 0;
            line-height: 1.1;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }
        .finale-role {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            color: var(--hologram-cyan);
            letter-spacing: 0.5em;
            text-transform: uppercase;
            margin-bottom: 2rem;
        }
        .finale-text {
            font-family: 'Noto Serif TC', serif;
            font-size: 1.5rem;
            font-style: italic;
            color: var(--accent-gold);
            text-align: center;
            letter-spacing: 0.1em;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .social-bar {
            margin-top: 3rem;
            display: flex;
            gap: 2rem;
            pointer-events: auto;
        }
        .social-btn {
            color: #fff;
            font-size: 2rem;
            width: 60px; height: 60px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            text-decoration: none;
            transition: 0.3s;
        }
        .social-btn:hover {
            background: var(--hologram-cyan);
            color: #000;
            box-shadow: 0 0 20px var(--hologram-cyan);
        }

        .nav-back {
            position: fixed; top: 3rem; left: 3rem; z-index: 100; font-size: 1.2rem;
            color: #555; text-decoration: none; font-family: 'Cinzel'; transition: 0.3s;
        }
        .nav-back:hover { color: var(--hologram-cyan); }

        /* Lightbox */
        #lightbox {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s; cursor: zoom-out;
        }
        #lightbox.active { opacity: 1; pointer-events: auto; }
        #lightbox-img {
            width: auto; height: auto;
            max-width: 80vw; max-height: 80vh;
            min-width: 300px;
            object-fit: contain;
            border: 2px solid var(--accent-gold);
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
        }

        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            color: var(--accent-gold); font-family: 'Cinzel'; letter-spacing: 0.2em; font-size: 1.5rem;
        }

        @media (max-width: 900px) {
            .content-section { justify-content: center !important; align-items: center !important; padding: 1.5rem; }
            .holo-card { padding: 2.5rem; background: rgba(0, 5, 10, 0.9); max-width: 100%; margin-top: 10vh; }
            #sec-roadmap { padding-bottom: 10vh; }
            .hero-title { font-size: 4rem; margin-top: -20vh; }
            .hero-subtitle { font-size: 1.2rem; margin-bottom: 2rem; }
            .section-title { font-size: 2.5rem; }
            p { font-size: 1.3rem; line-height: 1.8; }
            #start-btn { padding: 1.5rem 3rem; font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <div id="loader">GATHERING SHARDS...</div>
    <a href="/guild/" class="nav-back">GUILD</a>

    <div id="webgl-container"></div>
    <div id="scroll-spacer"></div>

    <div id="icon-layer">
        <i class="fa-solid fa-cat float-icon" style="top: 20%; left: 10%; color: #fff; opacity: 0.2;"></i>
        <i class="fa-solid fa-feather float-icon" style="top: 70%; left: 80%; color: var(--accent-gold); opacity: 0.3;"></i>
        <i class="fa-solid fa-compass float-icon" style="top: 15%; left: 85%; color: var(--hologram-cyan); opacity: 0.3;"></i>
        <i class="fa-solid fa-book-open float-icon" style="top: 80%; left: 15%; color: #fff; opacity: 0.1;"></i>
    </div>

    <!-- Lightbox -->
    <div id="lightbox" onclick="this.classList.remove('active')">
        <img id="lightbox-img" src="">
    </div>

    <!-- 0. Hero -->
    <div id="sec-hero" class="content-section active">
        <div>
            <h1 class="hero-title">LEYA</h1>
            <div class="hero-subtitle">The Prism Core</div>
            <button id="start-btn">ASSEMBLE CORE</button>
        </div>
    </div>

    <!-- Scroll Hint -->
    <div id="scroll-hint" style="position: fixed; bottom: 30px; width: 100%; text-align: center; color: #fff; opacity: 0; pointer-events: none; z-index: 50;">
        <p style="font-size: 1rem; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.2em;">Scroll to Explore</p>
        <i class="fa-solid fa-chevron-down" style="font-size: 2rem; animation: bounce 2s infinite;"></i>
    </div>
    <style>@keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }</style>

    <!-- 1. The Drift -->
    <div id="sec-drift" class="content-section">
        <div class="holo-card">
            <h2 class="section-title">Drifting</h2>
            <p>
                我是 <strong>Leya</strong>。30歲以前，三分之一的時間漂泊在海外。那是探索世界的旅程，也是尋找自我的流浪。
            </p>
            <div class="card-gallery">
                <img src="/assets/img/guild/leya/gallery_1.webp" class="card-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/leya/avatar.webp" class="card-img" onclick="openLightbox(this.src)">
            </div>
        </div>
    </div>

    <!-- 2. The Return -->
    <div id="sec-return" class="content-section">
        <div class="holo-card">
            <h2 class="section-title">Resonance</h2>
            <p>
                當旅程暫告段落，回到台灣後，迎接我的是內心巨大的衝擊與重新適應的陣痛。
            </p>
            <p>
                在世俗的眼光中，我無婚姻、無子女、無房無車。只有一顆正在學會調適的心。
            </p>
            <div class="card-gallery">
                <img src="/assets/img/guild/leya/gallery_2.webp" class="card-img" style="height: 180px;" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/leya/gallery_3.webp" class="card-img" style="height: 180px;" onclick="openLightbox(this.src)">
            </div>
        </div>
    </div>

    <!-- 3. Core Self -->
    <div id="sec-core" class="content-section">
        <div class="holo-card" style="text-align: center;">
            <h2 class="section-title">The Prism</h2>
            <p>
                花了一年時間，我將碎裂的自己拼湊完整。
            </p>
            <p>
                我是<span class="highlight">感性與理性並存</span>的矛盾體，既喜歡解構人性的複雜，又對世界保持著孩子般的好奇。
                敢於質疑表象，也敢於擁抱未知。
            </p>
        </div>
    </div>

    <!-- 4. Value Proposition -->
    <div id="sec-value" class="content-section">
        <div class="holo-card">
            <h2 class="section-title">Catalyst</h2>
            <h3 style="color: var(--accent-gold); margin-bottom: 1.5rem; font-size: 2rem;">
                <i class="fa-solid fa-lightbulb"></i> 慢慢走也可以
            </h3>
            <p>
                如果你也正處於人生的十字路口，我希望能成為你的<strong>勇氣參照物</strong>。
            </p>
            <p>
                用我的故事告訴你：<span class="highlight">走在自己要的路上都會發光。</span><br>
                花了一年時間調適，我發現人生沒有標準答案，晚一點開始真的沒關係。
            </p>
        </div>
    </div>

    <!-- 5. Services & Sharing -->
    <div id="sec-services" class="content-section">
        <div class="holo-card">
            <h2 class="section-title">Signal</h2>
            <p style="margin-bottom: 2rem;">我想透過這些方式，與你分享這份力量：</p>
            <ul style="list-style: none; font-size: 1.6rem; color: #fff; line-height: 2.2;">
                <li><i class="fa-solid fa-video" style="margin-right:15px; color: var(--hologram-cyan);"></i> <strong>頻道紀實：</strong> 分享澳洲打工與西班牙朝聖的旅程。</li>
                <li><i class="fa-solid fa-comments" style="margin-right:15px; color: var(--hologram-cyan);"></i> <strong>生命交流：</strong> 提供一個感性又理性的諮詢空間。</li>
                <li><i class="fa-solid fa-pen-fancy" style="margin-right:15px; color: var(--hologram-cyan);"></i> <strong>文字創作：</strong> 關於人性思考與自我探索的隨筆。</li>
            </ul>
            <div class="card-gallery" style="margin-top: 2rem;">
                <img src="/assets/img/guild/leya/gallery_6.webp" class="card-img" style="grid-column: span 2; height: 350px;" onclick="openLightbox(this.src)">
            </div>
        </div>
    </div>

    <!-- 6. Message to You -->
    <div id="sec-message" class="content-section">
         <div class="holo-card" style="border-color: var(--accent-gold);">
            <h2 class="section-title" style="color: var(--accent-gold); border-color: var(--accent-gold);">Together</h2>
            <p>
                一邊害怕、一邊前進。
            </p>
            <p>
                走在不後悔的路上，讓我們跟著大家一起往前走。
                慢慢走也可以，只要方向是對的。
            </p>
        </div>
    </div>

    <!-- 7. Roadmap -->
    <div id="sec-roadmap" class="content-section" style="flex-direction: column;">
        <div class="holo-card" style="text-align: center; margin-bottom: 2rem;">
            <h2 class="section-title">Future</h2>
            <p>
                這是一場沒有終點的旅程。我的下一個目標已經在發光。
            </p>
            <div class="card-gallery" style="margin-bottom: 2rem;">
                <img src="/assets/img/guild/leya/gallery_4.webp" class="card-img" style="height: 150px; margin: 0;" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/leya/gallery_5.webp" class="card-img" style="height: 150px; margin: 0;" onclick="openLightbox(this.src)">
            </div>
            <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 3rem;">
                <div>
                    <div style="font-size: 4rem; color: #a8c0ff; margin-bottom: 0.5rem;"><i class="fa-solid fa-earth-oceania"></i></div>
                    <h3>Australia</h3>
                </div>
                <div>
                    <div style="font-size: 4rem; color: var(--accent-gold); margin-bottom: 0.5rem;"><i class="fa-solid fa-person-hiking"></i></div>
                    <h3>Spain</h3>
                </div>
                <div>
                    <div style="font-size: 4rem; color: #ff9a9e; margin-bottom: 0.5rem;"><i class="fa-brands fa-youtube"></i></div>
                    <h3>Channel</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- 8. Finale Banner -->
    <div id="sec-finale">
        <div class="finale-content">
            <div class="finale-avatar-container">
                <img src="/assets/img/guild/leya/avatar.webp" class="finale-avatar" alt="Leya">
            </div>
            <h1 class="finale-title">LEYA</h1>
            <div class="finale-role">The Prism Core</div>
            <h2 class="finale-text">"SHINE ON YOUR PATH"</h2>
            <div class="social-bar">
                <a href="https://www.threads.net/@goodays.leya" target="_blank" class="social-btn"><i class="fa-brands fa-threads"></i></a>
                <a href="https://www.instagram.com/goodays.leya/" target="_blank" class="social-btn"><i class="fa-brands fa-instagram"></i></a>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <p>Made with <span class="heart">♥</span> by <a href="/guild/" class="footer-link">SuperGalen's Dungeon</a></p>
    </footer>

    <script>
        function openLightbox(src) {
            document.getElementById('lightbox-img').src = src;
            document.getElementById('lightbox').classList.add('active');
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { RoomEnvironment } from 'three/addons/environments/RoomEnvironment.js';

        // --- 1. Setup ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 0, 20);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.outputEncoding = THREE.SRGBColorSpace;
        container.appendChild(renderer.domElement);

        const pmremGenerator = new THREE.PMREMGenerator(renderer);
        pmremGenerator.compileEquirectangularShader();
        const roomEnvironment = new RoomEnvironment();
        scene.environment = pmremGenerator.fromScene(roomEnvironment).texture;

        // --- 2. Procedural Textures (Roughness/Normal) ---
        function createNoiseTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 512;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#808080'; // Mid-grey base
            ctx.fillRect(0, 0, 512, 512);

            // Add noise
            for(let i=0; i<50000; i++) {
                const x = Math.random() * 512;
                const y = Math.random() * 512;
                const gray = Math.floor(Math.random() * 255);
                ctx.fillStyle = `rgb(${gray},${gray},${gray})`;
                ctx.fillRect(x, y, 2, 2);
            }

            // Add scratches
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            for(let i=0; i<50; i++) {
                ctx.beginPath();
                ctx.moveTo(Math.random()*512, Math.random()*512);
                ctx.lineTo(Math.random()*512, Math.random()*512);
                ctx.stroke();
            }

            const tex = new THREE.CanvasTexture(canvas);
            tex.wrapS = THREE.RepeatWrapping;
            tex.wrapT = THREE.RepeatWrapping;
            return tex;
        }

        const noiseMap = createNoiseTexture();

        // --- 3. Background Particles ---
        const particlesGeo = new THREE.BufferGeometry();
        const particleCount = 2000;
        const posArray = new Float32Array(particleCount * 3);
        const colorArray = new Float32Array(particleCount * 3);

        for(let i=0; i<particleCount * 3; i+=3) {
            posArray[i] = (Math.random() - 0.5) * 80;
            posArray[i+1] = (Math.random() - 0.5) * 80;
            posArray[i+2] = (Math.random() - 0.5) * 60 - 20;
            const mix = Math.random();
            if(mix > 0.7) { colorArray[i]=1; colorArray[i+1]=0.9; colorArray[i+2]=0.5; }
            else { colorArray[i]=0; colorArray[i+1]=0.9; colorArray[i+2]=1; }
        }
        particlesGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        particlesGeo.setAttribute('color', new THREE.BufferAttribute(colorArray, 3));

        const canvas = document.createElement('canvas');
        canvas.width = 32; canvas.height = 32;
        const ctx = canvas.getContext('2d');
        ctx.beginPath(); ctx.arc(16, 16, 14, 0, Math.PI*2); ctx.fillStyle = '#ffffff'; ctx.fill();
        const circleTexture = new THREE.CanvasTexture(canvas);

        const particleMat = new THREE.PointsMaterial({
            size: 0.2, map: circleTexture, vertexColors: true,
            transparent: true, opacity: 0.6, blending: THREE.AdditiveBlending, depthWrite: false
        });
        scene.add(new THREE.Points(particlesGeo, particleMat));

        // --- 4. Crystal Cluster Geometry ---
        const crystalGroup = new THREE.Group();

        const material = new THREE.MeshPhysicalMaterial({
            color: 0xffffff, metalness: 0.1, roughness: 0.1,
            transmission: 1.0, thickness: 3.0, ior: 2.0,
            reflectivity: 0.8, iridescence: 1.0, iridescenceIOR: 1.3, dispersion: 0.6,
            clearcoat: 1.0, clearcoatRoughness: 0.1,
            side: THREE.DoubleSide, transparent: true,
            attenuationColor: new THREE.Color(0xb3e5fc), attenuationDistance: 2.0,
            roughnessMap: noiseMap, // Add texture for realism
            flatShading: true
        });

        // Procedural Shard
        function createQuartzShard(height, radius, segments = 6) {
            const geo = new THREE.CylinderGeometry(0, radius, height, segments, 1);
            geo.translate(0, height/2, 0);

            // Deform vertices for raw look
            const pos = geo.attributes.position;
            for(let i=0; i<pos.count; i++) {
                const x = pos.getX(i);
                const y = pos.getY(i);
                const z = pos.getZ(i);
                if(y > 0 && y < height) { // Don't deform tips too much
                    pos.setX(i, x + (Math.random()-0.5)*0.1);
                    pos.setZ(i, z + (Math.random()-0.5)*0.1);
                }
            }
            geo.computeVertexNormals();
            return new THREE.Mesh(geo, material);
        }

        const shards = [];

        // Central Pillar
        const mainShard = createQuartzShard(7, 1.5, 6);
        mainShard.userData = {
            targetPos: new THREE.Vector3(0, -3, 0),
            targetRot: new THREE.Euler(0, 0, 0),
            startPos: new THREE.Vector3(0, 15, -10),
            startRot: new THREE.Euler(Math.random()*Math.PI, Math.random()*Math.PI, 0)
        };
        mainShard.position.copy(mainShard.userData.startPos);
        mainShard.rotation.copy(mainShard.userData.startRot);
        crystalGroup.add(mainShard);
        shards.push(mainShard);

        // Surrounding Shards
        const childCount = 10;
        for(let i=0; i<childCount; i++) {
            const h = 2 + Math.random() * 3;
            const w = 0.4 + Math.random() * 0.5;
            const child = createQuartzShard(h, w, 5 + Math.floor(Math.random()*2));

            const angle = (Math.PI * 2 / childCount) * i + (Math.random()*0.5);
            const tilt = 0.3 + Math.random() * 0.4;

            const dist = 1.2;
            const tPos = new THREE.Vector3(Math.sin(angle)*dist, -3 + (Math.random()*0.5), Math.cos(angle)*dist);

            const dummy = new THREE.Object3D();
            dummy.position.copy(tPos);
            dummy.lookAt(0, -3 + h, 0);
            dummy.rotateX(Math.PI/2 - tilt);
            const tRot = dummy.rotation;

            const sPos = new THREE.Vector3(
                (Math.random()-0.5) * 40,
                (Math.random()-0.5) * 40,
                (Math.random()-0.5) * 20
            );
            const sRot = new THREE.Euler(Math.random()*Math.PI, Math.random()*Math.PI, 0);

            child.userData = { targetPos: tPos, targetRot: {x:dummy.rotation.x, y:dummy.rotation.y, z:dummy.rotation.z}, startPos: sPos, startRot: sRot };
            child.position.copy(sPos);
            child.rotation.copy(sRot);

            crystalGroup.add(child);
            shards.push(child);
        }

        scene.add(crystalGroup);

        // --- 5. Lights & Projection ---
        const lightGroup = new THREE.Group();
        scene.add(lightGroup);
        const lightColors = [0x00ffff, 0xff00ff, 0xffd700];
        lightColors.forEach((c, i) => {
            const l = new THREE.PointLight(c, 15, 40);
            l.position.set(Math.sin(i*2)*10, Math.cos(i*2)*10, 10);
            lightGroup.add(l);
        });

        // Projection Beam
        const beamGeo = new THREE.ConeGeometry(4, 15, 32, 1, true);
        beamGeo.translate(0, 7.5, 0);
        beamGeo.rotateX(-Math.PI/2);

        const beamMat = new THREE.ShaderMaterial({
            uniforms: {
                color: { value: new THREE.Color(0x00f3ff) },
                time: { value: 0 }
            },
            vertexShader: `
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,
            fragmentShader: `
                uniform vec3 color;
                uniform float time;
                varying vec2 vUv;
                void main() {
                    float alpha = (1.0 - vUv.x) * 0.5; // Fade along length
                    alpha *= pow(sin(vUv.y * 20.0 - time * 5.0) * 0.5 + 0.5, 2.0); // Scanline
                    gl_FragColor = vec4(color, alpha);
                }
            `,
            transparent: true,
            side: THREE.DoubleSide,
            depthWrite: false,
            blending: THREE.AdditiveBlending
        });

        const beam = new THREE.Mesh(beamGeo, beamMat);
        beam.position.set(0, -2, 0);
        beam.scale.set(0, 0, 0); // Start hidden
        crystalGroup.add(beam);

        // --- Animation Loop ---
        let assembled = false;

        function animate() {
            requestAnimationFrame(animate);
            const t = Date.now() * 0.0005;

            if(assembled) {
                crystalGroup.rotation.y += 0.001;
            } else {
                crystalGroup.rotation.y += 0.0002;
            }

            lightGroup.rotation.z = t * 0.3;
            beamMat.uniforms.time.value = t;

            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- Interaction ---
        document.getElementById('start-btn').addEventListener('click', assembleCrystal);

        function assembleCrystal() {
            if(assembled) return;
            assembled = true;

            const tl = gsap.timeline();

            // 1. Fade UI
            tl.to("#sec-hero > div", { opacity: 0, scale: 0.8, duration: 0.5 });
            tl.set("#sec-hero", { pointerEvents: "none" });

            // 2. Assemble Shards
            // Main Shard
            tl.to(mainShard.position, { x: 0, y: -3, z: 0, duration: 2.5, ease: "power4.inOut" }, 0);
            tl.to(mainShard.rotation, { x: 0, y: 0, z: 0, duration: 2.5, ease: "power4.inOut" }, 0);

            // Children
            shards.slice(1).forEach((shard, i) => {
                tl.to(shard.position, {
                    x: shard.userData.targetPos.x,
                    y: shard.userData.targetPos.y,
                    z: shard.userData.targetPos.z,
                    duration: 2.5 + Math.random(),
                    ease: "elastic.out(1, 0.5)"
                }, 0.2 + i*0.05);

                const tr = shard.userData.targetRot;
                tl.to(shard.rotation, {
                    x: tr.x, y: tr.y, z: tr.z,
                    duration: 2.5,
                    ease: "power2.out"
                }, 0.2 + i*0.05);
            });

            // 3. Camera Zoom & Flash
            tl.to(camera.position, { z: 12, duration: 2, ease: "power2.inOut" }, 0);

            // 4. Reveal Scroll
            tl.to("#scroll-spacer", { display: "block" });
            tl.to("#scroll-hint", { opacity: 1, duration: 1, delay: 0.5 }); // Show hint
            tl.to(".site-footer", { opacity: 1, pointerEvents: "auto", duration: 1 }, "-=1");
            tl.add(() => initScroll());
        }

        // --- Scroll Logic ---
        gsap.registerPlugin(ScrollTrigger);

        function initScroll() {
            let tl = gsap.timeline({
                scrollTrigger: {
                    trigger: "#scroll-spacer",
                    start: "top top",
                    end: "bottom bottom",
                    scrub: 1,
                    onUpdate: (self) => {
                        // Hide hint
                        if(self.progress > 0.05) {
                            gsap.to("#scroll-hint", { opacity: 0, duration: 0.3, overwrite: true });
                        }
                        // Reveal Finale Banner at end
                        if(self.progress > 0.95) {
                            gsap.to("#sec-finale", { opacity: 1, duration: 1 });
                        } else {
                            gsap.to("#sec-finale", { opacity: 0, duration: 0.5 });
                        }
                    }
                }
            });

            // Extended Camera Path for 7 Sections
            // 1. Drift
            tl.to(camera.position, { x: 5, y: -2, z: 10, duration: 1 })
              .to(crystalGroup.rotation, { x: 0.1, y: 1.0, duration: 1 }, "<");

            // 2. Return
            tl.to(camera.position, { x: 3, y: 2, z: 12, duration: 1 })
              .to(crystalGroup.rotation, { x: -0.2, y: 2.0, duration: 1 }, "<");

            // 3. Core (Center)
            tl.to(camera.position, { x: 0, y: 0, z: 8, duration: 1 }) // Zoom in
              .to(crystalGroup.rotation, { x: 0.5, y: 3.14, duration: 1 }, "<");

            // 4. Value
            tl.to(camera.position, { x: -4, y: -3, z: 10, duration: 1 })
              .to(crystalGroup.rotation, { x: 0, y: 4.5, duration: 1 }, "<");

            // 5. Services (Beam Pulse)
            tl.to(camera.position, { x: -2, y: -1, z: 11, duration: 1 })
              .to(crystalGroup.rotation, { x: -0.3, y: 5.5, duration: 1 }, "<")
              .to(beam.scale, { x: 1, y: 1, z: 1, duration: 0.5, yoyo: true, repeat: 1 }, "<");

            // 6. Message
            tl.to(camera.position, { x: 2, y: 4, z: 12, duration: 1 })
              .to(crystalGroup.rotation, { x: 0.2, y: 6.5, duration: 1 }, "<");

            // 7. Roadmap
            tl.to(camera.position, { x: 0, y: 6, z: 14, duration: 1 })
              .to(camera.rotation, { x: -0.2, duration: 1 }, "<")
              .to(crystalGroup.rotation, { x: 0, y: 7.5, duration: 1 }, "<");

            // Sections Logic
            function section(id, start, end) {
                const card = document.querySelector(`${id} .holo-card`);
                if(card) {
                    gsap.fromTo(card,
                        { y: 80, opacity: 0, scale: 0.9 },
                        {
                            y: 0, opacity: 1, scale: 1, duration: 0.6, ease: "back.out(1.2)",
                            scrollTrigger: {
                                trigger: "#scroll-spacer",
                                start: start * 100 + "% top",
                                end: end * 100 + "% top",
                                toggleActions: "play reverse play reverse"
                            }
                        }
                    );
                }

                ScrollTrigger.create({
                    trigger: "#scroll-spacer",
                    start: start * 100 + "% top",
                    end: end * 100 + "% top",
                    onEnter: () => gsap.to(id, { opacity: 1, pointerEvents: 'auto' }),
                    onLeave: () => gsap.to(id, { opacity: 0, pointerEvents: 'none' }),
                    onEnterBack: () => gsap.to(id, { opacity: 1, pointerEvents: 'auto' }),
                    onLeaveBack: () => gsap.to(id, { opacity: 0, pointerEvents: 'none' })
                });
            }

            // Timeline Distribution (Total 1000vh)
            section("#sec-drift",    0.02, 0.15);
            section("#sec-return",   0.18, 0.30);
            section("#sec-core",     0.33, 0.45);
            section("#sec-value",    0.48, 0.60);
            section("#sec-services", 0.63, 0.75);
            section("#sec-message",  0.78, 0.88);
            section("#sec-roadmap",  0.90, 0.98); // Adjusted to end earlier for finale
        }

        document.addEventListener('mousemove', (e) => {
            const x = (e.clientX / window.innerWidth - 0.5) * 20;
            const y = (e.clientY / window.innerHeight - 0.5) * 20;
            gsap.to(".float-icon", { x: x, y: y, duration: 1, ease: "power1.out" });
        });

        function hideLoader() {
            gsap.to("#loader", { opacity: 0, duration: 1, onComplete: () => {
                document.getElementById('loader').style.display = 'none';
            }});
        }

        if (document.readyState === 'complete') {
            hideLoader();
        } else {
            window.addEventListener('load', hideLoader);
        }

    </script>
</body>
</html>
