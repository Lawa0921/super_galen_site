<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leya | The Prism Core</title>
    <meta name="description" content="A brave heart drifting in the universe. Rational yet emotional.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;500;700&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --bg-color: #020205;
            --text-color: #f0f0f0;
            --accent-gold: #FFD700;
            --glass-border: rgba(255, 255, 255, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Noto Serif TC', serif;
            overflow-x: hidden;
            width: 100vw;
            scrollbar-width: none;
        }
        body::-webkit-scrollbar { display: none; }

        /* --- Canvas Wrapper --- */
        #webgl-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* --- Scroll Spacer --- */
        #scroll-spacer {
            height: 900vh; /* Longer scroll for 6 chapters */
            width: 100%;
            position: absolute;
            top: 0; left: 0;
            z-index: -1;
            pointer-events: none;
        }

        /* --- Content Layer --- */
        .content-section {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 10;
            opacity: 0;
            display: flex;
            padding: 5vw;
            transition: opacity 0.5s ease;
        }

        .content-section.active {
            pointer-events: auto;
        }

        /* Layouts - Alternating for dynamism */
        #sec-hero { justify-content: center; align-items: center; text-align: center; }

        /* 1. Drifting: Top Left */
        #sec-drifting { justify-content: flex-start; align-items: flex-start; padding-top: 15vh; padding-left: 8vw; }

        /* 2. Reset: Right Center */
        #sec-reset { justify-content: flex-end; align-items: center; padding-right: 8vw; }

        /* 3. Core: Bottom Left */
        #sec-core { justify-content: flex-start; align-items: flex-end; padding-bottom: 15vh; padding-left: 8vw; }

        /* 4. Catalyst: Top Right */
        #sec-catalyst { justify-content: flex-end; align-items: flex-start; padding-top: 15vh; padding-right: 8vw; }

        /* 5. Perspective: Left Center */
        #sec-perspective { justify-content: flex-start; align-items: center; padding-left: 8vw; }

        /* 6. Roadmap: Bottom Center */
        #sec-roadmap { justify-content: center; align-items: flex-end; padding-bottom: 5vh; }

        /* --- Glass Cards (Smaller & Cleaner) --- */
        .glass-card {
            background: rgba(10, 15, 20, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            padding: 2rem;
            max-width: 400px; /* Narrower for less text per block */
            width: 100%;
            border-radius: 2px;
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform-origin: center;
        }

        /* Gold Corners */
        .glass-card::before {
            content: ''; position: absolute; top: -1px; left: -1px;
            width: 15px; height: 15px; border-top: 1px solid var(--accent-gold); border-left: 1px solid var(--accent-gold);
        }
        .glass-card::after {
            content: ''; position: absolute; bottom: -1px; right: -1px;
            width: 15px; height: 15px; border-bottom: 1px solid var(--accent-gold); border-right: 1px solid var(--accent-gold);
        }

        h1, h2, h3 { font-family: 'Cinzel', serif; letter-spacing: 0.1em; }

        .hero-title {
            font-size: clamp(4rem, 12vw, 9rem);
            color: #fff;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 1.5rem;
            color: #fff;
            margin-bottom: 1rem;
            text-transform: uppercase;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: inline-block;
            letter-spacing: 2px;
        }

        p {
            font-size: 1rem;
            line-height: 1.8;
            margin-bottom: 1rem;
            color: #ddd;
            text-align: justify;
        }

        .highlight { color: var(--accent-gold); font-weight: 700; }

        /* Images in Cards */
        .card-img {
            width: 100%; height: 200px; object-fit: cover;
            border: 1px solid rgba(255,255,255,0.2);
            cursor: zoom-in;
            margin-bottom: 1rem;
            transition: transform 0.3s;
        }
        .card-img:hover { transform: scale(1.02); border-color: var(--accent-gold); }

        /* --- Footer --- */
        .fixed-footer {
            position: fixed; bottom: 2rem; width: 100%; text-align: center;
            z-index: 100; pointer-events: none;
        }
        .socials { pointer-events: auto; display: inline-flex; gap: 2rem; }
        .social-link { color: #555; font-size: 1.5rem; transition: 0.3s; }
        .social-link:hover { color: #fff; transform: scale(1.2); text-shadow: 0 0 10px #fff; }

        .nav-back {
            position: fixed; top: 2rem; left: 2rem; z-index: 100;
            color: #555; text-decoration: none; font-family: 'Cinzel'; transition: 0.3s;
        }
        .nav-back:hover { color: #fff; }

        /* Lightbox */
        #lightbox {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        #lightbox.active { opacity: 1; pointer-events: auto; }
        #lightbox-img { max-width: 90%; max-height: 90%; border: 2px solid var(--accent-gold); }

        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            color: var(--accent-gold); font-family: 'Cinzel'; letter-spacing: 0.2em;
        }

        @media (max-width: 900px) {
            .content-section { justify-content: center !important; align-items: flex-end !important; padding: 2rem; padding-bottom: 15vh; }
            .glass-card { padding: 1.5rem; background: rgba(0, 0, 0, 0.7); max-width: 100%; }
            /* Adjust individual padding resets for mobile */
            #sec-drifting, #sec-reset, #sec-core, #sec-catalyst, #sec-perspective { padding: 2rem; padding-bottom: 15vh; }
        }
    </style>
</head>
<body>

    <div id="loader">FORMING CLUSTER...</div>
    <a href="/guild/" class="nav-back">GUILD</a>

    <div id="webgl-container"></div>
    <div id="scroll-spacer"></div>

    <!-- Lightbox -->
    <div id="lightbox" onclick="this.classList.remove('active')">
        <img id="lightbox-img" src="">
    </div>

    <!-- 0. Hero -->
    <div id="sec-hero" class="content-section">
        <div>
            <h1 class="hero-title">LEYA</h1>
            <div style="color: #888; letter-spacing: 0.5em; text-transform: uppercase; font-size: 0.8rem;">Quartz Soul</div>
        </div>
    </div>

    <!-- 1. Drifting -->
    <div id="sec-drifting" class="content-section">
        <div class="glass-card">
            <h2 class="section-title">01. Drifting</h2>
            <img src="/assets/img/guild/leya/gallery_1.webp" class="card-img" onclick="openLightbox(this.src)">
            <p>
                30歲以前，我有三分之一的時間漂泊在海外。那是探索世界的旅程，也是尋找自我的流浪。
            </p>
        </div>
    </div>

    <!-- 2. Reset -->
    <div id="sec-reset" class="content-section">
        <div class="glass-card">
            <h2 class="section-title">02. Reset</h2>
            <img src="/assets/img/guild/leya/avatar.webp" class="card-img" onclick="openLightbox(this.src)">
            <p>
                當旅程暫告段落，回到台灣後，迎接我的不是安穩，而是內心巨大的衝擊與重新適應。在世俗眼光中，我彷彿一無所有。
            </p>
        </div>
    </div>

    <!-- 3. Core -->
    <div id="sec-core" class="content-section">
        <div class="glass-card">
            <h2 class="section-title">03. The Core</h2>
            <p>
                但我擁有一顆<span class="highlight">勇敢的心</span>。花了一年時間，我將碎裂的自己拼湊完整。我是感性與理性並存的矛盾體，對世界保持著孩子般的好奇。
            </p>
        </div>
    </div>

    <!-- 4. Catalyst -->
    <div id="sec-catalyst" class="content-section">
        <div class="glass-card">
            <h2 class="section-title">04. Catalyst</h2>
            <img src="/assets/img/guild/leya/gallery_2.webp" class="card-img" onclick="openLightbox(this.src)">
            <p>
                <strong>勇敢的催化劑</strong><br>
                如果你也正處於人生的十字路口，我希望能成為你的參照物——晚一點開始，真的沒關係。
            </p>
        </div>
    </div>

    <!-- 5. Perspective -->
    <div id="sec-perspective" class="content-section">
        <div class="glass-card">
            <h2 class="section-title">05. Perspective</h2>
            <img src="/assets/img/guild/leya/gallery_3.webp" class="card-img" onclick="openLightbox(this.src)">
            <p>
                在這個資訊過載的時代，我們練習剝開表象。敢於質疑權威，思考人性。一邊害怕，一邊前進。
            </p>
        </div>
    </div>

    <!-- 6. Roadmap -->
    <div id="sec-roadmap" class="content-section" style="flex-direction: column;">
        <div class="glass-card" style="text-align: center;">
            <h2 class="section-title">06. Next</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 1rem;">
                <img src="/assets/img/guild/leya/gallery_4.webp" class="card-img" style="height: 100px; margin: 0;" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/leya/gallery_5.webp" class="card-img" style="height: 100px; margin: 0;" onclick="openLightbox(this.src)">
            </div>
            <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 1rem;">
                <div style="font-size: 0.9rem;"><i class="fa-solid fa-earth-oceania" style="color: #a8c0ff;"></i> Australia</div>
                <div style="font-size: 0.9rem;"><i class="fa-solid fa-person-hiking" style="color: var(--accent-gold);"></i> Spain</div>
                <div style="font-size: 0.9rem;"><i class="fa-brands fa-youtube" style="color: #ff9a9e;"></i> Channel</div>
            </div>
        </div>
    </div>

    <div class="fixed-footer">
        <div class="socials">
            <a href="https://www.threads.net/@goodays.leya" target="_blank" class="social-link"><i class="fa-brands fa-threads"></i></a>
            <a href="https://www.instagram.com/goodays.leya/" target="_blank" class="social-link"><i class="fa-brands fa-instagram"></i></a>
        </div>
        <div style="margin-top: 1rem; color: #444; font-size: 0.8rem;">Made with ♥ for Guild</div>
    </div>

    <!-- MODULE SCRIPT -->
    <script>
        function openLightbox(src) {
            document.getElementById('lightbox-img').src = src;
            document.getElementById('lightbox').classList.add('active');
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { RoomEnvironment } from 'three/addons/environments/RoomEnvironment.js';

        // --- 1. Setup ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 0, 15);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.outputEncoding = THREE.SRGBColorSpace;
        container.appendChild(renderer.domElement);

        const pmremGenerator = new THREE.PMREMGenerator(renderer);
        pmremGenerator.compileEquirectangularShader();
        const roomEnvironment = new RoomEnvironment();
        scene.environment = pmremGenerator.fromScene(roomEnvironment).texture;

        // --- 2. Background Particles ---
        const canvas = document.createElement('canvas');
        canvas.width = 32; canvas.height = 32;
        const ctx = canvas.getContext('2d');
        ctx.beginPath();
        ctx.arc(16, 16, 14, 0, Math.PI * 2);
        ctx.fillStyle = '#ffffff';
        ctx.fill();
        const circleTexture = new THREE.CanvasTexture(canvas);

        const particlesGeo = new THREE.BufferGeometry();
        const particleCount = 1500;
        const posArray = new Float32Array(particleCount * 3);
        const colorArray = new Float32Array(particleCount * 3);

        for(let i=0; i<particleCount * 3; i+=3) {
            posArray[i] = (Math.random() - 0.5) * 60;
            posArray[i+1] = (Math.random() - 0.5) * 60;
            posArray[i+2] = (Math.random() - 0.5) * 40 - 20;

            const mix = Math.random();
            if(mix > 0.7) { // Gold
                colorArray[i] = 1.0; colorArray[i+1] = 0.9; colorArray[i+2] = 0.5;
            } else { // White/Blue
                colorArray[i] = 0.8; colorArray[i+1] = 0.9; colorArray[i+2] = 1.0;
            }
        }

        particlesGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        particlesGeo.setAttribute('color', new THREE.BufferAttribute(colorArray, 3));

        const particleMat = new THREE.PointsMaterial({
            size: 0.1, map: circleTexture, vertexColors: true,
            transparent: true, opacity: 0.6, blending: THREE.AdditiveBlending, depthWrite: false
        });
        scene.add(new THREE.Points(particlesGeo, particleMat));

        // --- 3. Quartz Cluster Geometry ---
        const crystalGroup = new THREE.Group();

        const material = new THREE.MeshPhysicalMaterial({
            color: 0xffffff,
            metalness: 0.0,
            roughness: 0.05, // Very smooth
            transmission: 1.0,
            thickness: 3.0, // Thicker glass
            ior: 2.0, // High Refraction
            reflectivity: 0.8,
            iridescence: 1.0,
            iridescenceIOR: 1.3,
            dispersion: 0.6,
            clearcoat: 1.0,
            side: THREE.DoubleSide,
            transparent: true,
            attenuationColor: new THREE.Color(0xe0f7fa),
            attenuationDistance: 3.0
        });

        // Generate Shards (Cylinders with pointed tops)
        function createQuartzShard(height, radius, angleY, tiltX) {
            const segments = 5 + Math.floor(Math.random()*2); // 5 or 6 sides
            const geo = new THREE.CylinderGeometry(0, radius, height, segments, 1, false);
            // Move pivot to bottom
            geo.translate(0, height/2, 0);
            const mesh = new THREE.Mesh(geo, material);

            // Random tilt
            mesh.rotation.x = tiltX;
            mesh.rotation.y = angleY;
            mesh.rotation.z = (Math.random() - 0.5) * 0.5;

            return mesh;
        }

        // Central Pillar
        const mainShard = createQuartzShard(6, 1.2, 0, 0);
        crystalGroup.add(mainShard);

        // Surrounding Shards
        const numShards = 8;
        for(let i=0; i<numShards; i++) {
            const angle = (Math.PI * 2 / numShards) * i;
            const h = 2 + Math.random() * 3;
            const w = 0.4 + Math.random() * 0.4;
            const tilt = 0.3 + Math.random() * 0.3; // Lean out

            const shard = createQuartzShard(h, w, angle, tilt);

            // Position at base
            shard.position.x = Math.sin(angle) * 0.8;
            shard.position.z = Math.cos(angle) * 0.8;
            shard.position.y = -1 + Math.random(); // Varied height base

            // Look away from center
            shard.lookAt(new THREE.Vector3(shard.position.x * 2, 0, shard.position.z * 2));
            shard.rotateX(Math.PI / 2 - tilt); // Adjust tilt relative to lookAt

            crystalGroup.add(shard);
        }

        // Glow Core
        const coreGeo = new THREE.IcosahedronGeometry(1, 0);
        const coreMat = new THREE.MeshBasicMaterial({
            color: 0xffd700, wireframe: true, transparent: true, opacity: 0.2
        });
        const core = new THREE.Mesh(coreGeo, coreMat);
        core.position.y = 1;
        crystalGroup.add(core);

        scene.add(crystalGroup);

        // --- 4. Lights ---
        const lightGroup = new THREE.Group();
        scene.add(lightGroup);
        const lightColors = [0xffffff, 0xffd700, 0xa8c0ff];
        lightColors.forEach((c, i) => {
            const l = new THREE.PointLight(c, 8, 30);
            l.position.set(Math.sin(i*2)*8, Math.cos(i*2)*8, 8);
            lightGroup.add(l);
        });

        // --- Animation ---
        function animate() {
            requestAnimationFrame(animate);
            const t = Date.now() * 0.0005;

            // Gentle float
            crystalGroup.position.y = Math.sin(t) * 0.2;
            crystalGroup.rotation.y += 0.001; // Slow spin base

            lightGroup.rotation.z = t * 0.2;
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- GSAP Scroll ---
        gsap.registerPlugin(ScrollTrigger);

        function initScroll() {
            // Helper for sections
            function sectionAnim(id, start, end) {
                const card = document.querySelector(`${id} .glass-card`) || document.querySelector(`${id} > div`);
                if(card) {
                    gsap.fromTo(card,
                        { y: 50, opacity: 0, scale: 0.9 },
                        {
                            y: 0, opacity: 1, scale: 1, duration: 0.8, ease: "power2.out",
                            scrollTrigger: {
                                trigger: "#scroll-spacer",
                                start: start * 100 + "% top",
                                end: end * 100 + "% top",
                                toggleActions: "play reverse play reverse"
                            }
                        }
                    );
                }

                ScrollTrigger.create({
                    trigger: "#scroll-spacer",
                    start: start * 100 + "% top",
                    end: end * 100 + "% top",
                    onEnter: () => gsap.to(id, { opacity: 1, pointerEvents: 'auto' }),
                    onLeave: () => gsap.to(id, { opacity: 0, pointerEvents: 'none' }),
                    onEnterBack: () => gsap.to(id, { opacity: 1, pointerEvents: 'auto' }),
                    onLeaveBack: () => gsap.to(id, { opacity: 0, pointerEvents: 'none' })
                });
            }

            // Camera Timeline
            let tl = gsap.timeline({
                scrollTrigger: {
                    trigger: "#scroll-spacer",
                    start: "top top",
                    end: "bottom bottom",
                    scrub: 1
                }
            });

            // 0. Hero (Center) -> 1. Drifting (Top Left)
            tl.to(camera.position, { z: 12, x: 4, y: -2, duration: 1 })
              .to(crystalGroup.rotation, { y: 1, x: 0.2, duration: 1 }, "<");

            // 1 -> 2. Reset (Right Center)
            tl.to(camera.position, { z: 10, x: -4, y: 0, duration: 1 })
              .to(crystalGroup.rotation, { y: 2.5, x: -0.2, duration: 1 }, "<");

            // 2 -> 3. Core (Bottom Left)
            tl.to(camera.position, { z: 8, x: 3, y: 3, duration: 1 })
              .to(crystalGroup.rotation, { y: 4, x: 0.5, duration: 1 }, "<");

            // 3 -> 4. Catalyst (Top Right)
            tl.to(camera.position, { z: 9, x: -3, y: -3, duration: 1 })
              .to(crystalGroup.rotation, { y: 5, x: -0.5, duration: 1 }, "<");

            // 4 -> 5. Perspective (Left Center)
            tl.to(camera.position, { z: 11, x: 4, y: 0, duration: 1 })
              .to(crystalGroup.rotation, { y: 6, x: 0, duration: 1 }, "<");

            // 5 -> 6. Roadmap (Bottom Center)
            tl.to(camera.position, { z: 14, x: 0, y: 5, duration: 1 })
              .to(crystalGroup.rotation, { y: 7, x: 0.5, duration: 1 }, "<")
              .to(camera.rotation, { x: -0.3, duration: 1 }, "<");

            // Init Sections
            // Scroll Length is 900vh = 9 units.
            // 6 sections + Hero. ~14% per section.
            sectionAnim("#sec-hero", 0, 0.05);
            sectionAnim("#sec-drifting", 0.10, 0.22);
            sectionAnim("#sec-reset", 0.25, 0.37);
            sectionAnim("#sec-core", 0.40, 0.52);
            sectionAnim("#sec-catalyst", 0.55, 0.67);
            sectionAnim("#sec-perspective", 0.70, 0.82);
            sectionAnim("#sec-roadmap", 0.85, 1.0);
        }

        window.addEventListener('load', () => {
            gsap.to("#loader", { opacity: 0, duration: 1, onComplete: () => {
                document.getElementById('loader').style.display = 'none';
                initScroll();
            }});
        });

    </script>
</body>
</html>
