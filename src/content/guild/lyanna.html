<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lyanna | The Cosmic Navigator</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+TC:wght@300;500;700;900&family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>

    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --c-bg: #050510; /* Deep Space */
            --c-text: #e0e0e0;
            --c-gold: #ffd700;
            --c-purple: #9b59b6;
            --c-blue: #3498db;
            --c-glass: rgba(20, 20, 30, 0.7);

            --f-title: 'Cinzel', serif;
            --f-body: 'Noto Serif TC', serif;
            --f-ui: 'Montserrat', sans-serif;
        }

        body {
            margin: 0;
            overflow-x: hidden;
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: var(--f-body);
        }

        /* --- LAYOUT & CANVAS --- */
        #canvas-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100vh;
            z-index: 0;
            pointer-events: none;
        }

        .scrolly-container {
            position: relative;
            z-index: 10;
        }

        section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            box-sizing: border-box;
            position: relative;
        }

        /* --- UI COMPONENTS --- */
        .nav-back {
            position: fixed; top: 2rem; left: 2rem; z-index: 100;
            font-family: var(--f-ui);
            font-weight: bold;
            font-size: 0.9rem; letter-spacing: 2px;
            color: var(--c-gold); text-decoration: none;
            padding: 0.8rem 1.5rem;
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--c-gold);
            backdrop-filter: blur(5px);
            transition: 0.3s;
            text-transform: uppercase;
        }
        .nav-back:hover {
            background: var(--c-gold); color: var(--c-bg);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }

        .glass-panel {
            background: var(--c-glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 3rem;
            max-width: 650px;
            width: 100%;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .glass-panel:hover {
            border-color: rgba(255, 215, 0, 0.3);
            box-shadow: 0 10px 50px rgba(52, 152, 219, 0.15);
        }
        /* Tech/Sci-fi Corners */
        .glass-panel::before, .glass-panel::after {
            content: ''; position: absolute; width: 20px; height: 20px;
            border: 1px solid var(--c-gold);
            transition: 0.3s;
        }
        .glass-panel::before { top: -1px; left: -1px; border-right: none; border-bottom: none; }
        .glass-panel::after { bottom: -1px; right: -1px; border-left: none; border-top: none; }


        h2 {
            font-family: var(--f-title);
            color: var(--c-gold);
            font-size: 2.5rem; margin: 0 0 1rem 0;
            text-transform: uppercase;
            letter-spacing: 3px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 0.5rem;
            display: inline-block;
        }

        .subtitle {
            font-family: var(--f-ui);
            color: var(--c-blue);
            font-size: 0.9rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 1.5rem;
            display: block;
        }

        p {
            font-size: 1.1rem; line-height: 2; margin-bottom: 1.5rem; color: #ccc;
            text-align: justify;
        }

        .highlight { color: var(--c-gold); font-weight: bold; }
        .highlight-blue { color: var(--c-blue); font-weight: bold; }

        ul.star-list {
            list-style: none; padding: 0; margin: 0;
        }
        ul.star-list li {
            margin-bottom: 1rem; padding-left: 1.5rem; position: relative;
            font-size: 1.05rem; color: #ddd;
        }
        ul.star-list li::before {
            content: '✦'; position: absolute; left: 0; top: 2px; color: var(--c-gold);
        }


        /* --- HERO --- */
        #hero {
            flex-direction: column; text-align: center;
            height: 100vh;
        }
        .avatar-frame {
            width: 220px; height: 220px; margin-bottom: 2rem;
            position: relative;
            border-radius: 50%;
            padding: 5px;
            background: linear-gradient(45deg, var(--c-blue), var(--c-purple), var(--c-gold));
            animation: rotate-border 4s linear infinite;
        }
        .avatar-img {
            width: 100%; height: 100%; border-radius: 50%;
            object-fit: cover; border: 4px solid var(--c-bg);
            background: var(--c-bg);
            position: relative; z-index: 2;
        }
        @keyframes rotate-border { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }

        .hero-title {
            font-family: var(--f-title); font-size: 4.5rem;
            background: linear-gradient(to right, #fff, #aaa);
            -webkit-background-clip: text; color: transparent;
            margin: 0; letter-spacing: 5px;
            text-shadow: 0 0 30px rgba(255,255,255,0.3);
        }
        .hero-role {
            font-family: var(--f-ui); font-size: 1rem; letter-spacing: 4px; color: var(--c-blue);
            margin-top: 1rem; text-transform: uppercase;
        }

        /* --- COURSE DECK --- */
        #course-deck {
            height: 200vh; /* Extra height for scroll duration */
            display: flex;
            align-items: center;
            justify-content: center;
            /* Content is handled by Canvas */
        }
        .deck-instructions {
            position: absolute; bottom: 10%; left: 50%; transform: translateX(-50%);
            font-family: var(--f-ui); color: var(--c-gold); letter-spacing: 2px; font-size: 0.8rem;
            background: rgba(0,0,0,0.5); padding: 0.5rem 1rem; border-radius: 20px;
            pointer-events: none; opacity: 0;
            border: 1px solid var(--c-gold);
        }


        /* --- FOOTER --- */
        footer {
            padding: 3rem; text-align: center; font-family: var(--f-ui); font-size: 0.8rem; color: #555;
            background: #000; position: relative; z-index: 10;
        }
        .social-links {
            display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem;
        }
        .social-btn {
            width: 50px; height: 50px; border-radius: 50%;
            border: 1px solid var(--c-text); color: var(--c-text);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; text-decoration: none;
            transition: 0.3s;
        }
        .social-btn:hover {
            background: var(--c-gold); color: #000; border-color: var(--c-gold);
            transform: scale(1.1); box-shadow: 0 0 20px var(--c-gold);
        }

        @media (max-width: 768px) {
            .hero-title { font-size: 2.8rem; }
            .glass-panel { padding: 2rem 1.5rem; }
            section { padding: 1rem; }
        }
    </style>
</head>
<body>

    <a href="/guild/" class="nav-back">Guild Hall</a>

    <div id="canvas-container"></div>

    <div class="scrolly-container">

        <!-- 1. HERO -->
        <section id="hero">
            <div class="avatar-frame">
                <img src="/assets/img/guild/lyanna/avatar.webp" class="avatar-img" alt="Lyanna">
            </div>
            <h1 class="hero-title">LYANNA</h1>
            <div class="hero-role">The Cosmic Navigator</div>
            <div style="margin-top: 2rem; font-family: var(--f-ui); color: #888;">SCROLL TO EXPLORE</div>
        </section>

        <!-- 2. INTRO (Why) -->
        <section id="philosophy">
            <div class="glass-panel">
                <span class="subtitle">01. Origin</span>
                <h2>The Compass</h2>
                <p>
                    我是 <b>允曦 Lyanna</b>，華語教師培訓課程創辦者，也是一位 <span class="highlight">MMT 個人天賦諮詢師</span>。
                </p>
                <p>
                    在陪伴許多老師與學員的過程中，我發現多數人卡住的，從來不只是考試。
                    而是：<br>
                    <span class="highlight-blue">「我適合嗎？」</span><br>
                    <span class="highlight-blue">「我能走多遠？」</span>
                </p>
                <p>
                    因此，我將華語教學專業結合天賦分析，讓學習不只停在證照，而是回到人生整體的選擇。
                    我不只教你如何考試，更陪你找到<span class="highlight">屬於你的航道</span>。
                </p>
            </div>
        </section>

        <!-- 3. SERVICES (What) -->
        <section id="services" style="align-items: flex-start;">
            <div class="glass-panel" style="margin-left: auto; margin-right: 5%;">
                <span class="subtitle">02. Methodology</span>
                <h2>The Map</h2>
                <p>我專注於陪伴對華語教學有熱情的人，從迷惘到真正走出去。</p>
                <ul class="star-list">
                    <li><b>教育部華語教師證照</b>：系統化培訓，拆解考試難點。</li>
                    <li><b>海外職涯規劃</b>：結合真實海外教學經驗，提供落地建議。</li>
                    <li><b>轉職與人生探索</b>：運用 MMT 天賦系統，釐清你的核心優勢。</li>
                </ul>
                <p style="margin-top: 2rem;">
                    真正能走得遠的，不只是會考試的人，而是<span class="highlight">對自己有理解、對選擇有準備的人</span>。
                </p>
            </div>
        </section>

        <!-- 4. COURSE DECK (The 3D Carousel) -->
        <section id="course-deck">
            <!-- Invisible trigger for GSAP/ThreeJS -->
            <div class="deck-instructions">SCROLL TO ROTATE DECK</div>
        </section>

        <!-- 5. FINAL CALL -->
        <section id="contact">
            <div class="glass-panel" style="text-align: center;">
                <span class="subtitle">03. Boarding</span>
                <h2>Start Your Journey</h2>
                <p>
                    如果你正在思考是否要投入華語教學、是否適合走向海外，
                    或正在轉職的路口。
                </p>
                <p>
                    希望能用我走過的經驗，陪你把「華語」變成一條<span class="highlight">穩定、清楚、走得出去的路</span>。
                </p>
            </div>
        </section>

        <!-- FOOTER -->
        <footer>
            <div class="social-links">
                <a href="https://www.threads.com/@fun_2_journey" target="_blank" class="social-btn"><i class="fa-brands fa-threads"></i></a>
                <a href="https://www.instagram.com/fun_2_journey/" target="_blank" class="social-btn"><i class="fa-brands fa-instagram"></i></a>
                <a href="https://www.mosme.net/mosme/book?s=%E5%85%81%E6%9B%A6" target="_blank" class="social-btn"><i class="fa-solid fa-book"></i></a>
            </div>
            <p>Made with <i class="fa-solid fa-heart" style="color:var(--c-gold);"></i> by <a href="#" style="color:#777;text-decoration:none;">SuperGalen's Dungeon</a></p>
            <br>
            <a href="/guild/" style="color: #444; text-decoration: none; font-size: 0.7rem;">RETURN TO GUILD</a>
        </footer>

    </div>

    <script type="module">
        import * as THREE from 'three';

        // --- 1. SETUP ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050510, 0.03); // Deep space fog

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- 2. STARS (Constellation) ---
        const starCount = 800;
        const starGeo = new THREE.BufferGeometry();
        const starPos = [];

        for(let i=0; i<starCount; i++) {
            const x = (Math.random() - 0.5) * 60;
            const y = (Math.random() - 0.5) * 60;
            const z = (Math.random() - 0.5) * 100; // Deep Z
            starPos.push(x, y, z);
        }
        starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));

        const starMat = new THREE.PointsMaterial({
            color: 0xffffff,
            size: 0.1,
            transparent: true,
            opacity: 0.8
        });
        const starSystem = new THREE.Points(starGeo, starMat);
        scene.add(starSystem);

        // Lines connecting stars (Constellation effect)
        const lineGeo = new THREE.BufferGeometry();
        const linePos = [];
        // Connect random pairs if close
        for(let i=0; i<300; i++) {
             const idx1 = Math.floor(Math.random() * starCount);
             const idx2 = Math.floor(Math.random() * starCount);

             const x1 = starPos[idx1*3]; const y1 = starPos[idx1*3+1]; const z1 = starPos[idx1*3+2];
             const x2 = starPos[idx2*3]; const y2 = starPos[idx2*3+1]; const z2 = starPos[idx2*3+2];

             // Distance check roughly
             const dist = Math.sqrt((x1-x2)**2 + (y1-y2)**2 + (z1-z2)**2);
             if (dist < 15) {
                linePos.push(x1,y1,z1, x2,y2,z2);
             }
        }
        lineGeo.setAttribute('position', new THREE.Float32BufferAttribute(linePos, 3));
        const lineMat = new THREE.LineBasicMaterial({ color: 0x3498db, transparent: true, opacity: 0.2 });
        const lines = new THREE.LineSegments(lineGeo, lineMat);
        scene.add(lines);


        // --- 3. COURSE CAROUSEL (3D Deck) ---
        const deckGroup = new THREE.Group();
        deckGroup.position.set(0, -50, -20); // Hidden initially
        deckGroup.visible = false;
        scene.add(deckGroup);

        const slideUrls = [
            '/assets/img/guild/lyanna/slide_1.webp',
            '/assets/img/guild/lyanna/slide_2.webp',
            '/assets/img/guild/lyanna/slide_3.webp',
            '/assets/img/guild/lyanna/slide_4.webp',
            '/assets/img/guild/lyanna/slide_5.webp'
        ];

        const loader = new THREE.TextureLoader();
        const radius = 5;
        const totalSlides = slideUrls.length;

        slideUrls.forEach((url, i) => {
            loader.load(url, (tex) => {
                tex.colorSpace = THREE.SRGBColorSpace;
                // Default aspect 1.5 if not loaded yet, but usually we wait.
                // We'll fix aspect ratio to standard slide (16:9 or 4:3)
                const geo = new THREE.PlaneGeometry(5, 3.5);
                const mat = new THREE.MeshBasicMaterial({
                    map: tex,
                    side: THREE.DoubleSide
                });
                const mesh = new THREE.Mesh(geo, mat);

                // Cylinder layout
                const angle = (i / totalSlides) * Math.PI * 2;
                mesh.position.x = Math.sin(angle) * radius;
                mesh.position.z = Math.cos(angle) * radius;

                // Rotate to face CENTER (so camera inside sees them)
                // mesh.lookAt(0, 0, 0);
                // Actually we want them facing OUT if camera is outside, or IN if camera is inside.
                // Let's make them face OUT and camera rotates around them?
                // Or camera inside?
                // Let's try: Cards in a circle, rotating around Y axis.

                mesh.rotation.y = angle; // Tangential? No.
                mesh.lookAt(0,0,0);
                mesh.rotation.y += Math.PI; // Face outwards

                deckGroup.add(mesh);
            });
        });


        // --- 4. ANIMATION LOOP ---
        const clock = new THREE.Clock();

        // Mouse Interaction
        let mouseX = 0;
        let mouseY = 0;
        window.addEventListener('mousemove', (e) => {
            mouseX = (e.clientX - window.innerWidth / 2) * 0.0005;
            mouseY = (e.clientY - window.innerHeight / 2) * 0.0005;
        });

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // Star motion
            starSystem.rotation.y += 0.0002;
            lines.rotation.y += 0.0002;

            // Parallax
            scene.rotation.x += (mouseY - scene.rotation.x) * 0.05;
            scene.rotation.y += (mouseX - scene.rotation.y) * 0.05;

            renderer.render(scene, camera);
        }
        animate();


        // --- 5. GSAP SCROLL LOGIC ---
        // Register
        gsap.registerPlugin(ScrollTrigger);

        // A. Deep Space Dive
        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: "body",
                start: "top top",
                end: "bottom bottom",
                scrub: 1
            }
        });

        tl.to(camera.position, { z: -10, ease: "none" });

        // B. Reveal Deck Section
        ScrollTrigger.create({
            trigger: "#course-deck",
            start: "top center",
            end: "bottom bottom",
            onEnter: () => {
                deckGroup.visible = true;
                gsap.to(deckGroup.position, { y: 0, z: -15, duration: 1.5, ease: "power2.out" });
                gsap.to(".deck-instructions", { opacity: 1, duration: 0.5 });
            },
            onLeaveBack: () => {
                gsap.to(deckGroup.position, { y: -50, duration: 1, onComplete: () => { deckGroup.visible = false; } });
                gsap.to(".deck-instructions", { opacity: 0 });
            }
        });

        // C. Rotate Deck
        gsap.to(deckGroup.rotation, {
            y: Math.PI * 2,
            ease: "none",
            scrollTrigger: {
                trigger: "#course-deck",
                start: "top bottom",
                end: "bottom top",
                scrub: 1
            }
        });


        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>