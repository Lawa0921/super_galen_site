<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lyanna | The Cosmic Navigator</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Noto+Serif+TC:wght@300;500;700;900&family=Montserrat:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        :root {
            --c-bg: #000000;
            --c-gold: #FFD700;
            --c-gold-dim: #AA8800;
            --c-purple: #9D00FF;
            --c-blue: #00FFFF;
            --f-title: 'Cinzel', serif;
            --f-body: 'Noto Serif TC', serif;
            --f-ui: 'Montserrat', sans-serif;
        }

        body {
            margin: 0;
            overflow-x: hidden;
            background-color: var(--c-bg);
            color: #fff;
            font-family: var(--f-body);
        }

        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            z-index: 0;
        }

        /* --- UI OVERLAY --- */
        .scrolly-container {
            position: relative; z-index: 10;
        }

        section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 4rem;
            box-sizing: border-box;
            position: relative;
            perspective: 1000px;
        }

        /* Nav */
        .nav-back {
            position: fixed; top: 2rem; left: 2rem; z-index: 100;
            font-family: var(--f-ui); font-weight: 900;
            font-size: 0.8rem; letter-spacing: 3px;
            color: var(--c-gold); text-decoration: none;
            padding: 1rem 2rem;
            border: 1px solid var(--c-gold);
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
            transition: 0.4s;
            text-transform: uppercase;
        }
        .nav-back:hover {
            background: var(--c-gold); color: #000;
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
            box-shadow: 0 0 30px var(--c-gold);
        }

        /* Glass Cards */
        .glass-card {
            background: rgba(10, 10, 15, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 215, 0, 0.2);
            padding: 3rem;
            max-width: 600px;
            position: relative;
            transform-style: preserve-3d;
            border-left: 5px solid var(--c-gold);
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            opacity: 0; /* JS Fade in */
            transform: translateY(50px);
            transition: transform 0.3s;
        }
        .glass-card:hover {
            transform: scale(1.02) translateY(0) !important;
            border-color: var(--c-gold);
        }

        /* Tech Decoration */
        .glass-card::before {
            content: ''; position: absolute; top: -10px; right: -10px;
            width: 40px; height: 40px;
            border-top: 2px solid var(--c-gold);
            border-right: 2px solid var(--c-gold);
        }
        .glass-card::after {
            content: ''; position: absolute; bottom: -10px; left: -10px;
            width: 40px; height: 40px;
            border-bottom: 2px solid var(--c-gold);
            border-left: 2px solid var(--c-gold);
        }

        /* Layout Helpers */
        .left { margin-right: auto; }
        .right { margin-left: auto; }
        .center { margin: 0 auto; }

        h1 {
            font-family: var(--f-title); font-size: 8vw; line-height: 0.9;
            color: transparent; -webkit-text-stroke: 2px var(--c-gold);
            text-transform: uppercase; margin: 0;
            position: relative; z-index: 2;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            mix-blend-mode: lighten;
            opacity: 0; transform: translateY(50px);
        }
        h1 span { display: block; font-size: 2rem; letter-spacing: 10px; color: #fff; -webkit-text-stroke: 0; margin-top: 1rem; font-family: var(--f-ui); }

        h2 {
            font-family: var(--f-title); font-size: 3rem; color: #fff;
            margin: 0 0 1rem 0; text-transform: uppercase;
        }
        .subtitle {
            font-family: var(--f-ui); color: var(--c-gold); letter-spacing: 4px;
            font-size: 0.9rem; margin-bottom: 1rem; display: block; font-weight: 700;
        }

        p {
            font-size: 1.1rem; line-height: 1.8; color: #ddd; margin-bottom: 1.5rem;
            text-shadow: 0 2px 5px rgba(0,0,0,0.8);
        }

        .highlight { color: var(--c-gold); font-weight: 700; text-shadow: 0 0 10px var(--c-gold-dim); }
        .highlight-blue { color: var(--c-blue); font-weight: 700; text-shadow: 0 0 10px rgba(0,255,255,0.4); }

        /* HERO Avatar */
        .hero-avatar {
            width: 300px; height: 300px;
            position: absolute; right: 10%; top: 20%;
            border-radius: 50%;
            border: 2px solid var(--c-gold);
            box-shadow: 0 0 50px var(--c-gold);
            overflow: hidden;
            z-index: 1;
            opacity: 0; transform: scale(0.8);
        }
        .hero-avatar img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%) contrast(1.2); transition: 1s; }
        .hero-avatar:hover img { filter: grayscale(0%); transform: scale(1.1); }


        /* COURSE GALLERY SCROLL SECTION */
        #course-tunnel {
            height: 400vh; /* Long scroll for tunnel */
            justify-content: flex-start;
            padding: 0;
        }
        .tunnel-content {
            position: sticky; top: 0; height: 100vh; width: 100%;
            display: flex; align-items: center; justify-content: center;
            pointer-events: none; /* Let clicks pass to 3D if needed */
        }
        .tunnel-text {
            text-align: center;
            background: rgba(0,0,0,0.6); padding: 2rem;
            backdrop-filter: blur(5px); border: 1px solid #333;
            transform: translateY(-20vh); /* Move up a bit */
        }

        /* FOOTER */
        footer {
            padding: 4rem 2rem; text-align: center; font-family: var(--f-ui);
            background: #000; position: relative; z-index: 20; border-top: 1px solid #333;
        }
        .social-row { display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem; }
        .social-icon {
            font-size: 2rem; color: #555; transition: 0.3s;
        }
        .social-icon:hover { color: var(--c-gold); text-shadow: 0 0 20px var(--c-gold); transform: translateY(-5px); }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 15vw; }
            h1 span { font-size: 1rem; }
            section { padding: 1.5rem; }
            .hero-avatar { width: 200px; height: 200px; top: 15%; right: 50%; transform: translateX(50%) scale(0.8); position: relative; margin-bottom: 2rem; margin-top: 5rem; }
            .glass-card { padding: 1.5rem; width: 100%; }
            #hero { justify-content: flex-start; padding-top: 6rem; }
        }
    </style>
</head>
<body>

    <a href="/guild/" class="nav-back">Guild Hall</a>
    <div id="canvas-container"></div>

    <div class="scrolly-container">

        <!-- 1. HERO -->
        <section id="hero">
            <div class="hero-avatar">
                <img src="/assets/img/guild/lyanna/avatar.webp" alt="Lyanna">
            </div>
            <h1 class="glitch-text">LYANNA<span>COSMIC NAVIGATOR</span></h1>

            <div style="margin-top: 2rem; font-family: var(--f-ui); color: var(--c-gold); letter-spacing: 2px;">
                <i class="fa-solid fa-arrow-down"></i> INITIATE SEQUENCE
            </div>
        </section>

        <!-- 2. ORIGIN -->
        <section id="origin" style="align-items: flex-start;">
            <div class="glass-card left">
                <span class="subtitle">01. THE COMPASS</span>
                <h2>ORIGIN</h2>
                <p>我是 <b>允曦 Lyanna</b>，華語教師培訓課程創辦者，<br>同時也是 <span class="highlight">MMT 個人天賦諮詢師</span>。</p>
                <p>在引導無數學員的過程中，我發現真正的障礙從來不是考試，而是對未來的迷惘：<br>
                <span class="highlight-blue">「我適合嗎？」</span> <span class="highlight-blue">「這條路能走多遠？」</span></p>
                <p>我將華語教學專業結合天賦分析，陪你找到<span class="highlight">屬於你的航道</span>。</p>
            </div>
        </section>

        <!-- 3. METHODOLOGY -->
        <section id="method" style="align-items: flex-end;">
            <div class="glass-card right">
                <span class="subtitle">02. THE MAP</span>
                <h2>METHODOLOGY</h2>
                <p>我不只教你如何考試，更陪你釐清方向。</p>
                <ul style="list-style:none; padding:0; line-height:2; color:#ddd;">
                    <li><i class="fa-solid fa-star" style="color:var(--c-gold)"></i> <b>教育部華語教師證照</b>：系統化培訓，拆解難點。</li>
                    <li><i class="fa-solid fa-star" style="color:var(--c-gold)"></i> <b>海外職涯規劃</b>：真實海外經驗，落地建議。</li>
                    <li><i class="fa-solid fa-star" style="color:var(--c-gold)"></i> <b>轉職與人生探索</b>：運用 MMT 系統，釐清核心優勢。</li>
                </ul>
                <p>真正能走得遠的，是對自己有理解、對選擇有準備的人。</p>
            </div>
        </section>

        <!-- 4. TUNNEL GALLERY -->
        <section id="course-tunnel">
            <div class="tunnel-content">
                <div class="tunnel-text">
                    <h2 style="font-size: 4rem; color: var(--c-gold);">THE COURSE</h2>
                    <p>SCROLL TO DIVE DEEP</p>
                </div>
            </div>
        </section>

        <!-- 5. FINAL -->
        <section id="final" style="justify-content: center; align-items: center;">
            <div class="glass-card center" style="text-align: center; border-color: var(--c-blue);">
                <span class="subtitle">03. BOARDING</span>
                <h2>START YOUR JOURNEY</h2>
                <p>如果你正在思考是否投入華語教學，或站在人生的十字路口。</p>
                <p>讓我用走過的經驗，陪你把「華語」變成一條<br><span class="highlight" style="font-size:1.5rem;">穩定、清楚、走得出去的路</span>。</p>
            </div>
        </section>

        <footer>
            <div class="social-row">
                <a href="https://www.threads.com/@fun_2_journey" target="_blank" class="social-icon"><i class="fa-brands fa-threads"></i></a>
                <a href="https://www.instagram.com/fun_2_journey/" target="_blank" class="social-icon"><i class="fa-brands fa-instagram"></i></a>
                <a href="https://www.mosme.net/mosme/book?s=%E5%85%81%E6%9B%A6" target="_blank" class="social-icon"><i class="fa-solid fa-book"></i></a>
            </div>
            <p>Made with <i class="fa-solid fa-bolt" style="color:var(--c-gold);"></i> by <a href="#" style="color:#666;">SuperGalen's Dungeon</a></p>
            <a href="/guild/" style="color: #444; font-size: 0.7rem; text-decoration: none;">RETURN TO GUILD</a>
        </footer>
    </div>

    <!-- SCRIPT -->
    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // --- 1. SCENE SETUP ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        // scene.fog = new THREE.FogExp2(0x000000, 0.02); // Removed fog to let bloom shine

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        const renderer = new THREE.WebGLRenderer({ antialias: false, powerPreference: "high-performance" });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
        renderer.toneMapping = THREE.ReinhardToneMapping;
        container.appendChild(renderer.domElement);

        // --- 2. POST PROCESSING (BLOOM) ---
        const renderScene = new RenderPass(scene, camera);
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0;
        bloomPass.strength = 1.5; // Intense bloom
        bloomPass.radius = 0.5;

        const composer = new EffectComposer(renderer);
        composer.addPass(renderScene);
        composer.addPass(bloomPass);

        // --- 3. GOLDEN FLUX (Instanced Particles) ---
        const particleCount = 2000;
        const geometry = new THREE.TetrahedronGeometry(0.05); // Sharp shards
        const material = new THREE.MeshBasicMaterial({ color: 0xFFD700 });
        const particles = new THREE.InstancedMesh(geometry, material, particleCount);

        const dummy = new THREE.Object3D();
        const pData = []; // Store speed/offset

        for (let i = 0; i < particleCount; i++) {
            dummy.position.set(
                (Math.random() - 0.5) * 60,
                (Math.random() - 0.5) * 60,
                (Math.random() - 0.5) * 100 - 20
            );
            dummy.rotation.set(Math.random()*Math.PI, Math.random()*Math.PI, 0);
            dummy.scale.setScalar(Math.random() * 2 + 0.5);
            dummy.updateMatrix();
            particles.setMatrixAt(i, dummy.matrix);

            pData.push({
                x: dummy.position.x,
                y: dummy.position.y,
                z: dummy.position.z,
                speed: Math.random() * 0.1 + 0.02,
                rotSpeed: (Math.random() - 0.5) * 0.05
            });
        }
        scene.add(particles);

        // --- 4. COURSE SPIRAL TUNNEL ---
        const tunnelGroup = new THREE.Group();
        scene.add(tunnelGroup);

        const slideUrls = [
            '/assets/img/guild/lyanna/slide_1.webp',
            '/assets/img/guild/lyanna/slide_2.webp',
            '/assets/img/guild/lyanna/slide_3.webp',
            '/assets/img/guild/lyanna/slide_4.webp',
            '/assets/img/guild/lyanna/slide_5.webp'
        ];
        const loader = new THREE.TextureLoader();

        // Create 20 items (repeat textures)
        for (let i = 0; i < 20; i++) {
            loader.load(slideUrls[i % slideUrls.length], (tex) => {
                tex.colorSpace = THREE.SRGBColorSpace;
                const mat = new THREE.MeshBasicMaterial({ map: tex, side: THREE.DoubleSide });
                const geo = new THREE.PlaneGeometry(8, 5); // Bigger cards
                const mesh = new THREE.Mesh(geo, mat);

                // Spiral Position
                const angle = i * 0.5;
                const radius = 10;
                const zPos = -30 - (i * 15); // Deep spacing

                mesh.position.set(Math.cos(angle)*radius, Math.sin(angle)*radius, zPos);

                // Look at center line, but slightly tilted
                mesh.lookAt(0,0, zPos + 20);
                mesh.rotation.z = angle; // Tilt with spiral

                tunnelGroup.add(mesh);
            });
        }
        tunnelGroup.visible = false; // Hidden until tunnel section

        // --- 5. ANIMATION LOOP ---
        let time = 0;
        let speedMult = 1; // Speed multiplier for "Warp"

        function animate() {
            requestAnimationFrame(animate);
            time += 0.01;

            // Particles Flow
            for (let i = 0; i < particleCount; i++) {
                const d = pData[i];
                // Move towards camera (positive Z)
                d.z += d.speed * speedMult;

                // Wrap around
                if (d.z > 10) d.z = -100;

                dummy.position.set(d.x, d.y, d.z);
                dummy.rotation.x += d.rotSpeed;
                dummy.rotation.y += d.rotSpeed;
                dummy.updateMatrix();
                particles.setMatrixAt(i, dummy.matrix);
            }
            particles.instanceMatrix.needsUpdate = true;

            // Camera subtle movement (unless in tunnel)
            if(!tunnelGroup.visible) {
                camera.rotation.z = Math.sin(time * 0.2) * 0.05;
                camera.position.x = Math.sin(time * 0.1) * 0.5;
                camera.position.y = Math.cos(time * 0.1) * 0.5;
            }

            composer.render();
        }
        animate();


        // --- 6. GSAP INTERACTION ---
        gsap.registerPlugin(ScrollTrigger);

        // A. Reveal Hero
        gsap.to(".hero-avatar", { opacity: 1, scale: 1, duration: 2, ease: "elastic.out(1, 0.5)" });
        gsap.to("h1", { opacity: 1, y: 0, duration: 1.5, delay: 0.5 });

        // B. Section Enters
        gsap.utils.toArray(".glass-card").forEach(card => {
            gsap.to(card, {
                opacity: 1, y: 0,
                duration: 1,
                scrollTrigger: {
                    trigger: card,
                    start: "top 80%",
                    toggleActions: "play none none reverse"
                }
            });
        });

        // C. Tunnel Sequence (The "Explosive" Part)
        // We want the tunnel mesh group to move towards the camera (simulate flying through)
        // Total distance needed = 20 cards * 15 z-spacing = 300 units

        const tunnelTimeline = gsap.timeline({
            scrollTrigger: {
                trigger: "#course-tunnel",
                start: "top top",
                end: "bottom bottom", // 400vh long
                scrub: 0.1,
                onEnter: () => {
                    tunnelGroup.visible = true;
                    speedMult = 8; // WARP SPEED PARTICLES
                },
                onLeave: () => {
                    // speedMult = 1; // Keep it fast?
                },
                onLeaveBack: () => {
                    tunnelGroup.visible = false;
                    speedMult = 1;
                }
            }
        });

        // Move the tunnel group Z towards camera
        // Starting Z is mostly negative. We want to bring them past camera (Z=5)
        // Last card is at -330. We need to move group +350.
        tunnelTimeline.to(tunnelGroup.position, {
            z: 350,
            ease: "none"
        });

        // Spin camera wildly during tunnel
        tunnelTimeline.to(camera.rotation, {
            z: Math.PI * 2, // Full rotation
            ease: "none"
        }, "<");


        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>