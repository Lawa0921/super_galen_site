<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miglo Jelly | èœœå…‰Qå‡</title>
    <meta name="description" content="èœœå…‰Qå‡ - å …æŒçœŸèŠ±ï¼Œæ‹’çµ•ç³–æ¼¿ã€‚è®“å–èŒ¶æˆç‚ºä¸€ç¨®æ”¾é¬†è€Œå®‰å¿ƒçš„æ—¥å¸¸é¸æ“‡ã€‚">
    <meta property="og:image" content="/assets/img/guild/miglo/avatar.webp">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&family=Dela+Gothic+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --c-tea: #FFC107;
            --c-rose: #FF4081;
            --c-jelly: rgba(255, 255, 255, 0.9);
            --c-dark: #1a0f0f;
            --c-glass: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0; padding: 0; box-sizing: border-box;
            background-color: var(--c-dark);
            color: #fff;
            font-family: 'Zen Maru Gothic', sans-serif;
            overflow-x: hidden;
            width: 100vw;
        }

        * { box-sizing: border-box; }

        /* --- Canvas --- */
        #webgl-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none;
            background: radial-gradient(circle at center, #2e1a1a 0%, #000 100%);
        }

        /* --- Scroll Spacer --- */
        #scroll-spacer {
            height: 1500vh; /* Significantly expanded for better pacing */
            width: 100%; position: relative;
            z-index: -1; pointer-events: none;
        }

        /* --- UI Overlay --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
        }

        /* Brand Mark */
        .brand-mark {
            position: fixed; top: 2rem; left: 2rem; z-index: 100;
            display: flex; align-items: center; gap: 10px;
            pointer-events: auto; text-decoration: none;
        }
        .mark-img {
            width: 50px; height: 50px; border-radius: 50%;
            border: 2px solid var(--c-tea);
        }

        /* Typography */
        .hero-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; width: 100%;
            pointer-events: none; /* Prevent blocking */
        }

        .big-text {
            font-family: 'Dela Gothic One', cursive;
            font-size: clamp(3rem, 12vw, 10rem);
            line-height: 1;
            color: var(--c-tea);
            text-shadow: 4px 4px 0px var(--c-rose);
            white-space: nowrap;
            opacity: 0; /* JS handles reveal */
        }
        .sub-hero {
            font-family: 'Zen Maru Gothic';
            margin-top: 1rem; font-size: 1.5rem;
            color: #fff; font-weight: 700;
            letter-spacing: 0.2em;
        }

        /* --- Content Panels --- */
        .content-panel {
            position: absolute;
            top: 50%; left: 0; width: 100%;
            transform: translateY(-50%);
            display: flex; justify-content: center; align-items: center;
            gap: 4rem;
            pointer-events: none;
            padding: 0 5%;
        }

        .text-card {
            background: rgba(20, 10, 10, 0.6);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 20px;
            padding: 2.5rem;
            width: 100%; max-width: 500px;
            backdrop-filter: blur(15px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            position: relative; z-index: 2;
            pointer-events: auto;
            opacity: 0;
        }

        .image-card {
            width: 100%; max-width: 400px; height: 500px;
            position: relative; z-index: 1;
            pointer-events: auto;
            border-radius: 20px;
            overflow: hidden;
            border: 4px solid #fff;
            transform: rotate(-3deg);
            opacity: 0;
        }
        .image-card img {
            width: 100%; height: 100%; object-fit: cover;
            transition: transform 0.5s;
        }
        .image-card:hover img { transform: scale(1.1); }

        .panel-left { flex-direction: row; }
        .panel-right { flex-direction: row-reverse; }

        .text-card h3 {
            font-family: 'Dela Gothic One', cursive;
            font-size: 2rem; color: var(--c-tea); margin-bottom: 1rem;
            border-bottom: 2px dashed var(--c-rose);
            padding-bottom: 0.5rem;
        }
        .text-card p {
            font-size: 1.1rem; line-height: 1.8; color: #eee; margin-bottom: 1rem;
        }
        .text-card ul {
            list-style: none; padding: 0; margin: 0;
        }
        .text-card li {
            font-size: 1.1rem; line-height: 1.8; color: #eee;
            margin-bottom: 0.5rem; display: flex; align-items: center; gap: 10px;
        }
        .text-card li i { color: var(--c-rose); }

        .highlight {
            color: var(--c-rose); font-weight: 900;
            background: rgba(255, 64, 129, 0.1); padding: 0 5px; border-radius: 4px;
        }

        /* --- Gallery Panel --- */
        #panel-gallery {
            flex-direction: column;
            gap: 2rem;
            width: 90%; max-width: 1200px; left: 5%;
            padding-bottom: 10vh; /* Extra breathing room at bottom */
        }
        .gallery-title {
            font-family: 'Dela Gothic One'; font-size: 3rem; color: #fff;
            text-shadow: 2px 2px 0 var(--c-tea); text-align: center;
            opacity: 0; transform: translateY(20px);
            margin-bottom: 2rem;
        }
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            width: 100%;
            pointer-events: auto;
        }
        .g-item {
            border-radius: 15px; overflow: hidden;
            height: 250px; border: 2px solid rgba(255,255,255,0.2);
            position: relative; opacity: 0; transform: scale(0.8);
            transition: transform 0.3s;
            background: rgba(0,0,0,0.3);
        }
        .g-item:hover { transform: scale(1.05) !important; z-index: 10; border-color: var(--c-tea); }
        .g-item img {
            width: 100%; height: 100%; object-fit: cover;
        }

        /* --- Finale --- */
        #finale {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #FFC107, #FF4081);
            z-index: 50;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            clip-path: circle(0% at 50% 50%);
            transition: clip-path 0.8s cubic-bezier(0.7, 0, 0.3, 1);
            pointer-events: auto; text-align: center;
            color: #fff;
        }
        #finale.active { clip-path: circle(150% at 50% 50%); }

        .finale-avatar {
            width: 200px; height: 200px; border-radius: 50%;
            border: 8px solid #fff; margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: bounce 2s infinite ease-in-out;
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        .social-btn {
            display: inline-flex; align-items: center; gap: 10px;
            background: #fff; color: var(--c-rose);
            padding: 1rem 2rem; border-radius: 50px;
            font-family: 'Dela Gothic One'; font-size: 1.5rem;
            text-decoration: none; margin: 1rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .social-btn:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.3); }

        /* --- Entrance --- */
        #entrance-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--c-dark); z-index: 10001;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: var(--c-tea);
        }
        .loader-text {
            font-family: 'Dela Gothic One'; font-size: 2rem; margin-top: 1rem;
            animation: blink 1s infinite;
        }
        @keyframes blink { 50% { opacity: 0.5; } }

        @media (max-width: 900px) {
            .content-panel { flex-direction: column !important; gap: 2rem; padding: 0 1.5rem; }
            .image-card { width: 100%; height: 300px; transform: rotate(0deg); order: -1; }
            .big-text { font-size: 15vw; white-space: normal; }
            .finale-avatar { width: 150px; height: 150px; }
            .social-btn { padding: 0.8rem 1.5rem; font-size: 1.2rem; }
            .gallery-grid { grid-template-columns: repeat(2, 1fr); }
            #panel-gallery { width: 100%; left: 0; padding: 0 1rem; }
        }
    </style>
</head>
<body>

    <div id="entrance-screen">
        <div style="font-size: 4rem;">ğŸ®</div>
        <div class="loader-text">BREWING...</div>
    </div>

    <div id="webgl-container"></div>
    <div id="scroll-spacer"></div>

    <a href="/guild/" class="brand-mark">
        <img src="/assets/img/guild/miglo/avatar.webp" class="mark-img">
        <div style="font-family:'Dela Gothic One'; color:#fff; font-size: 1.2rem;">MIGLO</div>
    </a>

    <!-- Overlays -->
    <div class="overlay">
        <!-- Hero -->
        <div id="hero-text" class="hero-container">
            <div class="big-text">MIGLO JELLY</div>
            <div class="sub-hero">å …æŒçœŸèŠ± â€¢ æ‹’çµ•ç³–æ¼¿ â€¢ ç™‚ç™’æ—¥å¸¸</div>
        </div>

        <!-- 1. Origin -->
        <div id="panel-1" class="content-panel panel-left">
            <div class="text-card">
                <h3>// èµ·æº STORY</h3>
                <p>æˆ‘æ˜¯èœœå…‰Qå‡çš„é—†é—†ï¼æœ¬ä¾†æ˜¯å†·é£²æ¥­åå¹¾å¹´çš„è³‡æ·±å“¡å·¥ï¼Œæ¯å¤©ç…®èŒ¶ã€ç…®èŒ¶é‚„æ˜¯ç…®èŒ¶ã€‚</p>
                <p>ç›´åˆ°æŸå¤©è…¦è¢‹çªç„¶<span class="highlight">è¢«é©¢è¸¢äº†</span>ï¼ˆç¬‘ï¼‰ï¼Œå¿ƒæƒ³ï¼šã€Œç‚ºä»€éº¼æ²’äººæƒ³ç…®èŠ±ï¼ŸèŠ±è·ŸèŒ¶ä¸æ˜¯å¾ˆæ­å—ï¼Ÿã€</p>
                <p>æ–¼æ˜¯ï¼Œèœœå…‰Qå‡èª•ç”Ÿäº†ã€‚ä¸€å€‹ä»¥ã€Œæœ‰æ©ŸçœŸèŠ±ã€ç‚ºæ ¸å¿ƒçš„èŠ±æœé£²å“ç‰Œã€‚</p>
            </div>
            <div class="image-card">
                <img src="/assets/img/guild/miglo/gallery_1.webp" alt="Jelly Cups">
            </div>
        </div>

        <!-- 2. Philosophy -->
        <div id="panel-2" class="content-panel panel-right">
            <div class="text-card">
                <h3>// å …æŒ PHILOSOPHY</h3>
                <p>è€é—†æ›¾èªªï¼šã€ŒçœŸèŠ±å¾ˆè²´ã€‚ã€<br>ä½†æˆ‘å¿ƒæƒ³ï¼šã€Œå¯æ˜¯ç³–æ¼¿çš„èŠ±æ²’æœ‰çœŸèŠ±çš„é¦™ï¼Œä¹Ÿä¸å¥åº·ï¼ã€</p>
                <p>æˆ‘çš„å—…è¦º<span class="highlight">è¶…ç´šéˆæ•</span>ï¼Œç³–æ¼¿çš„é¦™ç²¾å‘³æœƒè®“æˆ‘ä¸èˆ’æœï¼Œç„¡æ³•æ”¾é¬†ã€‚æ‰€ä»¥æˆ‘ç¯¤å®šè¦å‰µæ¥­ï¼Œç…®å‡ºçœŸæ­£æœ‰èŠ±é¦™çš„èŒ¶ã€‚</p>
                <p>æˆ‘å€‘ç›¸ä¿¡é¤Šç”Ÿä¸è©²æœ‰è·é›¢ï¼Œå …æŒåŸæ–™å–®ç´”ã€è£½ç¨‹é€æ˜ã€‚</p>
            </div>
            <div class="image-card">
                <img src="/assets/img/guild/miglo/gallery_4.webp" alt="Rose Tea">
            </div>
        </div>

        <!-- 3. Services (New) -->
        <div id="panel-3" class="content-panel panel-left">
            <div class="text-card">
                <h3>// æœå‹™ SERVICES</h3>
                <p>æˆ‘å€‘æä¾›çš„ä¸åªæ˜¯ä¸€æ¯é£²æ–™ï¼Œè€Œæ˜¯ä¸€ä»½å°ç”Ÿæ´»è³ªæ„Ÿçš„æ‰¿è«¾ã€‚</p>
                <ul>
                    <li><i class="fa-solid fa-seedling"></i> <strong>æœ‰æ©ŸçœŸèŠ±é¸æ</strong>ï¼šåš´é¸å¯é£Ÿç”¨èŠ±å‰ï¼Œçµ•ä¸ä½¿ç”¨äººå·¥ç³–æ¼¿ã€‚</li>
                    <li><i class="fa-solid fa-flask"></i> <strong>èŠ±é¦™æœå‡å·¥è—</strong>ï¼šç¨å®¶ç ”ç™¼èŠ±é¦™ç³»åˆ—æœå‡ï¼Œå£æ„ŸQå½ˆï¼Œé¦™æ°£å¤©ç„¶ã€‚</li>
                    <li><i class="fa-solid fa-heart-pulse"></i> <strong>å¥åº·æŠŠé—œ</strong>ï¼šç‚ºæ¯ä¸€ä½å®¢äººçš„å¥åº·è‘—æƒ³ï¼Œå …æŒè£½ç¨‹é€æ˜ã€‚</li>
                </ul>
            </div>
            <div class="image-card">
                <img src="/assets/img/guild/miglo/gallery_6.webp" alt="Healthy Ingredients">
            </div>
        </div>

        <!-- 4. Values (Shifted) -->
        <div id="panel-4" class="content-panel panel-right">
            <div class="text-card">
                <h3>// é€£çµ CONNECTION</h3>
                <p>å°æˆ‘ä¾†èªªï¼Œ<span class="highlight">å®¢äººå°±åƒæœ‹å‹ä¸€æ¨£</span>ã€‚</p>
                <p>æˆ‘æœƒå¾ˆåŠªåŠ›è¨˜ä½æ¯å€‹å®¢äººçš„å£å‘³è·Ÿå–œå¥½ï¼Œç”šè‡³å¹«å¿™æŠŠé—œå¥åº·ï¼</p>
                <p>é€™äº›å¹´å¾å®¶äººçš„åå°åˆ°æ”¯æŒï¼Œå…¨é æˆ‘å±¹ç«‹ä¸æ–çš„ä¿¡å¿µã€‚æˆ‘æ˜¯å€‹æƒ³åšä»€éº¼å°±æœƒå¾ˆåŸ·è‘—ï¼Œä¸€ç›´å …æŒåšä¸‹å»çš„äººï¼</p>
            </div>
            <div class="image-card">
                <img src="/assets/img/guild/miglo/gallery_2.webp" alt="Tea Flowers">
            </div>
        </div>

        <!-- 5. Personality (Shifted) -->
        <div id="panel-5" class="content-panel panel-left">
            <div class="text-card">
                <h3>// ç‰¹è³ª TRAITS</h3>
                <p><strong>ENFP ç«¶é¸è€…</strong></p>
                <p>æˆ‘æ˜¯å€‹æƒ…ç·’æ¯”è¼ƒæ•æ„Ÿçš„ E äººï¼Œæœ‰äº›æƒ…ç·’ç„¡æ³•å¯Ÿè¦ºçš„åœ°æ–¹ï¼Œé‚„è«‹å¤§å®¶å¤šå¤šåŒ…æ¶µï¼</p>
                <p>æ­¡è¿å¤§å®¶ä¾†èªè­˜æˆ‘ï¼Œèªè­˜èœœå…‰Qå‡ï¼é™ªä½ æ…¢æ…¢å–ï¼Œæ…¢æ…¢è®Šå¥½ã€‚ğŸ˜—</p>
            </div>
            <div class="image-card">
                <img src="/assets/img/guild/miglo/gallery_5.webp" alt="Miglo Product">
            </div>
        </div>

        <!-- 6. Gallery (New) -->
        <div id="panel-gallery" class="content-panel">
            <div class="gallery-title">FLORAL GALLERY</div>
            <div class="gallery-grid">
                <!-- Using all gallery images -->
                <div class="g-item"><img src="/assets/img/guild/miglo/gallery_1.webp"></div>
                <div class="g-item"><img src="/assets/img/guild/miglo/gallery_2.webp"></div>
                <div class="g-item"><img src="/assets/img/guild/miglo/gallery_3.webp"></div>
                <div class="g-item"><img src="/assets/img/guild/miglo/gallery_4.webp"></div>
                <div class="g-item"><img src="/assets/img/guild/miglo/gallery_5.webp"></div>
                <div class="g-item"><img src="/assets/img/guild/miglo/gallery_6.webp"></div>
                <div class="g-item"><img src="/assets/img/guild/miglo/gallery_7.webp"></div>
                <div class="g-item"><img src="/assets/img/guild/miglo/avatar.webp"></div>
            </div>
        </div>
    </div>

    <!-- Finale -->
    <div id="finale">
        <img src="/assets/img/guild/miglo/avatar.webp" class="finale-avatar">
        <h2 style="font-family: 'Dela Gothic One'; font-size: 3rem; margin-bottom: 2rem;">LET'S CONNECT!</h2>

        <div>
            <a href="https://www.instagram.com/miglo_jelly25/" target="_blank" class="social-btn">
                <i class="fa-brands fa-instagram"></i> Instagram
            </a>
            <a href="https://www.threads.com/@miglo_jelly25" target="_blank" class="social-btn">
                <i class="fa-brands fa-threads"></i> Threads
            </a>
        </div>

        <button onclick="document.getElementById('finale').classList.remove('active')" style="margin-top: 3rem; background: transparent; border: 2px solid #fff; padding: 1rem 2rem; color: #fff; font-family: 'Zen Maru Gothic'; font-weight: 700; cursor: pointer; border-radius: 50px;">
            BACK TO JELLY WORLD
        </button>
    </div>

    <script type="module">
        import * as THREE from 'three';

        // --- Setup ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        // Fog for depth
        scene.fog = new THREE.FogExp2(0x1a0f0f, 0.02);

        const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- Lights ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const pointLight = new THREE.PointLight(0xff4081, 2, 50);
        pointLight.position.set(2, 5, 5);
        scene.add(pointLight);

        const sunLight = new THREE.DirectionalLight(0xffc107, 1);
        sunLight.position.set(-5, 10, 5);
        scene.add(sunLight);

        // --- Objects: Jelly Cubes (InstancedMesh) ---
        // Using Rounded Box logic via simple Box geometry for now, but smooth shaded
        const jellyGeo = new THREE.BoxGeometry(1, 1, 1);
        const jellyMat = new THREE.MeshPhysicalMaterial({
            color: 0xffffff,
            metalness: 0,
            roughness: 0,
            transmission: 0.9, // Glass/Jelly like
            thickness: 1,
            transparent: true,
            opacity: 0.8,
            ior: 1.5,
        });

        const count = 100;
        const mesh = new THREE.InstancedMesh(jellyGeo, jellyMat, count);
        scene.add(mesh);

        const dummy = new THREE.Object3D();
        const positions = [];
        const rotations = [];
        const speeds = [];

        for(let i=0; i<count; i++) {
            const x = (Math.random() - 0.5) * 40;
            const y = (Math.random() - 0.5) * 40;
            const z = (Math.random() - 0.5) * 100 - 20; // Spread deep into Z

            dummy.position.set(x, y, z);
            dummy.rotation.set(Math.random()*Math.PI, Math.random()*Math.PI, Math.random()*Math.PI);
            const scale = 0.5 + Math.random();
            dummy.scale.set(scale, scale, scale);
            dummy.updateMatrix();
            mesh.setMatrixAt(i, dummy.matrix);

            positions.push({x, y, z, ox: x, oy: y, oz: z}); // Store original pos
            rotations.push({x: Math.random()*0.01, y: Math.random()*0.01});
            speeds.push(0.01 + Math.random() * 0.02);
        }

        // --- Objects: Flower Petals (Particles) ---
        const pGeo = new THREE.BufferGeometry();
        const pCount = 300;
        const pPos = new Float32Array(pCount * 3);
        const pCol = new Float32Array(pCount * 3);

        const color1 = new THREE.Color(0xFFC107); // Gold
        const color2 = new THREE.Color(0xFF4081); // Pink

        for(let i=0; i<pCount; i++) {
            pPos[i*3] = (Math.random() - 0.5) * 50;
            pPos[i*3+1] = (Math.random() - 0.5) * 50;
            pPos[i*3+2] = (Math.random() - 0.5) * 100;

            const c = Math.random() > 0.5 ? color1 : color2;
            pCol[i*3] = c.r;
            pCol[i*3+1] = c.g;
            pCol[i*3+2] = c.b;
        }
        pGeo.setAttribute('position', new THREE.BufferAttribute(pPos, 3));
        pGeo.setAttribute('color', new THREE.BufferAttribute(pCol, 3));

        const pMat = new THREE.PointsMaterial({
            size: 0.3, vertexColors: true, transparent: true, opacity: 0.8,
            map: createCircleTexture(),
            alphaTest: 0.5
        });

        function createCircleTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const context = canvas.getContext('2d');
            context.beginPath();
            context.arc(16, 16, 16, 0, 2 * Math.PI);
            context.fillStyle = '#ffffff';
            context.fill();
            const texture = new THREE.CanvasTexture(canvas);
            return texture;
        }

        const particles = new THREE.Points(pGeo, pMat);
        scene.add(particles);


        // --- GSAP Animations ---
        gsap.registerPlugin(ScrollTrigger);

        // Entrance
        window.addEventListener('load', () => {
            const loader = document.getElementById('entrance-screen');
            gsap.to(loader, {
                opacity: 0, duration: 1, delay: 0.5,
                onComplete: () => {
                    loader.remove();
                    startAnimations();
                }
            });
        });

        function startAnimations() {
            // Hero Entrance
            gsap.fromTo(".big-text",
                { opacity: 0, scale: 0.5, rotation: -10 },
                { opacity: 1, scale: 1, rotation: 0, duration: 1.5, ease: "elastic.out(1, 0.5)" }
            );

            // Hero Exit (New - fixes title overlap)
            gsap.to(".hero-container", {
                opacity: 0,
                y: -100,
                scale: 1.5,
                scrollTrigger: {
                    trigger: "#scroll-spacer",
                    start: "top top",
                    end: "5% top",
                    scrub: true
                }
            });

            // Camera Flight
            gsap.to(camera.position, {
                z: -80,
                ease: "none",
                scrollTrigger: {
                    trigger: "#scroll-spacer",
                    start: "top top",
                    end: "bottom bottom",
                    scrub: 0.5
                }
            });

            // Panels - Shifted earlier to give Gallery more space (1500vh total)
            const panels = [
                { id: "#panel-1", start: 5, end: 15 },
                { id: "#panel-2", start: 20, end: 30 },
                { id: "#panel-3", start: 35, end: 45 }, // Services
                { id: "#panel-4", start: 50, end: 60 }, // Connection
                { id: "#panel-5", start: 65, end: 75 }  // Traits
            ];

            panels.forEach(p => {
                const tl = gsap.timeline({
                    scrollTrigger: {
                        trigger: "#scroll-spacer",
                        start: p.start + "% top",
                        end: p.end + "% top",
                        scrub: 1
                    }
                });

                // Entrance
                tl.to(`${p.id} .text-card`, { opacity: 1, x: 0, rotation: 0, duration: 1 }, 0);
                tl.to(`${p.id} .image-card`, { opacity: 1, x: 0, rotation: -3, duration: 1 }, 0);

                // Exit
                tl.to([`${p.id} .text-card`, `${p.id} .image-card`], { opacity: 0, y: -50, duration: 1 }, 2);
            });

            // Set initial state for panels
            panels.forEach(p => {
                gsap.set(`${p.id} .text-card`, { opacity: 0, x: -50, rotation: -5 });
                gsap.set(`${p.id} .image-card`, { opacity: 0, x: 50, rotation: 5 });
            });

            // Gallery Animation (Starts earlier at 80%, fully visible by 90%)
            // This leaves 90% -> 99.5% (~140vh) of pure scrolling time to view the gallery
            gsap.fromTo("#panel-gallery .gallery-title",
                { opacity: 0, y: 50 },
                { opacity: 1, y: 0,
                  scrollTrigger: { trigger: "#scroll-spacer", start: "78% top", end: "82% top", scrub: 1 }
                }
            );

            const galleryItems = gsap.utils.toArray(".g-item");
            gsap.fromTo(galleryItems,
                { opacity: 0, scale: 0.5 },
                {
                    opacity: 1, scale: 1, stagger: 0.1,
                    scrollTrigger: {
                        trigger: "#scroll-spacer",
                        start: "80% top",
                        end: "90% top",
                        scrub: 1
                    }
                }
            );


            // Finale
            ScrollTrigger.create({
                trigger: "#scroll-spacer",
                start: "99.5% bottom", // Stricter trigger as per design pattern
                onEnter: () => document.getElementById('finale').classList.add('active'),
                onLeaveBack: () => document.getElementById('finale').classList.remove('active')
            });
        }

        // --- Mouse Interaction ---
        const mouse = new THREE.Vector2();
        window.addEventListener('mousemove', (e) => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
        });

        // --- Loop ---
        const clock = new THREE.Clock();

        function animate() {
            const time = clock.getElapsedTime();

            // Animate Jelly Instances
            for(let i=0; i<count; i++) {
                const {x, y, z, ox, oy, oz} = positions[i];

                // Float
                const newY = oy + Math.sin(time + x) * 2;

                // Rotate
                dummy.rotation.set(time * rotations[i].x, time * rotations[i].y, 0);

                dummy.position.set(ox, newY, z);
                dummy.updateMatrix();
                mesh.setMatrixAt(i, dummy.matrix);
            }
            mesh.instanceMatrix.needsUpdate = true;

            // Rotate Particles
            particles.rotation.y = time * 0.05;

            // Camera slight shake/float independent of scroll
            camera.position.x += (mouse.x * 2 - camera.position.x) * 0.02;
            camera.position.y += (mouse.y * 2 - camera.position.y) * 0.02;

            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }

        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
