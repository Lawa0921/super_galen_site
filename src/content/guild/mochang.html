<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mo Chang | The Ink Singer</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;600;900&family=Ma+Shan+Zheng&family=Zhi+Mang+Xing&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --c-bg: #1a1a1a;
            --c-ink: #000000;
            --c-paper: #f0f0f0;
            --c-gold: #d4af37;
            --c-accent: #ff4d4d;
            --c-text: #e0e0e0;

            --f-serif: 'Noto Serif TC', serif;
            --f-cali: 'Zhi Mang Xing', cursive; /* Calligraphy style */
        }

        body {
            margin: 0;
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: var(--f-serif);
            overflow-x: hidden;
            cursor: none;
        }

        /* --- Loader --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .ink-drop {
            width: 20px; height: 20px; background: #fff; border-radius: 50%;
            animation: drop 1s ease-in forwards;
        }
        @keyframes drop {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(0.5); }
            100% { transform: scale(50); opacity: 0; }
        }

        /* --- Custom Cursor --- */
        #cursor {
            position: fixed; top: 0; left: 0; width: 30px; height: 30px;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%; pointer-events: none; z-index: 10000;
            transform: translate(-50%, -50%);
            mix-blend-mode: exclusion;
            transition: width 0.2s, height 0.2s;
        }
        #cursor.hovered { width: 60px; height: 60px; background: radial-gradient(circle, var(--c-gold) 0%, rgba(0,0,0,0) 70%); }

        /* --- Canvas --- */
        #webgl-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            z-index: -1; pointer-events: none;
        }

        /* --- Navigation --- */
        .nav-back {
            position: fixed; top: 2rem; left: 2rem; z-index: 100;
            color: var(--c-text); text-decoration: none;
            font-family: var(--f-serif); font-size: 1rem;
            border-bottom: 1px solid transparent;
            transition: 0.3s;
        }
        .nav-back:hover { border-color: var(--c-gold); color: var(--c-gold); }

        /* --- Layout --- */
        section {
            min-height: 100vh;
            display: flex; align-items: center; justify-content: center;
            position: relative; padding: 4rem 2rem; box-sizing: border-box;
        }
        .container {
            max-width: 1000px; width: 100%; position: relative; z-index: 10;
        }

        /* --- Typography --- */
        h1 {
            font-family: var(--f-cali); font-size: clamp(4rem, 15vw, 10rem);
            line-height: 0.8; margin: 0; color: #fff;
            text-shadow: 0 0 20px rgba(255,255,255,0.2);
            mix-blend-mode: overlay;
        }
        h2 {
            font-family: var(--f-cali); font-size: clamp(2.5rem, 8vw, 5rem);
            margin-bottom: 1rem; color: var(--c-gold);
        }
        .tag {
            font-family: var(--f-serif); font-size: 0.9rem; letter-spacing: 3px;
            color: #888; text-transform: uppercase; display: block; margin-bottom: 0.5rem;
        }

        p {
            font-size: 1.1rem; line-height: 1.8; color: #ccc;
            max-width: 600px; margin-bottom: 1.5rem;
            text-align: justify;
        }

        /* --- Hero Section --- */
        .hero-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: center;
        }
        .avatar-container {
            position: relative; width: 100%; max-width: 400px; aspect-ratio: 2/3;
            overflow: hidden; border-radius: 4px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        .avatar-img {
            width: 100%; height: 100%; object-fit: cover;
            filter: sepia(0.2) contrast(1.1) grayscale(0.3);
        }
        .ink-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/textures/water.jpg'); /* Placeholder for noise if needed, but using CSS blend */
            mix-blend-mode: multiply; opacity: 0.5;
        }

        /* --- Timeline/Content --- */
        .content-block {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 3rem; border: 1px solid rgba(255,255,255,0.05);
            border-left: 2px solid var(--c-gold);
            position: relative; overflow: hidden;
        }
        .content-block::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.05), transparent);
            transform: translateX(-100%); transition: 0.5s; pointer-events: none;
        }
        .content-block:hover::before { transform: translateX(100%); transition: 1s; }

        .chibi-box {
            position: absolute; right: -50px; bottom: -20px; width: 150px; opacity: 0.8;
            transform: rotate(-10deg); filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
            transition: 0.3s;
        }
        .content-block:hover .chibi-box { right: -20px; opacity: 1; transform: rotate(0deg); }

        /* --- Skills/Keywords --- */
        .keywords {
            display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 2rem;
        }
        .keyword {
            border: 1px solid #444; padding: 0.5rem 1.5rem; border-radius: 50px;
            font-size: 0.9rem; transition: 0.3s; cursor: pointer;
        }
        .keyword:hover {
            border-color: var(--c-gold); color: var(--c-gold); background: rgba(212, 175, 55, 0.1);
        }

        /* --- Footer --- */
        footer {
            padding: 4rem 0; text-align: center; background: #000; border-top: 1px solid #333;
        }
        .social-icons {
            display: flex; justify-content: center; gap: 2rem; margin-top: 2rem;
        }
        .social-link {
            color: #fff; font-size: 1.5rem; transition: 0.3s; width: 50px; height: 50px;
            display: flex; align-items: center; justify-content: center;
            border: 1px solid #333; border-radius: 50%;
        }
        .social-link:hover {
            color: var(--c-gold); border-color: var(--c-gold); transform: translateY(-5px);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }

        /* --- Mobile --- */
        @media (max-width: 768px) {
            .hero-grid { grid-template-columns: 1fr; text-align: center; }
            h1 { font-size: 4rem; }
            .avatar-container { margin: 0 auto; width: 80%; }
            .content-block { padding: 1.5rem; }
            .chibi-box { display: none; }
            #cursor { display: none; }
            body { cursor: auto; }
        }
    </style>
</head>
<body>

    <!-- LOADING -->
    <div id="loader">
        <div class="ink-drop"></div>
    </div>

    <!-- CURSOR -->
    <div id="cursor"></div>

    <a href="/guild/" class="nav-back">← GUILD</a>
    <div id="webgl-container"></div>

    <!-- 1. HERO -->
    <section id="hero">
        <div class="container">
            <div class="hero-grid">
                <div class="gs-reveal">
                    <span class="tag">INK & SOUND ALCHEMIST</span>
                    <h1>墨唱</h1>
                    <h2 style="font-family: var(--f-serif); font-size: 1.5rem; letter-spacing: 5px; color: #fff; opacity: 0.8;">MO CHANG</h2>
                    <p style="margin-top: 2rem; color: #aaa;">
                        "Strings of the Pipa, Code of the World. Wandering through the realms of Game, Food, and Sound."
                    </p>
                </div>
                <div class="gs-reveal avatar-container">
                    <img src="/assets/img/guild/mochang/avatar.webp" alt="Mo Chang" class="avatar-img">
                </div>
            </div>
        </div>
    </section>

    <!-- 2. ORIGIN -->
    <section id="origin">
        <div class="container">
            <div class="content-block gs-reveal">
                <span class="tag" style="color: var(--c-gold)">THE ORIGIN</span>
                <h2>Game & MUD</h2>
                <p>
                    曾經，我是一個熱愛遊戲的少年。在 MUD (Multi-User Dungeon) 的純文字世界裡，我看見了無限的想像。
                    立志投身遊戲業界，在代碼與邏輯的迷宮中探索了十年。
                </p>
                <p>
                    <i class="fa-solid fa-code"></i> C++ / Python / Lua <br>
                    <i class="fa-solid fa-gamepad"></i> Game Design / Scripting
                </p>
            </div>
        </div>
    </section>

    <!-- 3. WANDERING -->
    <section id="wandering">
        <div class="container" style="display: flex; justify-content: flex-end;">
            <div class="content-block gs-reveal" style="border-left: none; border-right: 2px solid var(--c-accent); text-align: right;">
                <span class="tag" style="color: var(--c-accent)">THE DRIFT</span>
                <h2>Chef & MIS</h2>
                <p>
                    離開遊戲業後，我曾拿起菜刀，試圖在味覺中尋找答案。
                    命運卻讓我誤打誤撞成為了資訊人員 (MIS)。
                    在這漫長的十年裡，我亦是外送員、街頭藝人、詞作人。
                </p>
                <div class="keywords" style="justify-content: flex-end;">
                    <span class="keyword">Delivery</span>
                    <span class="keyword">Street Perfomer</span>
                    <span class="keyword">Lyricist</span>
                </div>
            </div>
        </div>
    </section>

    <!-- 4. RESONANCE -->
    <section id="resonance">
        <div class="container">
            <div class="content-block gs-reveal">
                <img src="/assets/img/guild/mochang/chibi.webp" class="chibi-box" alt="Chibi">
                <span class="tag" style="color: #bd4dff">CURRENT FORM</span>
                <h2>Ink & Strings</h2>
                <p>
                    如今，我有了一位妻子和一個孩子。在生活的縫隙中，我拿起了琵琶與空靈鼓。
                    自學編曲與 DAW，我試圖將古風與現代結合，書寫屬於自己的旋律。
                </p>
                <p>
                    "宜蘭不上街頭的街頭藝人，正在尋找下一個音符。"
                </p>
                <div class="keywords">
                    <span class="keyword">Pipa (琵琶)</span>
                    <span class="keyword">Ethereal Drum</span>
                    <span class="keyword">Composition</span>
                    <span class="keyword">DAW</span>
                </div>
            </div>
        </div>
    </section>

    <!-- 5. GALLERY -->
    <section id="gallery">
        <div class="container" style="text-align: center;">
            <span class="tag">CREATIONS</span>
            <h2 class="gs-reveal">The Archive</h2>
            <div style="margin-top: 3rem; display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap;">
                <a href="https://www.youtube.com/@flyzhicha" target="_blank" class="keyword" style="font-size: 1.2rem; padding: 1rem 2rem;">
                    <i class="fa-brands fa-youtube"></i> Watch on YouTube
                </a>
                <a href="https://www.instagram.com/feihailuo" target="_blank" class="keyword" style="font-size: 1.2rem; padding: 1rem 2rem;">
                    <i class="fa-brands fa-instagram"></i> Instagram Gallery
                </a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="social-icons">
                <a href="https://www.threads.com/@feihailuo" target="_blank" class="social-link"><i class="fa-brands fa-threads"></i></a>
                <a href="https://www.instagram.com/feihailuo" target="_blank" class="social-link"><i class="fa-brands fa-instagram"></i></a>
                <a href="https://www.youtube.com/@flyzhicha" target="_blank" class="social-link"><i class="fa-brands fa-youtube"></i></a>
            </div>
            <p style="margin-top: 2rem; color: #666; font-size: 0.8rem;">
                Made with <i class="fa-solid fa-pen-nib"></i> & <i class="fa-solid fa-music"></i> by SuperGalen's Dungeon
            </p>
        </div>
    </footer>

    <script type="module">
        import * as THREE from 'three';

        // --- SETUP ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        // Dark background color
        scene.background = new THREE.Color(0x1a1a1a);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 5;

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- INK TEXTURE ---
        function createInkTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 128; canvas.height = 128;
            const ctx = canvas.getContext('2d');

            // Soft gradient
            const grad = ctx.createRadialGradient(64,64,0, 64,64,64);
            grad.addColorStop(0, 'rgba(255,255,255,1)');
            grad.addColorStop(0.2, 'rgba(255,255,255,0.8)');
            grad.addColorStop(0.5, 'rgba(255,255,255,0.2)');
            grad.addColorStop(1, 'rgba(255,255,255,0)');

            ctx.fillStyle = grad;
            ctx.fillRect(0,0,128,128);

            return new THREE.CanvasTexture(canvas);
        }

        // --- PARTICLES ---
        const particleCount = 200;
        const geom = new THREE.BufferGeometry();
        const positions = new Float32Array(particleCount * 3);
        const sizes = new Float32Array(particleCount);
        const speeds = [];

        for(let i=0; i<particleCount; i++) {
            positions[i*3] = (Math.random() - 0.5) * 15;
            positions[i*3+1] = (Math.random() - 0.5) * 15;
            positions[i*3+2] = (Math.random() - 0.5) * 5;
            sizes[i] = Math.random() * 2;
            speeds.push({
                x: (Math.random() - 0.5) * 0.01,
                y: (Math.random() - 0.5) * 0.01,
                rot: (Math.random() - 0.5) * 0.02
            });
        }

        geom.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        geom.setAttribute('size', new THREE.BufferAttribute(sizes, 1));

        const mat = new THREE.PointsMaterial({
            size: 0.5,
            map: createInkTexture(),
            transparent: true,
            opacity: 0.6,
            vertexColors: false,
            color: 0xcccccc, // Light grey/white ink on dark bg
            depthWrite: false,
            blending: THREE.AdditiveBlending
        });

        const points = new THREE.Points(geom, mat);
        scene.add(points);

        // --- GOLD PARTICLES (Accents) ---
        const goldCount = 50;
        const goldGeom = new THREE.BufferGeometry();
        const goldPos = new Float32Array(goldCount * 3);

        for(let i=0; i<goldCount; i++) {
            goldPos[i*3] = (Math.random() - 0.5) * 10;
            goldPos[i*3+1] = (Math.random() - 0.5) * 10;
            goldPos[i*3+2] = (Math.random() - 0.5) * 5;
        }
        goldGeom.setAttribute('position', new THREE.BufferAttribute(goldPos, 3));

        const goldMat = new THREE.PointsMaterial({
            size: 0.2,
            color: 0xd4af37, // Gold
            transparent: true,
            opacity: 0.8,
            blending: THREE.AdditiveBlending
        });

        const goldPoints = new THREE.Points(goldGeom, goldMat);
        scene.add(goldPoints);

        // --- INTERACTION ---
        const mouse = new THREE.Vector2();
        const target = new THREE.Vector2();

        // Touch/Mouse handling
        const isTouch = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);

        if (!isTouch) {
            document.addEventListener('mousemove', (e) => {
                mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;

                // Cursor
                const cursor = document.getElementById('cursor');
                cursor.style.top = e.clientY + 'px';
                cursor.style.left = e.clientX + 'px';
            });

            document.querySelectorAll('a, .content-block, .keyword').forEach(el => {
                el.addEventListener('mouseenter', () => document.getElementById('cursor').classList.add('hovered'));
                el.addEventListener('mouseleave', () => document.getElementById('cursor').classList.remove('hovered'));
            });
        }

        // --- ANIMATION ---
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // Ink flow
            const pos = points.geometry.attributes.position.array;
            for(let i=0; i<particleCount; i++) {
                // Flow field simulation (Perlin-ish noise simplified)
                const x = pos[i*3];
                const y = pos[i*3+1];

                pos[i*3] += Math.sin(y * 0.5 + time * 0.5) * 0.01;
                pos[i*3+1] += Math.cos(x * 0.5 + time * 0.5) * 0.01;

                // Mouse interaction (repel)
                const dx = x - mouse.x * 5;
                const dy = y - mouse.y * 5;
                const dist = Math.sqrt(dx*dx + dy*dy);
                if(dist < 2) {
                    pos[i*3] += dx * 0.02;
                    pos[i*3+1] += dy * 0.02;
                }

                // Wrap around
                if(Math.abs(pos[i*3]) > 8) pos[i*3] *= -0.9;
                if(Math.abs(pos[i*3+1]) > 8) pos[i*3+1] *= -0.9;
            }
            points.geometry.attributes.position.needsUpdate = true;
            points.rotation.z += 0.001;

            // Gold float
            goldPoints.rotation.y -= 0.002;
            goldPoints.position.y = Math.sin(time) * 0.5;

            renderer.render(scene, camera);
        }
        animate();

        // --- GSAP ---
        gsap.registerPlugin(ScrollTrigger);

        // 1. Reveal Content
        gsap.utils.toArray('.gs-reveal').forEach(elem => {
            gsap.from(elem, {
                y: 50,
                opacity: 0,
                duration: 1,
                scrollTrigger: {
                    trigger: elem,
                    start: "top 80%",
                    toggleActions: "play none none reverse"
                }
            });
        });

        // 2. Scene Colors based on Section
        // Hero: Dark/White -> Origin: Green (Code) -> Wandering: Red/Orange (Kitchen) -> Resonance: Purple/Gold
        const colors = [
            { id: '#hero', color: 0xcccccc, gold: 0xd4af37 },
            { id: '#origin', color: 0x00ff00, gold: 0x004400 }, // Matrix green
            { id: '#wandering', color: 0xff4d4d, gold: 0xffaa00 }, // Fire
            { id: '#resonance', color: 0xbd4dff, gold: 0xffffff } // Magic
        ];

        colors.forEach(sec => {
            ScrollTrigger.create({
                trigger: sec.id,
                start: "top center",
                end: "bottom center",
                onEnter: () => {
                    gsap.to(mat.color, { r: new THREE.Color(sec.color).r, g: new THREE.Color(sec.color).g, b: new THREE.Color(sec.color).b, duration: 1 });
                    gsap.to(goldMat.color, { r: new THREE.Color(sec.gold).r, g: new THREE.Color(sec.gold).g, b: new THREE.Color(sec.gold).b, duration: 1 });
                },
                onEnterBack: () => {
                    gsap.to(mat.color, { r: new THREE.Color(sec.color).r, g: new THREE.Color(sec.color).g, b: new THREE.Color(sec.color).b, duration: 1 });
                    gsap.to(goldMat.color, { r: new THREE.Color(sec.gold).r, g: new THREE.Color(sec.gold).g, b: new THREE.Color(sec.gold).b, duration: 1 });
                }
            });
        });

        // Remove Loader
        window.onload = () => {
            setTimeout(() => {
                gsap.to('#loader', { opacity: 0, duration: 1, onComplete: () => document.getElementById('loader').remove() });
                gsap.from('h1', { scale: 1.5, opacity: 0, duration: 1.5, ease: "power4.out" });
            }, 1000);
        };

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
