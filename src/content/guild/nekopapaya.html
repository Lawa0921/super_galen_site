<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEKOPAPAYA | The Floating Atelier</title>
    <meta name="description" content="NEKOPAPAYA - 人體狀態觀察分析師 | 康樂股長 | 避風港">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        :root {
            /* Palette: Golden Hour Cabin */
            --c-wood: #8B5A2B;
            --c-wall: #F9F1E6;
            --c-text: #4A3B2C;
            --c-accent: #E09F3E;
            --c-sea: #3E88A5;

            --f-en: 'Nunito', sans-serif;
            --f-zh: 'Noto Sans TC', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--c-wall);
            color: var(--c-text);
            font-family: var(--f-zh);
            overflow-x: hidden;
            line-height: 1.7;
        }

        #webgl-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0; }
        .scroller { position: relative; z-index: 10; pointer-events: none; }
        .interactive-layer { pointer-events: auto; }

        /* --- UI Overlay --- */
        .ui-grid {
            min-height: 100vh;
            display: grid; grid-template-columns: 1fr;
            padding: 4rem 2rem;
            position: relative;
        }
        @media(min-width: 900px) {
            .ui-grid { grid-template-columns: 1fr 1fr; }
        }

        /* Paper Notes (Content) */
        .paper-note {
            background: #FFFCF5;
            padding: 2.5rem;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1), 0 0 1px rgba(0,0,0,0.2);
            transform: rotate(-1deg);
            max-width: 450px;
            margin-bottom: 20vh;
            opacity: 0; transform: translateY(50px) rotate(-1deg); /* Init for GSAP */
            color: #333;
            position: relative;
        }
        .paper-note::before { /* Pin/Tape */
            content: ''; position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            width: 80px; height: 25px; background: rgba(230, 200, 150, 0.6);
            border: 1px solid rgba(0,0,0,0.05); transform: translateX(-50%) rotate(2deg);
        }
        .paper-note:nth-child(even) { transform: rotate(1deg); margin-left: auto; }

        .pos-center { margin: 0 auto 20vh; text-align: center; }

        h1 { font-family: var(--f-en); font-weight: 700; font-size: 2.5rem; color: var(--c-wood); margin-bottom: 0.5rem; }
        h2 { font-family: var(--f-en); font-weight: 700; font-size: 0.9rem; letter-spacing: 0.1em; color: var(--c-accent); text-transform: uppercase; margin-bottom: 1rem; }
        p { margin-bottom: 1rem; font-size: 1.05rem; }

        /* Avatar Polaroid */
        .polaroid {
            background: white; padding: 0.8rem 0.8rem 2.5rem 0.8rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: rotate(-3deg);
            width: 180px; margin: 0 auto 1.5rem;
        }
        .polaroid img { width: 100%; display: block; filter: saturate(0.9); }

        /* Nav */
        .nav-fixed {
            position: fixed; top: 2rem; left: 2rem; z-index: 50;
            font-family: var(--f-en); font-weight: 700; color: var(--c-wood);
            text-decoration: none; background: rgba(255,255,255,0.8);
            padding: 0.5rem 1rem; border-radius: 4px; pointer-events: auto;
        }

        /* Social */
        .social-link {
            display: inline-flex; align-items: center; justify-content: center;
            width: 50px; height: 50px; border-radius: 50%; background: var(--c-wall);
            color: var(--c-wood); font-size: 1.2rem; margin: 0 0.5rem;
            transition: 0.2s; text-decoration: none; border: 1px solid var(--c-wood);
        }
        .social-link:hover { background: var(--c-accent); color: white; border-color: var(--c-accent); }

    </style>
</head>
<body>

    <a href="/guild" class="nav-fixed">← GUILD</a>
    <div id="webgl-container"></div>

    <div class="scroller">
        <div class="ui-grid">

            <!-- Left Col (Spacer for 3D View) -->
            <div class="spacer"></div>

            <!-- Right Col (Content) -->
            <div class="content-col">
                <div style="height: 30vh;"></div>

                <!-- 1. Hero -->
                <div class="paper-note interactive-layer gs-reveal">
                    <div class="polaroid">
                        <img src="/assets/img/guild/nekopapaya/avatar.webp" alt="Avatar">
                    </div>
                    <h1>NEKOPAPAYA</h1>
                    <p style="font-weight: 500; color: var(--c-wood);">人體狀態觀察分析師 | 康樂股長</p>
                    <p style="font-style: italic; color: #888;">"Hydrogen knocking on your soul."</p>
                </div>

                <!-- 2. Safe Haven -->
                <div class="paper-note interactive-layer gs-reveal">
                    <h2>CORE CONCEPT</h2>
                    <h1>The Cabin.</h1>
                    <p>這裡是一個可以停下來、坐一下的地方。</p>
                    <p>這艘船就像一個移動的避風港。有時候我會在這裡，人聚在一起，慢慢享受人與人的溫度。</p>
                    <p style="font-size: 0.9rem; color: #999;">(沒有強迫，只有邀請)</p>
                </div>

                <!-- 3. Methodology -->
                <div class="paper-note interactive-layer gs-reveal">
                    <h2>ANALYSIS</h2>
                    <h1>Observer.</h1>
                    <p>喜歡可愛人事物星人。我觀察、我感受、我連結。</p>
                    <p>在熱鬧的背後，捕捉微弱的訊號。將散落的個體，透過熱情重新編織成網。</p>
                </div>

                <!-- 4. Connect -->
                <div class="paper-note interactive-layer gs-reveal">
                    <h2>SYNC</h2>
                    <h1>Connect.</h1>
                    <p>魔人揪揪出動！如果你剛好想參與、想一起感受，就可以私訊我。</p>
                    <div style="margin-top: 1.5rem;">
                        <a href="https://www.threads.net/@nekopapaya" target="_blank" class="social-link"><i class="fa-brands fa-threads"></i></a>
                        <a href="https://www.instagram.com/nekopapaya/" target="_blank" class="social-link"><i class="fa-brands fa-instagram"></i></a>
                    </div>
                </div>

                <div style="height: 30vh;"></div>
            </div>

        </div>
    </div>

    <!-- SCRIPT -->
    <script type="module">
        import * as THREE from 'three';

        // --- Setup ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        // Sky Color (Sunset Gradient via Fog?)
        const bgCol = new THREE.Color(0xFFE4B5); // Moccasin
        scene.background = bgCol;
        scene.fog = new THREE.Fog(0xFFE4B5, 15, 40);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 2, 8); // Inside cabin looking out

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.SoftShadowMap;
        container.appendChild(renderer.domElement);

        // --- Lights ---
        const ambient = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambient);

        const sun = new THREE.DirectionalLight(0xFFD700, 1.2); // Sunset gold
        sun.position.set(-10, 5, -10); // Coming through window
        sun.castShadow = true;
        scene.add(sun);

        // --- Objects: The Floating Atelier ---
        const room = new THREE.Group();
        scene.add(room);

        // Materials
        const matWood = new THREE.MeshStandardMaterial({ color: 0x8B5A2B, roughness: 0.9 });
        const matWall = new THREE.MeshStandardMaterial({ color: 0xF9F1E6, roughness: 1 });
        const matDark = new THREE.MeshStandardMaterial({ color: 0x4A3B2C, roughness: 1 });
        const matGlass = new THREE.MeshPhysicalMaterial({ color: 0x88ccff, transparent: true, opacity: 0.3, roughness: 0, transmission: 0.5 });

        // 1. Cabin Structure
        // Floor
        const floor = new THREE.Mesh(new THREE.BoxGeometry(10, 0.5, 10), matWood);
        floor.position.y = -0.25; floor.receiveShadow = true; room.add(floor);
        // Back Wall (Window)
        const wallBack = new THREE.Mesh(new THREE.BoxGeometry(10, 6, 0.5), matWall);
        wallBack.position.set(0, 3, -5); wallBack.receiveShadow = true; room.add(wallBack);

        // Window Frame (Cutout via scaling trick or primitives)
        // Let's make a big window opening
        const winFrameH = new THREE.Mesh(new THREE.BoxGeometry(4, 0.2, 0.6), matWood);
        winFrameH.position.set(0, 4, -5); room.add(winFrameH);
        const winFrameB = new THREE.Mesh(new THREE.BoxGeometry(4, 0.5, 0.8), matWood); // Sill
        winFrameB.position.set(0, 1.5, -5); room.add(winFrameB);
        const winGlass = new THREE.Mesh(new THREE.BoxGeometry(3.8, 2.3, 0.1), matGlass);
        winGlass.position.set(0, 2.75, -5); room.add(winGlass);

        // 2. The Desk (Analyst Station)
        const deskGroup = new THREE.Group();
        deskGroup.position.set(0, 0, -3.5);
        room.add(deskGroup);

        const deskTop = new THREE.Mesh(new THREE.BoxGeometry(5, 0.2, 2), matWood);
        deskTop.position.y = 1.5; deskTop.castShadow = true; deskGroup.add(deskTop);
        // Legs
        const legGeo = new THREE.CylinderGeometry(0.1, 0.1, 1.5);
        const l1 = new THREE.Mesh(legGeo, matDark); l1.position.set(-2.2, 0.75, 0.8); deskGroup.add(l1);
        const l2 = new THREE.Mesh(legGeo, matDark); l2.position.set(2.2, 0.75, 0.8); deskGroup.add(l2);

        // Props
        // Book
        const book = new THREE.Mesh(new THREE.BoxGeometry(0.8, 0.1, 0.6), new THREE.MeshStandardMaterial({color:0xA8B2A1}));
        book.position.set(-1, 1.6, 0.5); deskGroup.add(book);
        // Mug
        const mug = new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.15, 0.3), new THREE.MeshStandardMaterial({color:0xE09F3E}));
        mug.position.set(1, 1.7, 0.5); deskGroup.add(mug);
        // Lamp
        const lampBase = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.3, 0.1), matDark);
        lampBase.position.set(1.8, 1.6, 0); deskGroup.add(lampBase);
        const lampStem = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 1), matDark);
        lampStem.position.set(1.8, 2.1, 0); deskGroup.add(lampStem);
        const lampHead = new THREE.Mesh(new THREE.ConeGeometry(0.3, 0.5, 32, 1, true), new THREE.MeshStandardMaterial({color:0xF9F1E6, side:THREE.DoubleSide}));
        lampHead.position.set(1.6, 2.5, 0); lampHead.rotation.z = 0.5; deskGroup.add(lampHead);
        // Lamp Light
        const lampP = new THREE.PointLight(0xFFD700, 0.5, 3);
        lampP.position.set(1.6, 2.4, 0); deskGroup.add(lampP);

        // 3. The Sea (Outside Window)
        const seaGeo = new THREE.PlaneGeometry(100, 50, 64, 64);
        const seaMat = new THREE.MeshStandardMaterial({
            color: 0x3E88A5, roughness: 0.1, metalness: 0.5,
            flatShading: true
        });
        const sea = new THREE.Mesh(seaGeo, seaMat);
        sea.rotation.x = -Math.PI/2;
        sea.position.set(0, -2, -30); // Far back
        scene.add(sea);

        // 4. Floating Hydrogen Bubbles
        const bubbles = [];
        const bGeo = new THREE.SphereGeometry(0.15, 16, 16);
        const bMat = new THREE.MeshBasicMaterial({ color: 0xFFFFFF, transparent: true, opacity: 0.6 });
        for(let i=0; i<15; i++) {
            const b = new THREE.Mesh(bGeo, bMat);
            b.position.set(
                (Math.random()-0.5)*4,
                Math.random()*4,
                (Math.random()-0.5)*2
            );
            b.userData = { speed: Math.random()*0.02 + 0.01, offset: Math.random()*10 };
            room.add(b);
            bubbles.push(b);
        }


        // --- Interaction ---
        let scrollY = 0;
        window.addEventListener('scroll', () => scrollY = window.scrollY);

        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // 1. Sea Waves
            const pos = seaGeo.attributes.position;
            for(let i=0; i<pos.count; i++) {
                const x = pos.getX(i);
                const y = pos.getY(i);
                pos.setZ(i, Math.sin(x*0.5 + time)*0.5 + Math.cos(y*0.3 + time*0.8)*0.5);
            }
            pos.needsUpdate = true;

            // 2. Cabin Rocking (Boat feel)
            room.rotation.z = Math.sin(time * 0.5) * 0.02;
            room.rotation.x = Math.sin(time * 0.3) * 0.01;

            // 3. Bubbles
            bubbles.forEach(b => {
                b.position.y += b.userData.speed;
                if(b.position.y > 6) b.position.y = 0;
                b.position.x += Math.sin(time + b.userData.offset) * 0.005;
            });

            // 4. Parallax Camera
            // Move camera slightly based on scroll to "look around" room
            const progress = scrollY / (document.body.scrollHeight - window.innerHeight);
            camera.position.x = Math.sin(progress * 0.5) * 1;
            camera.position.y = 2 - progress * 0.5;
            camera.lookAt(0, 1.5, -5); // Look at window

            renderer.render(scene, camera);
        }
        animate();

        // GSAP
        gsap.registerPlugin(ScrollTrigger);
        gsap.utils.toArray('.gs-reveal').forEach(elem => {
            gsap.to(elem, {
                y: 0, opacity: 1, rotate: 0, duration: 1, ease: "power2.out",
                scrollTrigger: { trigger: elem, start: "top 85%" }
            });
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>