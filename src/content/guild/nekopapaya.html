<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEKOPAPAYA | The Analyst's Haven</title>
    <meta name="description" content="NEKOPAPAYA - 人體狀態觀察分析師 | 康樂股長 | 避風港">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&family=Nunito:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js" defer></script>

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        :root {
            /* Palette: Editorial Chic */
            --c-bg: #F9F8F6;       /* Editorial White */
            --c-text: #2C2C2C;     /* Deep Charcoal */
            --c-accent: #78C0A8;   /* Muted Green */
            --c-warm: #E2B57B;     /* Champagne Gold */
            --c-cool: #87CEEB;     /* Airy Blue */

            --f-serif: 'Noto Serif TC', serif;
            --f-display: 'Playfair Display', serif;
            --f-sans: 'Nunito', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: var(--f-serif);
            overflow-x: hidden;
            line-height: 1.8;
            cursor: default;
        }

        /* --- Global Layers --- */
        #webgl-container {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 0; pointer-events: none; opacity: 0.6; /* Subtle */
        }

        #noise-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 1; pointer-events: none; opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='1'/%3E%3C/svg%3E");
        }

        .scroller { position: relative; z-index: 10; pointer-events: none; }
        .interactive-layer { pointer-events: auto; }

        /* --- Sections --- */
        .section {
            min-height: 100vh;
            padding: 8rem 2rem;
            display: flex; flex-direction: column; justify-content: center;
            position: relative;
        }

        .container {
            max-width: 1200px; width: 100%; margin: 0 auto;
            position: relative;
        }

        /* --- Typography (Editorial) --- */
        .reveal-text {
            overflow: hidden; display: block;
        }
        .reveal-inner {
            display: block; transform: translateY(100%);
        }

        h1 {
            font-family: var(--f-display);
            font-size: clamp(4rem, 10vw, 8rem);
            font-weight: 400; /* Elegant */
            line-height: 1;
            margin-bottom: 2rem;
            letter-spacing: -0.03em;
            color: var(--c-text);
        }

        .sub-heading {
            font-family: var(--f-sans);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
            color: var(--c-accent);
            display: flex; align-items: center; gap: 1rem;
        }
        .sub-heading::before {
            content: ''; width: 40px; height: 1px; background: var(--c-accent);
        }

        p.lead {
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            font-weight: 300;
            max-width: 30ch;
            line-height: 1.4;
            margin-bottom: 4rem;
        }

        .quote {
            font-family: var(--f-display);
            font-style: italic;
            font-size: clamp(2rem, 5vw, 4rem);
            color: var(--c-text);
            text-align: center;
            margin: 4rem 0;
            opacity: 0.8;
        }

        /* --- Components --- */
        .nav-fixed {
            position: fixed; top: 2rem; left: 2rem; z-index: 50;
            font-family: var(--f-sans); font-weight: 700; font-size: 0.9rem;
            color: var(--c-text); text-decoration: none;
            display: flex; align-items: center; gap: 0.5rem;
            pointer-events: auto; opacity: 0; /* Animated in */
        }
        .nav-line { width: 0px; height: 1px; background: var(--c-text); transition: width 0.3s; }
        .nav-fixed:hover .nav-line { width: 20px; }

        .image-parallax {
            width: 100%; height: 60vh;
            overflow: hidden;
            border-radius: 4px;
            margin: 4rem 0;
            position: relative;
        }
        .image-parallax img {
            width: 100%; height: 120%; /* Taller for parallax */
            object-fit: cover;
            object-position: center;
        }

        /* --- Methodology Grid (Pinning) --- */
        .method-section {
            display: grid; grid-template-columns: 1fr; gap: 4rem;
            align-items: start; min-height: 150vh; /* Scroll space */
        }
        @media(min-width: 900px) {
            .method-section { grid-template-columns: 0.8fr 1.2fr; }
        }

        .method-nav {
            position: relative; /* Fallback */
            display: flex; flex-direction: column; gap: 2rem;
        }
        .method-step {
            font-family: var(--f-sans); font-size: 2rem; font-weight: 700;
            color: rgba(0,0,0,0.2); transition: color 0.3s, transform 0.3s;
            cursor: pointer;
        }
        .method-step.active {
            color: var(--c-text); transform: translateX(20px);
        }

        .method-content {
            padding-top: 10vh;
        }
        .method-card {
            background: white; padding: 4rem; margin-bottom: 4rem;
            border-radius: 2px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.05);
            opacity: 0.5; transition: opacity 0.5s;
        }
        .method-card.active { opacity: 1; }

        /* --- Footer --- */
        .footer-link {
            font-family: var(--f-display); font-size: 4rem;
            color: var(--c-text); text-decoration: none;
            border-bottom: 2px solid transparent;
            transition: border-color 0.3s;
            margin-right: 2rem;
            display: inline-block;
        }
        .footer-link:hover { border-color: var(--c-text); }

    </style>
</head>
<body>

    <a href="/guild" class="nav-fixed" id="nav">
        <div class="nav-line"></div> NEKOPAPAYA
    </a>

    <div id="webgl-container"></div>
    <div id="noise-overlay"></div>

    <div class="scroller">

        <!-- 1. Hero: The Introduction -->
        <section class="section" style="justify-content: flex-end; padding-bottom: 10vh;">
            <div class="container interactive-layer">
                <div class="sub-heading reveal-text"><span class="reveal-inner">Human State Analyst</span></div>

                <h1 class="reveal-text">
                    <span class="reveal-inner">The Observation</span>
                </h1>
                <h1 class="reveal-text" style="margin-top: -1rem;">
                    <span class="reveal-inner">of Quiet Souls.</span>
                </h1>

                <div style="margin-top: 4rem; display: flex; justify-content: space-between; align-items: flex-end;">
                    <p class="lead reveal-text">
                        <span class="reveal-inner">
                            I am Nekopapaya.<br>
                            Conductor of Joy.<br>
                            Analyst of the Invisible.
                        </span>
                    </p>
                    <div class="reveal-text" style="text-align: right;">
                        <span class="reveal-inner" style="font-family: var(--f-sans); font-size: 0.9rem; color: var(--c-accent);">
                            SCROLL TO ANALYZE ↓
                        </span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. The Philosophy (Parallax Image) -->
        <section class="section" style="padding: 0;">
            <div class="container interactive-layer">
                <div class="image-parallax gs-parallax">
                    <img src="/assets/img/guild/nekopapaya/scene.webp" alt="Safe Haven Scene">
                </div>
                <div style="max-width: 600px; margin: -5rem auto 0; background: white; padding: 4rem; position: relative; z-index: 2; box-shadow: 0 10px 40px rgba(0,0,0,0.05);">
                    <div class="sub-heading">Core Concept</div>
                    <h2 style="font-family: var(--f-display); font-size: 3rem; margin-bottom: 2rem;">Safe Haven.</h2>
                    <p>
                        這是一個可以停下來、坐一下的地方。<br>
                        有時候我會在這裡，人聚在一起，慢慢享受人與人的溫度。
                    </p>
                    <p style="margin-top: 1rem; font-style: italic; color: var(--c-accent);">
                        "Hydrogen knocking on your soul."
                    </p>
                </div>
            </div>
        </section>

        <!-- 3. Methodology (Pinning Scroll) -->
        <section class="section">
            <div class="container interactive-layer">
                <div class="method-section">

                    <!-- Left: Navigation (Pinned) -->
                    <div class="method-nav">
                        <div class="sub-heading" style="margin-bottom: 0;">Methodology</div>
                        <div class="method-step" data-target="m1">01. Observe</div>
                        <div class="method-step" data-target="m2">02. Analyze</div>
                        <div class="method-step" data-target="m3">03. Connect</div>
                    </div>

                    <!-- Right: Content (Scrolling) -->
                    <div class="method-content">

                        <div class="method-card" id="m1">
                            <h3 style="font-family: var(--f-display); font-size: 2.5rem; margin-bottom: 1rem;">The Silent Observer</h3>
                            <p>
                                無聲地觀察每個人的狀態與需求。<br>
                                在熱鬧的背後，往往藏著最需要被看見的靈魂。
                            </p>
                            <div style="margin-top: 2rem; width: 100%; height: 2px; background: #eee;">
                                <div style="width: 30%; height: 100%; background: var(--c-accent);"></div>
                            </div>
                        </div>

                        <div class="method-card" id="m2">
                            <h3 style="font-family: var(--f-display); font-size: 2.5rem; margin-bottom: 1rem;">Emotional Analysis</h3>
                            <p>
                                解構情緒，調配出最適合當下的氛圍。<br>
                                如同實驗室中的精準配方，讓每個人都感到自在。
                            </p>
                            <div style="margin-top: 2rem; width: 100%; height: 2px; background: #eee;">
                                <div style="width: 60%; height: 100%; background: var(--c-cool);"></div>
                            </div>
                        </div>

                        <div class="method-card" id="m3">
                            <h3 style="font-family: var(--f-display); font-size: 2.5rem; margin-bottom: 1rem;">The Connection</h3>
                            <p>
                                魔人揪揪出動！將孤單的靈魂串連起來。<br>
                                創造一個沒有壓力、自由進出的聚會空間。
                            </p>
                            <div style="margin-top: 2rem; width: 100%; height: 2px; background: #eee;">
                                <div style="width: 90%; height: 100%; background: var(--c-warm);"></div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </section>

        <!-- 4. Footer -->
        <section class="section" style="text-align: center;">
            <div class="container interactive-layer">
                <div class="reveal-text">
                    <p class="reveal-inner" style="font-family: var(--f-sans); color: var(--c-accent); margin-bottom: 2rem;">Ready to Gather?</p>
                </div>
                <div>
                    <a href="https://www.threads.net/@nekopapaya" target="_blank" class="footer-link">Threads</a>
                    <a href="https://www.instagram.com/nekopapaya/" target="_blank" class="footer-link">Instagram</a>
                </div>
                <div style="margin-top: 4rem; opacity: 0.5;">
                    <p style="font-size: 0.9rem;">Safety Protocol: 自由選擇，無壓力空間。</p>
                </div>
            </div>
        </section>

    </div>

    <!-- SCRIPT: The Editorial Engine -->
    <script type="module">
        import * as THREE from 'three';

        // --- GSAP Setup ---
        gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

        // Global State (Declared early to avoid TDZ issues)
        let targetColorIndex = 0;

        // 1. Hero Reveal
        const tl = gsap.timeline({ defaults: { ease: "power4.out", duration: 1.5 } });

        tl.to('.nav-fixed', { opacity: 1, duration: 1 })
          .to('.reveal-inner', { y: '0%', stagger: 0.15 }, "-=0.5");

        // 2. Parallax Image
        gsap.to('.gs-parallax img', {
            yPercent: 20,
            ease: "none",
            scrollTrigger: {
                trigger: '.gs-parallax',
                start: "top bottom",
                end: "bottom top",
                scrub: true
            }
        });

        // 3. Methodology Pinning & Active State
        // Only run pin on desktop
        if (window.innerWidth > 900) {
            ScrollTrigger.create({
                trigger: ".method-section",
                start: "top top",
                end: "bottom bottom",
                pin: ".method-nav",
                scrub: true
            });
        }

        // Highlights for steps
        const steps = document.querySelectorAll('.method-step');
        const cards = document.querySelectorAll('.method-card');

        cards.forEach((card, i) => {
            ScrollTrigger.create({
                trigger: card,
                start: "top center",
                end: "bottom center",
                onEnter: () => updateActive(i),
                onEnterBack: () => updateActive(i)
            });
        });

        function updateActive(index) {
            steps.forEach((step, i) => {
                if (i === index) step.classList.add('active');
                else step.classList.remove('active');
            });
            cards.forEach((card, i) => {
                if (i === index) card.classList.add('active');
                else card.classList.remove('active');
            });

            // Color Shift (WebGL)
            targetColorIndex = index + 1; // +1 because 0 is hero
        }


        // --- Three.js Background (Fluid Gradient Shader) ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        const camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);
        const renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        const fragmentShader = `
            uniform float time;
            uniform vec3 colorA;
            uniform vec3 colorB;
            varying vec2 vUv;

            void main() {
                // Simple gradient based on UV and Time
                float mixFactor = vUv.y + sin(time * 0.5 + vUv.x * 3.0) * 0.2;
                vec3 finalColor = mix(colorA, colorB, clamp(mixFactor, 0.0, 1.0));

                // Soft center light
                float d = distance(vUv, vec2(0.5, 0.5));
                finalColor += (1.0 - d) * 0.15;

                gl_FragColor = vec4(finalColor, 1.0);
            }
        `;

        const vertexShader = `
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = vec4(position, 1.0);
            }
        `;

        // Color Palettes
        const palettes = [
            { a: new THREE.Color(0xF9F8F6), b: new THREE.Color(0xE8E2D9) }, // 0: Neutral (Hero)
            { a: new THREE.Color(0xE8F6F3), b: new THREE.Color(0x78C0A8) }, // 1: Green (Observe)
            { a: new THREE.Color(0xEBF5FB), b: new THREE.Color(0x87CEEB) }, // 2: Blue (Analyze)
            { a: new THREE.Color(0xFCF3CF), b: new THREE.Color(0xE2B57B) }  // 3: Gold (Connect)
        ];

        const uniformColorA = new THREE.Color(palettes[0].a);
        const uniformColorB = new THREE.Color(palettes[0].b);

        const uniforms = {
            time: { value: 0 },
            colorA: { value: uniformColorA },
            colorB: { value: uniformColorB }
        };

        const material = new THREE.ShaderMaterial({
            uniforms: uniforms,
            vertexShader: vertexShader,
            fragmentShader: fragmentShader
        });

        const plane = new THREE.Mesh(new THREE.PlaneGeometry(2, 2), material);
        scene.add(plane);

        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            uniforms.time.value = clock.getElapsedTime();

            // Smooth Color Transition
            const targetA = palettes[targetColorIndex % palettes.length].a;
            const targetB = palettes[targetColorIndex % palettes.length].b;

            uniformColorA.lerp(targetA, 0.02);
            uniformColorB.lerp(targetB, 0.02);

            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>