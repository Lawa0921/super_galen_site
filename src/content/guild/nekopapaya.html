<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEKOPAPAYA | The Cozy Haven</title>
    <meta name="description" content="NEKOPAPAYA - 人體狀態觀察分析師 | 康樂股長 | 避風港">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        :root {
            /* Palette: Soft Clay */
            --c-bg: #F4F1EC;
            --c-text: #2D3436;
            --c-accent: #8FA891; /* Sage */
            --c-warm: #E6B89C;   /* Terracotta */
            --c-wood: #D7B698;

            --f-en: 'Nunito', sans-serif;
            --f-zh: 'Noto Sans TC', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: var(--f-zh);
            overflow-x: hidden;
            line-height: 1.7;
        }

        /* --- Layout --- */
        #webgl-container {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 0; pointer-events: none;
        }

        .scroller { position: relative; z-index: 10; pointer-events: none; }
        .interactive-layer { pointer-events: auto; }

        .split-layout {
            display: grid; grid-template-columns: 1fr;
            min-height: 100vh;
        }
        @media(min-width: 900px) {
            .split-layout { grid-template-columns: 1fr 1fr; }
        }

        /* --- Content Sections --- */
        .content-col {
            padding: 4rem 2rem;
            display: flex; flex-direction: column; gap: 80vh; /* Spacer */
            margin-top: 20vh;
        }
        @media(min-width: 900px) {
            .content-col { grid-column: 2; padding-left: 4rem; padding-right: 10%; }
        }

        .text-block {
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.05);
            border: 1px solid white;
            transition: transform 0.3s;
            opacity: 0; transform: translateY(50px); /* Init hidden for GSAP */
        }
        .text-block:hover { transform: translateY(-5px); }

        h1 { font-family: var(--f-en); font-weight: 900; font-size: 3.5rem; line-height: 1.1; margin-bottom: 1rem; color: var(--c-text); }
        h2 { font-family: var(--f-en); font-weight: 700; font-size: 0.9rem; letter-spacing: 0.2em; color: var(--c-accent); text-transform: uppercase; margin-bottom: 1.5rem; }
        h3 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; }
        p { font-size: 1.1rem; color: #555; margin-bottom: 1.5rem; }

        .tag-row { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .tag { background: white; padding: 0.4rem 1rem; border-radius: 50px; font-size: 0.8rem; font-weight: 700; color: var(--c-accent); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* --- Avatar --- */
        .avatar-circle {
            width: 100px; height: 100px; border-radius: 50%;
            border: 4px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            overflow: hidden; margin-bottom: 2rem;
        }
        .avatar-circle img { width: 100%; height: 100%; object-fit: cover; }

        /* --- Nav & Social --- */
        .nav-fixed {
            position: fixed; top: 2rem; left: 2rem; z-index: 50;
            font-family: var(--f-en); font-weight: 900;
            color: var(--c-text); text-decoration: none;
            padding: 0.5rem 1.2rem; background: white; border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); pointer-events: auto;
        }

        .social-link {
            display: inline-flex; align-items: center; justify-content: center;
            width: 50px; height: 50px; border-radius: 50%; background: var(--c-bg);
            color: var(--c-text); font-size: 1.2rem; margin-right: 1rem;
            transition: 0.2s; text-decoration: none;
        }
        .social-link:hover { transform: scale(1.1); background: var(--c-accent); color: white; }

        /* --- Mobile Overlay --- */
        @media(max-width: 900px) {
            #webgl-container { opacity: 0.3; } /* Fade out bg on mobile for text readability */
            .content-col { gap: 40vh; margin-top: 10vh; }
        }

    </style>
</head>
<body>

    <a href="/guild" class="nav-fixed">← GUILD</a>
    <div id="webgl-container"></div>

    <div class="scroller">
        <div class="split-layout">

            <!-- Left: 3D Scene Space (Empty in Grid) -->
            <div></div>

            <!-- Right: Content -->
            <div class="content-col">

                <!-- 1. Hero -->
                <div class="text-block interactive-layer gs-reveal">
                    <div class="avatar-circle">
                        <img src="/assets/img/guild/nekopapaya/avatar.webp" alt="Avatar">
                    </div>
                    <div class="tag-row">
                        <span class="tag">#Analyst</span>
                        <span class="tag">#SafeHaven</span>
                    </div>
                    <h1>NEKOPAPAYA</h1>
                    <p style="font-weight: 500;">人體狀態觀察分析師 | 康樂股長</p>
                    <p style="font-style: italic; color: var(--c-accent);">"Hydrogen knocking on your soul."</p>
                </div>

                <!-- 2. Methodology -->
                <div class="text-block interactive-layer gs-reveal">
                    <h2>THE METHOD</h2>
                    <h3>Observer & Tuner.</h3>
                    <p>無聲地觀察每個人的狀態與需求。在熱鬧的背後，看見靈魂的頻率。</p>
                    <p>就像科學家在實驗室調配配方，我調配的是「氛圍」。消除雜訊，讓每個人都能找到最舒適的波長。</p>
                </div>

                <!-- 3. Philosophy -->
                <div class="text-block interactive-layer gs-reveal">
                    <h2>CORE VALUE</h2>
                    <h3>Safe Haven.</h3>
                    <p>這裡是一個可以停下來、坐一下的地方。有時候我會在這裡，人聚在一起，慢慢享受人與人的溫度。</p>
                    <p style="border-left: 3px solid var(--c-accent); padding-left: 1rem;">
                        <strong>Safety Protocol:</strong> 沒有強迫，只有邀請。隨時歡迎，也隨時自由。
                    </p>
                </div>

                <!-- 4. Contact -->
                <div class="text-block interactive-layer gs-reveal">
                    <h2>SYNC</h2>
                    <h3>Connect.</h3>
                    <p>魔人揪揪出動！如果你剛好想參與、想一起感受，就可以私訊我。</p>
                    <div style="margin-top: 2rem;">
                        <a href="https://www.threads.net/@nekopapaya" target="_blank" class="social-link"><i class="fa-brands fa-threads"></i></a>
                        <a href="https://www.instagram.com/nekopapaya/" target="_blank" class="social-link"><i class="fa-brands fa-instagram"></i></a>
                    </div>
                </div>

                <div style="height: 20vh;"></div>

            </div>
        </div>
    </div>

    <!-- SCRIPT -->
    <script type="module">
        import * as THREE from 'three';

        // --- Setup ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        // scene.background = new THREE.Color(0xF4F1EC);
        // Soft gradient bg via shader later? Or just simple fog.
        scene.fog = new THREE.Fog(0xF4F1EC, 15, 30);

        const camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(8, 6, 12);
        camera.lookAt(0, 1, 0);

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.SoftShadowMap;
        container.appendChild(renderer.domElement);

        // --- Lights (Studio Soft) ---
        const ambient = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambient);

        const dirLight = new THREE.DirectionalLight(0xFFE4C4, 1.2);
        dirLight.position.set(5, 10, 5);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 2048;
        dirLight.shadow.mapSize.height = 2048;
        dirLight.shadow.bias = -0.0001;
        scene.add(dirLight);

        const fillLight = new THREE.DirectionalLight(0xE6F3FF, 0.5); // Cool fill
        fillLight.position.set(-5, 2, -5);
        scene.add(fillLight);

        // --- Materials (Clay) ---
        const matClay = new THREE.MeshStandardMaterial({ color: 0xFFFFFF, roughness: 1, metalness: 0 });
        const matAccent = new THREE.MeshStandardMaterial({ color: 0x8FA891, roughness: 1 });
        const matWarm = new THREE.MeshStandardMaterial({ color: 0xE6B89C, roughness: 1 });
        const matWood = new THREE.MeshStandardMaterial({ color: 0xD7B698, roughness: 0.9 });
        const matDark = new THREE.MeshStandardMaterial({ color: 0x4A4A4A, roughness: 1 });

        // --- Scene Builder (Diorama) ---
        const stage = new THREE.Group();
        scene.add(stage);

        // 1. Floor Platform
        const floorGeo = new THREE.CylinderGeometry(6, 6, 0.5, 64);
        const floor = new THREE.Mesh(floorGeo, matClay);
        floor.position.y = -0.25; floor.receiveShadow = true;
        stage.add(floor);

        // 2. The Cozy Armchair
        const chairGroup = new THREE.Group();
        chairGroup.position.set(0, 0, 0);
        stage.add(chairGroup);
        // Base
        const seatGeo = new THREE.CylinderGeometry(1.5, 1.2, 0.8, 32);
        const seat = new THREE.Mesh(seatGeo, matWarm);
        seat.position.y = 0.4; seat.castShadow = true; chairGroup.add(seat);
        // Backrest (Torus segment trick or sphere cut)
        const backGeo = new THREE.SphereGeometry(1.5, 32, 16, 0, Math.PI * 2, 0, Math.PI/2);
        const back = new THREE.Mesh(backGeo, matWarm);
        back.rotation.x = Math.PI; back.position.y = 1.2; back.scale.z = 0.5;
        back.castShadow = true; chairGroup.add(back);

        // 3. Sleeping Cat (Minimalist)
        const catGroup = new THREE.Group();
        catGroup.position.set(0, 0.8, 0);
        chairGroup.add(catGroup);
        const catBody = new THREE.Mesh(new THREE.SphereGeometry(0.5, 32, 16, 0, Math.PI*2, 0, Math.PI/2), matDark);
        catBody.scale.y = 0.6; catBody.castShadow = true; catGroup.add(catBody);
        const catHead = new THREE.Mesh(new THREE.SphereGeometry(0.35), matDark);
        catHead.position.set(0.4, 0.1, 0.2); catHead.castShadow = true; catGroup.add(catHead);
        // Ears
        const earGeo = new THREE.ConeGeometry(0.1, 0.2, 4);
        const ear1 = new THREE.Mesh(earGeo, matDark); ear1.position.set(0.3, 0.4, 0.2); catHead.add(ear1);
        const ear2 = new THREE.Mesh(earGeo, matDark); ear2.position.set(0.5, 0.4, 0.2); catHead.add(ear2);

        // 4. Side Table & Plant
        const table = new THREE.Mesh(new THREE.CylinderGeometry(0.8, 0.8, 0.6, 32), matWood);
        table.position.set(2.5, 0.3, 1); table.castShadow = true; stage.add(table);
        // Plant
        const pot = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.3, 0.5), matClay);
        pot.position.set(0, 0.55, 0); pot.castShadow = true; table.add(pot);
        const leafGeo = new THREE.SphereGeometry(0.3);
        const l1 = new THREE.Mesh(leafGeo, matAccent); l1.position.set(0, 0.5, 0); pot.add(l1);
        const l2 = new THREE.Mesh(leafGeo, matAccent); l2.position.set(0.2, 0.7, 0); pot.add(l2);
        const l3 = new THREE.Mesh(leafGeo, matAccent); l3.position.set(-0.2, 0.6, 0.1); pot.add(l3);

        // 5. Paper Boat (Floor)
        const boatGroup = new THREE.Group();
        boatGroup.position.set(-2, 0.1, 2); boatGroup.rotation.y = 0.5;
        stage.add(boatGroup);
        const boatGeo = new THREE.ConeGeometry(0.5, 0.4, 4, 1, true); // Simplified
        const boat = new THREE.Mesh(boatGeo, new THREE.MeshStandardMaterial({color: 0xFFFFFF, roughness: 0.9}));
        boat.rotation.z = Math.PI; boat.scale.z = 2; boat.castShadow = true;
        boatGroup.add(boat);

        // 6. Floating Hydrogen Bubbles
        const bubbles = [];
        const bubbleGeo = new THREE.SphereGeometry(0.2, 16, 16);
        const bubbleMat = new THREE.MeshStandardMaterial({ color: 0x8AB6D6, transparent: true, opacity: 0.6 });

        for(let i=0; i<12; i++) {
            const b = new THREE.Mesh(bubbleGeo, bubbleMat);
            b.position.set(
                (Math.random()-0.5)*5,
                Math.random()*4 + 1,
                (Math.random()-0.5)*5
            );
            b.userData = { speed: Math.random()*0.02 + 0.01, offset: Math.random()*10 };
            stage.add(b);
            bubbles.push(b);
        }


        // --- Interaction ---
        let scrollY = 0;
        let targetRotation = 0;
        const mouse = new THREE.Vector2();

        window.addEventListener('scroll', () => {
            scrollY = window.scrollY;
            // Rotate stage based on scroll
            targetRotation = scrollY * 0.002;
        });

        window.addEventListener('mousemove', (e) => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
        });

        // Loop
        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;

            // Turntable Effect
            stage.rotation.y += (targetRotation - stage.rotation.y) * 0.05;

            // Subtle Idle Animation
            catGroup.scale.y = 1 + Math.sin(time * 2) * 0.02; // Breathing
            catGroup.scale.x = 1 - Math.sin(time * 2) * 0.01;
            catGroup.scale.z = 1 - Math.sin(time * 2) * 0.01;

            boatGroup.rotation.z = Math.sin(time) * 0.1; // Rocking

            // Bubbles
            bubbles.forEach(b => {
                b.position.y += Math.sin(time + b.userData.offset) * 0.005;
                b.position.x += Math.cos(time + b.userData.offset) * 0.002;
            });

            // Camera Parallax
            camera.position.x += (8 + mouse.x - camera.position.x) * 0.05;
            camera.position.y += (6 + mouse.y - camera.position.y) * 0.05;
            camera.lookAt(0, 1, 0);

            renderer.render(scene, camera);
        }
        animate();

        // GSAP
        gsap.registerPlugin(ScrollTrigger);
        gsap.utils.toArray('.gs-reveal').forEach(elem => {
            gsap.to(elem, {
                y: 0, opacity: 1, duration: 1, ease: "power2.out",
                scrollTrigger: { trigger: elem, start: "top 85%" }
            });
        });

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>