<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEKOPAPAYA | The Cozy Haven</title>
    <meta name="description" content="NEKOPAPAYA - 人體狀態觀察分析師 | 康樂股長 | 避風港">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        :root {
            /* Palette: Enriched Haven */
            --c-bg: #F4F1EC;
            --c-text: #4a4a4a;
            --c-accent: #8FA891;
            --c-blue: #8AB6D6;
            --c-warm: #EAC435;
            --c-wood: #D7B698;

            --f-en: 'Nunito', sans-serif;
            --f-zh: 'Noto Sans TC', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: var(--f-zh);
            overflow-x: hidden;
            line-height: 1.7;
        }

        #webgl-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0; }
        .scroller { position: relative; z-index: 10; pointer-events: none; }
        .interactive-layer { pointer-events: auto; }

        /* --- Tooltip UI --- */
        #tooltip {
            position: fixed; pointer-events: none; opacity: 0;
            background: rgba(255,255,255,0.9); padding: 0.5rem 1rem;
            border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            font-family: var(--f-en); font-weight: 700; color: var(--c-accent);
            transform: translate(-50%, -150%); transition: opacity 0.3s;
            z-index: 100;
        }

        /* --- Sections --- */
        .section {
            height: 120vh; /* More space */
            display: flex; flex-direction: column; justify-content: center;
            padding: 2rem; position: relative;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.05);
            max-width: 450px;
            border: 2px solid rgba(255,255,255,0.8);
            transition: transform 0.3s;
        }
        .content-card:hover { transform: translateY(-5px); }

        .pos-left { margin-right: auto; margin-left: 5vw; }
        .pos-right { margin-left: auto; margin-right: 5vw; }
        .pos-center { margin: 0 auto; text-align: center; }
        .pos-top-left { margin-right: auto; margin-left: 10vw; margin-bottom: auto; margin-top: 15vh; }

        h1 { font-family: var(--f-en); font-weight: 900; font-size: 3rem; line-height: 1.1; margin-bottom: 0.5rem; }
        h2 { font-family: var(--f-en); font-weight: 700; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--c-accent); margin-bottom: 1rem; }
        h3 { font-size: 1.2rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--c-text); }
        p { font-size: 1rem; color: #666; margin-bottom: 1rem; }

        .tag {
            display: inline-block; padding: 0.3rem 0.8rem; background: white;
            border-radius: 50px; font-size: 0.8rem; font-weight: 700; color: var(--c-accent);
            margin-right: 0.5rem; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .nav-fixed {
            position: fixed; top: 2rem; left: 2rem; z-index: 50;
            font-family: var(--f-en); font-weight: 900; color: var(--c-text); text-decoration: none;
            padding: 0.5rem 1.2rem; background: white; border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); pointer-events: auto;
        }

        .social-link {
            display: inline-flex; align-items: center; justify-content: center;
            width: 50px; height: 50px; border-radius: 50%; background: white;
            color: var(--c-text); font-size: 1.2rem; margin: 0 0.5rem;
            transition: transform 0.2s, background 0.2s, color 0.2s; text-decoration: none;
            box-shadow: 0 5px 10px rgba(0,0,0,0.05);
        }
        .social-link:hover { transform: scale(1.1); background: var(--c-accent); color: white; }

        @media(max-width: 768px) {
            .content-card { margin: 0 auto !important; width: 100%; max-width: 100%; padding: 1.5rem; }
            h1 { font-size: 2.2rem; }
            .section { height: auto; min-height: 80vh; padding: 4rem 1.5rem; }
        }

    </style>
</head>
<body>

    <a href="/guild" class="nav-fixed">← GUILD</a>
    <div id="tooltip"></div>
    <div id="webgl-container"></div>

    <div class="scroller">

        <!-- 1. Hero: Overview -->
        <section class="section">
            <div class="content-card pos-left interactive-layer gs-reveal">
                <span class="tag">#SafeHaven</span>
                <span class="tag">#Analyst</span>
                <h1 style="margin-top: 1rem;">NEKOPAPAYA</h1>
                <p>人體狀態觀察分析師 | 康樂股長</p>
                <p style="font-style: italic; color: var(--c-accent);">"Hydrogen knocking on your soul."</p>
                <div style="font-size: 0.9rem; color: #888;">
                    <i class="fa-solid fa-computer-mouse"></i> Scroll & Explore the Room
                </div>
            </div>
        </section>

        <!-- 2. Desk: Methodology -->
        <section class="section">
            <div class="content-card pos-right interactive-layer gs-reveal" style="max-width: 400px;">
                <h2>THE LAB</h2>
                <h1>Analysis.</h1>
                <h3>Observe & Tune</h3>
                <p>無聲地觀察每個人的狀態與需求。就像科學家在實驗室調配配方，我調配的是「氛圍」。</p>
                <div style="background: rgba(255,255,255,0.5); padding: 1rem; border-radius: 8px;">
                    <strong style="color: var(--c-blue);">Toolkit:</strong><br>
                    Listening, Empathy, Vibe Check.
                </div>
            </div>
        </section>

        <!-- 3. Bookshelf: Memories -->
        <section class="section">
            <div class="content-card pos-left interactive-layer gs-reveal">
                <h2>ARCHIVE</h2>
                <h1>Library of Souls.</h1>
                <p>每一個相遇都是一本書。我收集著大家的故事，將它們安放在這個空間裡。</p>
                <p>這裡不只是避風港，也是記憶的圖書館。</p>
            </div>
        </section>

        <!-- 4. Lounge: The Safe Zone -->
        <section class="section">
            <div class="content-card pos-right interactive-layer gs-reveal">
                <h2>THE HAVEN</h2>
                <h1>Rest Here.</h1>
                <p>這裡是一個可以停下來、坐一下的地方。沒有強迫，只有邀請。</p>
                <p>喜歡可愛人事物、熱情、船。這就是我靈魂的燃料。</p>
            </div>
        </section>

        <!-- 5. Corkboard: Connect -->
        <section class="section">
            <div class="content-card pos-center interactive-layer gs-reveal">
                <h2>CHANNEL OPEN</h2>
                <h1>Connect.</h1>
                <p>魔人揪揪出動！如果你剛好想參與、想一起感受，就可以私訊我。</p>
                <div style="margin-top: 2rem;">
                    <a href="https://www.threads.net/@nekopapaya" target="_blank" class="social-link"><i class="fa-brands fa-threads"></i></a>
                    <a href="https://www.instagram.com/nekopapaya/" target="_blank" class="social-link"><i class="fa-brands fa-instagram"></i></a>
                </div>
                <p style="font-size: 0.8rem; margin-top: 1rem; opacity: 0.6;">Safety Protocol: Voluntary Basis Only.</p>
            </div>
        </section>

    </div>

    <!-- SCRIPT -->
    <script type="module">
        import * as THREE from 'three';

        // --- Setup ---
        const container = document.getElementById('webgl-container');
        const tooltip = document.getElementById('tooltip');
        const scene = new THREE.Scene();
        scene.fog = new THREE.Fog(0xF4F1EC, 10, 25);

        // Isometric Camera
        const aspect = window.innerWidth / window.innerHeight;
        const d = 12;
        const camera = new THREE.OrthographicCamera(-d * aspect, d * aspect, d, -d, 1, 1000);
        camera.position.set(20, 20, 20);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.SoftShadowMap;
        container.appendChild(renderer.domElement);

        // Lights
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xFFE4C4, 0.8);
        dirLight.position.set(10, 20, 5);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 2048;
        dirLight.shadow.mapSize.height = 2048;
        scene.add(dirLight);

        // --- Assets (Materials) ---
        const matWood = new THREE.MeshStandardMaterial({ color: 0xD7B698, roughness: 0.8 });
        const matWall = new THREE.MeshStandardMaterial({ color: 0xFFFFFF, roughness: 0.9 });
        const matDark = new THREE.MeshStandardMaterial({ color: 0x4A4A4A, roughness: 0.8 });
        const matAccent = new THREE.MeshStandardMaterial({ color: 0x8FA891, roughness: 0.8 });
        const matBlue = new THREE.MeshStandardMaterial({ color: 0x8AB6D6, roughness: 0.6 });
        const matYellow = new THREE.MeshStandardMaterial({ color: 0xEAC435, roughness: 0.6 });
        const matPaper = new THREE.MeshStandardMaterial({ color: 0xFFF8DC, roughness: 0.9 });

        // --- Scene Builder ---
        const room = new THREE.Group();
        scene.add(room);

        // 1. Structure
        const floor = new THREE.Mesh(new THREE.BoxGeometry(14, 0.5, 14), matWood);
        floor.position.y = -0.25; floor.receiveShadow = true; room.add(floor);
        const wall1 = new THREE.Mesh(new THREE.BoxGeometry(14, 8, 0.5), matWall);
        wall1.position.set(0, 4, -7.25); wall1.receiveShadow = true; room.add(wall1);
        const wall2 = new THREE.Mesh(new THREE.BoxGeometry(0.5, 8, 14), matWall);
        wall2.position.set(-7.25, 4, 0); wall2.receiveShadow = true; room.add(wall2);

        // Window (Light Shaft)
        const winGeo = new THREE.BoxGeometry(0.2, 3, 2);
        const winFrame = new THREE.Mesh(winGeo, matWood);
        winFrame.position.set(-7, 5, -2); room.add(winFrame);
        // Fake light shaft mesh
        const shaftGeo = new THREE.ConeGeometry(2, 8, 4, 1, true);
        const shaftMat = new THREE.MeshBasicMaterial({ color: 0xFFFFFF, transparent: true, opacity: 0.1, side: THREE.DoubleSide });
        const shaft = new THREE.Mesh(shaftGeo, shaftMat);
        shaft.position.set(-5, 3, -2); shaft.rotation.z = -Math.PI/3; room.add(shaft);

        // 2. Desk Area (Analyst)
        const desk = new THREE.Group(); desk.position.set(-4, 0, -4); room.add(desk);
        const deskTop = new THREE.Mesh(new THREE.BoxGeometry(4, 0.2, 2.5), matWood);
        deskTop.position.y = 1.5; deskTop.castShadow = true; deskTop.receiveShadow = true; desk.add(deskTop);
        // Legs
        [[-1.8,1], [1.8,1], [-1.8,-1], [1.8,-1]].forEach(pos => {
            const leg = new THREE.Mesh(new THREE.CylinderGeometry(0.1,0.1,1.5), matDark);
            leg.position.set(pos[0], 0.75, pos[1]); desk.add(leg);
        });
        // Props: Monitor
        const mon = new THREE.Mesh(new THREE.BoxGeometry(2, 1.2, 0.1), matDark);
        mon.position.set(0, 2.4, -0.5); desk.add(mon);
        mon.userData = { name: "The Analyst", desc: "Processing Vibes..." };
        // Props: Photo Frame
        const photoGeo = new THREE.PlaneGeometry(0.8, 0.8);
        const photoTex = new THREE.TextureLoader().load('/assets/img/guild/nekopapaya/avatar.webp');
        const photoFrame = new THREE.Mesh(photoGeo, new THREE.MeshBasicMaterial({ map: photoTex }));
        photoFrame.position.set(1.2, 1.8, -0.8); photoFrame.rotation.set(-0.1, -0.2, 0); desk.add(photoFrame);

        // 3. Bookshelf (Collector)
        const shelf = new THREE.Group(); shelf.position.set(0, 0, -6.5); room.add(shelf);
        const shelfBody = new THREE.Mesh(new THREE.BoxGeometry(4, 5, 1), matWood);
        shelfBody.position.y = 2.5; shelfBody.castShadow = true; shelf.add(shelfBody);
        // Procedural Books
        const bookColors = [matAccent, matBlue, matYellow, matDark];
        for(let i=0; i<15; i++) {
            const bMat = bookColors[Math.floor(Math.random()*bookColors.length)];
            const book = new THREE.Mesh(new THREE.BoxGeometry(0.2, Math.random()*0.4+0.6, 0.8), bMat);
            book.position.set( (i-7)*0.22, Math.random()*3 + 1, 0.2 );
            book.userData = { name: "Story", desc: "A collected memory." };
            shelf.add(book);
        }

        // 4. Lounge (Haven)
        const lounge = new THREE.Group(); lounge.position.set(3, 0, 3); room.add(lounge);
        // Rug
        const rug = new THREE.Mesh(new THREE.CylinderGeometry(3, 3, 0.05, 32), matAccent);
        rug.position.y = 0.05; lounge.add(rug);
        // Beanbag
        const beanGeo = new THREE.SphereGeometry(1, 16, 16);
        const beanbag = new THREE.Mesh(beanGeo, matBlue);
        beanbag.position.set(0, 0.8, 0); beanbag.scale.y = 0.6; beanbag.castShadow = true;
        beanbag.userData = { name: "Relax", desc: "Take a seat." };
        lounge.add(beanbag);
        // Coffee Table
        const table = new THREE.Mesh(new THREE.CylinderGeometry(0.8, 0.8, 0.5, 16), matWood);
        table.position.set(-1.5, 0.25, 1); table.castShadow = true; lounge.add(table);
        // Mug
        const mug = new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.15, 0.3, 12), matYellow);
        mug.position.set(-1.5, 0.65, 1); mug.userData = { name: "Warmth", desc: "Hot Tea." };
        lounge.add(mug);

        // 5. Corkboard (Connect)
        const boardGroup = new THREE.Group(); boardGroup.position.set(-6.9, 4, 2); room.add(boardGroup);
        const board = new THREE.Mesh(new THREE.BoxGeometry(0.1, 3, 4), matWood);
        boardGroup.add(board);
        // Notes
        const noteGeo = new THREE.BoxGeometry(0.15, 0.5, 0.5);
        for(let i=0; i<5; i++) {
            const note = new THREE.Mesh(noteGeo, i%2==0 ? matYellow : matPaper);
            note.position.set(0.05, (Math.random()-0.5)*2, (Math.random()-0.5)*3);
            note.userData = { name: "Plan", desc: "Joy Event Idea." };
            boardGroup.add(note);
        }

        // 6. Floating Bubbles
        const bubbles = [];
        const bubbleGeo = new THREE.SphereGeometry(0.2, 8, 8);
        const bubbleMat = new THREE.MeshBasicMaterial({ color: 0x8AB6D6, transparent: true, opacity: 0.5 });
        for(let i=0; i<10; i++) {
            const b = new THREE.Mesh(bubbleGeo, bubbleMat);
            b.position.set((Math.random()-0.5)*10, Math.random()*6+1, (Math.random()-0.5)*10);
            b.userData = { speed: Math.random()*0.02, offset: Math.random()*10 };
            room.add(b);
            bubbles.push(b);
        }


        // --- Interaction (Scroll & Click) ---
        let scrollY = 0;
        let targetCamPos = new THREE.Vector3(20, 20, 20);
        let targetZoom = 1;
        let targetLookAt = new THREE.Vector3(0,0,0);
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2(-1, -1);

        window.addEventListener('scroll', () => {
            scrollY = window.scrollY;
            const progress = scrollY / (document.body.scrollHeight - window.innerHeight);

            if(progress < 0.1) { // Hero
                targetCamPos.set(20, 20, 20); targetZoom = 1; targetLookAt.set(0,0,0);
            } else if(progress < 0.35) { // Desk
                targetCamPos.set(-5, 10, 5); targetZoom = 2; targetLookAt.set(-4, 2, -4);
            } else if(progress < 0.6) { // Shelf
                targetCamPos.set(5, 8, -5); targetZoom = 2; targetLookAt.set(0, 3, -6.5);
            } else if(progress < 0.85) { // Lounge
                targetCamPos.set(5, 10, 5); targetZoom = 2; targetLookAt.set(3, 1, 3);
            } else { // Board
                targetCamPos.set(-10, 10, 10); targetZoom = 2; targetLookAt.set(-6.9, 4, 2);
            }
        });

        window.addEventListener('mousemove', (e) => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;

            // Tooltip movement
            tooltip.style.left = e.clientX + 'px';
            tooltip.style.top = e.clientY + 'px';
        });

        // Loop
        function animate() {
            requestAnimationFrame(animate);

            // Camera
            camera.position.lerp(targetCamPos, 0.05);
            camera.zoom += (targetZoom - camera.zoom) * 0.05;
            camera.updateProjectionMatrix();
            if(!window.camTarget) window.camTarget = new THREE.Vector3(0,0,0);
            window.camTarget.lerp(targetLookAt, 0.05);
            camera.lookAt(window.camTarget);

            // Bubbles
            const time = Date.now() * 0.001;
            bubbles.forEach(b => {
                b.position.y += Math.sin(time + b.userData.offset) * 0.01;
            });

            // Raycasting
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(room.children, true);
            let hit = null;

            for(let i=0; i<intersects.length; i++) {
                if(intersects[i].object.userData.name) {
                    hit = intersects[i].object;
                    break;
                }
            }

            if(hit) {
                document.body.style.cursor = 'pointer';
                tooltip.style.opacity = 1;
                tooltip.innerHTML = `${hit.userData.name}<br><span style='font-size:0.8em;font-weight:400'>${hit.userData.desc}</span>`;
            } else {
                document.body.style.cursor = 'default';
                tooltip.style.opacity = 0;
            }

            renderer.render(scene, camera);
        }
        animate();

        // GSAP
        gsap.registerPlugin(ScrollTrigger);
        gsap.utils.toArray('.gs-reveal').forEach(elem => {
            gsap.to(elem, {
                y: 0, opacity: 1, duration: 1, ease: "power2.out",
                scrollTrigger: { trigger: elem, start: "top 80%", toggleActions: "play reverse play reverse" }
            });
        });

        window.addEventListener('resize', () => {
            const aspect = window.innerWidth / window.innerHeight;
            camera.left = -d * aspect; camera.right = d * aspect;
            camera.top = d; camera.bottom = -d;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>