<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEKOPAPAYA | The Cozy Haven</title>
    <meta name="description" content="NEKOPAPAYA - 人體狀態觀察分析師 | 康樂股長 | 避風港">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        :root {
            /* Palette: Cozy Haven */
            --c-bg: #F4F1EC;       /* Cream */
            --c-text: #4a4a4a;     /* Soft Grey */
            --c-accent: #8FA891;   /* Sage Green */
            --c-blue: #8AB6D6;     /* Soft Blue */
            --c-warm: #EAC435;     /* Lamp Yellow */

            --f-en: 'Nunito', sans-serif;
            --f-zh: 'Noto Sans TC', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: var(--f-zh);
            overflow-x: hidden;
            line-height: 1.7;
        }

        /* --- Layers --- */
        #webgl-container {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 0; pointer-events: none;
        }

        .scroller { position: relative; z-index: 10; pointer-events: none; }
        .interactive-layer { pointer-events: auto; }

        /* --- Sections --- */
        .section {
            height: 100vh;
            display: flex; flex-direction: column; justify-content: center;
            padding: 2rem;
            position: relative;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            padding: 3rem;
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.05);
            max-width: 500px;
            transform: translateY(50px); opacity: 0; /* Init state */
            border: 2px solid white;
        }

        /* Positioning variations */
        .pos-left { margin-right: auto; margin-left: 5vw; }
        .pos-right { margin-left: auto; margin-right: 5vw; }
        .pos-center { margin: 0 auto; text-align: center; }

        /* --- Typography --- */
        h1 {
            font-family: var(--f-en); font-weight: 900; font-size: 3.5rem;
            line-height: 1.1; color: var(--c-text); margin-bottom: 1rem;
        }
        h2 {
            font-family: var(--f-en); font-weight: 700; font-size: 1rem;
            text-transform: uppercase; letter-spacing: 0.1em;
            color: var(--c-accent); margin-bottom: 1.5rem;
        }
        p { font-size: 1.1rem; color: #666; margin-bottom: 1.5rem; }

        .tag {
            display: inline-block; padding: 0.3rem 0.8rem;
            background: var(--c-bg); border-radius: 50px;
            font-size: 0.9rem; font-weight: 700; color: var(--c-accent);
            margin-right: 0.5rem;
        }

        /* --- Navigation --- */
        .nav-fixed {
            position: fixed; top: 2rem; left: 2rem; z-index: 50;
            font-family: var(--f-en); font-weight: 900;
            color: var(--c-text); text-decoration: none;
            padding: 0.5rem 1.2rem; background: white; border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); pointer-events: auto;
        }

        /* --- Social Links --- */
        .social-link {
            display: inline-flex; align-items: center; justify-content: center;
            width: 60px; height: 60px; border-radius: 50%; background: var(--c-bg);
            color: var(--c-text); font-size: 1.5rem; margin: 0 0.5rem;
            transition: transform 0.2s, background 0.2s, color 0.2s;
            text-decoration: none;
        }
        .social-link:hover { transform: scale(1.1); background: var(--c-accent); color: white; }

        /* --- RWD --- */
        @media(max-width: 768px) {
            .content-card { padding: 2rem; margin: 0 auto !important; width: 100%; }
            h1 { font-size: 2.5rem; }
            .section { justify-content: flex-end; padding-bottom: 10vh; }
        }

    </style>
</head>
<body>

    <a href="/guild" class="nav-fixed">← GUILD</a>

    <div id="webgl-container"></div>

    <div class="scroller">

        <!-- 1. Hero: The Room -->
        <section class="section">
            <div class="content-card pos-left interactive-layer gs-reveal">
                <h1>NEKOPAPAYA</h1>
                <p style="font-weight: 500; color: var(--c-accent);">Human State Analyst</p>
                <p>
                    人體狀態觀察分析師。<br>
                    康樂股長，魔人揪揪。<br>
                    "Hydrogen knocking on your soul."
                </p>
                <div>
                    <span class="tag">#SafeHaven</span>
                    <span class="tag">#Observation</span>
                    <span class="tag">#Joy</span>
                </div>
            </div>
        </section>

        <!-- 2. The Analyst's Desk -->
        <section class="section">
            <div class="content-card pos-right interactive-layer gs-reveal">
                <h2>METHODOLOGY</h2>
                <h1>The Analysis.</h1>
                <p>
                    <strong>Observe:</strong> 無聲地觀察每個人的狀態與需求。在熱鬧的背後，看見靈魂的頻率。<br><br>
                    <strong>Tune:</strong> 解構情緒，如同氫原子輕輕撞擊，調配出最適合當下的氛圍。
                </p>
            </div>
        </section>

        <!-- 3. The Cozy Corner -->
        <section class="section">
            <div class="content-card pos-left interactive-layer gs-reveal">
                <h2>CORE PHILOSOPHY</h2>
                <h1>Safe Haven.</h1>
                <p>
                    這裡是一個可以停下來、坐一下的地方。<br>
                    有時候我會在這裡，人聚在一起，慢慢享受人與人的溫度。
                </p>
                <p style="font-size: 0.9rem; color: var(--c-accent);">
                    * Safety Protocol: 每個人都可以自由選擇，沒有強迫，只有邀請。
                </p>
            </div>
        </section>

        <!-- 4. Connection -->
        <section class="section">
            <div class="content-card pos-center interactive-layer gs-reveal">
                <h2>READY TO SYNC?</h2>
                <h1>Connect.</h1>
                <p>如果你剛好想參與、想一起感受，就可以私訊我。</p>
                <div style="margin-top: 2rem;">
                    <a href="https://www.threads.net/@nekopapaya" target="_blank" class="social-link"><i class="fa-brands fa-threads"></i></a>
                    <a href="https://www.instagram.com/nekopapaya/" target="_blank" class="social-link"><i class="fa-brands fa-instagram"></i></a>
                </div>
            </div>
        </section>

    </div>

    <!-- SCRIPT: The Cozy Room -->
    <script type="module">
        import * as THREE from 'three';

        // --- Setup ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        // scene.background = new THREE.Color(0xF4F1EC); // Let CSS handle BG
        scene.fog = new THREE.Fog(0xF4F1EC, 8, 20);

        // Isometric Camera Setup
        const aspect = window.innerWidth / window.innerHeight;
        const d = 10;
        const camera = new THREE.OrthographicCamera(-d * aspect, d * aspect, d, -d, 1, 1000);

        // Initial Camera Position (High Angle)
        camera.position.set(20, 20, 20);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.SoftShadowMap;
        container.appendChild(renderer.domElement);

        // --- Lights ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xFFE4C4, 0.8); // Warm sunlight
        dirLight.position.set(10, 20, 10);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 2048;
        dirLight.shadow.mapSize.height = 2048;
        scene.add(dirLight);

        // --- The Room (Objects) ---
        const roomGroup = new THREE.Group();
        scene.add(roomGroup);

        // Materials
        const woodMat = new THREE.MeshStandardMaterial({ color: 0xD7B698, roughness: 0.8 });
        const wallMat = new THREE.MeshStandardMaterial({ color: 0xFFFFFF, roughness: 0.9 });
        const greenMat = new THREE.MeshStandardMaterial({ color: 0x8FA891, roughness: 0.8 });
        const blueMat = new THREE.MeshStandardMaterial({ color: 0x8AB6D6, roughness: 0.5 });
        const darkMat = new THREE.MeshStandardMaterial({ color: 0x4A4A4A, roughness: 0.8 });
        const glowMat = new THREE.MeshBasicMaterial({ color: 0x8AB6D6 });

        // 1. Floor
        const floor = new THREE.Mesh(new THREE.BoxGeometry(12, 0.5, 12), woodMat);
        floor.position.y = -0.25;
        floor.receiveShadow = true;
        roomGroup.add(floor);

        // 2. Walls (Corner)
        const wall1 = new THREE.Mesh(new THREE.BoxGeometry(12, 8, 0.5), wallMat);
        wall1.position.set(0, 4, -6.25);
        wall1.receiveShadow = true;
        roomGroup.add(wall1);

        const wall2 = new THREE.Mesh(new THREE.BoxGeometry(0.5, 8, 12), wallMat);
        wall2.position.set(-6.25, 4, 0);
        wall2.receiveShadow = true;
        roomGroup.add(wall2);

        // 3. Desk (Analyst Area)
        const deskGroup = new THREE.Group();
        deskGroup.position.set(-3, 0, -3);
        roomGroup.add(deskGroup);

        // Photo Frame (Avatar) on Desk
        const photoGeo = new THREE.PlaneGeometry(0.8, 0.8);
        const photoTex = new THREE.TextureLoader().load('/assets/img/guild/nekopapaya/avatar.webp');
        const photoMat = new THREE.MeshBasicMaterial({ map: photoTex });
        const photoFrame = new THREE.Mesh(photoGeo, photoMat);
        photoFrame.position.set(1.2, 1.8, -0.8);
        photoFrame.rotation.x = -0.1;
        photoFrame.rotation.y = -0.2;
        deskGroup.add(photoFrame);
        // Frame border
        const borderGeo = new THREE.BoxGeometry(0.9, 0.9, 0.05);
        const borderMesh = new THREE.Mesh(borderGeo, new THREE.MeshStandardMaterial({ color: 0xFFFFFF }));
        borderMesh.position.set(1.2, 1.8, -0.85);
        borderMesh.rotation.x = -0.1;
        borderMesh.rotation.y = -0.2;
        deskGroup.add(borderMesh);

        const deskTop = new THREE.Mesh(new THREE.BoxGeometry(4, 0.2, 2.5), woodMat);
        deskTop.position.y = 1.5; deskTop.castShadow = true;
        deskGroup.add(deskTop);

        // Legs
        const legGeo = new THREE.CylinderGeometry(0.1, 0.1, 1.5);
        const leg1 = new THREE.Mesh(legGeo, darkMat); leg1.position.set(-1.8, 0.75, 1); deskGroup.add(leg1);
        const leg2 = new THREE.Mesh(legGeo, darkMat); leg2.position.set(1.8, 0.75, 1); deskGroup.add(leg2);
        const leg3 = new THREE.Mesh(legGeo, darkMat); leg3.position.set(-1.8, 0.75, -1); deskGroup.add(leg3);
        const leg4 = new THREE.Mesh(legGeo, darkMat); leg4.position.set(1.8, 0.75, -1); deskGroup.add(leg4);

        // Monitor
        const monitorBase = new THREE.Mesh(new THREE.BoxGeometry(1, 0.1, 0.5), darkMat);
        monitorBase.position.set(0, 1.6, -0.5);
        deskGroup.add(monitorBase);
        const monitorStem = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.5, 0.1), darkMat);
        monitorStem.position.set(0, 1.8, -0.5);
        deskGroup.add(monitorStem);
        const monitorScreen = new THREE.Mesh(new THREE.BoxGeometry(2, 1.2, 0.1), darkMat);
        monitorScreen.position.set(0, 2.4, -0.5);
        deskGroup.add(monitorScreen);
        const screenGlow = new THREE.Mesh(new THREE.PlaneGeometry(1.8, 1), glowMat);
        screenGlow.position.set(0, 2.4, -0.44);
        deskGroup.add(screenGlow);

        // 4. Haven Area (Rug + Plant)
        const rug = new THREE.Mesh(new THREE.CylinderGeometry(2.5, 2.5, 0.1, 32), greenMat);
        rug.position.set(2, 0.05, 2);
        rug.receiveShadow = true;
        roomGroup.add(rug);

        // Floating Lamp (Magic)
        const lampGroup = new THREE.Group();
        lampGroup.position.set(3, 4, 3);
        roomGroup.add(lampGroup);
        const lampOrb = new THREE.Mesh(new THREE.SphereGeometry(0.8, 16, 16), new THREE.MeshBasicMaterial({ color: 0xFFE4C4 }));
        lampGroup.add(lampOrb);
        const lampLight = new THREE.PointLight(0xFFE4C4, 1, 10);
        lampGroup.add(lampLight);

        // 5. Hydrogen Bubbles (Souls)
        const bubbles = [];
        const bubbleGeo = new THREE.SphereGeometry(0.3, 16, 16);
        const bubbleMat = new THREE.MeshBasicMaterial({ color: 0x8AB6D6, transparent: true, opacity: 0.6 });

        for(let i=0; i<8; i++) {
            const b = new THREE.Mesh(bubbleGeo, bubbleMat);
            b.position.set(
                (Math.random() - 0.5) * 8,
                Math.random() * 5 + 1,
                (Math.random() - 0.5) * 8
            );
            b.userData = { speed: Math.random() * 0.01 + 0.005, offset: Math.random() * 10 };
            roomGroup.add(b);
            bubbles.push(b);
        }


        // --- Animation Loop (Scroll Logic) ---
        let scrollY = 0;
        let targetCamPos = new THREE.Vector3(15, 15, 15);
        let targetCamZoom = 1;
        let targetLookAt = new THREE.Vector3(0, 0, 0);

        window.addEventListener('scroll', () => {
            scrollY = window.scrollY;
            const h = window.innerHeight;
            const progress = scrollY / (document.body.scrollHeight - h); // 0 to 1

            // Keyframes
            if (progress < 0.1) {
                // 1. Hero: Wide View
                targetCamPos.set(15, 15, 15);
                targetCamZoom = 1;
                targetLookAt.set(0, 0, 0);
            } else if (progress < 0.4) {
                // 2. Desk: Zoom in
                targetCamPos.set(-5, 10, 5); // Side view
                targetCamZoom = 2;
                targetLookAt.set(-3, 2, -3); // Look at desk
            } else if (progress < 0.7) {
                // 3. Haven: Top view
                targetCamPos.set(5, 15, 5);
                targetCamZoom = 1.8;
                targetLookAt.set(2, 0, 2); // Look at rug
            } else {
                // 4. Connect: Pull back
                targetCamPos.set(20, 20, 20);
                targetCamZoom = 0.8;
                targetLookAt.set(0, 0, 0);
            }
        });

        // Loop
        function animate() {
            requestAnimationFrame(animate);

            // Lerp Camera
            camera.position.lerp(targetCamPos, 0.05);
            camera.zoom += (targetCamZoom - camera.zoom) * 0.05;
            camera.updateProjectionMatrix(); // Important for zoom

            // Lerp LookAt (manual orbit controls-ish)
            const currentLook = new THREE.Vector3();
            camera.getWorldDirection(currentLook);
            // This is hard to tween smoothly with LookAt.
            // Better: Tween a separate vector, then lookAt that vector.
            // Since we don't have a stored lookAt vector in camera, we use the global one.
            // Actually, OrbitControls usually handles this. Let's do simple lerp on the target point.

            // Using a dummy object for lookAt target
            if(!window.camTarget) {
                window.camTarget = new THREE.Vector3(0,0,0);
            }
            window.camTarget.lerp(targetLookAt, 0.05);
            camera.lookAt(window.camTarget);

            // Animate Bubbles
            const time = Date.now() * 0.001;
            bubbles.forEach(b => {
                b.position.y += Math.sin(time + b.userData.offset) * 0.01;
                b.position.x += Math.cos(time * 0.5 + b.userData.offset) * 0.005;
            });

            // Animate Lamp
            lampGroup.position.y = 4 + Math.sin(time * 2) * 0.2;

            renderer.render(scene, camera);
        }
        animate();

        // --- GSAP Reveals ---
        gsap.registerPlugin(ScrollTrigger);
        gsap.utils.toArray('.gs-reveal').forEach(elem => {
            gsap.to(elem, {
                y: 0, opacity: 1, duration: 1, ease: "power2.out",
                scrollTrigger: {
                    trigger: elem,
                    start: "top 80%",
                    toggleActions: "play reverse play reverse"
                }
            });
        });

        // Resize
        window.addEventListener('resize', () => {
            const aspect = window.innerWidth / window.innerHeight;
            camera.left = -d * aspect;
            camera.right = d * aspect;
            camera.top = d;
            camera.bottom = -d;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>