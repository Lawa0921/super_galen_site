<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEKOPAPAYA | The Safe Haven</title>
    <meta name="description" content="NEKOPAPAYA - 人體狀態觀察分析師 | 康樂股長 | 避風港">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&family=Nunito:wght@400;700&family=Nothing+You+Could+Do&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        :root {
            /* Palette: Gentle Safe Haven */
            --c-bg: #F4F1EC;       /* Milk Tea White */
            --c-bg-sec: #E8E2D9;   /* Sand */
            --c-accent: #A8B2A1;   /* Sage Green */
            --c-text: #3F3F3F;     /* Warm Dark Grey */
            --c-note: #8C8C8C;     /* Light Grey */
            --c-highlight: #D4A373; /* Warm Orange/Brown for boat light */

            --f-main: 'Noto Sans TC', sans-serif;
            --f-en: 'Nunito', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: var(--f-main);
            overflow-x: hidden;
            line-height: 1.8;
        }

        /* --- Global Layout --- */
        #webgl-container {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 0; pointer-events: none; /* Mouse handled via global listener */
        }

        .scroller { position: relative; z-index: 10; pointer-events: none; }
        .interactive-layer { pointer-events: auto; }

        .section {
            min-height: 100vh;
            padding: 6rem 2rem;
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }

        .container {
            max-width: 1000px; width: 100%; margin: 0 auto;
            position: relative;
        }

        /* --- Typography --- */
        h1 {
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 700;
            color: var(--c-text);
            letter-spacing: -0.02em;
            margin-bottom: 1rem;
            line-height: 1.1;
        }

        h2 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 400;
            margin-bottom: 2rem;
            color: var(--c-accent);
        }

        p {
            font-size: 1.1rem;
            color: var(--c-text);
            max-width: 65ch;
            margin-bottom: 1.5rem;
            font-weight: 300;
        }

        .note {
            font-size: 0.9rem;
            color: var(--c-note);
            margin-top: 0.5rem;
        }

        /* --- Components --- */
        .glass-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            padding: 3rem;
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(168, 178, 161, 0.15);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), box-shadow 0.4s;
        }
        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(168, 178, 161, 0.25);
            background: rgba(255, 255, 255, 0.8);
        }

        .tag {
            display: inline-block;
            padding: 0.4rem 1rem;
            background: var(--c-bg-sec);
            color: var(--c-text);
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 1rem;
            letter-spacing: 0.05em;
            margin-right: 0.5rem;
        }

        .avatar-img {
            width: 150px; height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .avatar-img:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .nav-fixed {
            position: fixed; top: 2rem; left: 2rem; z-index: 50;
            font-family: var(--f-en); font-weight: 700;
            color: var(--c-text); text-decoration: none;
            padding: 0.5rem 1.2rem; background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px); border-radius: 50px;
            pointer-events: auto;
            transition: transform 0.3s;
        }
        .nav-fixed:hover { transform: scale(1.05); }

        .btn-link {
            display: inline-flex; align-items: center; justify-content: center;
            width: 60px; height: 60px;
            background: white; border-radius: 50%;
            color: var(--c-text); font-size: 1.5rem;
            margin: 0 0.5rem;
            transition: transform 0.3s, background 0.3s, color 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .btn-link:hover {
            transform: scale(1.1) rotate(10deg);
            background: var(--c-accent);
            color: white;
        }

        /* --- Custom Interactive Elements --- */
        .mood-grid {
            display: grid; grid-template-columns: 1fr; gap: 2rem;
        }
        @media(min-width: 768px) {
            .mood-grid { grid-template-columns: 1fr 1fr; align-items: center; }
        }

        .polaroid {
            background: white; padding: 1rem 1rem 3rem 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transform: rotate(-3deg);
            transition: transform 0.5s;
            max-width: 300px;
            margin: 0 auto;
        }
        .polaroid:hover { transform: rotate(0deg) scale(1.02); z-index: 2; }
        .polaroid img { width: 100%; display: block; filter: saturate(0.8); transition: filter 0.5s; }
        .polaroid:hover img { filter: saturate(1.1); }

    </style>
</head>
<body>

    <a href="/guild" class="nav-fixed">← GUILD</a>

    <div id="webgl-container"></div>

    <div class="scroller">

        <!-- 1. Hero: The Safe Haven -->
        <section class="section">
            <div class="container interactive-layer" style="text-align: center;">
                <div class="gs-reveal">
                    <img src="/assets/img/guild/nekopapaya/avatar.webp" alt="Avatar" class="avatar-img">
                    <h1>NEKOPAPAYA</h1>
                    <p style="font-size: 1.5rem; margin: 0 auto; color: var(--c-accent); font-weight: 700;">康樂股長 | 魔人揪揪</p>
                    <div style="margin-top: 2rem;">
                        <span class="tag">人體狀態觀察分析師</span>
                        <span class="tag">Mood Board Designer</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. Intro: The Philosophy -->
        <section class="section">
            <div class="container interactive-layer">
                <div class="glass-card gs-reveal">
                    <span class="tag">Core Concept</span>
                    <h2>避風港 Safe Haven</h2>
                    <p>
                        這裡是一個可以停下來、坐一下的地方。<br>
                        有時候我會在這裡，人聚在一起，慢慢享受人與人的溫度。
                    </p>
                    <p>
                        不是為了任何目的，也不需要報名或承諾。<br>
                        如果你剛好想參與、想一起感受，就可以私訊我。
                    </p>
                    <p class="note">
                        每個人都可以自由選擇，這裡只留一個空間給願意的人。
                    </p>
                </div>
            </div>
        </section>

        <!-- 3. Mood Board: Visuals -->
        <section class="section">
            <div class="container interactive-layer">
                <div class="mood-grid">
                    <div class="gs-reveal">
                        <span class="tag">Atmosphere</span>
                        <h2>溫柔、慢、放鬆</h2>
                        <p>
                            有人但不熱鬧。<br>
                            空間感、留白多。<br>
                            不工整、自然、生活感。
                        </p>
                        <p>
                            這是一個「避風港」型的個人頁面，呈現聚人的氛圍。<br>
                            目標：讓人看到就有安全感、想停下來，不被要求或壓力。
                        </p>
                    </div>
                    <div class="gs-reveal" style="text-align: center;">
                        <div class="polaroid">
                            <img src="/assets/img/guild/nekopapaya/scene.webp" alt="Cozy Gathering">
                            <div style="font-family: 'Nothing You Could Do', cursive; margin-top: 1rem; color: #888;">Cozy Gathering</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. Contact -->
        <section class="section">
            <div class="container interactive-layer" style="text-align: center;">
                <div class="gs-reveal">
                    <h2 style="font-size: 3rem; margin-bottom: 3rem;">Ready to Join?</h2>
                    <div style="display: flex; justify-content: center; gap: 1rem;">
                        <a href="https://www.threads.net/@nekopapaya" target="_blank" class="btn-link"><i class="fa-brands fa-threads"></i></a>
                        <a href="https://www.instagram.com/nekopapaya/" target="_blank" class="btn-link"><i class="fa-brands fa-instagram"></i></a>
                    </div>
                    <p class="note" style="margin-top: 2rem;">私訊請不要用小帳 全當作詐騙不理</p>
                </div>
            </div>
        </section>

    </div>

    <!-- SCRIPT: The Cozy Cyber-Harbor -->
    <script type="module">
        import * as THREE from 'three';

        // --- Setup ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0xF4F1EC, 0.02); // Soft Mist

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 3, 8);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- Lights ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(ambientLight);

        const pointLight = new THREE.PointLight(0xD4A373, 2, 15);
        pointLight.position.set(0, 2, 0);
        scene.add(pointLight);

        // --- Objects ---

        // 1. The Sea (Displaced Plane)
        const seaGeometry = new THREE.PlaneGeometry(60, 60, 64, 64);

        // Helper to displace vertices manually since we are using StandardMaterial
        const posAttribute = seaGeometry.attributes.position;
        const vertexCount = posAttribute.count;
        const originalPositions = new Float32Array(vertexCount * 3);

        for (let i = 0; i < vertexCount; i++) {
             originalPositions[i * 3] = posAttribute.getX(i);
             originalPositions[i * 3 + 1] = posAttribute.getY(i);
             originalPositions[i * 3 + 2] = posAttribute.getZ(i);
        }

        const seaMaterial = new THREE.MeshStandardMaterial({
            color: 0xA8B2A1,
            roughness: 0.1,
            metalness: 0.1,
            transparent: true,
            opacity: 0.6,
            side: THREE.DoubleSide
        });
        const sea = new THREE.Mesh(seaGeometry, seaMaterial);
        sea.rotation.x = -Math.PI / 2;
        sea.position.y = -1;
        scene.add(sea);


        // 2. The Boat (Procedural Paper Boat)
        const boatGroup = new THREE.Group();

        // Hull
        const hullGeo = new THREE.ConeGeometry(1.5, 1, 4, 1);
        const hullMat = new THREE.MeshStandardMaterial({ color: 0xFFFFFF, roughness: 0.9 });
        const hull = new THREE.Mesh(hullGeo, hullMat);
        hull.rotation.z = Math.PI;
        hull.scale.set(1, 0.5, 2);
        boatGroup.add(hull);

        // Sail
        const sailGeo = new THREE.BufferGeometry();
        const sailVertices = new Float32Array([
            0, 0.5, 0,
            0, 2.5, 0,
            0, 0.5, 1.5,
            0, 0.5, 0,
            0, 0.5, 1.5,
            0, 2.5, 0
        ]);
        sailGeo.setAttribute('position', new THREE.BufferAttribute(sailVertices, 3));
        sailGeo.computeVertexNormals();
        const sailMat = new THREE.MeshStandardMaterial({ color: 0xFFFFFF, side: THREE.DoubleSide, roughness: 0.9 });
        const sail = new THREE.Mesh(sailGeo, sailMat);
        boatGroup.add(sail);

        // Lantern (Sphere)
        const lanternGeo = new THREE.SphereGeometry(0.2, 16, 16);
        const lanternMat = new THREE.MeshBasicMaterial({ color: 0xD4A373 });
        const lantern = new THREE.Mesh(lanternGeo, lanternMat);
        lantern.position.set(0, 0.5, 0);
        boatGroup.add(lantern);

        scene.add(boatGroup);

        // 3. Particles ("Fireflies" / "Spirits")
        const pCount = 300;
        const pGeo = new THREE.BufferGeometry();
        const pPos = new Float32Array(pCount * 3);
        const pSpeed = new Float32Array(pCount); // Individual speeds

        for(let i=0; i<pCount; i++) {
            pPos[i*3] = (Math.random() - 0.5) * 40;
            pPos[i*3+1] = (Math.random() * 5) + 1; // Above water
            pPos[i*3+2] = (Math.random() - 0.5) * 40;
            pSpeed[i] = Math.random() * 0.02 + 0.01;
        }

        pGeo.setAttribute('position', new THREE.BufferAttribute(pPos, 3));

        const pMat = new THREE.PointsMaterial({
            color: 0xD4A373,
            size: 0.15,
            transparent: true,
            opacity: 0.8,
            blending: THREE.AdditiveBlending
        });

        const particles = new THREE.Points(pGeo, pMat);
        scene.add(particles);

        // --- Interaction State ---
        let scrollY = 0;
        const mouse = new THREE.Vector2();

        window.addEventListener('scroll', () => {
            scrollY = window.scrollY;
        });

        window.addEventListener('mousemove', (e) => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
        });

        // Click Explosion (Interactive Ripple)
        let explosionTime = 0;
        window.addEventListener('mousedown', () => {
            explosionTime = 1.0;

            // GSAP Shockwave on boat
            gsap.to(boatGroup.scale, {
                x: 1.2, y: 1.2, z: 1.2,
                duration: 0.1,
                yoyo: true,
                repeat: 1
            });
        });

        // --- Animation Loop ---
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // 1. Water Wave Animation
            const pos = seaGeometry.attributes.position;

            // "Warp Speed" Factor based on scroll Y (simulating travel)
            // As we scroll down, we move forward.
            // But to make it infinite, we just animate the waves faster?
            // Or we actually move the camera.

            const effectiveScroll = scrollY * 0.005;

            for(let i=0; i<vertexCount; i++) {
                const x = originalPositions[i*3];
                // const y = originalPositions[i*3+1];
                const z = originalPositions[i*3+2];

                // Turbulence from explosion
                const turbulence = Math.max(0, explosionTime) * Math.sin(x * 5 + time * 10) * 0.5;

                // Wave Calculation
                // Adding scrollY to phase creates movement illusion
                const waveHeight = 0.4;
                const waveFreq = 0.4;

                const zOffset = Math.sin(x * waveFreq + time + effectiveScroll) * Math.cos(z * waveFreq + time * 0.8) * waveHeight;

                pos.setZ(i, zOffset + turbulence);
            }
            pos.needsUpdate = true;
            seaGeometry.computeVertexNormals();

            // 2. Boat Movement (Gentle Float)
            boatGroup.position.y = Math.sin(time * 1.5) * 0.1 - 0.3;
            boatGroup.rotation.z = Math.sin(time * 0.5) * 0.05;
            boatGroup.rotation.x = Math.sin(time * 0.3) * 0.05;

            // 3. Camera Follow
            // Camera stays relative to boat but moves slightly with scroll
            // Actually, let's move the camera forward through the mist as user scrolls
            // Reset position to loop? Or just fog hides the end.
            // We keep the boat in view.

            camera.position.z = 8 + Math.sin(time * 0.2) * 0.5;
            camera.position.y = 3 + scrollY * 0.002;
            camera.lookAt(0, 0, 0);

            // 4. Particle Animation
            const pPositions = particles.geometry.attributes.position.array;

            for(let i=0; i<pCount; i++) {
                // Move particles relative to scroll to create "passing by" effect
                // If we scroll down, particles should move towards camera (Z+)

                let z = pPositions[i*3+2];
                z += 0.02 + (scrollY * 0.0005); // Speed up with scroll

                if(z > 10) z = -30; // Reset far back

                pPositions[i*3+2] = z;

                // Gentle drift
                pPositions[i*3] += Math.sin(time + i) * 0.01;
                pPositions[i*3+1] += Math.cos(time + i) * 0.01;

                // Explosion Repulsion
                if(explosionTime > 0) {
                    const dx = pPositions[i*3];
                    const dy = pPositions[i*3+1];
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if(dist < 5) {
                        pPositions[i*3] += dx * 0.05 * explosionTime;
                        pPositions[i*3+1] += dy * 0.05 * explosionTime;
                    }
                }
            }
            particles.geometry.attributes.position.needsUpdate = true;

            if(explosionTime > 0) explosionTime -= 0.03;

            renderer.render(scene, camera);
        }
        animate();

        // --- Resize ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- GSAP Reveals ---
        gsap.registerPlugin(ScrollTrigger);

        gsap.utils.toArray('.gs-reveal').forEach(elem => {
            gsap.from(elem, {
                scrollTrigger: {
                    trigger: elem,
                    start: "top 85%",
                },
                y: 50,
                opacity: 0,
                duration: 1.2,
                ease: "power3.out"
            });
        });

    </script>
</body>
</html>