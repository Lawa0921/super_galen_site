<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEKOPAPAYA | The Ferryman</title>
    <meta name="description" content="NEKOPAPAYA - 人體狀態觀察分析師 | 康樂股長 | 避風港">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;700&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        :root {
            /* Palette: Starry Sea */
            --c-bg: #0a1a2a;       /* Deep Navy */
            --c-text: #F9F7F1;     /* Paper White */
            --c-accent: #FFD700;   /* Lantern Gold */
            --c-sub: #8899aa;      /* Muted Blue */

            --f-en: 'Nunito', sans-serif;
            --f-zh: 'Noto Serif TC', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: var(--f-zh);
            overflow-x: hidden;
            line-height: 1.8;
        }

        #webgl-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0; }
        .scroller { position: relative; z-index: 10; pointer-events: none; }
        .interactive-layer { pointer-events: auto; }

        /* --- Sections --- */
        .section {
            min-height: 100vh;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 2rem; position: relative;
            text-align: center;
        }

        /* --- Typography --- */
        h1 {
            font-family: var(--f-en); font-weight: 700; font-size: clamp(3rem, 8vw, 5rem);
            margin-bottom: 1rem; color: var(--c-text);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        h2 {
            font-family: var(--f-en); font-weight: 700; font-size: 1rem;
            text-transform: uppercase; letter-spacing: 0.2em;
            color: var(--c-accent); margin-bottom: 1.5rem;
        }
        p {
            font-size: 1.1rem; max-width: 600px; margin: 0 auto 1.5rem; opacity: 0.9;
        }

        .lantern-card {
            background: rgba(10, 26, 42, 0.6);
            backdrop-filter: blur(8px);
            padding: 3rem;
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 16px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.05);
            transform: translateY(30px); opacity: 0;
        }

        .avatar-frame {
            width: 120px; height: 120px; border-radius: 50%;
            margin: 0 auto 2rem;
            border: 2px solid var(--c-accent);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
            overflow: hidden;
        }
        .avatar-frame img { width: 100%; height: 100%; object-fit: cover; }

        /* Socials */
        .social-link {
            display: inline-flex; align-items: center; justify-content: center;
            width: 50px; height: 50px; border-radius: 50%;
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: white; font-size: 1.2rem; margin: 0 0.5rem;
            transition: 0.3s; text-decoration: none;
        }
        .social-link:hover { background: var(--c-accent); border-color: var(--c-accent); transform: translateY(-3px); color: var(--c-bg); }

        /* Nav */
        .nav-fixed {
            position: fixed; top: 2rem; left: 2rem; z-index: 50;
            font-family: var(--f-en); font-weight: 700;
            color: white; text-decoration: none; opacity: 0.6; transition: 0.3s;
            pointer-events: auto;
        }
        .nav-fixed:hover { opacity: 1; color: var(--c-accent); }

    </style>
</head>
<body>

    <a href="/guild" class="nav-fixed">← GUILD</a>
    <div id="webgl-container"></div>

    <div class="scroller">

        <!-- 1. Hero: The Ferryman -->
        <section class="section">
            <div class="lantern-card interactive-layer gs-reveal">
                <div class="avatar-frame">
                    <img src="/assets/img/guild/nekopapaya/avatar.webp" alt="Avatar">
                </div>
                <h2>THE FERRYMAN</h2>
                <h1>NEKOPAPAYA</h1>
                <p>
                    人體狀態觀察分析師。<br>
                    康樂股長，魔人揪揪。<br>
                    <span style="color: var(--c-accent);">"Hydrogen knocking on your soul."</span>
                </p>
                <div style="font-size: 0.8rem; opacity: 0.6; margin-top: 1rem;">
                    <i class="fa-solid fa-anchor"></i> Scroll to Set Sail
                </div>
            </div>
        </section>

        <!-- 2. The Boat: Haven -->
        <section class="section">
            <div class="lantern-card interactive-layer gs-reveal" style="text-align: left;">
                <h2>SAFE HAVEN</h2>
                <h1>The Boat.</h1>
                <p>這裡是一艘安靜的小船，也是一個避風港。</p>
                <p>
                    有時候我會在這裡，人聚在一起，慢慢享受人與人的溫度。<br>
                    沒有強迫，只有邀請。
                </p>
            </div>
        </section>

        <!-- 3. Lanterns: Passion -->
        <section class="section">
            <div class="lantern-card interactive-layer gs-reveal">
                <h2>GATHERING</h2>
                <h1>The Lanterns.</h1>
                <p>每一個飄過的燈籠，都是一個被連結的靈魂。</p>
                <p>我喜歡熱鬧，喜歡可愛的人事物。熱情是我燃燒的燃料。</p>
            </div>
        </section>

        <!-- 4. Destination: Connect -->
        <section class="section">
            <div class="lantern-card interactive-layer gs-reveal">
                <h2>DESTINATION</h2>
                <h1>Connect.</h1>
                <p>如果你剛好想參與、想一起感受，就可以私訊我。</p>
                <div style="margin-top: 2rem;">
                    <a href="https://www.threads.net/@nekopapaya" target="_blank" class="social-link"><i class="fa-brands fa-threads"></i></a>
                    <a href="https://www.instagram.com/nekopapaya/" target="_blank" class="social-link"><i class="fa-brands fa-instagram"></i></a>
                </div>
            </div>
        </section>

    </div>

    <!-- SCRIPT -->
    <script type="module">
        import * as THREE from 'three';

        // --- Setup ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x0a1a2a, 0.03);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 5, 10);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- Lights ---
        const ambient = new THREE.AmbientLight(0x404040); // Moonlight
        scene.add(ambient);

        const moonLight = new THREE.DirectionalLight(0x88ccff, 0.5);
        moonLight.position.set(-10, 20, -10);
        scene.add(moonLight);

        // --- Objects ---

        // 1. The Sea (Animated Mesh)
        const seaGeo = new THREE.PlaneGeometry(100, 100, 64, 64);
        const seaMat = new THREE.MeshStandardMaterial({
            color: 0x1a2a3a, roughness: 0.2, metalness: 0.8,
            flatShading: true
        });
        const sea = new THREE.Mesh(seaGeo, seaMat);
        sea.rotation.x = -Math.PI / 2;
        scene.add(sea);

        // 2. The Boat (Procedural)
        const boatGroup = new THREE.Group();
        scene.add(boatGroup);

        // Hull
        const hullGeo = new THREE.CylinderGeometry(1.5, 1, 4, 6, 1, false, 0, Math.PI);
        const hullMat = new THREE.MeshStandardMaterial({ color: 0x8B4513, roughness: 0.9 });
        const hull = new THREE.Mesh(hullGeo, hullMat);
        hull.rotation.z = Math.PI / 2;
        hull.scale.set(1, 0.7, 1);
        hull.position.y = 0.5;
        boatGroup.add(hull);
        // Deck
        const deckGeo = new THREE.BoxGeometry(3.5, 0.1, 1.8);
        const deck = new THREE.Mesh(deckGeo, hullMat);
        deck.position.y = 0.4;
        boatGroup.add(deck);

        // Box Cat Passenger
        const catGroup = new THREE.Group();
        catGroup.position.set(0, 0.5, 0);
        boatGroup.add(catGroup);
        const catMat = new THREE.MeshStandardMaterial({ color: 0xFFD700 });
        const cBody = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.4, 0.6), catMat);
        cBody.position.y = 0.2; catGroup.add(cBody);
        const cHead = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.4, 0.4), catMat);
        cHead.position.set(0, 0.6, 0.3); catGroup.add(cHead);
        // Ears
        const cEar = new THREE.Mesh(new THREE.ConeGeometry(0.1, 0.2, 4), new THREE.MeshStandardMaterial({color:0x222}));
        const e1 = cEar.clone(); e1.position.set(-0.15, 0.9, 0.3); catGroup.add(e1);
        const e2 = cEar.clone(); e2.position.set(0.15, 0.9, 0.3); catGroup.add(e2);

        // Boat Light (Lantern)
        const lanternGeo = new THREE.CylinderGeometry(0.1, 0.1, 0.3);
        const lanternMat = new THREE.MeshBasicMaterial({ color: 0xFFD700 });
        const lantern = new THREE.Mesh(lanternGeo, lanternMat);
        lantern.position.set(1.5, 1, 0);
        boatGroup.add(lantern);

        const boatLight = new THREE.PointLight(0xFFD700, 2, 10);
        boatLight.position.set(1.5, 1.2, 0);
        boatGroup.add(boatLight);


        // 3. Floating Lanterns (Instanced)
        const lCount = 100;
        const lInst = new THREE.InstancedMesh(
            new THREE.BoxGeometry(0.3, 0.4, 0.3),
            new THREE.MeshBasicMaterial({ color: 0xFFAB00 }),
            lCount
        );
        scene.add(lInst);

        const dummy = new THREE.Object3D();
        const lData = [];

        for(let i=0; i<lCount; i++) {
            const x = (Math.random()-0.5) * 60;
            const z = -Math.random() * 100 - 10; // Ahead of boat
            dummy.position.set(x, 0.2, z);
            dummy.rotation.y = Math.random() * Math.PI;
            dummy.updateMatrix();
            lInst.setMatrixAt(i, dummy.matrix);

            lData.push({ x, z, speed: Math.random()*0.05 + 0.02, offset: Math.random()*10 });
        }


        // --- Interaction ---
        let scrollY = 0;

        window.addEventListener('scroll', () => {
            scrollY = window.scrollY;
        });

        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // 1. Boat Movement
            boatGroup.position.y = Math.sin(time) * 0.1;
            boatGroup.rotation.x = Math.sin(time * 0.5) * 0.05;
            boatGroup.rotation.z = Math.sin(time * 0.3) * 0.05;

            // 2. Sea Waves
            const pos = seaGeo.attributes.position;
            for(let i=0; i<pos.count; i++) {
                const x = pos.getX(i);
                const y = pos.getY(i); // Actually Z in plane
                // Simple sine wave
                const z = Math.sin(x * 0.5 + time) * 0.2 + Math.cos(y * 0.3 + time) * 0.2;
                pos.setZ(i, z);
            }
            pos.needsUpdate = true;

            // 3. Lanterns Flow (Scroll Effect)
            // Move lanterns towards camera based on scroll
            const speed = 0.02 + scrollY * 0.0005;

            for(let i=0; i<lCount; i++) {
                const d = lData[i];
                d.z += speed;

                // Wrap
                if(d.z > 10) d.z = -80;

                // Bobbing
                const y = 0.2 + Math.sin(time * 2 + d.offset) * 0.1;

                dummy.position.set(d.x, y, d.z);
                dummy.updateMatrix();
                lInst.setMatrixAt(i, dummy.matrix);
            }
            lInst.instanceMatrix.needsUpdate = true;

            renderer.render(scene, camera);
        }
        animate();

        // GSAP
        gsap.registerPlugin(ScrollTrigger);
        gsap.utils.toArray('.gs-reveal').forEach(elem => {
            gsap.to(elem, {
                y: 0, opacity: 1, duration: 1, ease: "power2.out",
                scrollTrigger: { trigger: elem, start: "top 85%" }
            });
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>