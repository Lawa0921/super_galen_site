<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEKOPAPAYA | The Ethereal Haven</title>
    <meta name="description" content="NEKOPAPAYA - 人體狀態觀察分析師 | 康樂股長 | 避風港">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Italiana&family=Manrope:wght@300;500;700&family=Noto+Serif+TC:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>

    <!-- Three.js Import Map -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        :root {
            /* Palette: Milk Tea Editorial */
            --c-bg: #F4F1EC;       /* Cream */
            --c-text: #2D2A26;     /* Soft Charcoal */
            --c-accent: #A8B2A1;   /* Sage */
            --c-warm: #E6B89C;     /* Warm Clay */

            --f-head: 'Italiana', serif;
            --f-body: 'Manrope', sans-serif;
            --f-zh: 'Noto Serif TC', serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: var(--f-body);
            overflow-x: hidden;
            line-height: 1.8;
        }

        #webgl-container {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 0; pointer-events: none;
        }

        .scroller { position: relative; z-index: 10; pointer-events: none; }
        .interactive-layer { pointer-events: auto; }

        /* --- Sections --- */
        .section {
            min-height: 100vh;
            display: flex; flex-direction: column; justify-content: center;
            padding: 4rem 10vw;
            position: relative;
        }

        /* --- Typography --- */
        h1 {
            font-family: var(--f-head);
            font-size: clamp(4rem, 12vw, 10rem);
            font-weight: 400;
            line-height: 0.9;
            color: var(--c-text);
            margin-bottom: 2rem;
            letter-spacing: -0.02em;
        }

        h2 {
            font-family: var(--f-body);
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--c-accent);
            margin-bottom: 1.5rem;
            display: flex; align-items: center; gap: 1rem;
        }
        h2::before { content: ''; width: 40px; height: 1px; background: var(--c-accent); }

        p {
            font-family: var(--f-zh);
            font-size: 1.1rem;
            color: #555;
            max-width: 50ch;
            margin-bottom: 1.5rem;
        }

        /* --- Components --- */
        .glass-card {
            background: rgba(244, 241, 236, 0.6);
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-left: 2px solid var(--c-text);
            max-width: 600px;
            transform: translateY(50px); opacity: 0;
        }

        .nav-fixed {
            position: fixed; top: 2rem; left: 2rem; z-index: 50;
            font-family: var(--f-body); font-weight: 700; font-size: 0.9rem;
            color: var(--c-text); text-decoration: none;
            mix-blend-mode: multiply; pointer-events: auto;
        }

        /* --- Avatar --- */
        .avatar-float {
            width: 150px; height: 150px; border-radius: 50%;
            position: absolute; right: 10vw; top: 20vh;
            border: 1px solid rgba(0,0,0,0.1);
            overflow: hidden; opacity: 0.8;
            filter: grayscale(0.5); transition: 0.5s;
        }
        .avatar-float:hover { filter: grayscale(0); opacity: 1; transform: scale(1.05); }
        .avatar-float img { width: 100%; height: 100%; object-fit: cover; }

        /* Social */
        .social-link {
            display: inline-flex; align-items: center; justify-content: center;
            width: 60px; height: 60px; border-radius: 50%;
            border: 1px solid var(--c-text);
            color: var(--c-text); font-size: 1.2rem; margin-right: 1rem;
            transition: 0.3s; text-decoration: none;
        }
        .social-link:hover { background: var(--c-text); color: var(--c-bg); }

    </style>
</head>
<body>

    <a href="/guild" class="nav-fixed">NEKOPAPAYA</a>
    <div id="webgl-container"></div>

    <div class="scroller">

        <!-- 1. Hero -->
        <section class="section">
            <div class="interactive-layer">
                <div class="avatar-float gs-reveal">
                    <img src="/assets/img/guild/nekopapaya/avatar.webp" alt="Avatar">
                </div>
            </div>

            <div class="glass-card interactive-layer gs-reveal" style="background: transparent; padding: 0; border: none;">
                <h2>HUMAN STATE ANALYST</h2>
                <h1>The<br>Ethereal.</h1>
                <p>人體狀態觀察分析師 | 康樂股長</p>
                <p style="font-family: var(--f-head); font-size: 1.5rem; color: var(--c-text);">"Hydrogen knocking on your soul."</p>
            </div>
        </section>

        <!-- 2. The Haven -->
        <section class="section" style="align-items: flex-end; text-align: right;">
            <div class="glass-card interactive-layer gs-reveal" style="border-left: none; border-right: 2px solid var(--c-text);">
                <h2>SAFE HAVEN</h2>
                <h1 style="font-size: 4rem;">The Boat.</h1>
                <p>這裡是一個可以停下來、坐一下的地方。</p>
                <p>有時候我會在這裡，人聚在一起，慢慢享受人與人的溫度。沒有強迫，只有邀請。</p>
            </div>
        </section>

        <!-- 3. Methodology -->
        <section class="section">
            <div class="glass-card interactive-layer gs-reveal">
                <h2>METHODOLOGY</h2>
                <h1 style="font-size: 4rem;">Observe.</h1>
                <p>無聲地觀察每個人的狀態與需求。在熱鬧的背後，捕捉微弱的訊號。</p>
                <p>消除雜訊，調配出最適合當下的氛圍。</p>
            </div>
        </section>

        <!-- 4. Connect -->
        <section class="section" style="align-items: center; text-align: center;">
            <div class="glass-card interactive-layer gs-reveal" style="border: none; text-align: center;">
                <h2>DESTINATION</h2>
                <h1 style="font-size: 5rem;">Connect.</h1>
                <p>如果你剛好想參與、想一起感受，就可以私訊我。</p>
                <div style="margin-top: 3rem;">
                    <a href="https://www.threads.net/@nekopapaya" target="_blank" class="social-link"><i class="fa-brands fa-threads"></i></a>
                    <a href="https://www.instagram.com/nekopapaya/" target="_blank" class="social-link"><i class="fa-brands fa-instagram"></i></a>
                </div>
            </div>
        </section>

    </div>

    <!-- SCRIPT -->
    <script type="module">
        import * as THREE from 'three';

        // --- Setup ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        // Warm Cream Fog
        scene.fog = new THREE.FogExp2(0xF4F1EC, 0.035);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 5, 10);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.SoftShadowMap;
        container.appendChild(renderer.domElement);

        // --- Lights (Studio) ---
        const ambient = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(ambient);

        const sun = new THREE.DirectionalLight(0xffffff, 1);
        sun.position.set(5, 10, 5);
        sun.castShadow = true;
        sun.shadow.mapSize.width = 2048;
        sun.shadow.mapSize.height = 2048;
        sun.shadow.bias = -0.0001;
        scene.add(sun);

        // --- Objects ---

        // 1. The Sea (Liquid Milk Tea Shader)
        const seaGeo = new THREE.PlaneGeometry(100, 100, 256, 256);

        // Custom Shader Material for Viscous Liquid
        const seaMat = new THREE.MeshStandardMaterial({
            color: 0xE8E2D9, // Sand/Milk Tea
            roughness: 0.2,
            metalness: 0.1,
        });
        // We modify the material to animate vertices
        seaMat.onBeforeCompile = (shader) => {
            shader.uniforms.time = { value: 0 };
            shader.vertexShader = `
                uniform float time;
                ${shader.vertexShader}
            `;
            shader.vertexShader = shader.vertexShader.replace(
                '#include <begin_vertex>',
                `
                #include <begin_vertex>
                float y = sin(position.x * 0.5 + time) * 0.2 + cos(position.y * 0.3 + time * 0.8) * 0.2;
                // Add noise detail
                y += sin(position.x * 2.0 + time * 2.0) * 0.05;
                transformed.z += y; // Plane is rotated, so Z is up in local space (Y in world after rotation)
                `
            );
            seaMat.userData.shader = shader;
        };

        const sea = new THREE.Mesh(seaGeo, seaMat);
        sea.rotation.x = -Math.PI / 2;
        sea.receiveShadow = true;
        scene.add(sea);

        // 2. The Paper Boat (Procedural)
        const boatGroup = new THREE.Group();
        scene.add(boatGroup);

        // Paper Texture feel (White, rough)
        const paperMat = new THREE.MeshStandardMaterial({ color: 0xFFFFFF, roughness: 0.9, side: THREE.DoubleSide });

        // Folded Geometry
        const shape = new THREE.Shape();
        shape.moveTo(0,0);
        shape.lineTo(1, 0.5);
        shape.lineTo(2, 0);
        shape.lineTo(1, -0.5);

        // Simple Cone Approximation for Paper Boat style
        const hullGeo = new THREE.ConeGeometry(1.2, 0.8, 4, 1, true);
        const hull = new THREE.Mesh(hullGeo, paperMat);
        hull.rotation.z = Math.PI;
        hull.scale.z = 2.5; hull.scale.x = 1.2;
        hull.castShadow = true;
        boatGroup.add(hull);

        // Center Pyramid
        const sailGeo = new THREE.ConeGeometry(0.8, 1.2, 4);
        const sail = new THREE.Mesh(sailGeo, paperMat);
        sail.position.y = 0.4;
        sail.rotation.y = Math.PI/4;
        sail.castShadow = true;
        boatGroup.add(sail);


        // --- Interaction ---
        let scrollY = 0;
        window.addEventListener('scroll', () => scrollY = window.scrollY);

        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // Update Shader
            if(seaMat.userData.shader) {
                seaMat.userData.shader.uniforms.time.value = time * 0.5;
            }

            // Boat Physics
            boatGroup.position.y = Math.sin(time) * 0.1 - 0.1;
            boatGroup.rotation.z = Math.sin(time * 0.5) * 0.05;
            boatGroup.rotation.x = Math.sin(time * 0.3) * 0.03;

            // Scroll Movement (Infinite Sea)
            // Instead of moving boat, we move texture/waves? No, shader handles waves.
            // We just rotate the boat slightly to look at content?
            // Or move boat forward and reset?

            // Let's move the boat forward slowly
            boatGroup.position.z = -scrollY * 0.005;
            camera.position.z = 10 - scrollY * 0.005; // Follow boat

            // Mouse Parallax
            // camera.position.x += (mouse.x - camera.position.x) * 0.05;

            renderer.render(scene, camera);
        }
        animate();

        // GSAP Reveal
        gsap.registerPlugin(ScrollTrigger);
        gsap.utils.toArray('.gs-reveal').forEach(elem => {
            gsap.to(elem, {
                y: 0, opacity: 1, duration: 1.5, ease: "power2.out",
                scrollTrigger: { trigger: elem, start: "top 85%" }
            });
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>