<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIC NAIL | THE LOGIC ALCHEMIST</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=JetBrains+Mono:wght@300;700&family=Noto+Sans+TC:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --c-bg: #000000;
            --c-accent: #ff003c; /* Cyber Red */
            --c-sec: #00f3ff;    /* Cyber Cyan */
            --c-text: #ffffff;
            --c-dim: #444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
            width: 100vw;
        }

        /* --- Canvas --- */
        #gl-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* --- UI Overlay --- */
        .ui-layer {
            position: relative; z-index: 10;
            pointer-events: none; /* Let scroll pass through */
        }

        /* --- Navigation --- */
        nav {
            position: fixed; top: 0; left: 0; width: 100%;
            padding: 2rem;
            display: flex; justify-content: space-between; align-items: center;
            mix-blend-mode: difference;
            z-index: 100;
        }
        .brand {
            font-family: 'Anton', sans-serif;
            font-size: 2rem; letter-spacing: 2px;
            text-transform: uppercase;
        }
        .brand span { color: var(--c-accent); }

        .menu-btn {
            pointer-events: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            border: 1px solid #fff; padding: 0.5rem 1rem;
            text-decoration: none; color: #fff;
            transition: 0.3s;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        .menu-btn:hover { background: #fff; color: #000; }

        /* --- Global Scroll Progress --- */
        .progress-bar {
            position: fixed; right: 2rem; top: 50%; transform: translateY(-50%);
            height: 200px; width: 2px; background: rgba(255,255,255,0.1);
            z-index: 90;
        }
        .progress-fill {
            width: 100%; height: 0%; background: var(--c-accent);
            box-shadow: 0 0 10px var(--c-accent);
        }

        /* --- Section Styling --- */
        section {
            position: relative;
            min-height: 100vh;
            display: flex; flex-direction: column; justify-content: center;
            padding: 5vw 10vw;
            pointer-events: auto; /* Allow interaction with text */
        }

        /* --- Typography --- */
        h1, h2, h3 { font-family: 'Anton', sans-serif; text-transform: uppercase; }

        .hero-title {
            font-size: clamp(4rem, 12vw, 10rem);
            line-height: 0.85;
            mix-blend-mode: exclusion;
            opacity: 0; transform: translateY(50px);
        }
        .hero-subtitle {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem; margin-top: 2rem;
            color: var(--c-sec);
            border-left: 2px solid var(--c-sec);
            padding-left: 1rem;
            max-width: 600px;
        }

        /* --- Content Panels --- */
        .panel {
            background: rgba(10, 10, 10, 0.85);
            border: 1px solid #333;
            padding: 3rem;
            max-width: 1000px;
            margin: 0 auto;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            position: relative;
        }
        .panel::before {
            content: ''; position: absolute; top: -1px; left: -1px;
            width: 20px; height: 20px;
            border-top: 2px solid var(--c-sec); border-left: 2px solid var(--c-sec);
        }
        .panel::after {
            content: ''; position: absolute; bottom: -1px; right: -1px;
            width: 20px; height: 20px;
            border-bottom: 2px solid var(--c-sec); border-right: 2px solid var(--c-sec);
        }

        .panel h2 {
            font-size: 3.5rem; margin-bottom: 2rem;
            color: #fff;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        .panel h2 span { color: var(--c-accent); }

        .panel p {
            font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;
            color: #ccc;
        }
        .panel strong { color: #fff; font-weight: 700; }

        /* --- Logic Flow Visualization (S2) --- */
        .logic-flow {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem; margin-top: 3rem;
        }
        .logic-step {
            border: 1px solid #333; padding: 1.5rem;
            position: relative; transition: 0.3s;
        }
        .logic-step:hover { border-color: var(--c-sec); background: rgba(0, 243, 255, 0.05); }
        .logic-step h3 { color: var(--c-sec); font-size: 1.5rem; margin-bottom: 1rem; }
        .logic-step p { font-size: 0.9rem; color: #888; margin: 0; }
        .logic-step .step-num {
            position: absolute; top: -15px; right: 10px;
            background: #000; padding: 0 10px;
            font-family: 'JetBrains Mono', monospace; color: var(--c-accent);
        }

        /* --- Skill Matrix (S4) --- */
        .skill-matrix {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px; margin-top: 3rem;
        }
        .skill-card {
            border: 1px solid #333; padding: 1rem;
            font-family: 'JetBrains Mono', monospace;
            transition: 0.3s;
        }
        .skill-card:hover {
            transform: translateY(-5px);
            border-color: var(--c-accent);
            box-shadow: 0 5px 15px rgba(255, 0, 60, 0.2);
        }
        .skill-header {
            font-size: 0.8rem; color: #666; margin-bottom: 0.5rem;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .skill-title {
            font-size: 1.1rem; color: #fff; font-weight: bold; margin-bottom: 0.5rem;
        }
        .skill-desc { font-size: 0.8rem; color: #888; line-height: 1.4; }

        /* --- System Status (S5) --- */
        .status-terminal {
            background: #111; border: 1px solid #333;
            padding: 1.5rem; font-family: 'JetBrains Mono', monospace;
            color: #0f0; margin-top: 2rem;
            border-radius: 4px;
        }
        .cmd-line { margin-bottom: 0.5rem; display: flex; }
        .cmd-line::before { content: '>'; color: var(--c-accent); margin-right: 10px; }
        .cmd-line span { color: #fff; }

        /* --- Gallery Section (S3) --- */
        #s3 {
            height: 100vh; /* Full viewport */
            pointer-events: none; /* Let clicks pass to 3D if needed, though mostly visual */
            display: flex; align-items: flex-end; padding-bottom: 5rem;
            justify-content: center;
        }
        .gallery-ui-hint {
            font-family: 'JetBrains Mono', monospace;
            color: var(--c-sec);
            background: rgba(0,0,0,0.8); padding: 0.5rem 1rem;
            border: 1px solid var(--c-sec);
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0; /* Animated */
            transition: opacity 0.5s;
        }

        /* --- Socials --- */
        .social-grid {
            display: flex; gap: 2rem; margin-top: 2rem; justify-content: flex-end;
        }
        .social-link {
            font-size: 2rem; color: #555; transition: 0.3s;
        }
        .social-link:hover { color: var(--c-sec); transform: scale(1.1); text-shadow: 0 0 10px var(--c-sec); }

        /* --- Loader --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .loader-text {
            font-family: 'JetBrains Mono', monospace; color: var(--c-accent);
            font-size: 1.5rem; letter-spacing: 0.2em;
            margin-bottom: 1rem;
        }
        .loader-bar {
            width: 200px; height: 2px; background: #333; position: relative;
        }
        .loader-progress {
            position: absolute; left: 0; top: 0; height: 100%; width: 0%;
            background: var(--c-sec);
        }

    </style>
</head>
<body>

    <div id="loader">
        <div class="loader-text">INITIALIZING SYSTEM...</div>
        <div class="loader-bar"><div class="loader-progress"></div></div>
    </div>

    <div id="gl-container"></div>

    <div class="ui-layer">
        <nav>
            <div class="brand">VIC <span>NAIL</span></div>
            <a href="/guild/" class="menu-btn">RETURN_GUILD</a>
        </nav>

        <div class="progress-bar"><div class="progress-fill" id="prog-fill"></div></div>

        <!-- S1: HERO -->
        <section id="s1">
            <h1 class="hero-title">LOGIC<br>ALCHEMIST</h1>
            <div class="hero-subtitle">
                &gt; TARGET: PERFECT FORM<br>
                &gt; ROLE: EDUCATOR / MAKER / EXPLORER<br>
                &gt; EXP: 18 YEARS
            </div>
        </section>

        <!-- S2: PHILOSOPHY -->
        <section id="s2">
            <div class="panel">
                <h2>DECODE THE <span>ART</span></h2>
                <p>我是東東老師。身為日系品牌 <strong>PRESTO 台灣區講師</strong>，在 18 年的美甲生涯中，我堅持拒絕照表操課的死記硬背。</p>
                <p>「知其然，更要知其所以然。」</p>
                <p>美甲不只是塗抹色彩，更是結構工程學與化學的結合。我將複雜的技術拆解成「邏輯完善」的系統化課程，帶領學生理解每一個步驟背後的原理。</p>

                <div class="logic-flow">
                    <div class="logic-step">
                        <div class="step-num">01</div>
                        <h3>Input Analysis</h3>
                        <p>分析原生甲況、生活習慣與材質特性。不盲目施作，先理解基礎結構。</p>
                    </div>
                    <div class="logic-step">
                        <div class="step-num">02</div>
                        <h3>Logic Processing</h3>
                        <p>拆解施作步驟，運用物理支撐原理與化學凝膠特性，建構最穩固的基底。</p>
                    </div>
                    <div class="logic-step">
                        <div class="step-num">03</div>
                        <h3>Perfect Output</h3>
                        <p>不僅是外觀的精緻，更是持久度與健康度的完美平衡。內化技術成為武器。</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- S3: GALLERY SHOWCASE -->
        <section id="s3">
            <div class="gallery-ui-hint">// DRAG TO ROTATE ARCHIVES //</div>
        </section>

        <!-- S4: LIFE SKILLS -->
        <section id="s4">
            <div class="panel">
                <h2>FULL STACK <span>LIFE</span></h2>
                <p>脫下講師袍，我是一個技能點滿的雜學家。我的履歷表比色卡還豐富，這些看似不相關的經歷，都是我理解世界的獨特視角。</p>

                <div class="skill-matrix">
                    <div class="skill-card">
                        <div class="skill-header">Service.exe</div>
                        <div class="skill-title">火鍋店 / Uber</div>
                        <div class="skill-desc">練就極致的服務效率與動線規劃邏輯。</div>
                    </div>
                    <div class="skill-card">
                        <div class="skill-header">Hard_Labor.dll</div>
                        <div class="skill-title">工地 / 水電 DIY</div>
                        <div class="skill-desc">從結構補強到居家修繕，對「穩固」有著工科般的執著。</div>
                    </div>
                    <div class="skill-card">
                        <div class="skill-header">Manage.sys</div>
                        <div class="skill-title">人力派遣 / HR</div>
                        <div class="skill-desc">精準的人力資源配置與系統化管理思維。</div>
                    </div>
                    <div class="skill-card">
                        <div class="skill-header">Edu_Core.bat</div>
                        <div class="skill-title">學校老師</div>
                        <div class="skill-desc">因材施教，將艱澀知識轉化為易懂語言的傳授能力。</div>
                    </div>
                    <div class="skill-card">
                        <div class="skill-header">Creative.app</div>
                        <div class="skill-title">平面設計 / 影音</div>
                        <div class="skill-desc">視覺美感的數位化呈現，從指尖延伸到螢幕。</div>
                    </div>
                    <div class="skill-card">
                        <div class="skill-header">Life.config</div>
                        <div class="skill-title">烹飪 / 手作</div>
                        <div class="skill-desc">對生活細節的熱愛，是所有創作的靈感泉源。</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- S5: CURRENT STATUS -->
        <section id="s5">
            <div class="panel">
                <h2>SYSTEM <span>UPDATE</span></h2>
                <p>這就是我，一個專業與斜槓並存的靈魂。歡迎跟我聊聊邏輯縝密的美甲技術，或是各種天馬行空的科技與生活！✨</p>

                <div class="status-terminal">
                    <div class="cmd-line"><span>CURRENT_TASK: Automation_Workflow_Optimization</span></div>
                    <div class="cmd-line"><span>TOOL: N8N (Node-based Workflow Automation)</span></div>
                    <div class="cmd-line"><span>ROLE: Tech_Lead (Self-Appointed)</span></div>
                    <div class="cmd-line"><span>WORKFORCE: AI_Gemini (Cheap_Labor)</span></div>
                    <div class="cmd-line"><span>SUPERVISORS: 2 Cats (Feline_Overlords)</span></div>
                    <div class="cmd-line"><span>STATUS: Building the ultimate automated lifestyle...</span></div>
                </div>

                <div class="social-grid">
                    <a href="https://www.threads.com/@dwng1274" target="_blank" class="social-link"><i class="fa-brands fa-threads"></i></a>
                    <a href="https://www.facebook.com/VicNailArt" target="_blank" class="social-link"><i class="fa-brands fa-facebook"></i></a>
                    <a href="https://www.instagram.com/dwng1274/" target="_blank" class="social-link"><i class="fa-brands fa-instagram"></i></a>
                </div>
            </div>
        </section>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';
        import { RGBShiftShader } from 'three/addons/shaders/RGBShiftShader.js';

        // --- Config ---
        const CONFIG = {
            shardCount: 1500, // High density for the "Cool" explosion
            galleryImages: [
                '/assets/img/guild/vic/gallery_01.webp',
                '/assets/img/guild/vic/gallery_02.webp',
                '/assets/img/guild/vic/gallery_03.webp',
                '/assets/img/guild/vic/gallery_04.webp',
                '/assets/img/guild/vic/gallery_05.webp',
                '/assets/img/guild/vic/gallery_06.webp',
                '/assets/img/guild/vic/gallery_07.webp'
            ]
        };

        // --- Scene Setup ---
        const container = document.getElementById('gl-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x000000, 0.02);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.z = 10;

        const renderer = new THREE.WebGLRenderer({ antialias: false, powerPreference: "high-performance" });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
        renderer.toneMapping = THREE.NoToneMapping;
        container.appendChild(renderer.domElement);

        // --- Post Processing ---
        const composer = new EffectComposer(renderer);
        const renderPass = new RenderPass(scene, camera);
        composer.addPass(renderPass);

        // Bloom - Intense for the "Cool" factor
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0.1;
        bloomPass.strength = 1.2;
        bloomPass.radius = 0.5;
        composer.addPass(bloomPass);

        const rgbShiftPass = new ShaderPass(RGBShiftShader);
        rgbShiftPass.uniforms['amount'].value = 0.001;
        composer.addPass(rgbShiftPass);

        // --- Objects: The Shard Cloud (Spikes/Cone) ---
        // Revert to "Cool" Spikes
        const shardGeo = new THREE.ConeGeometry(0.1, 0.5, 3);
        const shardMat = new THREE.MeshBasicMaterial({
            color: 0x00f3ff,
            wireframe: true, // Wireframe is cool
            transparent: true,
            opacity: 0.8
        });
        const shards = new THREE.InstancedMesh(shardGeo, shardMat, CONFIG.shardCount);

        const dummy = new THREE.Object3D();
        const shardData = [];

        // Initialize Shards in a "Tornado/Tunnel"
        for (let i = 0; i < CONFIG.shardCount; i++) {
            const r = 4 + Math.random() * 8; // Initial radius
            const theta = Math.random() * Math.PI * 2;
            const y = (Math.random() - 0.5) * 40; // Tall tunnel

            dummy.position.set(
                Math.cos(theta) * r,
                y,
                Math.sin(theta) * r
            );

            // Random rotation
            dummy.rotation.set(Math.random()*Math.PI, Math.random()*Math.PI, Math.random()*Math.PI);

            dummy.updateMatrix();
            shards.setMatrixAt(i, dummy.matrix);

            shardData.push({
                idx: i,
                basePos: dummy.position.clone(),
                baseR: r,
                theta: theta,
                y: y,
                speed: 0.005 + Math.random() * 0.01,
                rotSpeed: {
                    x: (Math.random() - 0.5) * 0.05,
                    y: (Math.random() - 0.5) * 0.05
                }
            });
        }
        scene.add(shards);

        // --- Objects: The Gallery (Cylinder) ---
        const galleryGroup = new THREE.Group();
        scene.add(galleryGroup);
        const panels = [];
        const textureLoader = new THREE.TextureLoader();

        CONFIG.galleryImages.forEach((url, i) => {
            const tex = textureLoader.load(url);
            tex.colorSpace = THREE.SRGBColorSpace;

            // Large Portrait Frame
            const geo = new THREE.PlaneGeometry(7, 10);
            const mat = new THREE.MeshBasicMaterial({
                map: tex,
                side: THREE.DoubleSide,
                toneMapped: false,
                transparent: true,
                opacity: 0 // Start invisible
            });
            const mesh = new THREE.Mesh(geo, mat);

            // Add a solid black backing to ensure readability even with shards behind
            const backGeo = new THREE.PlaneGeometry(7.2, 10.2);
            const backMat = new THREE.MeshBasicMaterial({ color: 0x000000 });
            const backMesh = new THREE.Mesh(backGeo, backMat);
            backMesh.position.z = -0.1; // Slightly behind
            mesh.add(backMesh); // Attach to main mesh

            galleryGroup.add(mesh);
            panels.push(mesh);
        });

        // Hide gallery initially? No, let opacity handle it.
        galleryGroup.visible = true; // Always visible, opacity controlled


        // --- GSAP & Scroll Logic ---
        gsap.registerPlugin(ScrollTrigger);

        let scrollProgress = 0;

        // Main Progress Bar
        ScrollTrigger.create({
            trigger: "body",
            start: "top top",
            end: "bottom bottom",
            onUpdate: (self) => {
                scrollProgress = self.progress;
                gsap.set('#prog-fill', { height: (self.progress * 100) + '%' });

                // Intense RGB Glitch on scroll
                const vel = Math.abs(self.getVelocity());
                gsap.to(rgbShiftPass.uniforms['amount'], { value: 0.001 + vel * 0.0002, duration: 0.1 });
            }
        });

        // Intro Animation
        const tl = gsap.timeline();
        tl.to('.loader-progress', { width: '100%', duration: 1, ease: 'power2.inOut' })
          .to('#loader', { opacity: 0, duration: 0.5, onComplete: () => document.getElementById('loader').remove() })
          .to('.hero-title', { opacity: 1, y: 0, duration: 1, ease: 'power4.out' });

        // Panel Animations
        gsap.utils.toArray('.panel').forEach(panel => {
            gsap.from(panel, {
                scrollTrigger: {
                    trigger: panel,
                    start: "top 85%",
                    toggleActions: "play none none reverse"
                },
                y: 100,
                opacity: 0,
                duration: 0.8,
                ease: "power2.out"
            });
        });

        // --- Render Loop ---
        const clock = new THREE.Clock();
        let galleryRotation = 0;

        function animate() {
            requestAnimationFrame(animate);
            const t = clock.getElapsedTime();

            // 1. Shard Animation Logic
            // Based on Scroll Progress, shards should "Explode" outward to clear the center
            // S1 (0-0.2): Tight Tunnel
            // S2 (0.2-0.4): Expanding
            // S3 (0.4-0.6): MAX EXPANSION (Gallery Mode) - Clear view

            let explosionRadius = 0;
            const isGalleryZone = (scrollProgress > 0.35 && scrollProgress < 0.65);

            if (isGalleryZone) {
                // Max explosion
                explosionRadius = 20;
            } else {
                // Normal tunnel
                explosionRadius = 0;
            }

            // Lerp the explosion factor for smoothness
            // We use a global lerp factor
            // Actually, let's calculate per frame

            // Animate Shards
            for (let i = 0; i < CONFIG.shardCount; i++) {
                const d = shardData[i];

                // Basic Rotation
                d.theta += d.speed;

                // Calculate Target Radius
                // If in gallery zone, radius becomes HUGE to clear view
                let targetR = d.baseR;
                if (isGalleryZone) targetR = d.baseR + 25; // Push WAY out

                // We can't easily lerp per particle without storing state,
                // but we can lerp based on scrollProgress generally.
                // Let's rely on scrollProgress being continuous.

                // To make it "Cool", add some noise
                const noise = Math.sin(t * 2 + d.idx) * 0.5;

                // Interpolate current radius based on scroll range
                // Smooth transition manually:
                // 0.3 -> 0.4: Radius grows
                // 0.6 -> 0.7: Radius shrinks
                let expansion = 0;
                if (scrollProgress > 0.3 && scrollProgress < 0.4) expansion = (scrollProgress - 0.3) * 10; // 0 to 1
                else if (scrollProgress >= 0.4 && scrollProgress <= 0.6) expansion = 1;
                else if (scrollProgress > 0.6 && scrollProgress < 0.7) expansion = 1 - (scrollProgress - 0.6) * 10;

                const currentR = d.baseR + (expansion * 20);

                dummy.position.x = Math.cos(d.theta) * (currentR + noise);
                dummy.position.z = Math.sin(d.theta) * (currentR + noise);
                dummy.position.y = d.y + Math.sin(t + d.idx) * 1; // Float

                // Rotation
                dummy.rotation.x += d.rotSpeed.x;
                dummy.rotation.y += d.rotSpeed.y;

                dummy.updateMatrix();
                shards.setMatrixAt(i, dummy.matrix);
            }
            shards.instanceMatrix.needsUpdate = true;


            // 2. Gallery Logic
            const hint = document.querySelector('.gallery-ui-hint');

            if (isGalleryZone) {
                if(hint) hint.style.opacity = 1;

                // Show panels
                // Local scroll logic
                let localP = (scrollProgress - 0.35) / 0.25;
                if (localP < 0) localP = 0;
                if (localP > 1) localP = 1;

                const radius = 14; // Larger radius for bigger images
                const spacing = 0.5; // radians
                const totalRotation = (panels.length - 1) * spacing;
                const targetRot = -localP * totalRotation;

                galleryRotation += (targetRot - galleryRotation) * 0.1;

                panels.forEach((mesh, i) => {
                    const angle = (i * spacing) + galleryRotation;

                    mesh.position.x = Math.sin(angle) * radius;
                    mesh.position.z = (Math.cos(angle) * radius) - radius + 2; // Offset slightly
                    mesh.rotation.y = -angle;

                    const dist = Math.abs(angle);
                    // More generous visibility range
                    const opacity = Math.max(0, 1 - dist * 0.5);

                    mesh.material.opacity = opacity;
                    // Scale effect: Center image is bigger
                    const scale = 1 + Math.max(0, 1 - dist) * 0.2;
                    mesh.scale.setScalar(scale);

                    mesh.visible = opacity > 0.01;
                });

                // Move camera back to see the large images
                camera.position.z = 18;

            } else {
                if(hint) hint.style.opacity = 0;

                // Hide panels
                panels.forEach(m => {
                    m.material.opacity = 0;
                    m.visible = false;
                });

                // Camera flythrough logic
                let targetZ = 5; // Closer flythrough
                let targetY = 0;

                if (scrollProgress <= 0.35) {
                    targetZ = 10 - scrollProgress * 10; // Zoom in
                    targetY = -scrollProgress * 5;
                } else {
                    targetZ = 10;
                    targetY = -5;
                }

                camera.position.z += (targetZ - camera.position.z) * 0.1;
                camera.position.y += (targetY - camera.position.y) * 0.1;
            }

            composer.render();
        }

        animate();

        // --- Resize ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>