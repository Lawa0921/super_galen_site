<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIC NAIL | THE LOGIC ALCHEMIST</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&family=Space+Grotesk:wght@300;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --c-bg: #1a1a1a;
            --c-text: #f0f0f0;
            --c-accent: #d4af37; /* Metallic Gold */
            --c-sub: #a0a0a0;    /* Soft Grey */
            --c-glass: rgba(255, 255, 255, 0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
            width: 100vw;
        }

        /* --- Canvas --- */
        #gl-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
        }

        /* --- UI Overlay --- */
        .ui-layer {
            position: relative; z-index: 10;
            pointer-events: none;
        }

        nav {
            position: fixed; top: 0; left: 0; width: 100%;
            padding: 2rem;
            display: flex; justify-content: space-between; align-items: center;
            mix-blend-mode: difference;
            z-index: 100;
        }
        .brand {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem; letter-spacing: 2px;
            text-transform: uppercase;
            color: #fff;
        }
        .brand span { color: var(--c-accent); }

        .menu-btn {
            pointer-events: auto;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.8rem;
            border: 1px solid rgba(255,255,255,0.3); padding: 0.5rem 1rem;
            text-decoration: none; color: #fff;
            transition: 0.3s;
            background: rgba(0,0,0,0.2); backdrop-filter: blur(5px);
            text-transform: uppercase; letter-spacing: 1px;
        }
        .menu-btn:hover { background: #fff; color: #000; border-color: #fff; }

        /* --- Sections --- */
        section {
            position: relative;
            min-height: 100vh;
            display: flex; flex-direction: column; justify-content: center;
            padding: 10vw;
            pointer-events: none;
        }

        .hero-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(3rem, 10vw, 8rem);
            line-height: 1.1;
            text-transform: uppercase;
            color: #fff;
            opacity: 0; transform: translateY(30px);
            text-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .hero-title span {
            display: block; font-size: 0.4em; letter-spacing: 5px;
            font-family: 'Space Grotesk', sans-serif; color: var(--c-accent);
            margin-bottom: 1rem;
        }

        .hero-subtitle {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1rem; margin-top: 2rem;
            color: var(--c-sub);
            max-width: 500px;
            border-left: 1px solid var(--c-accent);
            padding-left: 1.5rem;
            letter-spacing: 1px;
            line-height: 1.6;
        }

        .content-box {
            background: rgba(20,20,20,0.6);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 4rem;
            max-width: 800px;
            margin-left: auto;
            transform: translateX(50px); opacity: 0;
            pointer-events: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            position: relative;
        }
        .content-box::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--c-accent), transparent);
        }
        .content-box.left {
            margin-left: 0; margin-right: auto;
            transform: translateX(-50px);
        }

        h2 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem; margin-bottom: 2rem;
            color: #fff;
            letter-spacing: 2px;
        }
        .content-box h2 span { color: var(--c-accent); font-style: italic; }

        p {
            font-size: 1rem; line-height: 1.8; margin-bottom: 1.5rem;
            color: #ccc; font-weight: 300;
        }
        strong { color: #fff; font-weight: 500; }

        /* --- Blueprint Grid (S2) --- */
        .blueprint-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem; margin-top: 3rem;
            border-top: 1px solid rgba(255,255,255,0.1); padding-top: 2rem;
        }
        .blueprint-item {
            position: relative; padding-left: 1.5rem;
        }
        .blueprint-item::before {
            content: ''; position: absolute; left: 0; top: 5px; width: 1px; height: 100%;
            background: var(--c-accent); opacity: 0.5;
        }
        .blueprint-item h3 {
            font-family: 'Space Grotesk', sans-serif; color: var(--c-accent);
            font-size: 0.9rem; letter-spacing: 2px; margin-bottom: 0.5rem; text-transform: uppercase;
        }
        .blueprint-item p { font-size: 0.9rem; margin: 0; color: #999; }

        /* --- Swatch Grid (S4) --- */
        .swatch-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px; margin-top: 3rem;
        }
        .swatch-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05); padding: 1.5rem 1rem;
            text-align: center; transition: 0.4s ease;
            position: relative; overflow: hidden;
        }
        .swatch-card::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px;
            background: var(--c-accent); transform: scaleX(0); transition: 0.4s; transform-origin: left;
        }
        .swatch-card:hover::after { transform: scaleX(1); }
        .swatch-card:hover { background: rgba(255,255,255,0.08); transform: translateY(-5px); }
        .swatch-name { color: #fff; font-size: 0.9rem; margin-bottom: 5px; font-weight: 500; font-family: 'Noto Sans TC', sans-serif; }
        .swatch-tag { color: var(--c-sub); font-size: 0.7rem; text-transform: uppercase; font-family: 'Space Grotesk', sans-serif; letter-spacing: 1px; }

        /* --- Workshop Status (S5) --- */
        .workshop-status {
            background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
            padding: 2rem; margin-top: 2rem;
            display: flex; flex-direction: column; gap: 1rem;
        }
        .status-row {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 0.5rem;
        }
        .status-row:last-child { border-bottom: none; }
        .status-label { font-family: 'Space Grotesk', sans-serif; color: var(--c-sub); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; }
        .status-val { color: #fff; font-family: 'Noto Sans TC', sans-serif; font-size: 0.9rem; }

        .social-links {
            display: flex; gap: 20px; margin-top: 2rem; pointer-events: auto; justify-content: flex-end;
        }
        .social-icon {
            font-size: 1.2rem; color: #666; transition: 0.3s; border: 1px solid #333;
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            border-radius: 50%;
        }
        .social-icon:hover { color: var(--c-accent); border-color: var(--c-accent); transform: rotate(15deg); }

        /* --- Scroll Progress --- */
        .scroll-line {
            position: fixed; right: 3rem; top: 0; height: 100vh; width: 1px;
            background: rgba(255,255,255,0.1); z-index: 90;
        }
        .scroll-dot {
            position: absolute; top: 0; left: -2px; width: 5px; height: 5px;
            background: var(--c-accent); border-radius: 50%;
            box-shadow: 0 0 10px var(--c-accent);
        }

        /* --- Gallery Hint --- */
        .gallery-hint {
             position: absolute; bottom: 5%; left: 50%; transform: translateX(-50%);
             font-family: 'Space Grotesk', sans-serif; font-size: 0.7rem; color: var(--c-sub);
             letter-spacing: 3px; opacity: 0; text-transform: uppercase;
        }

        /* --- Loader --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--c-bg); z-index: 999;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Cinzel', serif;
            color: var(--c-accent);
            font-size: 1.2rem; letter-spacing: 0.2em;
        }
    </style>
</head>
<body>

    <div id="loader">VIC NAIL ARTISTRY</div>

    <div id="gl-container"></div>

    <div class="ui-layer">
        <nav>
            <div class="brand">VIC <span>NAIL</span></div>
            <a href="/guild/" class="menu-btn">Back to Guild</a>
        </nav>

        <div class="scroll-line"><div class="scroll-dot" id="scroll-dot"></div></div>

        <!-- S1: HERO -->
        <section id="s1">
            <h1 class="hero-title"><span>The Logic of Beauty</span>Structural<br>Elegance</h1>
            <div class="hero-subtitle">
                å°‡æ„Ÿæ€§çš„ç¾å­¸ï¼Œæ‹†è§£ç‚ºç†æ€§çš„çµæ§‹ã€‚<br>
                18 å¹´æ¥µè‡´å·¥è—ï¼Œé‡æ–°å®šç¾©å‡è† è—è¡“ã€‚
            </div>
        </section>

        <!-- S2: PHILOSOPHY -->
        <section id="s2">
            <div class="content-box">
                <h2>The <span>Blueprint</span></h2>
                <p>æˆ‘æ˜¯æ±æ±è€å¸«ã€‚èº«ç‚º PRESTO å°ç£å€è¬›å¸«ï¼Œæˆ‘ç›¸ä¿¡ç¾ç”²ä¸åªæ˜¯è£é£¾ï¼Œè€Œæ˜¯ç²¾å¯†çš„å¾®å‹å»ºç¯‰å·¥ç¨‹ã€‚</p>
                <p>ã€ŒçŸ¥å…¶ç„¶ï¼Œæ›´è¦çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚ã€æ¯ä¸€å€‹ç­†è§¸èƒŒå¾Œï¼Œéƒ½æœ‰åš´è¬¹çš„é‚è¼¯æ”¯æ’ã€‚</p>

                <div class="blueprint-grid">
                    <div class="blueprint-item">
                        <h3>01. Foundation</h3>
                        <p>åˆ†æåŸç”Ÿç”²æ³èˆ‡æè³ªå¼µåŠ›ï¼Œå¥ å®šç©©å›ºåŸºçŸ³ã€‚</p>
                    </div>
                    <div class="blueprint-item">
                        <h3>02. Structure</h3>
                        <p>é‹ç”¨ç‰©ç†æ”¯æ’åŸç†ï¼Œå»ºæ§‹å®Œç¾å¼§åº¦èˆ‡åšåº¦ã€‚</p>
                    </div>
                    <div class="blueprint-item">
                        <h3>03. Aesthetic</h3>
                        <p>åœ¨çµ•å°çš„å¥åº·èˆ‡æŒä¹…ä¹‹ä¸Šï¼Œç¶»æ”¾è—è¡“å…‰å½©ã€‚</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- S3: GALLERY SHOWCASE -->
        <section id="s3" style="height: 150vh;">
            <div class="gallery-hint">Scroll to Explore Collection</div>
        </section>

        <!-- S4: LIFE -->
        <section id="s4">
            <div class="content-box left">
                <h2>Life <span>Palette</span></h2>
                <p>è„«ä¸‹è¬›å¸«è¢ï¼Œæˆ‘æ˜¯ä¸€å€‹å°ç”Ÿæ´»ç´°ç¯€å……æ»¿å¥½å¥‡çš„å·¥åŒ ã€‚é€™äº›è·¨é ˜åŸŸçš„ç¶“æ­·ï¼Œå¦‚åŒèª¿è‰²ç›¤ä¸Šçš„è‰²å½©ï¼Œè±å¯Œäº†æˆ‘çš„å‰µä½œåº•è˜Šã€‚</p>

                <div class="swatch-grid">
                    <div class="swatch-card">
                        <div class="swatch-name">ç«é‹/Uber</div>
                        <div class="swatch-tag">Service Logic</div>
                    </div>
                    <div class="swatch-card">
                        <div class="swatch-name">å·¥åœ°/æ°´é›»</div>
                        <div class="swatch-tag">Structure</div>
                    </div>
                    <div class="swatch-card">
                        <div class="swatch-name">äººåŠ›æ´¾é£</div>
                        <div class="swatch-tag">Management</div>
                    </div>
                    <div class="swatch-card">
                        <div class="swatch-name">å­¸æ ¡è€å¸«</div>
                        <div class="swatch-tag">Education</div>
                    </div>
                    <div class="swatch-card">
                        <div class="swatch-name">å¹³é¢/å½±éŸ³</div>
                        <div class="swatch-tag">Visual Art</div>
                    </div>
                    <div class="swatch-card">
                        <div class="swatch-name">çƒ¹é£ª/æ‰‹ä½œ</div>
                        <div class="swatch-tag">Craftsmanship</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- S5: CURRENT -->
        <section id="s5">
            <div class="content-box">
                <h2>Workshop <span>Status</span></h2>
                <p>ç›®å‰ç‹€æ…‹ï¼šè‡´åŠ›æ–¼å°‡å·¥ä½œæµç¨‹è‡ªå‹•åŒ–ï¼Œä¸¦åœ¨å®¶ä¸­å…©ä½è²“çš‡çš„ç›£ç£ä¸‹ï¼ŒæŒçºŒæ¢ç´¢ç§‘æŠ€èˆ‡å·¥è—çš„é‚Šç•Œã€‚</p>

                <div class="workshop-status">
                    <div class="status-row">
                        <span class="status-label">Current Focus</span>
                        <span class="status-val">Automated Workflow & Gel Art</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Tools</span>
                        <span class="status-val">N8N / PRESTO Gel / AI Assistant</span>
                    </div>
                    <div class="status-row">
                        <span class="status-label">Supervisors</span>
                        <span class="status-val">Two Cats ğŸˆ</span>
                    </div>
                </div>

                <div class="social-links">
                    <a href="https://www.threads.com/@dwng1274" target="_blank" class="social-icon"><i class="fa-brands fa-threads"></i></a>
                    <a href="https://www.facebook.com/VicNailArt" target="_blank" class="social-icon"><i class="fa-brands fa-facebook"></i></a>
                    <a href="https://www.instagram.com/dwng1274/" target="_blank" class="social-icon"><i class="fa-brands fa-instagram"></i></a>
                </div>
            </div>
        </section>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // --- Config ---
        const CONFIG = {
            galleryImages: [
                '/assets/img/guild/vic/gallery_01.webp',
                '/assets/img/guild/vic/gallery_02.webp',
                '/assets/img/guild/vic/gallery_03.webp',
                '/assets/img/guild/vic/gallery_04.webp',
                '/assets/img/guild/vic/gallery_05.webp',
                '/assets/img/guild/vic/gallery_06.webp',
                '/assets/img/guild/vic/gallery_07.webp'
            ]
        };

        // --- Scene Setup ---
        const container = document.getElementById('gl-container');
        const scene = new THREE.Scene();
        // Dark background for elegance
        scene.background = new THREE.Color(0x1a1a1a);
        scene.fog = new THREE.Fog(0x1a1a1a, 10, 30);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.z = 10;

        const renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.0;
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        // --- Post Processing ---
        const composer = new EffectComposer(renderer);
        const renderPass = new RenderPass(scene, camera);
        composer.addPass(renderPass);

        // Subtle Bloom for the Gold shine
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0.5;
        bloomPass.strength = 0.4;
        bloomPass.radius = 0.2;
        composer.addPass(bloomPass);

        // --- Lights ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        // Key Light
        const spotLight = new THREE.SpotLight(0xffd700, 10);
        spotLight.position.set(5, 10, 5);
        spotLight.castShadow = true;
        spotLight.angle = 0.5;
        spotLight.penumbra = 0.5;
        scene.add(spotLight);

        // Fill Light (Cool)
        const pointLight = new THREE.PointLight(0xaaccff, 2);
        pointLight.position.set(-5, 0, 5);
        scene.add(pointLight);

        // Back Light (Warm)
        const rimLight = new THREE.PointLight(0xffaa00, 2);
        rimLight.position.set(0, 5, -5);
        scene.add(rimLight);

        // --- Object: The Liquid Logic Core ---
        // A morphing shape representing "Gel" + "Structure"

        // 1. The Core (Liquid Gel)
        const coreGeo = new THREE.IcosahedronGeometry(1.5, 4); // High detail for morphing
        const coreMat = new THREE.MeshPhysicalMaterial({
            color: 0xffffff,
            roughness: 0.1,
            metalness: 0.1,
            transmission: 0.6, // Glass/Gel like
            thickness: 1.0,
            ior: 1.5,
            clearcoat: 1.0,
            clearcoatRoughness: 0.1,
            flatShading: false
        });
        const core = new THREE.Mesh(coreGeo, coreMat);
        core.castShadow = true;
        core.receiveShadow = true;

        // Save original vertices for noise animation
        const posAttribute = coreGeo.attributes.position;
        const originalPositions = [];
        for (let i = 0; i < posAttribute.count; i++) {
            originalPositions.push(
                new THREE.Vector3(posAttribute.getX(i), posAttribute.getY(i), posAttribute.getZ(i))
            );
        }

        scene.add(core);

        // 2. The Structure (Wireframe Cage)
        // Represents "Logic/Blueprint"
        const cageGeo = new THREE.IcosahedronGeometry(2.0, 1);
        const cageMat = new THREE.MeshBasicMaterial({
            color: 0xffd700, // Gold
            wireframe: true,
            transparent: true,
            opacity: 0.3
        });
        const cage = new THREE.Mesh(cageGeo, cageMat);
        scene.add(cage);

        // 3. Floating Particles (Dust/Glitter)
        const particlesGeo = new THREE.BufferGeometry();
        const particlesCount = 200;
        const pPos = new Float32Array(particlesCount * 3);
        for(let i=0; i<particlesCount*3; i++) {
            pPos[i] = (Math.random() - 0.5) * 15;
        }
        particlesGeo.setAttribute('position', new THREE.BufferAttribute(pPos, 3));
        const particlesMat = new THREE.PointsMaterial({
            color: 0xffd700,
            size: 0.03,
            transparent: true,
            opacity: 0.6
        });
        const particles = new THREE.Points(particlesGeo, particlesMat);
        scene.add(particles);

        // --- Gallery Objects ---
        const galleryGroup = new THREE.Group();
        scene.add(galleryGroup);
        const panels = [];
        const textureLoader = new THREE.TextureLoader();

        CONFIG.galleryImages.forEach((url, i) => {
            const tex = textureLoader.load(url);
            tex.colorSpace = THREE.SRGBColorSpace;

            const group = new THREE.Group();

            // Image
            const geo = new THREE.PlaneGeometry(3.5, 5);
            const mat = new THREE.MeshBasicMaterial({ map: tex, side: THREE.DoubleSide });
            const mesh = new THREE.Mesh(geo, mat);
            group.add(mesh);

            // Elegant Frame (Gold)
            const frameGeo = new THREE.BoxGeometry(3.6, 5.1, 0.05);
            const frameMat = new THREE.MeshStandardMaterial({
                color: 0xd4af37, // Gold
                metalness: 1.0,
                roughness: 0.3
            });
            const frame = new THREE.Mesh(frameGeo, frameMat);
            frame.position.z = -0.03;
            frame.castShadow = true;
            group.add(frame);

            // Initial Pos
            group.userData = { angle: (i / CONFIG.galleryImages.length) * Math.PI * 2, radius: 6 };
            galleryGroup.add(group);
            panels.push(group);
        });
        galleryGroup.visible = false; // Hidden initially

        // --- GSAP Scroll ---
        gsap.registerPlugin(ScrollTrigger);
        let scrollProgress = 0;

        ScrollTrigger.create({
            trigger: "body",
            start: "top top",
            end: "bottom bottom",
            onUpdate: (self) => {
                scrollProgress = self.progress;
                gsap.set('#scroll-dot', { top: (self.progress * 100) + '%' });
            }
        });

        // Intro
        gsap.to('.hero-title', {
            scrollTrigger: { trigger: '#s1', start: "top center" },
            opacity: 1, y: 0, duration: 1.5, ease: 'power3.out'
        });

        // Content Fade In
        gsap.utils.toArray('.content-box').forEach(box => {
            gsap.to(box, {
                scrollTrigger: {
                    trigger: box,
                    start: "top 85%",
                    end: "top 60%",
                    scrub: 1
                },
                x: 0,
                opacity: 1
            });
        });

        gsap.to('.gallery-hint', {
            scrollTrigger: { trigger: '#s3', start: "top center", end: "center center", scrub: true },
            opacity: 1
        });

        // --- Animation Loop ---
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const t = clock.getElapsedTime();

            // 1. Morph Liquid Core
            // Logic: Vertex Displacement based on noise
            const noiseFactor = 0.2 + (Math.sin(t * 0.5) * 0.1); // Breathing effect

            for (let i = 0; i < posAttribute.count; i++) {
                const orig = originalPositions[i];
                // Simple sine wave displacement
                const offset = Math.sin(orig.x * 2 + t) * Math.cos(orig.y * 2 + t) * noiseFactor;

                posAttribute.setXYZ(
                    i,
                    orig.x + offset * orig.x, // Expand outward
                    orig.y + offset * orig.y,
                    orig.z + offset * orig.z
                );
            }
            posAttribute.needsUpdate = true;
            coreGeo.computeVertexNormals();

            // Core Rotation
            core.rotation.y = t * 0.1;
            cage.rotation.y = -t * 0.05;
            cage.rotation.z = Math.sin(t * 0.1) * 0.1;

            // Particles
            particles.rotation.y = t * 0.02;

            // 2. Scroll Interaction
            // S1-S2: Focus on Core
            // S3: Core moves away, Gallery appears

            let galleryOp = 0;
            if (scrollProgress > 0.35 && scrollProgress < 0.65) {
                galleryOp = 1;
                if (scrollProgress < 0.4) galleryOp = (scrollProgress - 0.35) * 20;
                else if (scrollProgress > 0.6) galleryOp = 1 - (scrollProgress - 0.6) * 20;
            }

            // Core Visibility/Position
            if (scrollProgress > 0.3) {
                // Move Core back or fade it
                const exitFactor = Math.min(1, (scrollProgress - 0.3) * 5);
                core.material.opacity = 1 - exitFactor;
                core.material.transparent = true;
                cage.material.opacity = 0.3 * (1 - exitFactor);
                // Move it away?
                // core.position.z = -20 * exitFactor;
            } else {
                core.material.opacity = 1;
                core.material.transparent = true; // Always true for transmission
                cage.material.opacity = 0.3;
            }

            // Gallery Logic
            galleryGroup.visible = galleryOp > 0.01;

            panels.forEach((group, i) => {
                // Circular layout
                if (galleryOp > 0.01) {
                    const radius = 6;
                    const angleOffset = t * 0.1 - (scrollProgress * Math.PI * 2); // Rotate with scroll

                    group.position.x = Math.cos(group.userData.angle + angleOffset) * radius;
                    group.position.z = Math.sin(group.userData.angle + angleOffset) * radius;

                    // Simple opacity fade for meshes
                    group.children.forEach(c => {
                        if(c.material) {
                            c.material.transparent = true;
                            c.material.opacity = galleryOp;
                        }
                    });

                    group.lookAt(camera.position);
                }
            });

            // Camera Motion
            // S1 (0): z=10
            // S3 (0.5): z=14 (Back up for gallery)
            // S5 (1.0): z=10

            let targetZ = 8;
            if (scrollProgress > 0.3 && scrollProgress < 0.7) targetZ = 14;

            camera.position.z += (targetZ - camera.position.z) * 0.05;
            camera.position.y += (Math.sin(scrollProgress * Math.PI) - camera.position.y) * 0.05; // Subtle float

            composer.render();
        }

        animate();

        // --- Resize ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

        // Remove loader fallback
        setTimeout(() => {
            const l = document.getElementById('loader');
            if(l) l.remove();
        }, 1000);

    </script>
</body>
</html>