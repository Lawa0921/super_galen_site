<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIC NAIL | THE LOGIC ALCHEMIST</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=JetBrains+Mono:wght@300;700&family=Noto+Sans+TC:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --c-bg: #050505;
            --c-accent: #ff0055; /* Magenta/Gel Polish */
            --c-sec: #00e5ff;    /* Cyan/Cyber */
            --c-gold: #ffd700;   /* Gold/Luxury */
            --c-text: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: var(--c-bg);
            color: var(--c-text);
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
            width: 100vw;
        }

        /* --- Canvas --- */
        #gl-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0;
        }

        /* --- UI Overlay --- */
        .ui-layer {
            position: relative; z-index: 10;
            pointer-events: none; /* Let scroll pass through */
        }

        nav {
            position: fixed; top: 0; left: 0; width: 100%;
            padding: 2rem;
            display: flex; justify-content: space-between; align-items: center;
            mix-blend-mode: difference;
            z-index: 100;
        }
        .brand {
            font-family: 'Anton', sans-serif;
            font-size: 2rem; letter-spacing: 2px;
            text-transform: uppercase;
        }
        .brand span { color: var(--c-accent); text-shadow: 0 0 10px var(--c-accent); }

        .menu-btn {
            pointer-events: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            border: 1px solid #fff; padding: 0.5rem 1rem;
            text-decoration: none; color: #fff;
            transition: 0.3s;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(5px);
        }
        .menu-btn:hover { background: #fff; color: #000; }

        /* --- Sections --- */
        section {
            position: relative;
            min-height: 100vh;
            display: flex; flex-direction: column; justify-content: center;
            padding: 10vw;
            pointer-events: none;
        }

        .hero-title {
            font-family: 'Anton', sans-serif;
            font-size: clamp(4rem, 15vw, 12rem);
            line-height: 0.85;
            text-transform: uppercase;
            mix-blend-mode: screen;
            opacity: 0; transform: translateY(50px);
            background: linear-gradient(to right, #fff, var(--c-sec));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(0, 229, 255, 0.5));
        }
        .hero-subtitle {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem; margin-top: 2rem;
            color: var(--c-accent);
            max-width: 600px;
            text-shadow: 0 0 5px var(--c-accent);
        }

        .content-box {
            background: rgba(10,10,10,0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            border-left: 4px solid var(--c-accent);
            padding: 3rem;
            max-width: 900px;
            margin-left: auto;
            transform: translateX(100px); opacity: 0;
            pointer-events: auto;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        .content-box.left {
            margin-left: 0; margin-right: auto;
            transform: translateX(-100px);
            border-left: 1px solid #333;
            border-right: 4px solid var(--c-sec);
        }

        h2 {
            font-family: 'Anton', sans-serif;
            font-size: 3.5rem; margin-bottom: 2rem;
            text-transform: uppercase;
            color: #fff;
        }
        .content-box h2 span { color: var(--c-accent); }
        .content-box.left h2 span { color: var(--c-sec); }

        p {
            font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;
            color: #ccc;
        }
        strong { color: #fff; font-weight: 700; }

        /* --- Logic Flow (S2) --- */
        .logic-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem; margin-top: 2rem; border-top: 1px solid #333; padding-top: 2rem;
        }
        .logic-item {
            border: 1px solid #333; padding: 1rem;
            transition: 0.3s;
            position: relative; overflow: hidden;
        }
        .logic-item::before {
            content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%;
            background: var(--c-sec); transform: scaleY(0); transition: 0.3s;
        }
        .logic-item:hover::before { transform: scaleY(1); }
        .logic-item:hover { border-color: var(--c-sec); background: rgba(0,229,255,0.05); }
        .logic-item h3 { font-family: 'JetBrains Mono', monospace; color: var(--c-sec); margin-bottom: 0.5rem; font-size: 1rem; }
        .logic-item p { font-size: 0.9rem; margin: 0; color: #888; }

        /* --- Skill Matrix (S4) --- */
        .skill-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px; margin-top: 2rem;
        }
        .skill-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid #333; padding: 0.8rem;
            font-family: 'JetBrains Mono', monospace;
            text-align: center;
            transition: 0.3s;
        }
        .skill-card:hover {
            border-color: var(--c-accent);
            background: rgba(255, 0, 85, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.2);
        }
        .skill-name { color: #fff; font-size: 0.9rem; margin-bottom: 5px; font-weight: bold; }
        .skill-tag { color: #888; font-size: 0.7rem; text-transform: uppercase; }

        /* --- Terminal (S5) --- */
        .terminal {
            background: #000; border: 1px solid #333;
            padding: 1.5rem; font-family: 'JetBrains Mono', monospace;
            color: var(--c-sec); margin-top: 2rem; font-size: 0.9rem;
            border-radius: 5px;
            box-shadow: inset 0 0 20px rgba(0, 229, 255, 0.1);
        }
        .term-line { margin-bottom: 0.5rem; display: flex; }
        .term-line::before { content: '>'; color: var(--c-accent); margin-right: 10px; }

        .social-links {
            display: flex; gap: 20px; margin-top: 2rem; pointer-events: auto; justify-content: flex-end;
        }
        .social-icon {
            font-size: 1.5rem; color: #555; transition: 0.3s;
        }
        .social-icon:hover { color: var(--c-accent); transform: scale(1.2); text-shadow: 0 0 10px var(--c-accent); }

        /* --- Scroll Progress --- */
        .progress-bar {
            position: fixed; right: 2rem; top: 50%; transform: translateY(-50%);
            height: 200px; width: 2px; background: rgba(255,255,255,0.1);
            z-index: 90;
        }
        .progress-fill {
            width: 100%; height: 0%; background: var(--c-accent);
            box-shadow: 0 0 10px var(--c-accent);
        }

        /* --- Gallery Hint --- */
        .gallery-hint {
             position: absolute; bottom: 10%; left: 50%; transform: translateX(-50%);
             font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--c-sec);
             opacity: 0; background: rgba(0,0,0,0.8); padding: 5px 10px;
             border: 1px solid var(--c-sec);
        }

        /* --- Loader --- */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 999;
            display: flex; justify-content: center; align-items: center;
            font-family: 'JetBrains Mono', monospace;
            color: var(--c-sec);
            font-size: 1.5rem; letter-spacing: 0.2em;
        }
    </style>
</head>
<body>

    <div id="loader">INITIALIZING SYSTEM...</div>

    <div id="gl-container"></div>

    <div class="ui-layer">
        <nav>
            <div class="brand">VIC <span>NAIL</span></div>
            <a href="/guild/" class="menu-btn">GUILD_INDEX</a>
        </nav>

        <div class="progress-bar"><div class="progress-fill" id="prog-fill"></div></div>

        <!-- S1: HERO -->
        <section id="s1">
            <h1 class="hero-title">LOGIC<br>ALCHEMIST</h1>
            <div class="hero-subtitle">
                // NAIL ARTIST . EDUCATOR . MAKER<br>
                <span style="color: #fff;">EST. 18 YEARS</span>
            </div>
        </section>

        <!-- S2: PHILOSOPHY -->
        <section id="s2">
            <div class="content-box">
                <h2>Decode<br><span>The Art</span></h2>
                <p>æˆ‘æ˜¯æ±æ±è€å¸«ã€‚èº«ç‚º PRESTO å°ç£å€è¬›å¸«ï¼Œæˆ‘æ‹’çµ•ç…§è¡¨æ“èª²çš„æ­»è¨˜ç¡¬èƒŒã€‚</p>
                <p>ã€ŒçŸ¥å…¶ç„¶ï¼Œæ›´è¦çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚ã€æ˜¯æˆ‘å°å°ˆæ¥­çš„çµ•å°å …æŒã€‚</p>

                <div class="logic-grid">
                    <div class="logic-item">
                        <h3>01. INPUT_DATA</h3>
                        <p>åˆ†æåŸç”Ÿç”²æ³(Condition)èˆ‡æè³ªç‰¹æ€§(Material)ã€‚</p>
                    </div>
                    <div class="logic-item">
                        <h3>02. PROCESS_LOGIC</h3>
                        <p>é‹ç”¨ç‰©ç†çµæ§‹èˆ‡å‡è† åŒ–å­¸åæ‡‰(Polymerization)å»ºæ§‹ã€‚</p>
                    </div>
                    <div class="logic-item">
                        <h3>03. OUTPUT_ART</h3>
                        <p>å®Œç¾æŒä¹…çš„å¥åº·ç¾ç”²(Durability + Aesthetic)ã€‚</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- S3: GALLERY SHOWCASE -->
        <section id="s3" style="height: 150vh;">
            <div class="gallery-hint">[ SCROLL TO VIEW PORTFOLIO ]</div>
        </section>

        <!-- S4: LIFE -->
        <section id="s4">
            <div class="content-box left">
                <h2>Full Stack<br><span>Life</span></h2>
                <p>è„«ä¸‹è¬›å¸«è¢ï¼Œæˆ‘æ˜¯ä¸€å€‹ç”¨ç”Ÿå‘½åœ¨åŠªåŠ›æ´»è‘—çš„å†’éšªå®¶ã€‚æˆ‘çš„å±¥æ­·è¡¨æ¯”è‰²å¡é‚„è±å¯Œï¼Œé€™äº›ç¶“æ­·éƒ½æ˜¯æˆ‘ç†è§£ä¸–ç•Œçš„ç¨ç‰¹è¦–è§’ã€‚</p>

                <div class="skill-grid">
                    <div class="skill-card">
                        <div class="skill-name">ç«é‹/Uber</div>
                        <div class="skill-tag">Service_Optim.exe</div>
                    </div>
                    <div class="skill-card">
                        <div class="skill-name">å·¥åœ°/æ°´é›»</div>
                        <div class="skill-tag">Structural_Eng.dll</div>
                    </div>
                    <div class="skill-card">
                        <div class="skill-name">äººåŠ›æ´¾é£</div>
                        <div class="skill-tag">Resource_Mgmt.sys</div>
                    </div>
                    <div class="skill-card">
                        <div class="skill-name">å­¸æ ¡è€å¸«</div>
                        <div class="skill-tag">Knowledge_Transfer.bat</div>
                    </div>
                    <div class="skill-card">
                        <div class="skill-name">å¹³é¢/å½±éŸ³</div>
                        <div class="skill-tag">Visual_Design.app</div>
                    </div>
                    <div class="skill-card">
                        <div class="skill-name">çƒ¹é£ª/æ‰‹ä½œ</div>
                        <div class="skill-tag">Creative_Core.config</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- S5: CURRENT -->
        <section id="s5">
            <div class="content-box">
                <h2>System<br><span>Update</span></h2>
                <p>ç›®å‰ç‹€æ…‹ï¼šå®¶æœ‰å…©éš»è²“ä¸»å­ ğŸˆ æ“”ä»»é«˜éšç›£å·¥ã€‚</p>

                <div class="terminal">
                    <div class="term-line">Running: Gel_Application.exe</div>
                    <div class="term-line">Target: Automation_Life_Workflow</div>
                    <div class="term-line">Tool: N8N (Node-based)</div>
                    <div class="term-line">Worker: AI_Gemini (Low_Cost)</div>
                    <div class="term-line">Status: Compiling Logic...</div>
                </div>

                <div class="social-links">
                    <a href="https://www.threads.com/@dwng1274" target="_blank" class="social-icon"><i class="fa-brands fa-threads"></i></a>
                    <a href="https://www.facebook.com/VicNailArt" target="_blank" class="social-icon"><i class="fa-brands fa-facebook"></i></a>
                    <a href="https://www.instagram.com/dwng1274/" target="_blank" class="social-icon"><i class="fa-brands fa-instagram"></i></a>
                </div>
            </div>
        </section>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
        import { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';
        import { RGBShiftShader } from 'three/addons/shaders/RGBShiftShader.js';

        // --- Config ---
        const CONFIG = {
            shardCount: 800, // Reduced for clarity, focused on "Tools"
            galleryImages: [
                '/assets/img/guild/vic/gallery_01.webp',
                '/assets/img/guild/vic/gallery_02.webp',
                '/assets/img/guild/vic/gallery_03.webp',
                '/assets/img/guild/vic/gallery_04.webp',
                '/assets/img/guild/vic/gallery_05.webp',
                '/assets/img/guild/vic/gallery_06.webp',
                '/assets/img/guild/vic/gallery_07.webp'
            ]
        };

        // --- Scene Setup ---
        const container = document.getElementById('gl-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x000000, 0.02);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.z = 10;

        const renderer = new THREE.WebGLRenderer({ antialias: false, powerPreference: "high-performance" });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
        renderer.toneMapping = THREE.NoToneMapping;
        container.appendChild(renderer.domElement);

        // --- Post Processing ---
        const composer = new EffectComposer(renderer);
        const renderPass = new RenderPass(scene, camera);
        composer.addPass(renderPass);

        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0.1;
        bloomPass.strength = 1.2; // High bloom for neon effect
        bloomPass.radius = 0.5;
        composer.addPass(bloomPass);

        const rgbShiftPass = new ShaderPass(RGBShiftShader);
        rgbShiftPass.uniforms['amount'].value = 0.001;
        composer.addPass(rgbShiftPass);

        // --- Lights ---
        const ambientLight = new THREE.AmbientLight(0x404040, 2);
        scene.add(ambientLight);

        const blueLight = new THREE.PointLight(0x00e5ff, 5, 20);
        blueLight.position.set(-5, 5, 5);
        scene.add(blueLight);

        const pinkLight = new THREE.PointLight(0xff0055, 5, 20);
        pinkLight.position.set(5, -5, 5);
        scene.add(pinkLight);

        // --- Objects: "Relevant" Shards (Crystals & Tools) ---
        // 1. Crystal (Octahedron) - Represents Nail Art Decor
        const crystalGeo = new THREE.OctahedronGeometry(0.2, 0);
        const crystalMat = new THREE.MeshPhysicalMaterial({
            color: 0xff0055, // Hot Pink
            metalness: 0.9,
            roughness: 0.1,
            clearcoat: 1.0,
            transparent: true,
            opacity: 0.8,
            wireframe: true // Keep it cool
        });

        // 2. Tool (Cylinder) - Represents Files / Brushes
        const toolGeo = new THREE.CylinderGeometry(0.02, 0.02, 1, 6);
        const toolMat = new THREE.MeshPhysicalMaterial({
            color: 0x00e5ff, // Cyan
            metalness: 1.0, // Metallic
            roughness: 0.2,
            transparent: true,
            opacity: 0.6
        });

        const crystals = new THREE.InstancedMesh(crystalGeo, crystalMat, CONFIG.shardCount / 2);
        const tools = new THREE.InstancedMesh(toolGeo, toolMat, CONFIG.shardCount / 2);

        const dummy = new THREE.Object3D();
        const crystalData = [];
        const toolData = [];

        // Distribute in a DNA Helix / Double Spiral Structure
        // This represents "Logic" and "Structure"

        for (let i = 0; i < CONFIG.shardCount / 2; i++) {
            // Helix 1: Crystals
            const t = i * 0.1;
            const r = 4;
            const x = Math.cos(t) * r;
            const z = Math.sin(t) * r;
            const y = (i * 0.5) - 50; // Long vertical helix

            crystalData.push({
                idx: i,
                basePos: new THREE.Vector3(x, y, z),
                explodedPos: new THREE.Vector3(x*8, y, z*8), // Explode outward
                rotationSpeed: Math.random() * 0.05
            });

            dummy.position.set(x, y, z);
            dummy.rotation.set(Math.random(), Math.random(), Math.random());
            dummy.updateMatrix();
            crystals.setMatrixAt(i, dummy.matrix);

            // Helix 2: Tools (Offset by PI)
            const x2 = Math.cos(t + Math.PI) * r;
            const z2 = Math.sin(t + Math.PI) * r;

            toolData.push({
                idx: i,
                basePos: new THREE.Vector3(x2, y, z2),
                explodedPos: new THREE.Vector3(x2*8, y, z2*8),
                rotationSpeed: Math.random() * 0.05
            });

            dummy.position.set(x2, y, z2);
            dummy.rotation.set(Math.random(), Math.random(), Math.random()); // Rods random orientation
            dummy.updateMatrix();
            tools.setMatrixAt(i, dummy.matrix);
        }
        scene.add(crystals);
        scene.add(tools);

        // --- Objects: Glitter Particles ---
        const glitterGeo = new THREE.BufferGeometry();
        const glitterCount = 2000;
        const posArray = new Float32Array(glitterCount * 3);
        for(let i=0; i<glitterCount*3; i++) {
            posArray[i] = (Math.random() - 0.5) * 40; // Wide spread
        }
        glitterGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const glitterMat = new THREE.PointsMaterial({
            size: 0.05,
            color: 0xffd700, // Gold Dust
            transparent: true,
            opacity: 0.6,
            blending: THREE.AdditiveBlending
        });
        const glitter = new THREE.Points(glitterGeo, glitterMat);
        scene.add(glitter);

        // --- Objects: Gallery Panels (Framed Art) ---
        const textureLoader = new THREE.TextureLoader();
        const galleryGroup = new THREE.Group();
        scene.add(galleryGroup);
        const panels = [];

        CONFIG.galleryImages.forEach((url, i) => {
            const tex = textureLoader.load(url);
            tex.colorSpace = THREE.SRGBColorSpace;

            const group = new THREE.Group();

            // Image
            const geo = new THREE.PlaneGeometry(6, 8);
            const mat = new THREE.MeshBasicMaterial({ map: tex, side: THREE.DoubleSide, toneMapped: false });
            const mesh = new THREE.Mesh(geo, mat);
            group.add(mesh);

            // Frame (Torus/Rect) - Using Box for frame
            // Top/Bottom
            const frameMat = new THREE.MeshPhysicalMaterial({
                color: 0x222222,
                metalness: 0.8,
                roughness: 0.2,
                clearcoat: 1.0
            });
            const frameTop = new THREE.Mesh(new THREE.BoxGeometry(6.4, 0.2, 0.2), frameMat);
            frameTop.position.y = 4.1;
            group.add(frameTop);
            const frameBot = frameTop.clone();
            frameBot.position.y = -4.1;
            group.add(frameBot);
            const frameLeft = new THREE.Mesh(new THREE.BoxGeometry(0.2, 8.4, 0.2), frameMat);
            frameLeft.position.x = -3.1;
            group.add(frameLeft);
            const frameRight = frameLeft.clone();
            frameRight.position.x = 3.1;
            group.add(frameRight);

            // Black Backing
            const bg = new THREE.Mesh(new THREE.PlaneGeometry(6.2, 8.2), new THREE.MeshBasicMaterial({color:0x000000}));
            bg.position.z = -0.05;
            group.add(bg);

            // Initial pos
            const angle = (i / CONFIG.galleryImages.length) * Math.PI * 2;
            group.userData = { angle: angle, radius: 12 };

            galleryGroup.add(group);
            panels.push(group);
        });


        // --- GSAP Setup ---
        gsap.registerPlugin(ScrollTrigger);
        let scrollProgress = 0;

        ScrollTrigger.create({
            trigger: "body",
            start: "top top",
            end: "bottom bottom",
            onUpdate: (self) => {
                scrollProgress = self.progress;

                // Progress Bar
                const progFill = document.getElementById('prog-fill');
                if (progFill) progFill.style.height = (self.progress * 100) + '%';

                // RGB Shift
                const vel = Math.abs(self.getVelocity());
                gsap.to(rgbShiftPass.uniforms['amount'], { value: 0.001 + vel * 0.0002, duration: 0.1 });
            }
        });

        // Animations
        gsap.utils.toArray('.content-box').forEach(box => {
            gsap.to(box, {
                scrollTrigger: {
                    trigger: box,
                    start: "top 80%",
                    end: "top 50%",
                    scrub: 1
                },
                x: 0,
                opacity: 1
            });
        });

        gsap.to('.gallery-hint', {
            scrollTrigger: { trigger: '#s3', start: "top center", end: "center center", scrub: true },
            opacity: 1, y: -10
        });

        // --- Render Loop ---
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const t = clock.getElapsedTime();

            // 1. Helix Animation (Relevant Cool)
            // S1: Tight Helix
            // S3: EXPLODE (Repulsion)

            let explosionFactor = 0;
            if (scrollProgress > 0.3 && scrollProgress < 0.7) {
                 // Ramp up
                 if (scrollProgress < 0.4) explosionFactor = (scrollProgress - 0.3) * 10;
                 else if (scrollProgress > 0.6) explosionFactor = 1 - (scrollProgress - 0.6) * 10;
                 else explosionFactor = 1.0;
            }

            // Animate Crystals
            for (let i = 0; i < CONFIG.shardCount / 2; i++) {
                const d = crystalData[i];
                const lerpPos = new THREE.Vector3().lerpVectors(d.basePos, d.explodedPos, explosionFactor);

                // Add vertical scroll movement (Infinite helix loop illusion)
                // y = base.y + t*speed + scrollOffset
                // Let's just move the camera through it, keep objects static relative to Y

                dummy.position.copy(lerpPos);

                // Rotation
                dummy.rotation.x += d.rotationSpeed;
                dummy.rotation.y += d.rotationSpeed;

                dummy.updateMatrix();
                crystals.setMatrixAt(i, dummy.matrix);
            }
            crystals.instanceMatrix.needsUpdate = true;

            // Animate Tools
            for (let i = 0; i < CONFIG.shardCount / 2; i++) {
                const d = toolData[i];
                const lerpPos = new THREE.Vector3().lerpVectors(d.basePos, d.explodedPos, explosionFactor);

                dummy.position.copy(lerpPos);
                dummy.rotation.z += d.rotationSpeed; // Rods spin

                dummy.updateMatrix();
                tools.setMatrixAt(i, dummy.matrix);
            }
            tools.instanceMatrix.needsUpdate = true;

            // Rotate entire structure
            crystals.rotation.y = t * 0.1;
            tools.rotation.y = t * 0.1;


            // 2. Glitter Animation
            glitter.rotation.y = -t * 0.05;
            glitter.rotation.x = Math.sin(t * 0.1) * 0.1;


            // 3. Gallery Animation
            let galleryOp = 0;
            if (scrollProgress > 0.3 && scrollProgress < 0.7) {
                if (scrollProgress < 0.4) galleryOp = (scrollProgress - 0.3) * 10;
                else if (scrollProgress > 0.6) galleryOp = 1 - (scrollProgress - 0.6) * 10;
                else galleryOp = 1;
            }

            panels.forEach((group, i) => {
                group.visible = galleryOp > 0.01;

                // Opacity hack: traverse meshes (frame + image)
                group.children.forEach(c => {
                    if(c.material) c.material.opacity = galleryOp;
                });

                if (galleryOp > 0.01) {
                    const angleOffset = t * 0.2;
                    const r = group.userData.radius;

                    group.position.x = Math.cos(group.userData.angle + angleOffset) * r;
                    group.position.z = Math.sin(group.userData.angle + angleOffset) * r;
                    group.position.y = Math.sin(t + i) * 0.5;

                    group.lookAt(camera.position);
                }
            });

            // 4. Camera Movement
            // Scroll down Y axis to traverse the Helix
            // base Y is -50 to 50? No, we set them vertically spread.
            // Let's scroll camera.position.y from 10 down to -50

            const targetY = 10 - (scrollProgress * 60); // Move down through helix
            let targetZ = 12;

            if (scrollProgress > 0.3 && scrollProgress < 0.7) {
                targetZ = 20; // Pull back for gallery
            }

            camera.position.y += (targetY - camera.position.y) * 0.05;
            camera.position.z += (targetZ - camera.position.z) * 0.05;

            // Look slightly ahead/down? No, strict center looks cooler for symmetry.
            camera.lookAt(0, camera.position.y, 0);

            composer.render();
        }

        animate();

        // --- Resize ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- Init ---
        function startIntro() {
            const tl = gsap.timeline();
            tl.to('#loader', { opacity: 0, duration: 0.8, onComplete: () => document.getElementById('loader').remove() })
              .to('.hero-title', { opacity: 1, y: 0, duration: 1.5, ease: 'power4.out' }, "-=0.5");
        }
        window.addEventListener('load', startIntro);
        setTimeout(startIntro, 1500);

    </script>
</body>
</html>