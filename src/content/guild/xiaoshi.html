<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xiaoshi | The Drifter</title>
    <meta name="description" content="A wanderer of the streets. Manpower specialist, queuing expert, odd jobs.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Noto+Sans+TC:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --bg-color: #080808;
            --text-color: #d0d0d0;
            --accent-orange: #ffb700;
            --accent-tape: #f0e68c;
            --rain-blue: #4a6fa5;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
            width: 100vw;
            scrollbar-width: none;
        }
        body::-webkit-scrollbar { display: none; }

        h1, h2, h3, .street-font { font-family: 'Oswald', sans-serif; text-transform: uppercase; }

        /* --- Canvas Wrapper --- */
        #webgl-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* --- Scroll Spacer --- */
        #scroll-spacer {
            height: 600vh; /* Increased for longer ride */
            width: 100%;
            position: absolute;
            top: 0; left: 0;
            z-index: -1;
            pointer-events: none;
        }

        /* --- Navigation --- */
        .nav-back {
            position: fixed; top: 2rem; left: 2rem; z-index: 100; font-size: 1.2rem;
            color: #000; text-decoration: none; font-family: 'Oswald'; font-weight: 700;
            background: var(--accent-orange); padding: 0.5rem 1rem;
            transform: rotate(-2deg);
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
            transition: 0.3s;
        }
        .nav-back:hover { transform: rotate(0deg) scale(1.1); }

        /* --- Content Sections --- */
        .content-section {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 10;
            opacity: 0;
            display: flex;
            padding: 5vw;
            transition: opacity 0.5s ease;
            justify-content: center;
            align-items: center;
        }
        /* Active state handled by GSAP */

        /* --- Cards & UI --- */
        .data-card {
            background: rgba(10, 10, 12, 0.8);
            border: 1px solid #333;
            padding: 3rem;
            max-width: 600px;
            width: 100%;
            position: relative;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.9);
            transform: translateY(20px);
        }

        /* Tape Effect */
        .tape-label {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%) rotate(-1deg);
            background: var(--accent-tape); color: #000;
            padding: 5px 20px; font-size: 1rem; font-family: 'Oswald'; font-weight: 700;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            text-transform: uppercase;
        }

        .hero-title {
            font-size: clamp(4rem, 12vw, 8rem);
            color: #fff;
            line-height: 0.9;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 0px #000;
        }
        .hero-subtitle {
            font-size: 1.5rem; color: var(--accent-orange);
            letter-spacing: 0.1em; margin-bottom: 2rem;
            background: #000; color: #fff; padding: 0.2rem 1rem;
            display: inline-block; transform: rotate(-1deg);
        }

        .avatar-frame {
            width: 200px; height: 200px;
            margin: 0 auto 2rem auto;
            border-radius: 50%;
            border: 4px solid #fff;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .avatar-img {
            width: 100%; height: 100%; object-fit: cover;
            filter: grayscale(0.2) contrast(1.1);
        }

        p { line-height: 1.8; margin-bottom: 1rem; color: #bbb; font-size: 1.1rem; }
        strong { color: #fff; font-weight: 500; border-bottom: 1px solid var(--accent-orange); }

        /* Service Grid */
        .service-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;
        }
        .service-item {
            border: 1px solid #444;
            padding: 1.5rem;
            background: rgba(255,255,255,0.05);
            transition: 0.3s;
            position: relative;
        }
        .service-item:hover {
            border-color: var(--accent-orange);
            background: rgba(255, 183, 0, 0.1);
            transform: translateY(-5px);
        }
        .service-icon { color: var(--accent-orange); font-size: 1.5rem; margin-bottom: 1rem; display: block; }
        .service-title { font-family: 'Oswald'; color: #fff; font-size: 1.2rem; margin-bottom: 0.5rem; letter-spacing: 0.05em; }
        .service-desc { font-size: 0.9rem; color: #999; }

        /* Gallery */
        .gallery-container {
            display: flex; gap: 1rem; overflow-x: auto; padding-bottom: 1rem;
            scrollbar-width: thin; scrollbar-color: var(--accent-orange) transparent;
        }
        .gallery-img {
            height: 250px; width: auto; flex-shrink: 0;
            filter: grayscale(1) contrast(1.2); transition: 0.4s;
            cursor: pointer; border: 4px solid #fff;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
        }
        .gallery-img:hover { filter: grayscale(0); transform: scale(1.02) rotate(1deg); z-index: 5; }

        /* Finale */
        .finale-container { text-align: center; }
        .social-links { display: flex; gap: 2rem; justify-content: center; margin-top: 2rem; }
        .social-btn {
            color: #fff; font-size: 2rem; transition: 0.3s;
            width: 60px; height: 60px; border: 2px solid #fff; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
        }
        .social-btn:hover { background: var(--accent-orange); border-color: var(--accent-orange); color: #000; transform: scale(1.1); }

        /* Lightbox */
        #lightbox {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        #lightbox.active { opacity: 1; pointer-events: auto; }
        #lightbox-img { max-width: 90vw; max-height: 90vh; border: 10px solid #fff; box-shadow: 0 0 50px rgba(0,0,0,0.5); }

        @media (max-width: 768px) {
            .hero-title { font-size: 4rem; }
            .service-grid { grid-template-columns: 1fr; }
            .data-card { padding: 2rem 1.5rem; }
        }
    </style>
</head>
<body>

    <a href="/guild/" class="nav-back">GUILD</a>
    <div id="webgl-container"></div>
    <div id="scroll-spacer"></div>

    <!-- Lightbox -->
    <div id="lightbox" onclick="this.classList.remove('active')">
        <img id="lightbox-img" src="">
    </div>

    <!-- 1. Hero -->
    <div id="sec-hero" class="content-section active">
        <div style="text-align: center;">
            <div class="avatar-frame">
                <img src="/assets/img/guild/xiaoshi/avatar.webp" class="avatar-img" alt="Xiaoshi">
            </div>
            <h1 class="hero-title">XIAOSHI</h1>
            <div class="hero-subtitle">The Happy-Go-Lucky Drifter</div>
        </div>
    </div>

    <!-- 2. Profile / Bio -->
    <div id="sec-profile" class="content-section">
        <div class="data-card">
            <div class="tape-label">Who I Am</div>
            <p style="margin-top: 1rem;">
                我是<strong>小獅</strong>。<br>
                一個從基層爬起，被社會毒打的打工人。
            </p>
            <p>
                加入某奇怪論壇跑腿幫，已經將近20年。<br>
                目前是遊走各地的接案者，主要是雙北～但各地都會跑。
            </p>
            <p>
                有些案件的特殊性，會引起我的好奇心，所以工作一切以獨行為主。<br>
                要是那天真的剋死異鄉，所以趕快找尋公會加入～哈哈哈。
            </p>
            <p style="text-align: right; margin-top: 2rem; font-style: italic; color: var(--accent-orange);">
                法號～樂天a小獅
            </p>
        </div>
    </div>

    <!-- 3. Services -->
    <div id="sec-services" class="content-section">
        <div class="data-card">
            <div class="tape-label">What I Do</div>
            <div class="service-grid">
                <div class="service-item">
                    <i class="fa-solid fa-people-carry-box service-icon"></i>
                    <div class="service-title">MANPOWER</div>
                    <div class="service-desc">人力調度，各類臨時支援。</div>
                </div>
                <div class="service-item">
                    <i class="fa-solid fa-broom service-icon"></i>
                    <div class="service-title">CLEANING</div>
                    <div class="service-desc">居家服務，掃墓清潔，深層清理。</div>
                </div>
                <div class="service-item">
                    <i class="fa-solid fa-stopwatch service-icon"></i>
                    <div class="service-title">QUEUING</div>
                    <div class="service-desc">代排隊，限量美食，活動搶票。</div>
                </div>
                <div class="service-item">
                    <i class="fa-solid fa-utensils service-icon"></i>
                    <div class="service-title">FOOD SCOUT</div>
                    <div class="service-desc">美食獵人，部落客開拓，專業吃貨。</div>
                </div>
                <div class="service-item">
                    <i class="fa-solid fa-user-tie service-icon"></i>
                    <div class="service-title">BUTLER</div>
                    <div class="service-desc">專業管家服務，協助陪伴，代跑腿。</div>
                </div>
                <div class="service-item">
                    <i class="fa-solid fa-motorcycle service-icon"></i>
                    <div class="service-title">DRIFTER</div>
                    <div class="service-desc">萬事屋風格，只要有趣，使命必達。</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. Visual Logs -->
    <div id="sec-gallery" class="content-section">
        <div class="data-card" style="max-width: 900px; padding: 2rem;">
            <div class="tape-label">Drifter Logs</div>
            <div class="gallery-container">
                <img src="/assets/img/guild/xiaoshi/gallery_01.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_02.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_03.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_04.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_05.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_06.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_07.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_08.webp" class="gallery-img" onclick="openLightbox(this.src)">
            </div>
            <p style="margin-top: 1rem; font-size: 0.9rem; text-align: center; color: #666;">
                <i class="fa-solid fa-arrow-left"></i> SCROLL <i class="fa-solid fa-arrow-right"></i>
            </p>
        </div>
    </div>

    <!-- 5. Finale -->
    <div id="sec-finale" class="content-section">
        <div class="finale-container">
            <h1 class="hero-title" style="font-size: 3rem;">CONTACT</h1>
            <p style="font-size: 1.5rem; margin-bottom: 2rem; font-family: 'Oswald';">"Have a weird job? Call me."</p>

            <div class="social-links">
                <a href="https://www.threads.net/@iabc5040" target="_blank" class="social-btn"><i class="fa-brands fa-threads"></i></a>
                <a href="https://www.instagram.com/iabc5040/" target="_blank" class="social-btn"><i class="fa-brands fa-instagram"></i></a>
            </div>

            <div style="margin-top: 4rem; opacity: 0.5; font-size: 0.8rem;">
                © 2024 Xiaoshi. All Rights Reserved.
            </div>
        </div>
    </div>

    <script>
        function openLightbox(src) {
            document.getElementById('lightbox-img').src = src;
            document.getElementById('lightbox').classList.add('active');
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- 1. Scene Setup ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050505, 0.03); // Deep fog for infinite look

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 3, 6); // Behind and slightly above
        camera.lookAt(0, 1, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- 2. Environment (Infinite Road) ---
        const roadGroup = new THREE.Group();
        scene.add(roadGroup);

        // Road Texture/Grid
        const gridHelper = new THREE.GridHelper(200, 200, 0x333333, 0x111111);
        gridHelper.position.y = -0.1;
        gridHelper.scale.set(1, 1, 4); // Stretch for speed
        roadGroup.add(gridHelper);

        // Moving Stripes
        const stripeGeo = new THREE.PlaneGeometry(0.2, 5);
        const stripeMat = new THREE.MeshBasicMaterial({ color: 0xffb700 }); // Orange lines
        const stripes = [];

        for(let i=0; i<20; i++) {
            const mesh = new THREE.Mesh(stripeGeo, stripeMat);
            mesh.rotation.x = -Math.PI / 2;
            mesh.position.set(0, 0.01, -i * 10);
            roadGroup.add(mesh);
            stripes.push(mesh);
        }

        // Passing Lights (Simulate city lights)
        const lightGeo = new THREE.BoxGeometry(0.1, 4, 0.1);
        const lightMat = new THREE.MeshBasicMaterial({ color: 0x00f3ff });
        const lights = [];

        for(let i=0; i<30; i++) {
            const mesh = new THREE.Mesh(lightGeo, lightMat);
            const side = Math.random() > 0.5 ? 1 : -1;
            mesh.position.set(side * (5 + Math.random()*5), 2, -Math.random()*200);
            roadGroup.add(mesh);
            lights.push(mesh);
        }

        // --- 3. Motorcycle (Low Poly) ---
        const bikeGroup = new THREE.Group();
        scene.add(bikeGroup);

        // Body
        const bodyGeo = new THREE.BoxGeometry(0.8, 0.5, 2);
        const bodyMat = new THREE.MeshPhongMaterial({ color: 0x333333, shininess: 100 });
        const body = new THREE.Mesh(bodyGeo, bodyMat);
        body.position.y = 0.8;
        bikeGroup.add(body);

        // Tank
        const tankGeo = new THREE.BoxGeometry(0.7, 0.4, 1);
        const tankMat = new THREE.MeshPhongMaterial({ color: 0xffb700 }); // Orange Tank
        const tank = new THREE.Mesh(tankGeo, tankMat);
        tank.position.set(0, 1.2, 0.2);
        bikeGroup.add(tank);

        // Wheels
        const wheelGeo = new THREE.CylinderGeometry(0.6, 0.6, 0.3, 16);
        wheelGeo.rotateZ(Math.PI / 2);
        const wheelMat = new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 0.8 });

        const frontWheel = new THREE.Mesh(wheelGeo, wheelMat);
        frontWheel.position.set(0, 0.6, 1.5);
        bikeGroup.add(frontWheel);

        const backWheel = new THREE.Mesh(wheelGeo, wheelMat);
        backWheel.position.set(0, 0.6, -1.2);
        bikeGroup.add(backWheel);

        // Handlebars
        const handleGeo = new THREE.CylinderGeometry(0.05, 0.05, 1.5);
        handleGeo.rotateZ(Math.PI / 2);
        const handle = new THREE.Mesh(handleGeo, new THREE.MeshStandardMaterial({ color: 0x888888 }));
        handle.position.set(0, 1.4, 1.0);
        bikeGroup.add(handle);

        // Tail Light
        const tailLight = new THREE.PointLight(0xff0000, 1, 5);
        tailLight.position.set(0, 1, -1.2);
        bikeGroup.add(tailLight);

        // Head Light (Spotlight forward)
        const headLight = new THREE.SpotLight(0xffffff, 50);
        headLight.position.set(0, 1.2, 1.8);
        headLight.angle = 0.6;
        headLight.penumbra = 0.5;
        headLight.decay = 2;
        headLight.distance = 50;
        headLight.target.position.set(0, 0, 10);
        scene.add(headLight);
        scene.add(headLight.target);
        bikeGroup.add(headLight); // Group it so it leans with bike

        // Rider (Abstract - Iron Man Helmet ish?)
        const headGeo = new THREE.DodecahedronGeometry(0.35);
        const headMat = new THREE.MeshStandardMaterial({ color: 0x990000, roughness: 0.3, metalness: 0.8 });
        const head = new THREE.Mesh(headGeo, headMat);
        head.position.set(0, 2.1, 0.2);
        bikeGroup.add(head);

        const torsoGeo = new THREE.BoxGeometry(0.6, 0.9, 0.4);
        const torso = new THREE.Mesh(torsoGeo, new THREE.MeshStandardMaterial({ color: 0x111111 }));
        torso.position.set(0, 1.5, -0.2);
        torso.rotation.x = 0.3; // Leaning forward
        bikeGroup.add(torso);

        // --- 4. Lighting ---
        const ambientLight = new THREE.AmbientLight(0x404040, 2);
        scene.add(ambientLight);

        const streetLight = new THREE.DirectionalLight(0xffaa00, 1); // Warm street light
        streetLight.position.set(5, 10, 5);
        scene.add(streetLight);

        // --- 5. Animation Loop ---
        let speed = 0.5;

        function animate(time) {
            // Move Stripes (Infinite Road)
            stripes.forEach(s => {
                s.position.z += speed;
                if(s.position.z > 5) s.position.z -= 200; // Reset
            });

            // Move Passing Lights
            lights.forEach(l => {
                l.position.z += speed * 1.5; // Faster relative speed
                if(l.position.z > 10) {
                    l.position.z -= 200 + Math.random() * 50;
                    l.position.x = (Math.random() > 0.5 ? 1 : -1) * (5 + Math.random()*5);
                }
            });

            // Wheel Spin
            frontWheel.rotation.x -= speed * 0.5;
            backWheel.rotation.x -= speed * 0.5;

            // Engine Vibration
            bikeGroup.position.y = Math.sin(time * 20) * 0.005;

            renderer.render(scene, camera);
        }

        // Use GSAP ticker
        gsap.ticker.add(animate);

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- 6. Scroll Interaction (GSAP) ---
        gsap.registerPlugin(ScrollTrigger);

        // Calculate total scroll distance
        // The scroll-spacer is 600vh.

        // Bike Lean & Lane Change
        gsap.to(bikeGroup.rotation, {
            z: 0.2, // Lean right
            scrollTrigger: {
                trigger: "#scroll-spacer",
                start: "top top",
                end: "bottom bottom",
                scrub: 2, // Smooth scrubbing
            }
        });

        gsap.to(bikeGroup.position, {
            x: 2, // Move right
            scrollTrigger: {
                trigger: "#scroll-spacer",
                start: "top top",
                end: "bottom bottom",
                scrub: 2,
            }
        });

        // Sections Visibility Logic
        const contentSections = document.querySelectorAll('.content-section');
        contentSections.forEach((section, index) => {
            // Ensure first section starts active if not already handled by CSS
            if (index === 0) {
                 gsap.set(section, { opacity: 1, pointerEvents: 'auto' });
            }

            // Using ScrollTrigger directly on spacing
            ScrollTrigger.create({
                trigger: "#scroll-spacer",
                start: `${(index) * 100}vh top`, // Trigger every 100vh
                end: `${(index + 1) * 100}vh top`,
                onEnter: () => gsap.to(section, { opacity: 1, pointerEvents: 'auto', duration: 0.5 }),
                onLeave: () => gsap.to(section, { opacity: 0, pointerEvents: 'none', duration: 0.5 }),
                onEnterBack: () => gsap.to(section, { opacity: 1, pointerEvents: 'auto', duration: 0.5 }),
                onLeaveBack: () => gsap.to(section, { opacity: 0, pointerEvents: 'none', duration: 0.5 })
            });

            // Animate card inside
            const card = section.querySelector('.data-card');
            if(card) {
                gsap.fromTo(card,
                    { y: 100, opacity: 0, rotation: 5 },
                    {
                        y: 0, opacity: 1, rotation: 0, duration: 0.8, ease: "back.out(1.7)",
                        scrollTrigger: {
                            trigger: "#scroll-spacer",
                            start: `${(index) * 100}vh top`,
                            toggleActions: "play reverse play reverse"
                        }
                    }
                );
            }
        });

        // Initial Refresh to ensure triggers are correct
        ScrollTrigger.refresh();

    </script>
</body>
</html>
