<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xiaoshi | The Drifter</title>
    <meta name="description" content="A wanderer of the streets. Manpower specialist, queuing expert, odd jobs.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Noto+Sans+TC:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --bg-color: #080808;
            --text-color: #d0d0d0;
            --accent-orange: #ffb700;
            --accent-tape: #f0e68c;
            --rain-blue: #4a6fa5;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
            width: 100vw;
            scrollbar-width: none;
        }
        body::-webkit-scrollbar { display: none; }

        h1, h2, h3, .street-font { font-family: 'Oswald', sans-serif; text-transform: uppercase; }

        /* --- Canvas Wrapper --- */
        #webgl-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* --- Scroll Spacer --- */
        #scroll-spacer {
            height: 600vh; /* Increased for longer ride */
            width: 100%;
            position: absolute;
            top: 0; left: 0;
            z-index: -1;
            pointer-events: none;
        }

        /* --- Navigation --- */
        .nav-back {
            position: fixed; top: 2rem; left: 2rem; z-index: 100; font-size: 1.2rem;
            color: #000; text-decoration: none; font-family: 'Oswald'; font-weight: 700;
            background: var(--accent-orange); padding: 0.5rem 1rem;
            transform: rotate(-2deg);
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
            transition: 0.3s;
        }
        .nav-back:hover { transform: rotate(0deg) scale(1.1); }

        /* --- Rider Overlay --- */
        #rider-container {
            position: fixed;
            top: 15%; /* Start higher */
            left: 50%;
            transform: translateX(-50%);
            z-index: 5; /* Below content but above canvas */
            font-size: 3rem;
            color: var(--accent-orange);
            text-shadow: 0 5px 10px rgba(0,0,0,0.8);
            pointer-events: none;
            background: #000;
            padding: 10px;
            border-radius: 50%;
            border: 2px solid var(--accent-orange);
            will-change: transform;
        }

        #route-line {
            position: fixed;
            top: 0;
            left: 50%;
            width: 4px;
            height: 0; /* Animated */
            background: var(--accent-orange);
            transform: translateX(-50%);
            z-index: 4;
            box-shadow: 0 0 10px var(--accent-orange);
        }

        /* --- Content Sections --- */
        .content-section {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 10;
            opacity: 0;
            display: flex;
            padding: 5vw;
            transition: opacity 0.5s ease;
            justify-content: center;
            align-items: center;
        }
        .content-section.active { pointer-events: auto; opacity: 1; }

        /* --- Cards & UI --- */
        .data-card {
            background: rgba(10, 10, 12, 0.8);
            border: 1px solid #333;
            padding: 3rem;
            max-width: 600px;
            width: 100%;
            position: relative;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.9);
            transform: translateY(20px);
        }

        /* Tape Effect */
        .tape-label {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%) rotate(-1deg);
            background: var(--accent-tape); color: #000;
            padding: 5px 20px; font-size: 1rem; font-family: 'Oswald'; font-weight: 700;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            text-transform: uppercase;
        }

        .hero-title {
            font-size: clamp(4rem, 12vw, 8rem);
            color: #fff;
            line-height: 0.9;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 0px #000;
        }
        .hero-subtitle {
            font-size: 1.5rem; color: var(--accent-orange);
            letter-spacing: 0.1em; margin-bottom: 2rem;
            background: #000; color: #fff; padding: 0.2rem 1rem;
            display: inline-block; transform: rotate(-1deg);
        }

        .avatar-frame {
            width: 200px; height: 200px;
            margin: 0 auto 2rem auto;
            border-radius: 50%;
            border: 4px solid #fff;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .avatar-img {
            width: 100%; height: 100%; object-fit: cover;
            filter: grayscale(0.2) contrast(1.1);
        }

        p { line-height: 1.8; margin-bottom: 1rem; color: #bbb; font-size: 1.1rem; }
        strong { color: #fff; font-weight: 500; border-bottom: 1px solid var(--accent-orange); }

        /* Service Grid */
        .service-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;
        }
        .service-item {
            border: 1px solid #444;
            padding: 1.5rem;
            background: rgba(255,255,255,0.05);
            transition: 0.3s;
            position: relative;
        }
        .service-item:hover {
            border-color: var(--accent-orange);
            background: rgba(255, 183, 0, 0.1);
            transform: translateY(-5px);
        }
        .service-icon { color: var(--accent-orange); font-size: 1.5rem; margin-bottom: 1rem; display: block; }
        .service-title { font-family: 'Oswald'; color: #fff; font-size: 1.2rem; margin-bottom: 0.5rem; letter-spacing: 0.05em; }
        .service-desc { font-size: 0.9rem; color: #999; }

        /* Gallery */
        .gallery-container {
            display: flex; gap: 1rem; overflow-x: auto; padding-bottom: 1rem;
            scrollbar-width: thin; scrollbar-color: var(--accent-orange) transparent;
        }
        .gallery-img {
            height: 250px; width: auto; flex-shrink: 0;
            filter: grayscale(1) contrast(1.2); transition: 0.4s;
            cursor: pointer; border: 4px solid #fff;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
        }
        .gallery-img:hover { filter: grayscale(0); transform: scale(1.02) rotate(1deg); z-index: 5; }

        /* Finale */
        .finale-container { text-align: center; }
        .social-links { display: flex; gap: 2rem; justify-content: center; margin-top: 2rem; }
        .social-btn {
            color: #fff; font-size: 2rem; transition: 0.3s;
            width: 60px; height: 60px; border: 2px solid #fff; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
        }
        .social-btn:hover { background: var(--accent-orange); border-color: var(--accent-orange); color: #000; transform: scale(1.1); }

        /* Lightbox */
        #lightbox {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        #lightbox.active { opacity: 1; pointer-events: auto; }
        #lightbox-img { max-width: 90vw; max-height: 90vh; border: 10px solid #fff; box-shadow: 0 0 50px rgba(0,0,0,0.5); }

        @media (max-width: 768px) {
            .hero-title { font-size: 4rem; }
            .service-grid { grid-template-columns: 1fr; }
            .data-card { padding: 2rem 1.5rem; }
        }
    </style>
</head>
<body>

    <a href="/guild/" class="nav-back">GUILD</a>
    <div id="webgl-container"></div>
    <div id="scroll-spacer"></div>

    <!-- Lightbox -->
    <div id="lightbox" onclick="this.classList.remove('active')">
        <img id="lightbox-img" src="">
    </div>

    <!-- Route UI -->
    <div id="route-line"></div>
    <div id="rider-container">
        <i class="fa-solid fa-motorcycle"></i>
    </div>

    <!-- 1. Hero -->
    <div id="sec-hero" class="content-section active">
        <div style="text-align: center;">
            <div class="avatar-frame">
                <img src="/assets/img/guild/xiaoshi/avatar.webp" class="avatar-img" alt="Xiaoshi">
            </div>
            <h1 class="hero-title">XIAOSHI</h1>
            <div class="hero-subtitle">The Happy-Go-Lucky Drifter</div>
        </div>
    </div>

    <!-- 2. Profile / Bio -->
    <div id="sec-profile" class="content-section">
        <div class="data-card">
            <div class="tape-label">Who I Am</div>
            <p style="margin-top: 1rem;">
                我是<strong>小獅</strong>。<br>
                一個從基層爬起，被社會毒打的打工人。
            </p>
            <p>
                加入某奇怪論壇跑腿幫，已經將近20年。<br>
                目前是遊走各地的接案者，主要是雙北～但各地都會跑。
            </p>
            <p>
                有些案件的特殊性，會引起我的好奇心，所以工作一切以獨行為主。<br>
                要是那天真的剋死異鄉，所以趕快找尋公會加入～哈哈哈。
            </p>
            <p style="text-align: right; margin-top: 2rem; font-style: italic; color: var(--accent-orange);">
                法號～樂天a小獅
            </p>
        </div>
    </div>

    <!-- 3. Services -->
    <div id="sec-services" class="content-section">
        <div class="data-card">
            <div class="tape-label">What I Do</div>
            <div class="service-grid">
                <div class="service-item">
                    <i class="fa-solid fa-people-carry-box service-icon"></i>
                    <div class="service-title">MANPOWER</div>
                    <div class="service-desc">人力調度，各類臨時支援。</div>
                </div>
                <div class="service-item">
                    <i class="fa-solid fa-broom service-icon"></i>
                    <div class="service-title">CLEANING</div>
                    <div class="service-desc">居家服務，掃墓清潔，深層清理。</div>
                </div>
                <div class="service-item">
                    <i class="fa-solid fa-stopwatch service-icon"></i>
                    <div class="service-title">QUEUING</div>
                    <div class="service-desc">代排隊，限量美食，活動搶票。</div>
                </div>
                <div class="service-item">
                    <i class="fa-solid fa-utensils service-icon"></i>
                    <div class="service-title">FOOD SCOUT</div>
                    <div class="service-desc">美食獵人，部落客開拓，專業吃貨。</div>
                </div>
                <div class="service-item">
                    <i class="fa-solid fa-user-tie service-icon"></i>
                    <div class="service-title">BUTLER</div>
                    <div class="service-desc">專業管家服務，協助陪伴，代跑腿。</div>
                </div>
                <div class="service-item">
                    <i class="fa-solid fa-motorcycle service-icon"></i>
                    <div class="service-title">DRIFTER</div>
                    <div class="service-desc">萬事屋風格，只要有趣，使命必達。</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. Visual Logs -->
    <div id="sec-gallery" class="content-section">
        <div class="data-card" style="max-width: 900px; padding: 2rem;">
            <div class="tape-label">Drifter Logs</div>
            <div class="gallery-container">
                <img src="/assets/img/guild/xiaoshi/gallery_01.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_02.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_03.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_04.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_05.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_06.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_07.webp" class="gallery-img" onclick="openLightbox(this.src)">
                <img src="/assets/img/guild/xiaoshi/gallery_08.webp" class="gallery-img" onclick="openLightbox(this.src)">
            </div>
            <p style="margin-top: 1rem; font-size: 0.9rem; text-align: center; color: #666;">
                <i class="fa-solid fa-arrow-left"></i> SCROLL <i class="fa-solid fa-arrow-right"></i>
            </p>
        </div>
    </div>

    <!-- 5. Finale -->
    <div id="sec-finale" class="content-section">
        <div class="finale-container">
            <h1 class="hero-title" style="font-size: 3rem;">CONTACT</h1>
            <p style="font-size: 1.5rem; margin-bottom: 2rem; font-family: 'Oswald';">"Have a weird job? Call me."</p>

            <div class="social-links">
                <a href="https://www.threads.net/@iabc5040" target="_blank" class="social-btn"><i class="fa-brands fa-threads"></i></a>
                <a href="https://www.instagram.com/iabc5040/" target="_blank" class="social-btn"><i class="fa-brands fa-instagram"></i></a>
            </div>

            <div style="margin-top: 4rem; opacity: 0.5; font-size: 0.8rem;">
                © 2024 Xiaoshi. All Rights Reserved.
            </div>
        </div>
    </div>

    <script>
        function openLightbox(src) {
            document.getElementById('lightbox-img').src = src;
            document.getElementById('lightbox').classList.add('active');
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- 1. Scene Setup ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050505, 0.03); // Deep fog for infinite look

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 3, 6); // Behind and slightly above
        camera.lookAt(0, 1, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- 2. Simple Rain Environment (Static Road) ---
        // Just keeping the atmosphere, removing speed elements

        // --- 4. Lighting ---
        const ambientLight = new THREE.AmbientLight(0x404040, 2);
        scene.add(ambientLight);

        // --- 5. Animation Loop ---
        // Simple rain shader updates handled in shader logic if we added it back,
        // but currently we just have an empty scene. Let's add simple stars/rain particles.

        const particlesGeo = new THREE.BufferGeometry();
        const particleCount = 2000;
        const posArray = new Float32Array(particleCount * 3);

        for(let i=0; i<particleCount*3; i++) {
            posArray[i] = (Math.random() - 0.5) * 100;
        }

        particlesGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particleMat = new THREE.PointsMaterial({
            size: 0.1, color: 0x4a6fa5, transparent: true, opacity: 0.8
        });
        const particles = new THREE.Points(particlesGeo, particleMat);
        scene.add(particles);

        function animate(time) {
            // Gentle rain fall without forward speed
            const positions = particles.geometry.attributes.position.array;
            for(let i=1; i<particleCount*3; i+=3) {
                positions[i] -= 0.1;
                if(positions[i] < -50) positions[i] = 50;
            }
            particles.geometry.attributes.position.needsUpdate = true;

            renderer.render(scene, camera);
        }

        // Use GSAP ticker
        gsap.ticker.add(animate);

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- 6. Scroll Interaction (GSAP) ---
        gsap.registerPlugin(ScrollTrigger);

        const riderIcon = document.getElementById('rider-container');
        const routeLine = document.getElementById('route-line');
        const contentSections = document.querySelectorAll('.content-section');

        // Master Timeline linked to #scroll-spacer
        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: "#scroll-spacer",
                start: "top top",
                end: "bottom bottom",
                scrub: 0.5 // Unified scrub for smoother sync
            }
        });

        // 1. Draw Line Downwards (0 -> 100vh)
        tl.to(routeLine, { height: "100vh", ease: "none" }, 0);

        // 2. Move Rider Downwards (Along the line)
        // Use functional value for responsive recalc
        tl.to(riderIcon, {
            y: () => window.innerHeight * 0.65,
            ease: "none"
        }, 0);

        // 3. Sections Visibility Logic (Integrated)
        contentSections.forEach((section, index) => {
            // Initial state
            if (index === 0) gsap.set(section, { opacity: 1, pointerEvents: 'auto' });

            // Trigger visibility based on spacer progress
            ScrollTrigger.create({
                trigger: "#scroll-spacer",
                start: `${index * 100}vh top`,
                end: `${(index + 1) * 100}vh top`,
                onEnter: () => gsap.to(section, { opacity: 1, pointerEvents: 'auto', duration: 0.5 }),
                onLeave: () => gsap.to(section, { opacity: 0, pointerEvents: 'none', duration: 0.5 }),
                onEnterBack: () => gsap.to(section, { opacity: 1, pointerEvents: 'auto', duration: 0.5 }),
                onLeaveBack: () => gsap.to(section, { opacity: 0, pointerEvents: 'none', duration: 0.5 })
            });

            // Card Animations
            const card = section.querySelector('.data-card');
            if(card) {
                gsap.fromTo(card,
                    { y: 100, opacity: 0, rotation: 5 },
                    {
                        y: 0, opacity: 1, rotation: 0, duration: 0.8, ease: "back.out(1.7)",
                        scrollTrigger: {
                            trigger: "#scroll-spacer",
                            start: `${index * 100}vh top`,
                            toggleActions: "play reverse play reverse"
                        }
                    }
                );
            }
        });

        // Initial Refresh to ensure triggers are correct
        ScrollTrigger.refresh();

    </script>
</body>
</html>
