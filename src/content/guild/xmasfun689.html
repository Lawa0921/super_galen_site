<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XmasFun | Construction Mage</title>
    <meta name="description" content="XmasFun - Site Manager, Heavy Machinery Operator, and Elemental Mage.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Noto+Sans+TC:wght@400;700;900&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Libraries -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --c-safety: #FFD700; /* Construction Yellow */
            --c-earth: #8B4513;
            --c-water: #00BFFF;
            --c-electric: #7DF9FF;
            --c-dark: #050505;
            --c-concrete: #2a2a2a;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--c-dark);
            color: #fff;
            font-family: 'Noto Sans TC', sans-serif;
            overflow-x: hidden;
            width: 100vw;
        }

        /* --- Three.js Canvas --- */
        #webgl-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none;
        }

        /* --- Scroll Spacer --- */
        #scroll-spacer {
            height: 800vh; /* Extended for more "flight" time */
            width: 100%;
        }

        /* --- UI Overlay --- */
        .hud-border {
            position: fixed; pointer-events: none; z-index: 10;
            border: 2px solid rgba(255, 215, 0, 0.2);
            width: calc(100% - 40px); height: calc(100% - 40px);
            top: 20px; left: 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 10%, transparent 90%, rgba(0,0,0,0.8) 100%);
        }

        .hero-title {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Black Ops One', cursive;
            font-size: clamp(3rem, 12vw, 10rem);
            color: transparent;
            -webkit-text-stroke: 2px var(--c-safety);
            text-align: center;
            z-index: 5; pointer-events: none;
            white-space: nowrap;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }
        .hero-title.fill { color: var(--c-safety); -webkit-text-stroke: 0; opacity: 0; mix-blend-mode: overlay; }

        /* --- Cards --- */
        .panel {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            pointer-events: none; opacity: 0; z-index: 20; padding: 20px;
        }

        .card {
            background: rgba(10, 10, 10, 0.8);
            border-left: 5px solid var(--c-safety);
            border-top: 1px solid #333;
            border-bottom: 1px solid #333;
            border-right: 1px solid #333;
            padding: 2.5rem;
            max-width: 500px; width: 100%;
            backdrop-filter: blur(5px);
            pointer-events: auto;
            transform: skew(-5deg);
            box-shadow: 15px 15px 0px rgba(255, 215, 0, 0.1);
        }

        .card h2 {
            font-family: 'Black Ops One'; color: var(--c-safety);
            margin: 0 0 1rem 0; font-size: 2.5rem; text-transform: uppercase;
            letter-spacing: 0.1em;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        .card p { font-size: 1.2rem; line-height: 1.8; color: #ddd; transform: skew(5deg); }

        .highlight { color: #fff; background: rgba(255, 215, 0, 0.2); padding: 0 5px; }

        /* Back Button */
        .back-btn {
            position: fixed; top: 30px; left: 30px;
            color: var(--c-safety); font-family: 'Black Ops One'; text-decoration: none;
            font-size: 1.2rem; z-index: 100;
            border: 1px solid var(--c-safety); padding: 10px 20px;
            background: rgba(0,0,0,0.8); pointer-events: auto;
        }

        /* Finale */
        #finale {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--c-dark); z-index: 99;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none;
        }
        #finale.active { opacity: 1; pointer-events: auto; }

        .avatar-circle {
            width: 250px; height: 250px; border-radius: 50%;
            border: 8px solid var(--c-safety); overflow: hidden; margin-bottom: 2rem;
            box-shadow: 0 0 50px var(--c-safety);
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { box-shadow: 0 0 30px var(--c-safety); } 50% { box-shadow: 0 0 60px var(--c-safety); } 100% { box-shadow: 0 0 30px var(--c-safety); } }
        .avatar-circle img { width: 100%; height: 100%; object-fit: cover; }

        .social-links a { color: #fff; font-size: 3rem; margin: 0 1rem; transition: 0.3s; }
        .social-links a:hover { color: var(--c-safety); transform: scale(1.2); text-shadow: 0 0 20px var(--c-safety); }

    </style>
</head>
<body>

    <a href="/guild/" class="back-btn">GUILD // EXIT</a>
    <div id="webgl-container"></div>
    <div id="scroll-spacer"></div>

    <div class="hud-border"></div>

    <!-- Hero -->
    <div class="hero-title" id="hero-outline">CONSTRUCTION<br>MAGE</div>
    <div class="hero-title fill" id="hero-fill">CONSTRUCTION<br>MAGE</div>

    <!-- Panel 1: Machinery -->
    <div class="panel" id="panel-1" style="justify-content: flex-start; padding-left: 10%;">
        <div class="card">
            <h2>// Heavy Gear</h2>
            <p><strong>工地主任</strong> / <strong>重機械操作員</strong></p>
            <p>喜歡實作與重型機械的浪漫。<br>會開怪手、吊車、自走車。</p>
            <p style="margin-top: 1rem; font-size: 0.9rem; color: #888;">(雖然差一點就考到證照了...)</p>
        </div>
    </div>

    <!-- Panel 2: Elements -->
    <div class="panel" id="panel-2" style="justify-content: flex-end; padding-right: 10%;">
        <div class="card">
            <h2>// Elemental</h2>
            <p>朋友口中的 <strong style="color:var(--c-water)">水</strong> & <strong style="color:var(--c-electric)">電</strong> & <strong style="color:var(--c-earth)">土</strong> 三系法師。</p>
            <p>擁有水電證照的斜槓水電工。</p>
            <div style="margin-top:1rem; font-size: 2rem; display: flex; gap: 1rem;">
                <i class="fa-solid fa-bolt" style="color:var(--c-electric)"></i>
                <i class="fa-solid fa-droplet" style="color:var(--c-water)"></i>
                <i class="fa-solid fa-cubes" style="color:var(--c-earth)"></i>
            </div>
        </div>
    </div>

    <!-- Panel 3: Personal -->
    <div class="panel" id="panel-3">
        <div class="card" style="text-align: center; max-width: 600px;">
            <h2>// Warrior Soul</h2>
            <p>雖然被說是法師，但擁有<strong>戰士的體質</strong>。</p>
            <p>從小胖到現在，HP 條極厚。</p>
            <hr style="border-color: #444; margin: 2rem 0;">
            <p>喜歡 <strong>猴子布偶</strong> & <strong>Kururu 曹長</strong></p>
            <p>遊戲偏好：召喚師 (Solo Player)</p>
        </div>
    </div>

    <!-- Finale -->
    <div id="finale">
        <div class="avatar-circle">
            <img src="/assets/img/guild/xmasfun689/avatar.webp" alt="Avatar">
        </div>
        <h1 style="font-family: 'Black Ops One'; font-size: 4rem; color: var(--c-safety); margin: 0; text-transform: uppercase;">XmasFun</h1>
        <p style="font-family: 'Oswald'; font-size: 1.5rem; letter-spacing: 0.5em; color: #888; margin-bottom: 2rem;">SITE MANAGER // LEVEL 8</p>
        <div class="social-links">
            <a href="https://www.threads.net/@xmasfun689" target="_blank"><i class="fa-brands fa-threads"></i></a>
            <a href="https://www.instagram.com/xmasfun689/" target="_blank"><i class="fa-brands fa-instagram"></i></a>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';

        // --- Init ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);
        scene.fog = new THREE.FogExp2(0x050505, 0.015);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 2, 10);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- Assets ---
        const textureLoader = new THREE.TextureLoader();
        const texExcavator = textureLoader.load('/assets/img/guild/xmasfun689/excavator.webp');
        const texRoller = textureLoader.load('/assets/img/guild/xmasfun689/roller.webp');
        const texPlushies = textureLoader.load('/assets/img/guild/xmasfun689/plushies.webp');

        // --- Objects ---

        // 1. Grid Floor (Infinite Construction Site)
        const gridHelper = new THREE.GridHelper(200, 100, 0x333333, 0x111111);
        scene.add(gridHelper);

        // Hazard Stripes on Floor
        const planeGeo = new THREE.PlaneGeometry(200, 200);
        const planeMat = new THREE.MeshBasicMaterial({ color: 0x050505, side: THREE.DoubleSide }); // Dark floor to hide below grid
        const floor = new THREE.Mesh(planeGeo, planeMat);
        floor.rotation.x = -Math.PI / 2;
        floor.position.y = -0.1;
        scene.add(floor);

        // 2. Heavy Machinery (Floating Planes)
        function createSpritePlane(texture, width, height, x, y, z) {
            const mat = new THREE.MeshBasicMaterial({ map: texture, transparent: true, side: THREE.DoubleSide });
            const geo = new THREE.PlaneGeometry(width, height);
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set(x, y, z);
            scene.add(mesh);
            return mesh;
        }

        const excavator = createSpritePlane(texExcavator, 12, 12, 5, 4, -20);
        const roller = createSpritePlane(texRoller, 10, 10, -5, 3, -25); // Start hidden further back
        const plushies = createSpritePlane(texPlushies, 8, 8, 0, 3, -100);

        // 3. Elemental Groups
        const earthGroup = new THREE.Group();
        const waterGroup = new THREE.Group();
        const thunderGroup = new THREE.Group();
        scene.add(earthGroup);
        scene.add(waterGroup);
        scene.add(thunderGroup);

        // Earth: Floating Rocks
        const rockGeo = new THREE.IcosahedronGeometry(1, 0);
        const rockMat = new THREE.MeshStandardMaterial({ color: 0x8B4513, roughness: 0.9, flatShading: true });
        for(let i=0; i<15; i++) {
            const rock = new THREE.Mesh(rockGeo, rockMat);
            rock.position.set((Math.random()-0.5)*30, Math.random()*10, -40 + (Math.random()*20));
            rock.scale.setScalar(0.5 + Math.random());
            rock.rotation.set(Math.random(), Math.random(), Math.random());
            earthGroup.add(rock);
        }

        // Water: Bubbles
        const bubbleGeo = new THREE.SphereGeometry(0.5, 16, 16);
        const bubbleMat = new THREE.MeshPhysicalMaterial({
            color: 0x00BFFF, transmission: 0.9, opacity: 1, transparent: true, roughness: 0, metalness: 0.1
        });
        for(let i=0; i<30; i++) {
            const bubble = new THREE.Mesh(bubbleGeo, bubbleMat);
            bubble.position.set((Math.random()-0.5)*20, Math.random()*15, -45 + (Math.random()*15));
            waterGroup.add(bubble);
        }

        // Thunder: Lightning Bolts (Lines)
        // We will create dynamic lightning in animation loop, but here is static "energy"
        const lightningGeo = new THREE.BufferGeometry();
        const lightningCount = 50;
        const lPos = new Float32Array(lightningCount * 3);
        // ... just random points for now, updated in loop
        lightningGeo.setAttribute('position', new THREE.BufferAttribute(lPos, 3));
        const lightningMat = new THREE.PointsMaterial({ color: 0x7DF9FF, size: 0.5, transparent: true });
        const lightning = new THREE.Points(lightningGeo, lightningMat);
        lightning.position.z = -50;
        thunderGroup.add(lightning);

        // Lights
        const light = new THREE.PointLight(0xFFD700, 2, 50);
        light.position.set(0, 10, 10);
        scene.add(light);
        const ambient = new THREE.AmbientLight(0x404040, 2); // Brighter ambient
        scene.add(ambient);

        // --- GSAP Timeline ---
        gsap.registerPlugin(ScrollTrigger);

        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: "#scroll-spacer",
                start: "top top",
                end: "bottom bottom",
                scrub: 0.5
            }
        });

        // 0. Hero (Fade out)
        tl.to(["#hero-outline", "#hero-fill"], { opacity: 0, scale: 2, z: 100, duration: 0.5 }); // Fly into text

        // 1. Move to Machinery Section (z: 0 -> -20)
        tl.to(camera.position, { z: -15, ease: "none", duration: 2 });
        // Animate Excavator
        tl.fromTo(excavator.position, { x: 20 }, { x: 5, ease: "power2.out", duration: 2 }, "<");
        tl.fromTo(excavator.rotation, { y: Math.PI/2 }, { y: -0.2, duration: 2 }, "<");

        // Panel 1 Reveal
        tl.to("#panel-1", { opacity: 1, duration: 0.5 }, "-=1.5");
        tl.to("#panel-1", { opacity: 0, duration: 0.5 }, "-=0.5");

        // 2. Move to Elemental Section (z: -15 -> -45)
        tl.to(camera.position, { z: -40, ease: "none", duration: 2 });
        // Roller enters from left
        tl.fromTo(roller.position, { x: -20, z: -40 }, { x: -6, z: -35, ease: "power2.out", duration: 2 }, "<");
        tl.to(roller.rotation, { y: 0.5, duration: 2 }, "<");

        // Reveal Elements
        tl.from(earthGroup.position, { y: -20, duration: 1 }, "<"); // Rocks rise
        tl.from(waterGroup.scale, { x:0, y:0, z:0, duration: 1 }, "<0.5"); // Bubbles expand

        // Panel 2 Reveal
        tl.to("#panel-2", { opacity: 1, duration: 0.5 }, "-=1.5");
        tl.to("#panel-2", { opacity: 0, duration: 0.5 }, "-=0.5");

        // 3. Move to Personal Section (z: -40 -> -90)
        tl.to(camera.position, { z: -85, ease: "none", duration: 2 });

        // Plushies Appear
        tl.fromTo(plushies.position, { y: 20, z: -100 }, { y: 3, z: -90, duration: 2 }, "<");
        tl.to(plushies.rotation, { z: 0.2, yoyo: true, repeat: 3, duration: 0.5 }, "<");

        // Panel 3 Reveal
        tl.to("#panel-3", { opacity: 1, duration: 0.5 }, "-=1.5");
        tl.to("#panel-3", { opacity: 0, duration: 0.5 }, "-=0.5");

        // 4. Finale (Avatar)
        tl.to("#finale", { opacity: 1, pointerEvents: "auto", duration: 1 });


        // --- Animation Loop ---
        const clock = new THREE.Clock();

        function animate() {
            const t = clock.getElapsedTime();

            // Hover effects
            excavator.position.y = 4 + Math.sin(t) * 0.2;
            roller.position.y = 3 + Math.sin(t + 1) * 0.2;
            plushies.position.y = 3 + Math.sin(t + 2) * 0.3;

            // Rotate Elements
            earthGroup.children.forEach((rock, i) => {
                rock.rotation.x += 0.01;
                rock.rotation.y += 0.02;
            });
            waterGroup.children.forEach((b, i) => {
                b.position.y += Math.sin(t + i) * 0.02;
            });

            // Lightning Flash (Simple)
            if (Math.random() > 0.95) {
                lightningMat.opacity = 1;
                lightningMat.color.setHex(0xFFFFFF);
                // Scramble positions
                const positions = lightningGeo.attributes.position.array;
                for(let i=0; i<lightningCount*3; i+=3) {
                    positions[i] = (Math.random()-0.5)*20;
                    positions[i+1] = Math.random()*20;
                    positions[i+2] = (Math.random()-0.5)*10;
                }
                lightningGeo.attributes.position.needsUpdate = true;
            } else {
                lightningMat.opacity *= 0.9; // Fade out
                lightningMat.color.setHex(0x7DF9FF);
            }

            renderer.render(scene, camera);
        }
        gsap.ticker.add(animate);

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>