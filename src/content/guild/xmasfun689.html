<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XmasFun689 - Arcane Industrial Complex</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Share+Tech+Mono&family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>

    <style>
        :root {
            --c-void: #050508;
            --c-gold: #FFD700;
            --c-plasma: #00F3FF;
            --c-water: #0088ff;
            --c-alert: #ff3333;

            --f-magic: 'Cinzel', serif;
            --f-tech: 'Share Tech Mono', monospace;
            --f-body: 'Noto Serif TC', serif;
        }

        * { box-sizing: border-box; }
        body { margin: 0; background: transparent; color: white; font-family: var(--f-body); overflow-x: hidden; }

        /* WebGL */
        #webgl-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0; pointer-events: none; }

        /* P5 Canvas */
        #p5-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1; pointer-events: auto; background: var(--c-void); }

        /* Loader */
        #loader {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .loader-text { font-family: var(--f-tech); color: var(--c-gold); font-size: 1.2rem; letter-spacing: 3px; }
        .loader-bar { width: 150px; height: 2px; background: #333; margin-top: 10px; position: relative; overflow: hidden; }
        .loader-fill { position: absolute; left: 0; top: 0; height: 100%; width: 0%; background: var(--c-gold); }

        /* Layout */
        .scroller { position: relative; z-index: 10; padding-bottom: 20vh; }

        .section {
            min-height: 100vh;
            display: flex; align-items: center;
            padding: 4rem 5%;
            pointer-events: none;
        }

        /* Top Node Element */
        .node-marker {
            position: absolute; top: 5vh; left: 50%; transform: translateX(-50%);
            text-align: center; pointer-events: auto; z-index: 20;
        }
        .node-icon {
            font-size: 2.5rem; color: var(--c-plasma);
            animation: pulse-glow 2s infinite;
            text-shadow: 0 0 20px var(--c-plasma);
        }
        .node-label {
            font-family: var(--f-tech); font-size: 1rem; color: var(--c-plasma);
            letter-spacing: 2px; margin-top: 0.5rem; opacity: 0.8; font-weight: bold;
        }

        @keyframes pulse-glow {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); text-shadow: 0 0 30px var(--c-plasma); }
        }

        /* Magic Data Slate */
        .data-slate {
            pointer-events: auto;
            width: 100%; max-width: 550px;
            background: rgba(10, 12, 16, 0.85);
            border: 1px solid rgba(255, 215, 0, 0.15);
            backdrop-filter: blur(10px);
            padding: 3rem;
            position: relative;
            transform: perspective(1000px) rotateY(5deg);
            opacity: 0; /* GSAP */
            box-shadow: -20px 20px 60px rgba(0,0,0,0.5);
        }

        .data-slate::before {
            content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%;
            background: linear-gradient(to bottom, var(--c-gold), transparent);
        }

        /* Elemental Accents */
        .slate-earth { border-color: var(--c-gold); }
        .slate-earth::before { background: var(--c-gold); }

        .slate-water { border-color: var(--c-water); }
        .slate-water::before { background: var(--c-water); }

        .slate-plasma { border-color: var(--c-plasma); }
        .slate-plasma::before { background: var(--c-plasma); }

        /* Typography */
        h1 { font-family: var(--f-magic); font-size: 3.5rem; margin: 0; line-height: 1; text-transform: uppercase; color: white; text-shadow: 0 0 20px rgba(255,215,0,0.3); }
        h2 { font-family: var(--f-magic); font-size: 2.2rem; margin: 0 0 1rem; color: white; display: flex; align-items: center; gap: 1rem; }
        .sub-code { font-family: var(--f-tech); color: #888; font-size: 0.85rem; letter-spacing: 2px; margin-bottom: 1.5rem; display: block; border-bottom: 1px dashed rgba(255,255,255,0.1); padding-bottom: 0.5rem; }

        p { color: #ccc; line-height: 1.8; font-size: 1.1rem; margin-bottom: 1.5rem; text-align: justify; }

        .highlight { color: white; font-weight: bold; }
        .gold { color: var(--c-gold); }
        .cyan { color: var(--c-plasma); }
        .blue { color: var(--c-water); }

        /* Images */
        .holo-frame {
            padding: 5px; border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.02); margin-bottom: 1.5rem;
        }
        .holo-img { width: 100%; display: block; filter: contrast(1.1); }

        /* Skill Grid */
        .skill-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; }
        .skill-item {
            display: flex; align-items: center; gap: 10px;
            font-family: var(--f-tech); font-size: 0.9rem; color: #aaa;
            border: 1px solid rgba(255,255,255,0.1); padding: 10px;
        }
        .skill-item i { font-size: 1.2rem; }

        /* Footer */
        .footer {
            height: 40vh; display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: linear-gradient(to top, #000, transparent); pointer-events: auto;
        }
        .social-bar { display: flex; gap: 1.5rem; margin-bottom: 1.5rem; }
        .social-btn {
            width: 60px; height: 60px; border: 1px solid #444; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: white;
            transition: 0.3s; background: rgba(0,0,0,0.8);
            text-decoration: none; /* Important for icon links */
        }
        .social-btn:hover { border-color: var(--c-gold); color: var(--c-gold); transform: scale(1.1); box-shadow: 0 0 20px var(--c-gold); }
        .social-btn svg { width: 24px; height: 24px; fill: currentColor; }

        @media (max-width: 768px) {
            .section { padding: 4rem 1.5rem; justify-content: center; }
            .data-slate { padding: 2rem; transform: none !important; }
            h1 { font-size: 2.5rem; }
            .node-marker { top: 3vh; }
        }
    </style>
</head>
<body>

    <div id="loader">
        <div class="loader-text">ARCANE FORGE ONLINE</div>
        <div class="loader-bar"><div class="loader-fill" id="load-bar"></div></div>
    </div>

    <!-- Background Layers -->
    <div id="p5-container"></div>
    <div id="webgl-container"></div>

    <div class="scroller">

        <!-- Top Node / Endpoint -->
        <div class="node-marker">
            <div class="node-icon"><i class="fa-solid fa-atom"></i></div>
            <div class="node-label">MAGITEK CORE</div>
        </div>

        <!-- 1. Hero -->
        <section class="section" style="margin-top: 10vh;">
            <div class="data-slate slate-earth">
                <div style="display:flex; align-items:center; gap:1.5rem; margin-bottom:2rem;">
                    <div style="position:relative;">
                        <img src="/assets/img/guild/xmasfun689/avatar.webp" style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:2px solid var(--c-gold);">
                        <div style="position:absolute; bottom:-5px; right:-5px; background:var(--c-void); border:1px solid var(--c-gold); padding:2px 8px; font-size:0.7rem; font-family:var(--f-tech); color:var(--c-gold);">LV.8</div>
                    </div>
                    <div>
                        <span class="sub-code" style="margin:0; border:none; color:var(--c-plasma);">// SITE COMMANDER</span>
                        <h1>Magitek<br>Warlord</h1>
                    </div>
                </div>
                <p>
                    「擁有<b>戰士的體格</b>，卻守護著<b>召喚師的靈魂</b>。」
                </p>
                <p>
                    在這個鋼鐵與粉塵交織的迷宮中，我是引導秩序的魔導士。
                    八年的工地煉金術，將汗水與意志熔鑄成城市的基石。
                    我手握雷電與流水，駕馭著大地的鋼鐵巨獸。
                </p>
                <div class="skill-grid">
                    <div class="skill-item"><i class="fa-solid fa-hammer gold"></i> STR: S+</div>
                    <div class="skill-item"><i class="fa-solid fa-brain cyan"></i> INT: A</div>
                    <div class="skill-item"><i class="fa-solid fa-shield-halved gold"></i> DEF: S</div>
                    <div class="skill-item"><i class="fa-solid fa-wand-magic-sparkles cyan"></i> MANA: High</div>
                </div>
            </div>
        </section>

        <!-- 2. Earth (Heavy Machinery) -->
        <section class="section">
            <div class="data-slate slate-earth">
                <span class="sub-code">SECTOR 01: EARTH & STEEL</span>
                <h2><i class="fa-solid fa-layer-group gold"></i> Terraforming</h2>
                <div class="holo-frame">
                    <img src="/assets/img/guild/xmasfun689/excavator.webp" class="holo-img">
                </div>
                <p>
                    <b>大地魔像 (Excavator)</b><br>
                    我的首席召喚獸。這隻鋼鐵手臂能輕易撕裂大地，重塑地形。
                    雖然與執照擦肩而過（嘆），但這份操作手感早已刻入靈魂。在轟鳴聲中，我與它合而為一。
                </p>
                <p>
                    <b>鎮壓巨獸 (Roller)</b><br>
                    秩序的維護者。以絕對的重量碾平一切崎嶇，為未來的建築鋪設最堅實的基礎。
                </p>
                <div class="skill-grid">
                    <div class="skill-item" style="border-color:var(--c-gold); color:var(--c-gold);">SKILL: EXCAVATION</div>
                    <div class="skill-item" style="border-color:var(--c-gold); color:var(--c-gold);">SKILL: PAVING</div>
                </div>
            </div>
        </section>

        <!-- 3. Water & Lightning (Utility) -->
        <section class="section">
            <div class="data-slate slate-plasma">
                <span class="sub-code">SECTOR 02: FLUID & ENERGY</span>
                <h2><i class="fa-solid fa-bolt cyan"></i> Dual Arts</h2>
                <p>
                    <b>水之脈絡 (Hydro)</b><br>
                    持證水電工的奧義。建築物如同巨大的生物，而管道是它的血管。
                    我通曉流體力學，確保生命之源在其中順暢流動，冷卻這座鋼鐵森林的躁動。
                </p>
                <div style="width:100%; height:1px; background:linear-gradient(90deg, transparent, var(--c-plasma), transparent); margin:1.5rem 0;"></div>
                <p>
                    <b>雷之神經 (Electro)</b><br>
                    編織能量的網。在看不見的牆壁中，佈設著傳遞意志的神經網路。
                    朋友稱我為「水電土三系混合大法師」，因為我掌控著這座迷宮的生命律動。
                </p>
            </div>
        </section>

        <!-- 4. Soul (Sanctuary) -->
        <section class="section">
            <div class="data-slate slate-water" style="border-color: #bc13fe;">
                <span class="sub-code" style="color: #bc13fe;">SECTOR 03: INNER SANCTUARY</span>
                <h2 style="color: #bc13fe;"><i class="fa-solid fa-heart"></i> Soft Core</h2>
                <div class="holo-frame">
                    <img src="/assets/img/guild/xmasfun689/plushies.webp" class="holo-img">
                </div>
                <p>
                    <b>召喚師的秘密花園</b><br>
                    卸下重甲，戰士亦有溫柔的一面。
                    習慣了單人副本的孤獨，<b>猴子布偶</b> 與 <b>Kururu 曹長</b> 是我最忠實的使魔。
                    在這冷硬的工業世界裡，它們守護著我未曾磨滅的初心。
                </p>
            </div>
        </section>

        <footer class="footer">
            <div class="social-bar">
                <a href="https://www.threads.net/@xmasfun689" target="_blank" class="social-btn">
                    <svg viewBox="0 0 192 192"><path d="M141.537 88.9883C140.71 88.5919 139.87 88.2104 139.019 87.8451C137.537 60.5382 122.616 44.905 97.5619 44.745C97.4484 44.7443 97.3355 44.7443 97.222 44.7443C82.3586 44.7443 69.0639 51.1409 58.7414 61.5332C48.0296 72.3168 41.5234 87.1649 41.5234 103.565C41.5234 117.588 46.545 130.499 54.835 140.579C65.7337 153.834 81.3327 163.504 99.4102 166.703C102.508 167.251 105.702 167.533 108.995 167.533C116.791 167.533 124.28 165.719 131.026 162.434C132.887 161.528 133.659 159.288 132.753 157.427L129.569 150.891C128.81 149.333 127.185 148.431 125.532 148.651C120.306 149.348 114.789 149.713 108.995 149.713C86.3262 149.713 67.2458 137.067 59.2132 118.665C58.0583 116.02 57.2435 113.256 56.8154 110.383C67.6256 122.791 82.5273 130.829 99.2801 130.829C117.389 130.829 131.812 119.863 135.003 103.623C138.256 104.922 141.282 106.467 144.032 108.232C147.218 110.276 149.435 112.551 150.812 115.014C152.022 117.178 152.275 119.294 151.722 121.285C150.551 125.498 144.27 129.809 132.172 129.809C120.395 129.809 113.06 120.211 113.06 109.283V104.225C113.06 87.0544 108.57 73.0805 99.2798 64.9388C94.2798 60.5566 88.0808 58.129 80.9922 58.129C69.349 58.129 59.4586 66.8643 57.1793 79.5248C56.6366 82.5393 56.3503 85.6728 56.3503 88.8927C56.3503 112.016 70.8038 131.992 91.1396 139.754C92.4276 140.245 93.1818 141.748 92.7766 143.068L90.7397 149.72C90.2526 151.31 88.4655 152.179 86.9174 151.58C60.1065 141.205 41.5234 114.976 41.5234 88.8927C41.5234 84.1481 42.062 79.5393 43.0833 75.109C47.2343 56.9802 62.7725 43.3333 80.9922 43.3333C91.1294 43.3333 100.323 46.8049 107.458 52.6074C120.61 63.3039 127.887 81.3768 127.887 104.225V109.283C127.887 114.397 129.742 115.014 132.172 115.014C137.962 115.014 139.799 111.411 140.222 109.89C141.751 104.387 137.818 99.5544 132.766 96.6496C127.382 93.5539 121.293 91.3149 114.887 90.0243C114.004 77.0864 107.561 65.6542 97.4334 58.1566C97.3629 58.1044 97.2923 58.0524 97.2216 58.0006C117.817 58.1189 129.405 70.8129 130.569 93.1251C133.626 94.2473 136.562 95.597 139.356 97.1429C147.168 101.464 154.686 109.043 154.686 122.997C154.686 123.649 154.653 124.288 154.589 124.914C156.974 122.381 158.825 119.349 160.038 116.033C161.948 110.812 161.764 105.776 159.493 101.72C155.632 94.8213 149.098 90.7516 141.537 88.9883ZM80.9922 72.9238C85.5065 72.9238 89.6083 74.4561 92.8348 77.0163C96.345 79.8009 98.2329 83.8742 98.2329 88.8927C98.2329 93.9112 96.345 97.9845 92.8348 100.769C89.6083 103.329 85.5065 104.862 80.9922 104.862C76.4779 104.862 72.3761 103.329 69.1496 100.769C65.6394 97.9845 63.7515 93.9112 63.7515 88.8927C63.7515 83.8742 65.6394 79.8009 69.1496 77.0163C72.3761 74.4561 76.4779 72.9238 80.9922 72.9238Z"/></svg>
                </a>
                <a href="https://www.instagram.com/xmasfun689/" target="_blank" class="social-btn"><i class="fa-brands fa-instagram"></i></a>
            </div>
            <div style="font-family:var(--f-tech); font-size:0.8rem; color:#666;">MADE WITH LOVE BY SUPERGALEN'S DUNGEON</div>
        </footer>
    </div>

    <!-- P5.js Background Script -->
    <script>
        const sketch = (p) => {
            let gears = [];
            let circuits = [];
            let floaters = [];
            let mainNode;

            p.setup = () => {
                const canvas = p.createCanvas(p.windowWidth, p.windowHeight);
                canvas.parent('p5-container');
                p.angleMode(p.DEGREES);
                p.rectMode(p.CENTER);
                p.textAlign(p.CENTER, p.CENTER);
                p.textFont('monospace');

                // Init Gears - Thicker and more opaque
                // Add more gears for better background coverage
                for(let i=0; i<6; i++) {
                    gears.push(new Gear(
                        p.random(p.width),
                        p.random(p.height),
                        p.random(80, 200), // Larger gears
                        Math.floor(p.random(8, 20))
                    ));
                }

                // Init Fluid Circuits
                for(let i=0; i<15; i++) {
                    circuits.push(new FluidCircuit());
                }

                // Init Floating Data Bits
                for(let i=0; i<20; i++) {
                    floaters.push(new Floater());
                }

                // Main Node position (matches CSS .node-marker)
                mainNode = { x: p.width/2, y: p.height * 0.08, size: 20 };
            };

            p.draw = () => {
                p.clear();

                // 1. Gears (Background) - 2D Planar
                p.stroke(255, 215, 0, 100); // Gold, semi-transparent
                p.strokeWeight(3);
                p.noFill();
                gears.forEach(g => {
                    g.update();
                    g.display();
                });

                // 2. Fluid Circuits (Midground)
                circuits.forEach(c => {
                    c.update();
                    c.display();
                });

                // 3. Floating Data (Atmosphere)
                floaters.forEach(f => {
                    f.update();
                    f.display();
                });

                // 4. Plasma Beam (Foreground) - Connects Bottom to Top Node
                let scrollY = window.scrollY;
                let maxScroll = document.documentElement.scrollHeight - window.innerHeight;
                if(maxScroll <= 0) maxScroll = 1;

                // Calculate beam intensity based on scroll (Top = Strongest connection)
                // The user wants: "When scrolling UP, the plasma should extend UP to a node"
                // Let's interpret: Beam connects [Screen Bottom/Center] to [Top Node]
                // As you scroll UP (scrollY approaches 0), the connection becomes clearer/stronger.

                let scrollRatio = p.constrain(scrollY / maxScroll, 0, 1);
                // Inverse logic: Closer to top = more intense beam
                let intensity = 1 - scrollRatio * 0.5; // Always somewhat visible

                // Beam Source: Bottom of screen, following scroll?
                // Or maybe just a fixed beam that pulses?
                // "The plasma should extend upwards to a specific node"

                let startX = p.width / 2;
                let startY = p.height + 100; // Below screen
                let endX = mainNode.x;
                let endY = mainNode.y + 40; // Connect to bottom of node icon

                p.noFill();
                p.stroke(0, 243, 255, 150 + intensity * 105);
                p.strokeWeight(4 + intensity * 4);

                // Draw jagged lightning beam
                p.beginShape();
                let segments = 40;
                for(let i=0; i<=segments; i++) {
                    let t = i / segments;
                    let x = p.lerp(startX, endX, t);
                    let y = p.lerp(startY, endY, t);

                    // Noise offset for "fluid/electric" look
                    // Offset reduces near the target (Top Node) to "connect" cleanly
                    let noiseScale = 50 * (1-t); // Less noise at top
                    let xOff = (p.noise(i * 0.1, p.frameCount * 0.05) - 0.5) * noiseScale * 4;

                    p.vertex(x + xOff, y);
                }
                p.endShape();

                // 5. Node Visuals - Always Active/Scanning
                p.noFill();
                p.stroke(0, 243, 255, 80);
                p.strokeWeight(2);
                p.ellipse(mainNode.x, mainNode.y, 90);

                // Inner Spin
                p.push();
                p.translate(mainNode.x, mainNode.y);
                p.rotate(p.frameCount * 2);
                p.stroke(0, 243, 255, 150);
                p.line(-20, 0, 20, 0);
                p.line(0, -20, 0, 20);
                p.pop();
            };

            p.windowResized = () => {
                p.resizeCanvas(p.windowWidth, p.windowHeight);
                mainNode.x = p.width/2;
                mainNode.y = p.height * 0.08;
            };

            class Gear {
                constructor(x, y, r, teeth) {
                    this.x = x;
                    this.y = y;
                    this.r = r;
                    this.teeth = teeth;
                    this.angle = 0;
                    this.speed = p.random(0.05, 0.2) * (p.random() > 0.5 ? 1 : -1);
                }
                update() {
                    this.angle += this.speed;
                }
                display() {
                    p.push();
                    p.translate(this.x, this.y);
                    p.rotate(this.angle);
                    // Gear Body
                    p.ellipse(0, 0, this.r * 1.8);
                    p.ellipse(0, 0, this.r * 0.5); // Center hole
                    // Teeth
                    for(let i=0; i<360; i+=360/this.teeth) {
                        p.push();
                        p.rotate(i);
                        p.rect(0, -this.r, 15, 20);
                        p.pop();
                    }
                    // Spokes
                    p.line(-this.r * 0.8, 0, this.r * 0.8, 0);
                    p.line(0, -this.r * 0.8, 0, this.r * 0.8);
                    p.pop();
                }
            }

            class FluidCircuit {
                constructor() {
                    this.reset();
                }
                reset() {
                    this.x = p.random(p.width);
                    this.y = p.random(p.height);
                    this.speedY = p.random(-1, -3); // Flow upwards
                    this.amp = p.random(10, 30);
                    this.freq = p.random(0.02, 0.05);
                    this.offset = p.random(1000);
                    this.len = p.random(50, 150);
                    this.color = p.color(0, 243, 255, p.random(50, 150));
                }
                update() {
                    this.y += this.speedY;
                    if(this.y < -this.len) this.reset();
                }
                display() {
                    p.noFill();
                    p.stroke(this.color);
                    p.strokeWeight(2);
                    p.beginShape();
                    for(let i=0; i<this.len; i+=5) {
                        let y = this.y + i;
                        let x = this.x + p.sin((y + this.offset) * this.freq) * this.amp;
                        p.vertex(x, y);
                    }
                    p.endShape();
                }
            }

            class Floater {
                constructor() {
                    this.reset();
                }
                reset() {
                    this.x = p.random(p.width);
                    this.y = p.random(p.height, p.height + 200);
                    this.speed = p.random(0.5, 2);
                    this.char = String.fromCharCode(0x30A0 + Math.random() * 96);
                    this.alpha = p.random(50, 150);
                    this.baseX = this.x;
                }
                update() {
                    this.y -= this.speed;
                    // Mouse repulsion
                    let d = p.dist(p.mouseX, p.mouseY, this.x, this.y);
                    if(d < 100) {
                        let angle = p.atan2(this.y - p.mouseY, this.x - p.mouseX);
                        this.x += p.cos(angle) * 2;
                        this.y += p.sin(angle) * 2;
                    } else {
                        this.x = p.lerp(this.x, this.baseX, 0.02);
                    }
                    if(this.y < -50) this.reset();
                }
                display() {
                    p.fill(255, 255, 255, this.alpha);
                    p.noStroke();
                    p.textSize(14);
                    p.text(this.char, this.x, this.y);
                }
            }
        };
        new p5(sketch);
    </script>

    <!-- MAIN SCRIPT (Three.js) -->
    <script type="module">
        import * as THREE from 'https://esm.sh/three@0.160.0';
        import { EffectComposer } from 'https://esm.sh/three@0.160.0/examples/jsm/postprocessing/EffectComposer.js';
        import { RenderPass } from 'https://esm.sh/three@0.160.0/examples/jsm/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'https://esm.sh/three@0.160.0/examples/jsm/postprocessing/UnrealBloomPass.js';

        gsap.registerPlugin(ScrollTrigger, TextPlugin);

        // --- Init Scene ---
        const container = document.getElementById('webgl-container');
        const scene = new THREE.Scene();
        // Light fog to blend but not obscure p5
        scene.fog = new THREE.FogExp2(0x050508, 0.02);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(-5, 0, 15);
        camera.lookAt(2, 0, 0);

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
        renderer.setClearColor(0x000000, 0);
        container.appendChild(renderer.domElement);

        // --- Post Processing ---
        const composer = new EffectComposer(renderer);
        composer.addPass(new RenderPass(scene, camera));
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0;
        bloomPass.strength = 1.2;
        bloomPass.radius = 0.5;
        composer.addPass(bloomPass);

        // --- Lights ---
        const ambient = new THREE.AmbientLight(0x222222);
        scene.add(ambient);

        const mainLight = new THREE.PointLight(0xffffff, 1, 50);
        mainLight.position.set(-10, 10, 10);
        scene.add(mainLight);

        // --- GEAR & FACTORY GENERATION ---

        // Material Library
        const matGold = new THREE.MeshStandardMaterial({
            color: 0xFFD700, metalness: 0.8, roughness: 0.2, emissive: 0xFFD700, emissiveIntensity: 0.1
        });
        const matBlue = new THREE.MeshStandardMaterial({
            color: 0x0077BE, metalness: 0.9, roughness: 0.1, emissive: 0x0077BE, emissiveIntensity: 0.2
        });
        const matCyan = new THREE.MeshStandardMaterial({
            color: 0x00F3FF, metalness: 0.9, roughness: 0.1, emissive: 0x00F3FF, emissiveIntensity: 0.3
        });

        function createGear(radius, teeth, mat) {
            const group = new THREE.Group();
            const ring = new THREE.Mesh(new THREE.TorusGeometry(radius, 0.6, 16, 50), mat);
            ring.rotation.x = Math.PI/2;
            group.add(ring);
            const toothGeo = new THREE.BoxGeometry(1.5, 1, 2);
            for(let i=0; i<360; i+=360/teeth) {
                const rad = i * Math.PI / 180;
                const tooth = new THREE.Mesh(toothGeo, mat);
                tooth.position.set(Math.cos(rad)*radius, 0, Math.sin(rad)*radius);
                tooth.rotation.y = -rad;
                group.add(tooth);
            }
            const spoke = new THREE.Mesh(new THREE.BoxGeometry(radius*2, 0.5, 0.5), mat);
            group.add(spoke);
            const spoke2 = spoke.clone();
            spoke2.rotation.y = Math.PI/2;
            group.add(spoke2);
            return group;
        }

        const gearGroup = new THREE.Group();
        gearGroup.position.x = 4;
        scene.add(gearGroup);

        const gear1 = createGear(5, 12, matGold);
        gear1.position.y = -6;
        gearGroup.add(gear1);

        const gear2 = createGear(4, 10, matBlue);
        gear2.position.y = 2;
        gearGroup.add(gear2);

        const gear3 = createGear(3, 8, matCyan);
        gear3.position.y = 9;
        gearGroup.add(gear3);

        // --- ELEMENTAL PARTICLES ---

        // 1. Earth Crystals
        const oreGeo = new THREE.OctahedronGeometry(0.3);
        const oreGroup = new THREE.Group();
        for(let i=0; i<30; i++) {
            const m = new THREE.Mesh(oreGeo, matGold);
            m.position.set((Math.random()-0.5)*12, (Math.random()-0.5)*5 - 6, (Math.random()-0.5)*12);
            m.rotation.set(Math.random(), Math.random(), Math.random());
            oreGroup.add(m);
        }
        gearGroup.add(oreGroup);

        // 2. Water Steam
        const steamGeo = new THREE.BufferGeometry();
        const steamPos = new Float32Array(150 * 3);
        steamGeo.setAttribute('position', new THREE.BufferAttribute(steamPos, 3));
        const steamMat = new THREE.PointsMaterial({ color: 0x0077BE, size: 0.15, transparent: true, opacity: 0.6 });
        const steam = new THREE.Points(steamGeo, steamMat);
        steam.position.y = 2;
        gearGroup.add(steam);

        // 3. Lightning Arcs
        const plasmaMatLine = new THREE.LineBasicMaterial({ color: 0x00F3FF });
        function createArc(y1, y2) {
            const geo = new THREE.BufferGeometry();
            const pos = new Float32Array(20 * 3);
            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const line = new THREE.Line(geo, plasmaMatLine);
            gearGroup.add(line);
            return { mesh: line, y1: y1, y2: y2 };
        }
        const arcs = [createArc(-6, 2), createArc(2, 9)];

        // --- ANIMATION ---
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const t = clock.getElapsedTime();

            gear1.rotation.y = t * 0.3;
            gear2.rotation.y = -t * 0.4;
            gear3.rotation.y = t * 0.5;

            oreGroup.rotation.y = t * 0.1;
            oreGroup.children.forEach(ore => ore.rotation.x += 0.01);

            const sPos = steam.geometry.attributes.position.array;
            for(let i=0; i<150; i++) {
                if(sPos[i*3+1] === 0) {
                    sPos[i*3] = (Math.random()-0.5)*8;
                    sPos[i*3+1] = (Math.random()-0.5)*4;
                    sPos[i*3+2] = (Math.random()-0.5)*8;
                }
                sPos[i*3+1] += 0.02;
                sPos[i*3] += Math.sin(t + i)*0.01;
                if(sPos[i*3+1] > 3) sPos[i*3+1] = -3;
            }
            steam.geometry.attributes.position.needsUpdate = true;

            arcs.forEach(arc => {
                const arr = arc.mesh.geometry.attributes.position.array;
                for(let i=0; i<20; i++) {
                    const alpha = i/19;
                    const y = THREE.MathUtils.lerp(arc.y1, arc.y2, alpha);
                    const angle = t * 4 + alpha * Math.PI * 2;
                    const r = 0.5;
                    const jitter = (Math.random()-0.5) * 0.8;
                    arr[i*3] = Math.cos(angle)*r + jitter;
                    arr[i*3+1] = y;
                    arr[i*3+2] = Math.sin(angle)*r + jitter;
                }
                arc.mesh.geometry.attributes.position.needsUpdate = true;
            });

            composer.render();
        }
        animate();

        // --- SCROLL INTERACTION ---

        window.addEventListener('load', () => {
            document.getElementById('load-bar').style.width = '100%';
            setTimeout(() => {
                gsap.to('#loader', { opacity: 0, duration: 0.5, onComplete: () => document.getElementById('loader').remove() });
                gsap.to('.slate-earth', { opacity: 1, y: 0, duration: 1, delay: 0.5, ease: "power2.out" });
            }, 500);
        });

        const tl = gsap.timeline({
            scrollTrigger: {
                trigger: "body",
                start: "top top",
                end: "bottom bottom",
                scrub: 1
            }
        });

        // Spiral Up
        tl.to(camera.position, { y: 12, z: 12, x: -3, duration: 1 });
        tl.to(camera.rotation, { z: -0.1, duration: 1 }, "<");

        const panels = document.querySelectorAll('.data-slate');
        panels.forEach((p, i) => {
            if(i === 0) return;
            gsap.to(p, {
                opacity: 1, rotationY: 0, x: 0,
                duration: 1,
                scrollTrigger: {
                    trigger: p,
                    start: "top 85%",
                    toggleActions: "play none none reverse"
                }
            });
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>