<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XmasFun689 - Construction Mage</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Orbitron:wght@400;700;900&family=Noto+Serif+TC:wght@700&display=swap" rel="stylesheet">

    <!-- GSAP & Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <style>
        :root {
            --c-yellow: #FFD700;
            --c-black: #050505;
            --c-dark: #111;
            --c-cyan: #00FFFF;
            --c-earth: #CD853F;
            --font-display: 'Black Ops One', cursive;
            --font-ui: 'Orbitron', sans-serif;
            --font-body: 'Noto Serif TC', serif;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--c-black);
            color: white;
            overflow-x: hidden;
            font-family: var(--font-ui);
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: -1;
            background: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%);
        }

        /* Scrollytelling Layout */
        .scroll-spacer {
            height: 600vh; /* Extended for 4 zones */
            position: relative;
            z-index: 10;
        }

        /* Holographic UI Panels */
        .holo-panel {
            position: fixed;
            padding: 2rem;
            border: 2px solid var(--c-yellow);
            background: rgba(5, 5, 5, 0.85);
            backdrop-filter: blur(5px);
            color: var(--c-yellow);
            max-width: 90%;
            width: 500px;
            opacity: 0; /* Controlled by GSAP */
            transform: translateY(20px);
            clip-path: polygon(
                10% 0, 100% 0, 100% 90%, 90% 100%, 0 100%, 0 10%
            );
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
            pointer-events: none; /* Let scroll pass through mostly */
        }

        .holo-panel::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, transparent 30%, var(--c-yellow) 50%, transparent 70%);
            z-index: -1;
            opacity: 0.3;
            animation: holo-scan 3s infinite linear;
            pointer-events: none;
        }

        @keyframes holo-scan {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        .holo-panel h2 {
            font-family: var(--font-display);
            font-size: 2.5rem;
            margin: 0 0 1rem 0;
            text-transform: uppercase;
            text-shadow: 0 0 10px var(--c-yellow);
        }

        .holo-panel h3 {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 0.5rem;
        }

        .holo-panel p {
            font-family: var(--font-body);
            font-size: 1.1rem;
            line-height: 1.6;
            color: #ddd;
        }

        /* RPG Stats Grid */
        .rpg-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .stat-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 0.5rem;
            border-left: 3px solid var(--c-yellow);
        }
        .stat-label {
            font-size: 0.8rem;
            color: #888;
            display: block;
        }
        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }

        /* Variant Styles */
        .panel-earth {
            border-color: var(--c-earth);
            color: var(--c-earth);
        }
        .panel-earth h2 { text-shadow: 0 0 10px var(--c-earth); }
        .panel-earth .stat-box { border-left-color: var(--c-earth); }
        .panel-earth::before { background: linear-gradient(45deg, transparent 30%, var(--c-earth) 50%, transparent 70%); }
        .panel-earth { box-shadow: 0 0 15px rgba(205, 133, 63, 0.2); }

        .panel-element {
            border-color: var(--c-cyan);
            color: var(--c-cyan);
        }
        .panel-element h2 { text-shadow: 0 0 10px var(--c-cyan); }
        .panel-element .stat-box { border-left-color: var(--c-cyan); }
        .panel-element::before { background: linear-gradient(45deg, transparent 30%, var(--c-cyan) 50%, transparent 70%); }
        .panel-element { box-shadow: 0 0 15px rgba(0, 255, 255, 0.2); }

        /* Positioning */
        #panel-intro { top: 20%; left: 50%; transform: translate(-50%, 0); text-align: center; }
        #panel-machines { top: 20%; left: 5%; }
        #panel-elements { top: 20%; right: 5%; text-align: right; }
        #panel-finale {
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center;
            width: auto;
            border-color: #ff0055;
            color: #ff0055;
            background: rgba(0,0,0,0.95);
            pointer-events: auto; /* Buttons need clicks */
        }
        #panel-finale::before { background: linear-gradient(45deg, transparent 30%, #ff0055 50%, transparent 70%); }
        #panel-finale { box-shadow: 0 0 15px rgba(255, 0, 85, 0.2); }


        /* Social Icons */
        .social-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        .social-btn {
            width: 50px;
            height: 50px;
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .social-btn:hover {
            background: white;
            color: black;
            transform: scale(1.1);
        }
        .social-btn svg { width: 24px; height: 24px; fill: currentColor; }

        /* Guild Nav */
        .guild-nav {
            position: fixed;
            top: 2rem;
            left: 2rem;
            z-index: 100;
        }
        .guild-btn {
            font-family: var(--font-display);
            color: var(--c-yellow);
            text-decoration: none;
            font-size: 1.5rem;
            border: 2px solid var(--c-yellow);
            padding: 0.5rem 1rem;
            background: rgba(0,0,0,0.5);
            transition: all 0.3s;
        }
        .guild-btn:hover { background: var(--c-yellow); color: black; }

        /* Loader */
        #loader {
            position: fixed; inset: 0; background: black; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            font-family: var(--font-display); color: var(--c-yellow);
            font-size: 2rem;
            flex-direction: column;
            gap: 1rem;
        }
        .loader-bar {
            width: 200px; height: 4px; background: #333;
            position: relative; overflow: hidden;
        }
        .loader-bar::after {
            content: ''; position: absolute; inset: 0;
            background: var(--c-yellow);
            transform: translateX(-100%);
            animation: load 2s infinite;
        }
        @keyframes load { 100% { transform: translateX(100%); } }

        @media (max-width: 900px) {
            .holo-panel { width: 85%; padding: 1.5rem; top: auto !important; bottom: 10% !important; left: 50% !important; transform: translateX(-50%) !important; text-align: left !important; }
            #panel-intro { top: 20% !important; bottom: auto !important; }
            #panel-finale { top: 50% !important; bottom: auto !important; transform: translate(-50%, -50%) !important; text-align: center !important;}
            #panel-machines { bottom: 15% !important; }
            #panel-elements { bottom: 15% !important; }
            .holo-panel h2 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>

    <div id="loader">
        <div>INITIALIZING SYSTEM</div>
        <div class="loader-bar"></div>
    </div>

    <div class="guild-nav">
        <a href="/guild/" class="guild-btn">GUILD // EXIT</a>
    </div>

    <div id="canvas-container"></div>

    <!-- Scroll Spacer -->
    <div class="scroll-spacer"></div>

    <!-- Zones -->
    <div id="panel-intro" class="holo-panel">
        <h2>Construction Mage</h2>
        <h3>LEVEL 8 SITE MANAGER</h3>
        <p>Tempered by Steel. Fueled by Magic.<br>從業八年・工地主任</p>
    </div>

    <div id="panel-machines" class="holo-panel panel-earth">
        <h2>Heavy Metal</h2>
        <h3>THE ARSENAL</h3>
        <p>Commanding the giants of the earth. Master of Excavators, Cranes, and Rollers.</p>
        <p style="color: #ccc; font-size: 0.9rem;">喜歡實作跟重機械 會開怪手跟吊車還有自走車</p>
        <div class="rpg-stats">
            <div class="stat-box">
                <span class="stat-label">STR</span>
                <span class="stat-value">A+</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">Affinity</span>
                <span class="stat-value">Earth</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">Skill</span>
                <span class="stat-value">Excavation</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">Status</span>
                <span class="stat-value">Unlicensed</span>
            </div>
        </div>
    </div>

    <div id="panel-elements" class="holo-panel panel-element">
        <h2>Elemental Fusion</h2>
        <h3>WATER & LIGHTNING</h3>
        <p>Dual-licensed Slashie. Channeling the flow of water and the spark of lightning.</p>
        <p style="color: #ccc; font-size: 0.9rem;">
            有水電證照斜槓水電工<br>
            朋友說我是水&電&土系混合法師<br>
            <span style="font-size: 0.8rem; opacity: 0.8;">(遊戲堅持選召喚師的 Solo 玩家)</span>
        </p>
        <div class="rpg-stats">
            <div class="stat-box">
                <span class="stat-label">INT</span>
                <span class="stat-value">A</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">Class</span>
                <span class="stat-value">Summoner</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">Playstyle</span>
                <span class="stat-value">Solo</span>
            </div>
            <div class="stat-box">
                <span class="stat-label">License</span>
                <span class="stat-value">Dual</span>
            </div>
        </div>
    </div>

    <div id="panel-finale" class="holo-panel">
        <div style="width: 150px; height: 150px; margin: 0 auto 1rem; border-radius: 50%; overflow: hidden; border: 3px solid #ff0055; box-shadow: 0 0 20px #ff0055;">
            <img src="/assets/img/guild/xmasfun689/avatar.webp" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">
        </div>
        <h2 style="color: #ff0055; text-shadow: 0 0 10px #ff0055;">XmasFun689</h2>
        <h3>WARRIOR PHYSIQUE // SUMMONER SOUL</h3>
        <p>從小胖到現在的戰士體質<br>最愛猴子布偶跟 Kururu 曹長</p>

        <div class="social-links">
            <a href="https://www.threads.com/@xmasfun689" target="_blank" class="social-btn" title="Threads">
                <!-- Threads Icon -->
                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-2-5.5h2v2h-2zm4-3h2v2h-2zm-6-2h2v7h-2z"/></svg>
            </a>
            <a href="https://www.instagram.com/xmasfun689/" target="_blank" class="social-btn" title="Instagram">
                <!-- Instagram Icon -->
                <svg viewBox="0 0 24 24"><path d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z"/></svg>
            </a>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';

        gsap.registerPlugin(ScrollTrigger);

        // --- Config ---
        const ASSETS = {
            excavator: '/assets/img/guild/xmasfun689/excavator.webp',
            roller: '/assets/img/guild/xmasfun689/roller.webp',
            plushies: '/assets/img/guild/xmasfun689/plushies.webp'
        };

        // --- Scene Setup ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050505, 0.02);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1, 5); // Initial position

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- Lighting ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const pointLight = new THREE.PointLight(0xffd700, 2, 50);
        pointLight.position.set(0, 5, 0);
        scene.add(pointLight);

        // --- Helpers ---
        // Magic Circle Floor
        function createMagicCircle() {
            const size = 1024;
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');

            // Draw
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 10;
            ctx.shadowBlur = 20;
            ctx.shadowColor = '#FFD700';

            // Outer Ring
            ctx.beginPath();
            ctx.arc(size/2, size/2, size/2 - 20, 0, Math.PI * 2);
            ctx.stroke();

            // Inner Triangle
            ctx.beginPath();
            ctx.moveTo(size/2, 40);
            ctx.lineTo(size - 40, size - 100);
            ctx.lineTo(40, size - 100);
            ctx.closePath();
            ctx.stroke();

            // Inner Ring
            ctx.beginPath();
            ctx.arc(size/2, size/2, size/4, 0, Math.PI * 2);
            ctx.stroke();

            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.MeshBasicMaterial({
                map: texture,
                transparent: true,
                opacity: 0.8,
                side: THREE.DoubleSide,
                blending: THREE.AdditiveBlending
            });
            const geo = new THREE.PlaneGeometry(10, 10);
            const mesh = new THREE.Mesh(geo, material);
            mesh.rotation.x = -Math.PI / 2;
            mesh.position.y = -2;
            return mesh;
        }
        const magicCircle = createMagicCircle();
        scene.add(magicCircle);

        // Grid Floor (extended)
        const gridHelper = new THREE.GridHelper(200, 100, 0x333333, 0x111111);
        gridHelper.position.y = -2.1;
        scene.add(gridHelper);

        // --- Assets Loading ---
        const textureLoader = new THREE.TextureLoader();

        function createSprite(url, scale = 3) {
            const texture = textureLoader.load(url);
            texture.colorSpace = THREE.SRGBColorSpace;
            const material = new THREE.SpriteMaterial({ map: texture, transparent: true });
            const sprite = new THREE.Sprite(material);
            sprite.scale.set(scale, scale, 1);
            return sprite;
        }

        // 1. Excavator (Zone 2)
        const excavator = createSprite(ASSETS.excavator, 6);
        excavator.position.set(-3, 0, -20);
        scene.add(excavator);

        // 2. Roller (Zone 2)
        const roller = createSprite(ASSETS.roller, 5);
        roller.position.set(3, -0.5, -25);
        scene.add(roller);

        // 3. Plushies (Zone 4)
        const plushies = createSprite(ASSETS.plushies, 4);
        plushies.position.set(0, 0, -55);
        scene.add(plushies);

        // --- Elemental Effects ---

        // Earth: Floating Rocks (Instanced)
        const rockGeo = new THREE.DodecahedronGeometry(0.5, 0);
        const rockMat = new THREE.MeshStandardMaterial({ color: 0x8B4513, flatShading: true });
        const rockCount = 50;
        const rocks = new THREE.InstancedMesh(rockGeo, rockMat, rockCount);
        const dummy = new THREE.Object3D();

        for(let i=0; i<rockCount; i++) {
            dummy.position.set(
                (Math.random() - 0.5) * 20,
                (Math.random() - 0.5) * 10,
                -20 - Math.random() * 20 // Zone 2 area
            );
            dummy.rotation.set(Math.random()*Math.PI, Math.random()*Math.PI, 0);
            const s = Math.random() * 0.5 + 0.1;
            dummy.scale.set(s,s,s);
            dummy.updateMatrix();
            rocks.setMatrixAt(i, dummy.matrix);
        }
        scene.add(rocks);

        // Water: Particles
        const waterGeo = new THREE.BufferGeometry();
        const waterCount = 1000;
        const waterPos = new Float32Array(waterCount * 3);
        for(let i=0; i<waterCount*3; i+=3) {
            waterPos[i] = (Math.random() - 0.5) * 15; // x
            waterPos[i+1] = (Math.random() - 0.5) * 10; // y
            waterPos[i+2] = -40 + (Math.random() - 0.5) * 10; // z (Zone 3)
        }
        waterGeo.setAttribute('position', new THREE.BufferAttribute(waterPos, 3));
        const waterMat = new THREE.PointsMaterial({
            color: 0x00FFFF,
            size: 0.1,
            transparent: true,
            opacity: 0.6,
            blending: THREE.AdditiveBlending
        });
        const waterParticles = new THREE.Points(waterGeo, waterMat);
        scene.add(waterParticles);

        // Lightning: Dynamic Bolts (Zone 3)
        const boltCount = 5;
        const bolts = [];

        function createBolt() {
            const geo = new THREE.BufferGeometry();
            const points = [];
            let curr = new THREE.Vector3((Math.random()-0.5)*10, 5, -40);
            for(let i=0; i<10; i++) {
                points.push(curr.clone());
                curr.y -= 1;
                curr.x += (Math.random()-0.5)*2;
                curr.z += (Math.random()-0.5)*2;
            }
            geo.setFromPoints(points);
            const mat = new THREE.LineBasicMaterial({ color: 0xFFFF00, linewidth: 2 });
            const line = new THREE.Line(geo, mat);
            line.visible = false; // Initially hidden
            scene.add(line);
            return { mesh: line, points: points };
        }

        for(let i=0; i<boltCount; i++) bolts.push(createBolt());

        // --- Animation Loop ---
        const clock = new THREE.Clock();

        function animate() {
            const time = clock.getElapsedTime();

            // Rotate Magic Circle
            magicCircle.rotation.z = time * 0.1;

            // Animate Water
            const positions = waterParticles.geometry.attributes.position.array;
            for(let i=1; i<positions.length; i+=3) {
                positions[i] += 0.05;
                if(positions[i] > 5) positions[i] = -5;
            }
            waterParticles.geometry.attributes.position.needsUpdate = true;

            // Animate Lightning (flicker)
            bolts.forEach(bolt => {
                if (Math.random() > 0.9) { // Random flicker
                    bolt.mesh.visible = !bolt.mesh.visible;
                    if(bolt.mesh.visible) {
                        // Jitter points
                        const pos = bolt.mesh.geometry.attributes.position.array;
                        for(let i=0; i<pos.length; i+=3) {
                            pos[i] += (Math.random()-0.5)*0.2;
                        }
                        bolt.mesh.geometry.attributes.position.needsUpdate = true;
                    }
                }
            });

            // Gentle float for machines
            excavator.position.y = Math.sin(time) * 0.2;
            roller.position.y = Math.sin(time + 1) * 0.2 - 0.5;

            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }

        // Wait for fonts/images
        document.fonts.ready.then(() => {
            document.getElementById('loader').style.display = 'none';
            animate();
            initScroll();
        });

        // --- ScrollTrigger Logic ---
        function initScroll() {
            const timeline = gsap.timeline({
                scrollTrigger: {
                    trigger: ".scroll-spacer",
                    start: "top top",
                    end: "bottom bottom",
                    scrub: 1,
                }
            });

            // Camera Flight Path
            // Initial: z=5. End: z=-60

            // Phase 1: Intro -> Machinery (z: 5 -> -20)
            timeline.to(camera.position, { z: -20, duration: 4, ease: "none" }, 0);

            // Phase 2: Machinery -> Elements (z: -20 -> -40)
            timeline.to(camera.position, { z: -40, duration: 4, ease: "none" }, 4);

            // Phase 3: Elements -> Finale (z: -40 -> -55)
            timeline.to(camera.position, { z: -55, duration: 2, ease: "none" }, 8);

            // --- UI Text Animations ---

            // 1. Intro Panel (Fade out)
            timeline.to("#panel-intro", { opacity: 0, scale: 0.8, duration: 1 }, 0);

            // 2. Heavy Metal Panel (Fade In -> Out)
            timeline.fromTo("#panel-machines",
                { opacity: 0, x: -50 },
                { opacity: 1, x: 0, duration: 1 }, 1.5
            );
            timeline.to("#panel-machines", { opacity: 0, x: -50, duration: 1 }, 3.5);

            // 3. Elemental Panel (Fade In -> Out)
            timeline.fromTo("#panel-elements",
                { opacity: 0, x: 50 },
                { opacity: 1, x: 0, duration: 1 }, 5
            );
            timeline.to("#panel-elements", { opacity: 0, x: 50, duration: 1 }, 7);

            // 4. Finale Panel (Fade In)
            timeline.fromTo("#panel-finale",
                { opacity: 0, scale: 0.5 },
                { opacity: 1, scale: 1, duration: 1 }, 8.5
            );

            // --- 3D Element Triggers ---

            // Rocks: Rotate/Scatter as we pass
            timeline.to(rocks.rotation, { z: Math.PI, duration: 4 }, 2);

            // Lightning: Only visible in zone 3
            // Handled by z-position naturally, but we can boost intensity
        }

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>