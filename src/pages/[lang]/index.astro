---
/**
 * RPG é¢¨æ ¼é¦–é 
 * å‹•æ…‹è·¯ç”±ï¼š/zh-TW/, /zh-CN/, /en/, /ja/, /ko/
 */
import BaseLayout from '@components/layout/BaseLayout.astro';
import LanguageSwitcher from '@components/i18n/LanguageSwitcher.astro';
import StatusBar from '@components/rpg/StatusBar.astro';
import GameTabs from '@components/rpg/GameTabs.astro';
import SkillTreePanel from '@components/rpg/SkillTreePanel.astro';
import InventoryPanel from '@components/rpg/InventoryPanel.astro';
import AchievementsPanel from '@components/rpg/AchievementsPanel.astro';
import NewsletterSubscribe from '@components/layout/NewsletterSubscribe.astro';
import Footer from '@components/layout/Footer.astro';
import CheatModal from '@components/rpg/CheatModal.astro';
import { languages, defaultLang, type Language, useTranslations } from '@i18n/index';

export function getStaticPaths() {
  // éé è¨­èªè¨€åˆ—è¡¨ï¼ˆé è¨­èªè¨€ç”±æ ¹è·¯å¾‘è™•ç†ï¼‰
  const nonDefaultLangs = (Object.keys(languages) as Language[]).filter(l => l !== defaultLang);
  return nonDefaultLangs.map((lang) => ({
    params: { lang },
  }));
}

const { lang } = Astro.params as { lang: Language };
const { t, all: trans } = useTranslations(lang);

// é é¢æ¨™é¡Œ
const pageTitle = trans.site?.title || "SuperGalen's Dungeon";
const pageDescription = trans.site?.description || 'RPG é¢¨æ ¼æŠ€è¡“éƒ¨è½æ ¼';

// å±¬æ€§è³‡æ–™
// å±¬æ€§å€¼åŸå§‹è¨­è¨ˆï¼ŒåŒ…å«ç‰¹æ®Šè‰²å½© classã€tooltip key å’Œé è¨­ tooltip æ–‡å­—
const attributes = [
  { key: 'STR', name: trans.attributes?.STR?.name || 'STR', value: 42, tooltipKey: 'attributes.str_tooltip', tooltip: 'éµç›¤æ•²æ“ŠåŠ›é“ï¼Œå½±éŸ¿æ©Ÿæ¢°éµç›¤å£½å‘½' },
  { key: 'INT', name: trans.attributes?.INT?.name || 'INT', value: 87, tooltipKey: 'attributes.int_tooltip', tooltip: 'èˆ‡ AI æ‰“å˜´ç ²çš„æŠ€è¡“ï¼šç²¾é€š Prompt Engineering èˆ‡ ChatGPT åµæ¶' },
  { key: 'BUG', name: trans.attributes?.BUG?.name || 'BUG', value: 99, barClass: 'bug-bar', tooltipKey: 'attributes.bug_tooltip', tooltip: 'ç”¢ç”Ÿ Bug çš„å¤©è³¦ï¼Œè¶Šé«˜è¶Šå®¹æ˜“å¯«å‡ºã€é€™ä¸æ˜¯ Bugï¼Œæ˜¯ Featureã€' },
  { key: 'SAN', name: trans.attributes?.SAN?.name || 'SAN', value: 12, barClass: 'san-bar', tooltipKey: 'attributes.san_tooltip', tooltip: 'ç†æ™ºå€¼ï¼šçœ‹é Legacy Code å¾Œåƒ…å­˜çš„ç²¾ç¥ç‹€æ…‹' },
  { key: 'STS', name: trans.attributes?.STS?.name || 'STS', value: 85, barClass: 'stress-bar', tooltipKey: 'attributes.sts_tooltip', tooltip: 'å£“åŠ›å€¼ï¼šPM æ”¹éœ€æ±‚æ¬¡æ•¸ Ã— å®¢æˆ¶å‚¬é€²åº¦æ¬¡æ•¸' },
  { key: 'CAF', name: trans.attributes?.CAF?.name || 'CAF', value: 92, barClass: 'coffee-bar', tooltipKey: 'attributes.caf_tooltip', tooltip: 'å’–å•¡å› æ¿ƒåº¦ï¼šè¡€æ¶²ä¸­å’–å•¡å«é‡å·²è¶…éè¡€æ¶²æœ¬èº«' },
  { key: 'OVT', name: trans.attributes?.OVT?.name || 'OVT', value: 78, barClass: 'overtime-bar', tooltipKey: 'attributes.ovt_tooltip', tooltip: 'åŠ ç­æŒ‡æ•¸ï¼šã€æº–æ™‚ä¸‹ç­ã€æ˜¯ä»€éº¼ï¼Ÿèƒ½åƒå—ï¼Ÿ' },
  { key: 'DLN', name: trans.attributes?.DLN?.name || 'DLN', value: 95, barClass: 'deadline-bar', tooltipKey: 'attributes.dln_tooltip', tooltip: 'æ­»ç·šé€¼è¿‘åº¦ï¼šæ˜å¤©è¦ä¸Šç·šä½†é‚„æœ‰ 87 å€‹ Bug å¾…ä¿®' },
  { key: 'LUK', name: trans.attributes?.LUK?.name || 'LUK', value: 73, icon: 'lck', barClass: 'luck-bar', tooltipKey: 'attributes.luk_tooltip', tooltip: 'å¹¸é‹å€¼ï¼šæ˜¯å¦èƒ½åœ¨æœ€å¾Œä¸€åˆ»æ‰¾åˆ°è§£æ±º Bug çš„æ–¹æ³•' },
];
---

<BaseLayout title={pageTitle} description={pageDescription} lang={lang}>
  <header class="site-header">
      <nav class="site-nav">
        <a href={`/${lang}/`} class="site-title">SuperGalen's Dungeon</a>

        <!-- æ¼¢å ¡é¸å–®æŒ‰éˆ•ï¼ˆåªåœ¨è¡Œå‹•ç‰ˆé¡¯ç¤ºï¼‰ -->
        <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="é–‹å•Ÿé¸å–®">
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </button>

        <div class="nav-container desktop-nav">
          <!-- é€£æ¥éŒ¢åŒ…æŒ‰éˆ• (æœªé€£æ¥æ™‚é¡¯ç¤º) -->
          <button class="connect-wallet-btn-header" id="connect-wallet-header" style="display: none;">
            <span class="wallet-icon"><i class="fab fa-ethereum"></i></span>
            <span class="wallet-text" data-i18n="header.connect_wallet">{trans.header?.connect_wallet || 'é€£æ¥éŒ¢åŒ…'}</span>
          </button>

          <!-- éŒ¢åŒ…ç‹€æ…‹é¡¯ç¤º (å·²é€£æ¥æ™‚é¡¯ç¤º) -->
          <div class="wallet-status-header hidden" id="wallet-status-header">
            <!-- ç¶²è·¯ç‹€æ…‹ -->
            <div class="network-status">
              <span id="network-indicator"><i class="fas fa-circle text-danger"></i></span>
              <span id="network-name" data-i18n="header.not_connected">{trans.header?.not_connected || 'æœªé€£æ¥'}</span>
            </div>

            <!-- éŒ¢åŒ…åœ°å€ -->
            <div class="wallet-address" id="wallet-address-header">
              <span class="address-icon"><i class="fas fa-user"></i></span>
              <span class="address-text" id="user-address" data-i18n="header.not_connected">{trans.header?.not_connected || 'æœªé€£æ¥'}</span>
            </div>

            <!-- æ–·é–‹é€£çµæŒ‰éˆ• -->
            <button class="disconnect-btn-header" id="disconnect-wallet-header" data-i18n-title="header.disconnect_wallet" title="æ–·é–‹éŒ¢åŒ…">
              <i class="fas fa-unlink"></i>
            </button>
          </div>

          <!-- SGT é¤˜é¡é¡¯ç¤º -->
          <div class="sgt-balance-header hidden" id="sgt-balance-header" title="ç²¾ç¢ºé¤˜é¡è¼‰å…¥ä¸­...">
            <img src="/assets/images/sgt-token-icon.webp" alt="SGT" class="balance-icon" />
            <span class="balance-amount" id="sgt-balance-amount">123.45</span>
          </div>

          <!-- ç¶²è·¯åˆ‡æ›æŒ‰éˆ• -->
          <button class="network-switch-btn-header hidden" id="switch-to-polygon-header">
            <i class="fas fa-exchange-alt"></i> <span data-i18n="header.switch_to_polygon">{trans.header?.switch_to_polygon || 'åˆ‡æ›è‡³ Polygon'}</span>
          </button>
        </div>
      </nav>

      <!-- è¡Œå‹•ç‰ˆé¸å–®ï¼ˆæ»‘å…¥å¼ï¼‰ -->
      <div class="mobile-menu" id="mobile-menu">
        <div class="mobile-menu-header">
          <span class="mobile-menu-title" data-i18n="header.menu">{trans.header?.menu || 'é¸å–®'}</span>
          <button class="mobile-menu-close" id="mobile-menu-close" aria-label="é—œé–‰é¸å–®">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="mobile-menu-content">
          <!-- é€£æ¥éŒ¢åŒ…æŒ‰éˆ• (æœªé€£æ¥æ™‚é¡¯ç¤º) -->
          <button class="connect-wallet-btn-mobile" id="connect-wallet-mobile" style="display: none;">
            <span class="wallet-icon"><i class="fab fa-ethereum"></i></span>
            <span class="wallet-text" data-i18n="header.connect_wallet">{trans.header?.connect_wallet || 'é€£æ¥éŒ¢åŒ…'}</span>
          </button>

          <!-- éŒ¢åŒ…ç‹€æ…‹é¡¯ç¤º (å·²é€£æ¥æ™‚é¡¯ç¤º) -->
          <div class="wallet-status-mobile hidden" id="wallet-status-mobile">
            <div class="wallet-info-row">
              <!-- ç¶²è·¯ç‹€æ…‹ -->
              <div class="network-status">
                <span id="network-indicator-mobile"><i class="fas fa-circle text-danger"></i></span>
                <span id="network-name-mobile" data-i18n="header.not_connected">{trans.header?.not_connected || 'æœªé€£æ¥'}</span>
              </div>

              <!-- éŒ¢åŒ…åœ°å€ -->
              <div class="wallet-address" id="wallet-address-mobile">
                <span class="address-icon"><i class="fas fa-user"></i></span>
                <span class="address-text" id="user-address-mobile" data-i18n="header.not_connected">{trans.header?.not_connected || 'æœªé€£æ¥'}</span>
              </div>
            </div>

            <!-- æ–·é–‹é€£çµæŒ‰éˆ• -->
            <button class="disconnect-btn-mobile" id="disconnect-wallet-mobile" data-i18n-title="header.disconnect_wallet" title="æ–·é–‹éŒ¢åŒ…">
              <i class="fas fa-unlink"></i>
            </button>
          </div>

          <!-- SGT é¤˜é¡é¡¯ç¤º -->
          <div class="sgt-balance-mobile hidden" id="sgt-balance-mobile" title="ç²¾ç¢ºé¤˜é¡è¼‰å…¥ä¸­...">
            <img src="/assets/images/sgt-token-icon.webp" alt="SGT" class="balance-icon" />
            <span class="balance-amount" id="sgt-balance-amount-mobile">123.45</span>
          </div>

          <!-- ç¶²è·¯åˆ‡æ›æŒ‰éˆ• -->
          <button class="network-switch-btn-mobile hidden" id="switch-to-polygon-mobile">
            <i class="fas fa-exchange-alt"></i> <span data-i18n="header.switch_to_polygon">{trans.header?.switch_to_polygon || 'åˆ‡æ›è‡³ Polygon'}</span>
          </button>

          <!-- èªè¨€åˆ‡æ›å™¨ï¼ˆå…±ç”¨ï¼Œæœƒè¢« JS ç§»å‹•åˆ°é€™è£¡ï¼‰ -->
          <div class="mobile-language-switcher" id="mobile-language-container">
            <!-- èªè¨€åˆ‡æ›å™¨æœƒè¢« JS ç§»å‹•åˆ°é€™è£¡ -->
          </div>

          <!-- Dark Mode åˆ‡æ›é–‹é—œï¼ˆå…±ç”¨ï¼Œæœƒè¢« JS ç§»å‹•åˆ°é€™è£¡ï¼‰ -->
          <div class="theme-switch-wrapper-mobile" id="mobile-theme-container">
            <span class="theme-label" data-i18n="header.theme">{trans.header?.theme || 'ä¸»é¡Œ'}</span>
            <!-- ä¸»é¡Œåˆ‡æ›å™¨æœƒè¢« JS ç§»å‹•åˆ°é€™è£¡ -->
          </div>
        </div>
      </div>

      <!-- é¸å–®é®ç½©å±¤ -->
      <div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>

      <!-- å…±ç”¨å…ƒä»¶å®¹å™¨ï¼ˆåªåœ¨æ¡Œé¢ç‰ˆé¡¯ç¤ºï¼Œè¡Œå‹•ç‰ˆæ™‚æœƒè¢«ç§»å‹•ï¼‰ -->
      <div id="shared-controls-container" class="desktop-only">
        <!-- èªè¨€åˆ‡æ›å™¨ï¼ˆå…±ç”¨ï¼‰ -->
        <LanguageSwitcher currentLang={lang} currentPath={Astro.url.pathname} />

        <!-- Dark Mode åˆ‡æ›é–‹é—œï¼ˆå…±ç”¨ï¼‰ -->
        <div class="theme-switch-wrapper" id="shared-theme-switch">
          <span class="theme-icon"><i class="fas fa-sun"></i></span>
          <label class="theme-switch">
            <input type="checkbox" id="theme-toggle" />
            <span class="slider"></span>
          </label>
          <span class="theme-icon"><i class="fas fa-moon"></i></span>
        </div>
      </div>
  </header>

  <div class="rpg-interface">
    <div class="game-container">
      <!-- ç‹€æ…‹åˆ— -->
      <StatusBar lang={lang} />

      <!-- é ç±¤å°èˆª -->
      <GameTabs lang={lang} activeTab="status" />

      <!-- é ç±¤å…§å®¹å€åŸŸ -->
      <div class="tab-content">
        <!-- ç‹€æ…‹é¢æ¿ -->
        <div class="tab-panel active" id="status-tab">
          <div class="status-panel">
            <!-- å±¬æ€§å€å¡Š -->
            <div class="attributes-section">
              <h3 data-i18n="attributes.title">{trans.attributes?.title || 'å±¬æ€§é»æ•¸'}</h3>
              <div class="attribute-list">
                {attributes.map((attr) => (
                  <div class="attribute-item">
                    <div class="attr-name-container">
                      <img
                        src={`/assets/images/attr-${attr.icon || attr.key.toLowerCase()}.webp`}
                        alt={attr.key}
                        class="attr-icon"
                        width={attr.key === 'DLN' || attr.key === 'LUK' ? '90' : '128'}
                        height={attr.key === 'DLN' || attr.key === 'LUK' ? '90' : '128'}
                        data-i18n-title={attr.tooltipKey}
                        title={attr.tooltip}
                      />
                      <span class="attr-name" data-i18n={`attributes.${attr.key.toLowerCase()}`}>{attr.key}</span>
                    </div>
                    <span class="attr-value">{attr.value}</span>
                    <div class="attr-bar">
                      <div class={`attr-fill ${attr.barClass || ''}`} style={`width: ${attr.value}%`}></div>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <!-- ç‹€æ…‹è³‡è¨Šå€å¡Š -->
            <div class="stats-section">
              <h3 data-i18n="status_info.title">{trans.status_info?.title || 'ç‹€æ…‹è³‡è¨Š'}</h3>
              <div class="time-stats">
                <div class="time-stat-item">
                  <span class="time-label" data-i18n="status_info.dev_time">{trans.status_info?.dev_time || 'é–‹ç™¼æ™‚é–“'}</span>
                  <span class="time-value" id="developer-time">è¼‰å…¥ä¸­...</span>
                </div>
                <div class="time-stat-item">
                  <span class="time-label" data-i18n="status_info.camp_time">{trans.status_info?.camp_time || 'æ“šé»ç¶“ç‡Ÿæ™‚é–“'}</span>
                  <span class="time-value" id="camp-time">è¼‰å…¥ä¸­...</span>
                </div>
              </div>
              <div class="buff-container">
                <h4 data-i18n="status_info.buffs">{trans.status_info?.buffs || 'å¢ç›Šæ•ˆæœ'}</h4>
                <div class="buff-list">
                  <div class="buff-item" data-i18n-title="status_info.buff_coffee_desc" title="å’–å•¡åŠ æˆï¼šç·¨ç¢¼é€Ÿåº¦ +50%">
                    <img src="/assets/images/buff-coffee.webp" width="90" height="91" data-i18n-alt="status_info.buff_coffee" alt="å’–å•¡åŠ æˆ" class="buff-icon-img" />
                  </div>
                  <div class="buff-item" data-i18n-title="status_info.buff_focus_desc" title="å°ˆæ³¨æ¨¡å¼ï¼šéŒ¯èª¤ç‡ -30%">
                    <img src="/assets/images/buff-focus.webp" width="90" height="90" data-i18n-alt="status_info.buff_focus" alt="å°ˆæ³¨æ¨¡å¼" class="buff-icon-img" />
                  </div>
                  <div class="buff-item" data-i18n-title="status_info.buff_night_owl_desc" title="å¤œè²“å­ï¼šå¤œé–“æ•ˆç‡ +20%">
                    <img src="/assets/images/buff-night-owl.webp" width="90" height="90" data-i18n-alt="status_info.buff_night_owl" alt="å¤œè²“åŠ æˆ" class="buff-icon-img" />
                  </div>
                  <div class="buff-item" data-i18n-title="status_info.buff_inspiration_desc" title="éˆæ„Ÿï¼šè§£æ±ºå•é¡Œçš„é€Ÿåº¦ +40%">
                    <img src="/assets/images/buff-inspiration.webp" width="90" height="90" data-i18n-alt="status_info.buff_inspiration" alt="éˆæ„Ÿ" class="buff-icon-img" />
                  </div>
                </div>
              </div>
              <div class="debuff-container">
                <h4 data-i18n="status_info.debuffs">{trans.status_info?.debuffs || 'æ¸›ç›Šæ•ˆæœ'}</h4>
                <div class="debuff-list">
                  <div class="debuff-item" data-i18n-title="status_info.debuff_fatigue_desc" title="ç–²å‹ï¼šæ•´é«”æ•ˆç‡ -25%">
                    <img src="/assets/images/debuff-fatigue.webp" width="70" height="70" data-i18n-alt="status_info.debuff_fatigue" alt="ç–²å‹" class="debuff-icon-img" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- æŠ€èƒ½é¢æ¿ -->
        <div class="tab-panel" id="skills-tab">
          <SkillTreePanel lang={lang} />
        </div>

        <!-- æ•…äº‹é¢æ¿ -->
        <div class="tab-panel" id="story-tab">
          <div class="story-panel">
            <h3 data-i18n="story.title">{trans.story?.title || 'å†’éšªè€…æª”æ¡ˆ'}</h3>
            <div class="story-content">
              <p data-i18n="story.intro1">{trans.story?.intro1 || 'å¾å»¢ç‰©åˆ°å·¥ç¨‹å¸«çš„é€²åŒ–ä¹‹è·¯ï¼Œé€™æ˜¯ä¸€å€‹å……æ»¿æŒ‘æˆ°èˆ‡æˆé•·çš„å†’éšªæ•…äº‹...'}</p>
              <p data-i18n="story.intro2">{trans.story?.intro2 || 'æ›¾ç¶“æ˜¯å€‹å°ç¨‹å¼ä¸€ç«…ä¸é€šçš„éº»ç“œï¼Œç¶“éä¸æ–·çš„å­¸ç¿’èˆ‡å¯¦æˆ°ï¼Œå¦‚ä»Šå·²æˆç‚ºèƒ½å¤ ç¨ç•¶ä¸€é¢çš„å…¨ç«¯é–‹ç™¼è€…ã€‚'}</p>
              <p data-i18n="story.intro3">{trans.story?.intro3 || 'æ“…é•·å°‡è¤‡é›œçš„æŠ€è¡“æ¦‚å¿µè½‰åŒ–ç‚ºæ˜“æ‡‚çš„æ•™å­¸å…§å®¹ï¼ŒåŒæ™‚ç†±æ„›æ¢ç´¢æ–°æŠ€è¡“ï¼Œå°‡å…¶æ‡‰ç”¨æ–¼å¯¦éš›å°ˆæ¡ˆä¸­ã€‚'}</p>
            </div>
            <div class="timeline">
              <div class="timeline-item">
                <span class="timeline-date">2020.03</span>
                <span class="timeline-event" data-i18n="story.timeline_start">{trans.story?.timeline_start || 'è¸ä¸Šç¨‹å¼å†’éšªä¹‹è·¯'}</span>
              </div>
              <div class="timeline-item">
                <span class="timeline-date">2021.06</span>
                <span class="timeline-event" data-i18n="story.timeline_first_project">{trans.story?.timeline_first_project || 'å®Œæˆç¬¬ä¸€å€‹å•†æ¥­å°ˆæ¡ˆ'}</span>
              </div>
              <div class="timeline-item">
                <span class="timeline-date">2022.09</span>
                <span class="timeline-event" data-i18n="story.timeline_blockchain">{trans.story?.timeline_blockchain || 'åŠ å…¥å€å¡Šéˆé–‹ç™¼è¡Œåˆ—'}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ç‰©å“æ¬„é¢æ¿ -->
        <div class="tab-panel" id="inventory-tab">
          <InventoryPanel lang={lang} />
        </div>

        <!-- æˆå°±é¢æ¿ -->
        <div class="tab-panel" id="achievements-tab">
          <AchievementsPanel lang={lang} />
        </div>

        <!-- å¤¥ä¼´é¢æ¿ï¼ˆå«å¬å–šç³»çµ±ï¼‰ -->
        <div class="tab-panel" id="party-tab">
          <div class="summon-system">
            <!-- å¬å–šå€åŸŸ -->
            <div class="summon-section">
              <!-- å¬å–šé–€èƒŒæ™¯å€åŸŸ -->
              <div class="summon-portal-container">
                <picture>
                  <source srcset="/assets/images/summon-portal-bg.webp" type="image/webp" />
                  <img
                    src="/assets/images/summon-portal-bg.webp"
                    alt={trans.summon?.portal_alt || 'å¬å–šé–€'}
                    class="portal-background"
                    id="portalImage"
                    width="800"
                    height="800"
                    loading="lazy"
                  />
                </picture>

                <!-- å¬å–šå‹•ç•«å½±ç‰‡ -->
                <video id="summonVideo" class="summon-animation-video" preload="auto" playsinline muted>
                  <source src="/assets/video/summon-animation.mp4" type="video/mp4" />
                  {trans.summon?.video_not_supported || 'æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å½±ç‰‡æ’­æ”¾ã€‚'}
                </video>

                <!-- å¬å–šå…‰æšˆç‰¹æ•ˆ -->
                <div id="summonAura" class="summon-aura"></div>

                <!-- ç²’å­ç‰¹æ•ˆå®¹å™¨ -->
                <div id="particleContainer" class="particle-container"></div>

                <!-- å¯é»æ“Šçš„å¬å–šé–€å€åŸŸ -->
                <div
                  class="portal-interactive-area"
                  id="portalInteractiveArea"
                  onclick="performSummon()"
                  onmouseenter="showSummonTooltip(event)"
                  onmousemove="updateSummonTooltipPosition(event)"
                  onmouseleave="hideSummonTooltip()"
                >
                  <!-- å¬å–šç‰¹æ•ˆç’° -->
                  <div class="portal-ring portal-ring-1"></div>
                  <div class="portal-ring portal-ring-2"></div>
                  <div class="portal-ring portal-ring-3"></div>
                  <div class="portal-center">
                    <div class="portal-glow"></div>
                  </div>
                </div>

                <!-- å¬å–šè²»ç”¨æç¤ºå·¥å…· -->
                <div class="summon-tooltip" id="summonTooltip">
                  <div class="tooltip-content">
                    <div class="tooltip-title" data-i18n="ui.summon.click_to_summon">
                      {trans.summon?.click_to_summon || 'é»æ“Šå¬å–šå¤¥ä¼´'}
                    </div>
                    <div class="tooltip-cost">
                      <img
                        src="/assets/images/pile_of_gold_coins.webp"
                        alt={trans.summon?.gold_coin || 'é‡‘å¹£'}
                        class="tooltip-coin"
                        width="256"
                        height="256"
                      />
                      <span>10,000 {trans.summon?.gold || 'é‡‘å¹£'}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- å¤¥ä¼´æ”¶è—å€åŸŸ -->
          <div class="companion-collection">
            <!-- æ¨™é¡Œå’Œæ”¶é›†ç‡å€åŸŸ -->
            <div class="collection-header">
              <h3 class="collection-title" data-i18n="ui.summon.companion_collection">
                {trans.summon?.companion_collection || 'å¤¥ä¼´åœ–é‘‘'}
              </h3>
              <div class="collection-stats">
                <div class="stats-row">
                  <div class="progress-bar-container">
                    <div class="collection-progress-bar" id="collection-progress-bar" style="width: 0%"></div>
                  </div>
                  <div class="progress-info">
                    <span id="collected-count">0</span> / <span id="total-count">0</span>
                    (<span id="collection-percentage">0%</span>)
                  </div>
                </div>
              </div>
            </div>

            <!-- çµ±ä¸€çš„å¤¥ä¼´ç¶²æ ¼ -->
            <div class="companion-grid unified-grid" id="companion-grid">
              <!-- æ‰€æœ‰å¤¥ä¼´å¡ç‰‡å°‡ç”± JavaScript ç”Ÿæˆ -->
            </div>
          </div>

          <!-- å¬å–šçµæœæ¨¡æ…‹æ¡† -->
          <div class="summon-result-modal" id="summonResultModal">
            <div class="modal-content">
              <div class="modal-header">
                <h3 id="modalTitle"></h3>
                <button class="close-btn" id="closeModalBtn" onclick="closeSummonResult()">Ã—</button>
              </div>
              <div class="companion-showcase">
                <div class="companion-image">
                  <img src="" alt={trans.summon?.companion_portrait || 'å¤¥ä¼´ç«‹ç¹ª'} id="companionImage" />
                  <div class="companion-frame"></div>
                </div>
                <div class="companion-details">
                  <div class="rarity-stars" id="rarityStars"></div>
                  <h4 class="companion-name" id="companionName"></h4>
                  <p class="companion-description" id="companionDescription"></p>
                  <div class="companion-skills" id="companionSkills"></div>
                </div>
              </div>
            </div>
            <div class="modal-background" id="modalBackground"></div>
          </div>
        </div>

        <!-- è³¼è²·é¢æ¿ -->
        <div class="tab-panel" id="purchase-tab">
          <div class="purchase-panel">
            <div class="purchase-header">
              <h3>
                <img src="/assets/images/sgt-token-icon.webp" alt="SGT" class="purchase-title-icon" width="128" height="128" />
                <span data-i18n="ui.purchase.sgt_token_center">{trans.ui?.purchase?.sgt_token_center || 'SGT ä»£å¹£ä¸­å¿ƒ'}</span>
              </h3>
              <div class="purchase-network-status" id="purchase-network-status">
                <span class="network-indicator" id="purchase-network-indicator">ğŸ”´</span>
                <span id="purchase-network-name" data-i18n="purchase_manager.network.not_connected">{trans.purchase_manager?.network?.not_connected || 'æœªé€£æ¥'}</span>
              </div>
            </div>

            <!-- å…§éƒ¨é ç±¤å°èˆª -->
            <div class="inner-tabs-nav">
              <button class="inner-tab-btn active" data-tab="sgt-info-content">
                <div class="tab-icon"><i class="fas fa-star"></i></div>
                <span data-i18n="purchase.sgt_intro_service">{trans.purchase?.sgt_intro_service || 'SGT ä»‹ç´¹èˆ‡æœå‹™'}</span>
                <div class="tab-glow"></div>
              </button>
              <button class="inner-tab-btn" data-tab="purchase-content">
                <div class="tab-icon"><i class="fas fa-coins"></i></div>
                <span data-i18n="purchase.buy_tokens">{trans.purchase?.buy_tokens || 'è³¼è²·ä»£å¹£'}</span>
                <div class="tab-glow"></div>
              </button>
              <div class="tab-indicator"></div>
            </div>

            <!-- å…§éƒ¨é ç±¤å…§å®¹ -->
            <div class="inner-tabs-content">
              <!-- è³¼è²·ä»£å¹£é ç±¤ -->
              <div class="inner-tab-panel" id="purchase-content">
                <!-- è³¼è²·å€åŸŸ - æ™ºèƒ½çµ‚ç«¯æ©Ÿ -->
                <div class="purchase-section" id="purchase-section">
                  <!-- çµ‚ç«¯æ©Ÿæœƒç”± cyber-terminal.js å‹•æ…‹æ’å…¥åˆ°é€™è£¡ -->
                </div>
              </div>

              <!-- SGT ä»‹ç´¹é ç±¤ -->
              <div class="inner-tab-panel active" id="sgt-info-content">
                <div class="sgt-intro-section">
                  <div class="intro-hero">
                    <div class="hero-content">
                      <div class="token-showcase">
                        <img src="/assets/images/sgt-token-icon.webp" alt="SGT" class="showcase-token" width="128" height="128" />
                      </div>
                      <h2 data-i18n="ui.purchase_page.sgt_intro.title">{trans.ui?.purchase_page?.sgt_intro?.title || 'SuperGalen Token (SGT)'}</h2>
                      <p class="hero-subtitle" data-i18n="ui.purchase_page.sgt_intro.subtitle">{trans.ui?.purchase_page?.sgt_intro?.subtitle || 'é€£æ¥è“‹å€«æŠ€è¡“èˆ‡æœå‹™çš„ä»£å¹£'}</p>
                    </div>
                  </div>

                  <!-- SGT æ ¸å¿ƒè³‡è¨Š -->
                  <div class="sgt-core-info">
                    <div class="tech-grid">
                      <div class="tech-item">
                        <div class="tech-icon"><i class="fas fa-shield-alt"></i></div>
                        <div class="tech-label" data-i18n="ui.purchase_page.sgt_intro.tech_info.erc20_label">{trans.ui?.purchase_page?.sgt_intro?.tech_info?.erc20_label || 'ERC-20'}</div>
                        <div class="tech-value" data-i18n="ui.purchase_page.sgt_intro.tech_info.erc20_value">{trans.ui?.purchase_page?.sgt_intro?.tech_info?.erc20_value || 'æ¨™æº–ä»£å¹£'}</div>
                      </div>
                      <div class="tech-item">
                        <div class="tech-icon"><i class="fas fa-coins"></i></div>
                        <div class="tech-label" data-i18n="ui.purchase_page.sgt_intro.tech_info.total_supply_label">{trans.ui?.purchase_page?.sgt_intro?.tech_info?.total_supply_label || 'ç¸½ä¾›æ‡‰é‡'}</div>
                        <div class="tech-value" data-i18n="ui.purchase_page.sgt_intro.tech_info.total_supply_value">{trans.ui?.purchase_page?.sgt_intro?.tech_info?.total_supply_value || '100M SGT'}</div>
                      </div>
                      <div class="tech-item">
                        <div class="tech-icon"><i class="fas fa-exchange-alt"></i></div>
                        <div class="tech-label" data-i18n="ui.purchase_page.sgt_intro.tech_info.exchange_rate_label">{trans.ui?.purchase_page?.sgt_intro?.tech_info?.exchange_rate_label || 'å…Œæ›ç‡'}</div>
                        <div class="tech-value" data-i18n="ui.purchase_page.sgt_intro.tech_info.exchange_rate_value">{trans.ui?.purchase_page?.sgt_intro?.tech_info?.exchange_rate_value || '1 USDT = 30 SGT'}</div>
                      </div>
                      <div class="tech-item">
                        <div class="tech-icon"><i class="fas fa-lock"></i></div>
                        <div class="tech-label" data-i18n="ui.purchase_page.sgt_intro.tech_info.inflation_label">{trans.ui?.purchase_page?.sgt_intro?.tech_info?.inflation_label || 'é€šè†¨æ§åˆ¶'}</div>
                        <div class="tech-value" data-i18n="ui.purchase_page.sgt_intro.tech_info.inflation_value">{trans.ui?.purchase_page?.sgt_intro?.tech_info?.inflation_value || 'é›¶é€šè†¨'}</div>
                      </div>
                    </div>
                  </div>

                  <!-- å°ˆæ¥­æœå‹™å€åŸŸ -->
                  <div class="services-section">
                    <div class="services-hero">
                      <h2 class="services-title">
                        <i class="fas fa-code"></i>
                        <span data-i18n="ui.purchase_page.services.title">{trans.ui?.purchase_page?.services?.title || 'å°ˆæ¥­æŠ€è¡“æœå‹™'}</span>
                      </h2>
                      <p class="services-subtitle" data-i18n="ui.purchase_page.services.subtitle">{trans.ui?.purchase_page?.services?.subtitle || 'SuperGalen æä¾›å…¨æ–¹ä½æŠ€è¡“æœå‹™ï¼Œå¾æ§‹æƒ³åˆ°å¯¦ç¾çš„å®Œæ•´è§£æ±ºæ–¹æ¡ˆ'}</p>

                      <!-- æœå‹™é …ç›®èªªæ˜ -->
                      <div class="services-overview">
                        <div class="services-grid">
                          <div class="service-item">
                            <div class="service-icon"><i class="fas fa-globe"></i></div>
                            <h4 data-i18n="ui.purchase_page.services.items.web_development.title">{trans.ui?.purchase_page?.services?.items?.web_development?.title || 'ç¶²ç«™é–‹ç™¼'}</h4>
                            <p data-i18n="ui.purchase_page.services.items.web_development.description">{trans.ui?.purchase_page?.services?.items?.web_development?.description || 'ç¾ä»£åŒ–éŸ¿æ‡‰å¼ç¶²ç«™ï¼ŒåŒ…å«å‰ç«¯è¨­è¨ˆã€å¾Œç«¯é–‹ç™¼ã€è³‡æ–™åº«è¨­è¨ˆåŠ SEO å„ªåŒ–'}</p>
                          </div>
                          <div class="service-item">
                            <div class="service-icon"><i class="fas fa-blog"></i></div>
                            <h4 data-i18n="ui.purchase_page.services.items.blog_setup.title">{trans.ui?.purchase_page?.services?.items?.blog_setup?.title || 'éƒ¨è½æ ¼æ¶è¨­'}</h4>
                            <p data-i18n="ui.purchase_page.services.items.blog_setup.description">{trans.ui?.purchase_page?.services?.items?.blog_setup?.description || 'Jekyllã€WordPress ç­‰å¹³å°éƒ¨è½æ ¼å»ºç½®ï¼ŒåŒ…å«ä¸»é¡Œè¨­è¨ˆã€å…§å®¹ç®¡ç†åŠæ•ˆèƒ½å„ªåŒ–'}</p>
                          </div>
                          <div class="service-item">
                            <div class="service-icon"><i class="fas fa-cubes"></i></div>
                            <h4 data-i18n="ui.purchase_page.services.items.blockchain_dev.title">{trans.ui?.purchase_page?.services?.items?.blockchain_dev?.title || 'å€å¡Šéˆé–‹ç™¼'}</h4>
                            <p data-i18n="ui.purchase_page.services.items.blockchain_dev.description">{trans.ui?.purchase_page?.services?.items?.blockchain_dev?.description || 'æ™ºèƒ½åˆç´„é–‹ç™¼ã€DApp å»ºç½®ã€ä»£å¹£ç¶“æ¿Ÿè¨­è¨ˆåŠå€å¡Šéˆæ‡‰ç”¨æ•´åˆ'}</p>
                          </div>
                          <div class="service-item">
                            <div class="service-icon"><i class="fas fa-user-tie"></i></div>
                            <h4 data-i18n="ui.purchase_page.services.items.technical_consulting.title">{trans.ui?.purchase_page?.services?.items?.technical_consulting?.title || 'æŠ€è¡“è«®è©¢'}</h4>
                            <p data-i18n="ui.purchase_page.services.items.technical_consulting.description">{trans.ui?.purchase_page?.services?.items?.technical_consulting?.description || 'æ¶æ§‹è¨­è¨ˆã€æŠ€è¡“é¸å‹ã€ä»£ç¢¼å¯©æŸ¥ã€æ€§èƒ½å„ªåŒ–åŠæŠ€è¡“åœ˜éšŠæŒ‡å°'}</p>
                          </div>
                          <div class="service-item">
                            <div class="service-icon"><i class="fas fa-robot"></i></div>
                            <h4 data-i18n="ui.purchase_page.services.items.ai_consulting.title">{trans.ui?.purchase_page?.services?.items?.ai_consulting?.title || 'AI å·¥å…·è«®è©¢'}</h4>
                            <p data-i18n="ui.purchase_page.services.items.ai_consulting.description">{trans.ui?.purchase_page?.services?.items?.ai_consulting?.description || 'AI å·¥å…·æ•´åˆã€è‡ªå‹•åŒ–æµç¨‹è¨­è¨ˆã€æ©Ÿå™¨å­¸ç¿’æ‡‰ç”¨åŠ AI ç­–ç•¥è¦åŠƒ'}</p>
                          </div>
                          <div class="service-item">
                            <div class="service-icon"><i class="fas fa-mobile-alt"></i></div>
                            <h4 data-i18n="ui.purchase_page.services.items.system_integration.title">{trans.ui?.purchase_page?.services?.items?.system_integration?.title || 'ç³»çµ±æ•´åˆ'}</h4>
                            <p data-i18n="ui.purchase_page.services.items.system_integration.description">{trans.ui?.purchase_page?.services?.items?.system_integration?.description || 'API ä¸²æ¥ã€ç¬¬ä¸‰æ–¹æœå‹™æ•´åˆã€è³‡æ–™åº«é·ç§»åŠå¾®æœå‹™æ¶æ§‹è¨­è¨ˆ'}</p>
                          </div>
                        </div>

                        <!-- SGT æŠ˜æ‰£èªªæ˜ -->
                        <div class="sgt-discount-notice">
                          <div class="discount-content">
                            <div class="discount-icon"><i class="fas fa-tags"></i></div>
                            <div class="discount-text">
                              <h4 data-i18n="ui.purchase_page.sgt_benefits.title">{trans.ui?.purchase_page?.sgt_benefits?.title || 'SGT ä»£å¹£æ”¯ä»˜å„ªæƒ '}</h4>
                              <p data-i18n="ui.purchase_page.sgt_benefits.savings">{trans.ui?.purchase_page?.sgt_benefits?.savings || 'ä½¿ç”¨ SGT ä»£å¹£æ”¯ä»˜äº«æœ‰ 9 æŠ˜å„ªæƒ ï¼Œç›¸è¼ƒæ–¼ USDT/TWD æ”¯ä»˜å¯ç¯€çœ 10% è²»ç”¨'}</p>
                              <div class="discount-features">
                                <span class="feature-tag"><i class="fas fa-percent"></i> <span data-i18n="ui.purchase_page.sgt_benefits.discount">{trans.ui?.purchase_page?.sgt_benefits?.discount || '9 æŠ˜å„ªæƒ '}</span></span>
                                <span class="feature-tag"><i class="fas fa-star"></i> <span data-i18n="ui.purchase_page.sgt_benefits.priority">{trans.ui?.purchase_page?.sgt_benefits?.priority || 'å„ªå…ˆæ’ç¨‹'}</span></span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="services-content">
                      <!-- æœå‹™æ–¹æ¡ˆå¡ç‰‡ -->
                      <div class="service-tiers">
                        <div class="tier-card basic">
                          <div class="tier-header">
                            <div class="tier-icon"><i class="fas fa-comments"></i></div>
                            <h3 data-i18n="ui.purchase_page.casual_chat.title">{trans.ui?.purchase_page?.casual_chat?.title || 'è¼•é¬†å°è©±'}</h3>
                            <div class="tier-duration">
                              <i class="fas fa-clock"></i>
                              <span data-i18n="ui.purchase_page.casual_chat.duration">{trans.ui?.purchase_page?.casual_chat?.duration || 'è“‹å€«ç„¡æº–å‚™ | 1 å°æ™‚è«®è©¢'}</span>
                            </div>
                            <div class="tier-price">
                              <span class="price" data-i18n="ui.purchase_page.casual_chat.price_sgt">{trans.ui?.purchase_page?.casual_chat?.price_sgt || '270 SGT'}</span>
                              <span class="price-alt" data-i18n="ui.purchase_page.casual_chat.price_alt">{trans.ui?.purchase_page?.casual_chat?.price_alt || 'æˆ– 10 USDT'}</span>
                            </div>
                          </div>
                        </div>

                        <div class="tier-card professional popular">
                          <div class="popular-badge" data-i18n="ui.purchase_page.professional_consultation.popular_badge">{trans.ui?.purchase_page?.professional_consultation?.popular_badge || 'æ¨è–¦'}</div>
                          <div class="tier-header">
                            <div class="tier-icon"><i class="fas fa-bullseye"></i></div>
                            <h3 data-i18n="ui.purchase_page.professional_consultation.title">{trans.ui?.purchase_page?.professional_consultation?.title || 'å°ˆæ¥­è«®è©¢'}</h3>
                            <div class="tier-duration">
                              <i class="fas fa-clock"></i>
                              <span data-i18n="ui.purchase_page.professional_consultation.duration">{trans.ui?.purchase_page?.professional_consultation?.duration || 'è“‹å€« 1-2 å¤©æº–å‚™ | 1 å°æ™‚'}</span>
                            </div>
                            <div class="tier-price">
                              <span class="price" data-i18n="ui.purchase_page.professional_consultation.price_sgt">{trans.ui?.purchase_page?.professional_consultation?.price_sgt || '540 SGT'}</span>
                              <span class="price-alt" data-i18n="ui.purchase_page.professional_consultation.price_alt">{trans.ui?.purchase_page?.professional_consultation?.price_alt || 'æˆ– 20 USDT'}</span>
                            </div>
                          </div>
                        </div>

                        <div class="tier-card expert">
                          <div class="tier-header">
                            <div class="tier-icon"><i class="fas fa-microscope"></i></div>
                            <h3 data-i18n="ui.purchase_page.deep_dive.title">{trans.ui?.purchase_page?.deep_dive?.title || 'æ·±åº¦è¨è«–'}</h3>
                            <div class="tier-duration">
                              <i class="fas fa-clock"></i>
                              <span data-i18n="ui.purchase_page.deep_dive.duration">{trans.ui?.purchase_page?.deep_dive?.duration || 'è“‹å€« 3-5 å¤©æº–å‚™ | 1 å°æ™‚'}</span>
                            </div>
                            <div class="tier-price">
                              <span class="price" data-i18n="ui.purchase_page.deep_dive.price_sgt">{trans.ui?.purchase_page?.deep_dive?.price_sgt || '810 SGT'}</span>
                              <span class="price-alt" data-i18n="ui.purchase_page.deep_dive.price_alt">{trans.ui?.purchase_page?.deep_dive?.price_alt || 'æˆ– 30 USDT'}</span>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- æ¥æ¡ˆåˆä½œæµç¨‹ -->
                      <div class="consultation-info">
                        <div class="consultation-header">
                          <h3><i class="fas fa-handshake"></i> <span data-i18n="ui.purchase_page.consultation_workflow.title">{trans.ui?.purchase_page?.consultation_workflow?.title || 'æ¥æ¡ˆåˆä½œæµç¨‹'}</span></h3>
                          <p data-i18n="ui.purchase_page.consultation_workflow.description">{trans.ui?.purchase_page?.consultation_workflow?.description || 'å°ˆæ¥­æ¥æ¡ˆæœå‹™ï¼Œå¾éœ€æ±‚è¨è«–åˆ°å°ˆæ¡ˆäº¤ä»˜çš„å®Œæ•´æµç¨‹'}</p>
                        </div>

                        <div class="process-steps">
                          <div class="step-item">
                            <div class="step-number">1</div>
                            <div class="step-content">
                              <h4 data-i18n="ui.purchase_page.consultation_workflow.steps.initial_consultation.title">{trans.ui?.purchase_page?.consultation_workflow?.steps?.initial_consultation?.title || 'åˆæ­¥è«®è©¢'}</h4>
                              <p>
                                <span data-i18n="ui.purchase_page.consultation_workflow.steps.initial_consultation.description">{trans.ui?.purchase_page?.consultation_workflow?.steps?.initial_consultation?.description || 'å…è²»éœ€æ±‚è¨è«–èˆ‡å¯è¡Œæ€§è©•ä¼°'}</span><br/>
                                <small><i class="fas fa-phone"></i> <span data-i18n="ui.purchase_page.consultation_workflow.steps.initial_consultation.note">{trans.ui?.purchase_page?.consultation_workflow?.steps?.initial_consultation?.note || 'ç´„ 15-30 åˆ†é˜ç·šä¸Šæœƒè­°'}</span></small>
                              </p>
                            </div>
                          </div>
                          <div class="step-item">
                            <div class="step-number">2</div>
                            <div class="step-content">
                              <h4 data-i18n="ui.purchase_page.consultation_workflow.steps.requirement_confirmation.title">{trans.ui?.purchase_page?.consultation_workflow?.steps?.requirement_confirmation?.title || 'éœ€æ±‚ç¢ºèª'}</h4>
                              <p>
                                <span data-i18n="ui.purchase_page.consultation_workflow.steps.requirement_confirmation.description">{trans.ui?.purchase_page?.consultation_workflow?.steps?.requirement_confirmation?.description || 'è©³ç´°è¦æ ¼åˆ¶å®šèˆ‡å ±åƒ¹æä¾›'}</span><br/>
                                <small><i class="fas fa-file-contract"></i> <span data-i18n="ui.purchase_page.consultation_workflow.steps.requirement_confirmation.note">{trans.ui?.purchase_page?.consultation_workflow?.steps?.requirement_confirmation?.note || 'æä¾›å®Œæ•´å°ˆæ¡ˆä¼åŠƒæ›¸'}</span></small>
                              </p>
                            </div>
                          </div>
                          <div class="step-item">
                            <div class="step-number">3</div>
                            <div class="step-content">
                              <h4 data-i18n="ui.purchase_page.consultation_workflow.steps.project_execution.title">{trans.ui?.purchase_page?.consultation_workflow?.steps?.project_execution?.title || 'å°ˆæ¡ˆåŸ·è¡Œ'}</h4>
                              <p>
                                <span data-i18n="ui.purchase_page.consultation_workflow.steps.project_execution.description">{trans.ui?.purchase_page?.consultation_workflow?.steps?.project_execution?.description || 'éšæ®µæ€§é–‹ç™¼èˆ‡å®šæœŸé€²åº¦å›å ±'}</span><br/>
                                <small><i class="fas fa-coins"></i> <span data-i18n="ui.purchase_page.consultation_workflow.steps.project_execution.note">{trans.ui?.purchase_page?.consultation_workflow?.steps?.project_execution?.note || 'æ”¯æ´ SGT ä»£å¹£ä»˜æ¬¾äº«å„ªæƒ '}</span></small>
                              </p>
                            </div>
                          </div>
                          <div class="step-item">
                            <div class="step-number">4</div>
                            <div class="step-content">
                              <h4 data-i18n="ui.purchase_page.consultation_workflow.steps.testing_acceptance.title">{trans.ui?.purchase_page?.consultation_workflow?.steps?.testing_acceptance?.title || 'æ¸¬è©¦é©—æ”¶'}</h4>
                              <p>
                                <span data-i18n="ui.purchase_page.consultation_workflow.steps.testing_acceptance.description">{trans.ui?.purchase_page?.consultation_workflow?.steps?.testing_acceptance?.description || 'åŠŸèƒ½æ¸¬è©¦èˆ‡å“è³ªé©—è­‰éšæ®µ'}</span><br/>
                                <small><i class="fas fa-check-circle"></i> <span data-i18n="ui.purchase_page.consultation_workflow.steps.testing_acceptance.note">{trans.ui?.purchase_page?.consultation_workflow?.steps?.testing_acceptance?.note || 'ç¢ºä¿å°ˆæ¡ˆç¬¦åˆéœ€æ±‚è¦æ ¼'}</span></small>
                              </p>
                            </div>
                          </div>
                          <div class="step-item">
                            <div class="step-number">5</div>
                            <div class="step-content">
                              <h4 data-i18n="ui.purchase_page.consultation_workflow.steps.maintenance.title">{trans.ui?.purchase_page?.consultation_workflow?.steps?.maintenance?.title || 'å¾ŒçºŒç¶­è­·'}</h4>
                              <p>
                                <span data-i18n="ui.purchase_page.consultation_workflow.steps.maintenance.description">{trans.ui?.purchase_page?.consultation_workflow?.steps?.maintenance?.description || 'äº¤ä»˜å¾Œçš„æŠ€è¡“æ”¯æ´èˆ‡ç¶­è­·'}</span><br/>
                                <small><i class="fas fa-tools"></i> <span data-i18n="ui.purchase_page.consultation_workflow.steps.maintenance.note">{trans.ui?.purchase_page?.consultation_workflow?.steps?.maintenance?.note || 'ä¾éœ€æ±‚æä¾›ç¶­è­·æœå‹™å ±åƒ¹'}</span></small>
                              </p>
                            </div>
                          </div>
                        </div>

                        <div class="features-grid">
                          <div class="feature-card">
                            <div class="feature-icon"><i class="fas fa-gift"></i></div>
                            <h4 data-i18n="ui.purchase_page.features.free_consultation.title">{trans.ui?.purchase_page?.features?.free_consultation?.title || 'å…è²»è«®è©¢'}</h4>
                            <p data-i18n="ui.purchase_page.features.free_consultation.description">{trans.ui?.purchase_page?.features?.free_consultation?.description || 'åˆæ­¥è«®è©¢å®Œå…¨å…è²»ï¼Œç„¡éš±è—è²»ç”¨'}</p>
                          </div>
                          <div class="feature-card">
                            <div class="feature-icon"><i class="fas fa-credit-card"></i></div>
                            <h4 data-i18n="ui.purchase_page.features.flexible_payment.title">{trans.ui?.purchase_page?.features?.flexible_payment?.title || 'å½ˆæ€§ä»˜æ¬¾'}</h4>
                            <p data-i18n="ui.purchase_page.features.flexible_payment.description">{trans.ui?.purchase_page?.features?.flexible_payment?.description || 'æ”¯æ´ SGT ä»£å¹£ä»˜æ¬¾äº«å„ªæƒ åƒ¹æ ¼'}</p>
                          </div>
                          <div class="feature-card">
                            <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
                            <h4 data-i18n="ui.purchase_page.features.quality_guarantee.title">{trans.ui?.purchase_page?.features?.quality_guarantee?.title || 'å“è³ªä¿è­‰'}</h4>
                            <p data-i18n="ui.purchase_page.features.quality_guarantee.description">{trans.ui?.purchase_page?.features?.quality_guarantee?.description || 'éšæ®µæ€§äº¤ä»˜ç¢ºèªï¼Œç¢ºä¿å°ˆæ¡ˆå“è³ª'}</p>
                          </div>
                          <div class="feature-card">
                            <div class="feature-icon"><i class="fas fa-headset"></i></div>
                            <h4 data-i18n="ui.purchase_page.features.long_term_support.title">{trans.ui?.purchase_page?.features?.long_term_support?.title || 'é•·æœŸæ”¯æ´'}</h4>
                            <p>
                              <span data-i18n="ui.purchase_page.features.long_term_support.description">{trans.ui?.purchase_page?.features?.long_term_support?.description || 'æä¾›å”®å¾ŒæŠ€è¡“æ”¯æ´èˆ‡ç¶­è­·æœå‹™'}</span><br/>
                              <small><i class="fas fa-calculator"></i> <span data-i18n="ui.purchase_page.features.long_term_support.note">{trans.ui?.purchase_page?.features?.long_term_support?.note || 'ä¾æ“šéœ€æ±‚æ”¶è²»'}</span></small>
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- é–‹ç™¼è€…ä½œå¼Šæ¨¡æ…‹æ¡† -->
  <CheatModal />

  <!-- ç¶²ç«™é å°¾ -->
  <Footer lang={lang} />

  <!-- é›»å­å ±è¨‚é–±æµ®å‹•æŒ‰éˆ• -->
  <NewsletterSubscribe lang={lang} />
</BaseLayout>

<style>
  .rpg-interface {
    min-height: 100vh;
    background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
  }

  /* Header æ¨£å¼ç”±å…¨å±€ _header.scss æä¾› */

  .game-container {
    padding-top: 60px;
    max-width: 1400px;
    margin: 0 auto;
  }

  .tab-content {
    min-height: 500px;
  }

  .tab-panel {
    display: none;
    padding: 1.5rem;
    animation: fadeIn 0.3s ease;
  }

  .tab-panel.active {
    display: block;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .panel-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #ffd700;
    font-size: 1.25rem;
    margin: 0 0 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(255, 215, 0, 0.3);
  }

  /* å±¬æ€§é¢æ¿æ¨£å¼ */
  .attributes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }

  .attribute-item {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 8px;
    padding: 1rem;
    transition: all 0.2s ease;
  }

  .attribute-item:hover {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.05);
  }

  .attr-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .attr-key {
    background: #ffd700;
    color: #0a0e27;
    padding: 0.15rem 0.4rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: bold;
  }

  .attr-name {
    color: #e0e0e0;
    font-weight: 500;
  }

  .attr-value {
    margin-left: auto;
    color: #ffd700;
    font-weight: bold;
  }

  .attr-bar {
    height: 8px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 0.5rem;
  }

  /* .attr-fill æ¨£å¼ç”±å…¨å±€ _status-panel.scss æä¾›ï¼ŒåŒ…å«å„å±¬æ€§çš„ç‰¹æ®Šé¡è‰² */

  .attr-desc {
    margin: 0;
    font-size: 0.8rem;
    color: #888;
  }

  /* æŠ€èƒ½æ¨¹é¢æ¿ */
  .skill-tree-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
  }

  #skill-tree-canvas {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 8px;
    max-width: 100%;
  }

  .skill-tree-hint {
    color: #888;
    font-size: 0.85rem;
  }

  /* å…¶ä»–é¢æ¿é€šç”¨æ¨£å¼ */
  .story-panel,
  .inventory-panel,
  .achievements-panel,
  .party-panel,
  .purchase-panel {
    color: #e0e0e0;
  }

  .story-content {
    line-height: 1.8;
    background: rgba(0, 0, 0, 0.3);
    padding: 1.5rem;
    border-radius: 8px;
  }

  .inventory-grid,
  .achievements-grid,
  .party-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 0.5rem;
  }

  /* è³¼è²·é¢æ¿ */
  .purchase-content {
    max-width: 500px;
    margin: 0 auto;
  }

  .sgt-info {
    margin-top: 1.5rem;
    animation: fadeIn 0.3s ease;
  }

  .sgt-balance-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.25rem;
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 170, 0, 0.05));
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: 12px;
    margin-bottom: 1.5rem;
  }

  .sgt-icon {
    font-size: 2rem;
    color: #ffd700;
  }

  .sgt-details {
    display: flex;
    flex-direction: column;
  }

  .sgt-label {
    font-size: 0.85rem;
    color: #888;
  }

  .sgt-amount {
    font-size: 1.5rem;
    font-weight: bold;
    color: #ffd700;
  }

  .purchase-form {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 12px;
    padding: 1.5rem;
  }

  .form-group {
    margin-bottom: 1rem;
  }

  .form-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: #b0b0b0;
    font-size: 0.9rem;
  }

  .form-input {
    width: 100%;
    padding: 0.75rem 1rem;
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: 8px;
    color: #e0e0e0;
    font-size: 1rem;
    transition: border-color 0.2s;
  }

  .form-input:focus {
    outline: none;
    border-color: #ffd700;
  }

  .form-input::placeholder {
    color: #666;
  }

  .exchange-rate {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem;
    background: rgba(100, 149, 237, 0.1);
    border-radius: 8px;
    margin-bottom: 1rem;
    color: #6495ed;
    font-size: 0.9rem;
  }

  .purchase-btn {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 1rem;
    background: linear-gradient(135deg, #ffd700, #ffaa00);
    border: none;
    border-radius: 8px;
    color: #0a0e27;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .purchase-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
  }

  .purchase-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  @media (max-width: 768px) {
    .game-container {
      padding-top: 50px;
    }

    .tab-panel {
      padding: 1rem;
    }

    .attributes-grid {
      grid-template-columns: 1fr;
    }
  }

  /* ==================== Light Mode æ¨£å¼ ==================== */
  :global([data-theme="light"]) .attribute-item {
    background: rgba(241, 245, 249, 0.8);
    border-color: rgba(203, 213, 225, 0.5);
  }

  :global([data-theme="light"]) .attribute-item:hover {
    border-color: #d97706;
    background: rgba(217, 119, 6, 0.05);
  }

  :global([data-theme="light"]) .attr-name {
    color: #475569;
  }

  :global([data-theme="light"]) .attr-value {
    color: #d97706;
  }

  :global([data-theme="light"]) .attr-bar {
    background: rgba(203, 213, 225, 0.5);
  }

  :global([data-theme="light"]) .attr-desc {
    color: #64748b;
  }

  :global([data-theme="light"]) .attr-key {
    background: #d97706;
    color: #fff;
  }

  :global([data-theme="light"]) #skill-tree-canvas {
    background: rgba(241, 245, 249, 0.8);
    border-color: rgba(203, 213, 225, 0.5);
  }

  :global([data-theme="light"]) .skill-tree-hint {
    color: #64748b;
  }

  :global([data-theme="light"]) .story-content {
    background: rgba(241, 245, 249, 0.8);
    color: #1e293b;
  }

  :global([data-theme="light"]) .story-panel,
  :global([data-theme="light"]) .inventory-panel,
  :global([data-theme="light"]) .achievements-panel,
  :global([data-theme="light"]) .party-panel,
  :global([data-theme="light"]) .purchase-panel {
    color: #1e293b;
  }

  :global([data-theme="light"]) .panel-title {
    color: #d97706;
    border-bottom-color: rgba(217, 119, 6, 0.3);
  }
</style>

<script>
  // åˆå§‹åŒ–éŠæˆ²ç³»çµ±
  import { initGameState, getGameState } from '@scripts/core/gamestate';
  import { getWalletManager, initWalletManager } from '@scripts/web3/wallet-manager';
  import { initPurchaseManager, getPurchaseManager } from '@scripts/web3/purchase-manager';
  import { initSGTBalance, getSGTBalance } from '@scripts/web3/sgt-balance';
  import { getContractsConfig } from '@scripts/web3/contracts-config';

  // å…Œæ›æ¯”ä¾‹ï¼ˆ1 USDT = 30 SGTï¼Œèˆ‡åˆç´„ä¸€è‡´ï¼‰
  const EXCHANGE_RATE = 30;

  document.addEventListener('DOMContentLoaded', async () => {
    console.log('ğŸ® SuperGalen Dungeon åˆå§‹åŒ–ä¸­...');

    // åˆå§‹åŒ–éŠæˆ²ç‹€æ…‹
    initGameState();
    console.log('âœ“ éŠæˆ²ç‹€æ…‹å·²åˆå§‹åŒ–');

    // åˆå§‹åŒ– Web3 æ¨¡çµ„
    await initWalletManager();
    console.log('âœ“ éŒ¢åŒ…ç®¡ç†å™¨å·²åˆå§‹åŒ–');

    await initSGTBalance();
    console.log('âœ“ SGT é¤˜é¡é¡¯ç¤ºå™¨å·²åˆå§‹åŒ–');

    await initPurchaseManager();
    console.log('âœ“ è³¼è²·ç®¡ç†å™¨å·²åˆå§‹åŒ–');

    // ç›£è½éŠæˆ²äº‹ä»¶
    document.addEventListener('playerDied', () => {
      console.log('ğŸ’€ ç©å®¶æ­»äº¡ï¼Œé–‹å§‹å¾©æ´»å€’æ•¸...');
    });

    document.addEventListener('playerRevived', () => {
      console.log('âœ¨ ç©å®¶å·²å¾©æ´»ï¼');
    });

    document.addEventListener('gameStateUpdated', (e: Event) => {
      const customEvent = e as CustomEvent;
      console.log('ğŸ“Š éŠæˆ²ç‹€æ…‹æ›´æ–°:', customEvent.detail);
    });

    // è¨­ç½®è³¼è²·é¢æ¿äº’å‹•
    setupPurchasePanel();

    console.log('ğŸ° SuperGalen Dungeon æº–å‚™å°±ç·’ï¼');
  });

  function setupPurchasePanel() {
    const sgtInfoEl = document.getElementById('sgt-info');
    const usdtAmountInput = document.getElementById('usdt-amount') as HTMLInputElement;
    const exchangePreviewEl = document.getElementById('exchange-preview');
    const purchaseBtn = document.getElementById('purchase-btn');
    const sgtBalanceEl = document.getElementById('sgt-balance');

    // ç›£è½éŒ¢åŒ…é€£æ¥äº‹ä»¶
    document.addEventListener('wallet:connect', async (e: Event) => {
      const customEvent = e as CustomEvent;
      if (customEvent.detail?.success && sgtInfoEl) {
        sgtInfoEl.style.display = 'block';

        // æ›´æ–° SGT é¤˜é¡
        const sgtBalance = getSGTBalance();
        await sgtBalance.refresh();
      }
    });

    document.addEventListener('wallet:disconnect', () => {
      if (sgtInfoEl) {
        sgtInfoEl.style.display = 'none';
      }
      if (sgtBalanceEl) {
        sgtBalanceEl.textContent = '0.0000';
      }
    });

    // ç›£è½ SGT é¤˜é¡æ›´æ–°äº‹ä»¶
    document.addEventListener('sgtBalanceUpdated', (e: Event) => {
      const customEvent = e as CustomEvent;
      if (sgtBalanceEl && customEvent.detail?.newBalance) {
        const balance = parseFloat(customEvent.detail.newBalance);
        sgtBalanceEl.textContent = balance.toFixed(4);
      }
    });

    // è™•ç† USDT è¼¸å…¥è®Šæ›´
    usdtAmountInput?.addEventListener('input', () => {
      const usdtAmount = parseFloat(usdtAmountInput.value) || 0;
      const sgtAmount = usdtAmount * EXCHANGE_RATE;

      if (exchangePreviewEl) {
        exchangePreviewEl.textContent = `${usdtAmount} USDT = ${sgtAmount.toLocaleString()} SGT`;
      }

      if (purchaseBtn) {
        (purchaseBtn as HTMLButtonElement).disabled = usdtAmount <= 0;
      }
    });

    // è™•ç†è³¼è²·æŒ‰éˆ•é»æ“Š
    purchaseBtn?.addEventListener('click', async () => {
      const wallet = getWalletManager();
      const state = wallet.getState();

      if (!state.isConnected) {
        // å˜—è©¦é€£æ¥éŒ¢åŒ…
        await wallet.connect();
        return;
      }

      const usdtAmount = parseFloat(usdtAmountInput?.value || '0');
      if (usdtAmount <= 0) {
        alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ USDT æ•¸é‡');
        return;
      }

      // ä½¿ç”¨è³¼è²·ç®¡ç†å™¨åŸ·è¡Œè³¼è²·
      const purchaseManager = getPurchaseManager();
      await purchaseManager.purchaseSGT();
    });

    // æª¢æŸ¥åˆå§‹é€£æ¥ç‹€æ…‹
    try {
      const wallet = getWalletManager();
      const state = wallet.getState();
      if (state.isConnected && sgtInfoEl) {
        sgtInfoEl.style.display = 'block';
      }
    } catch {
      // éŒ¢åŒ…ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
    }
  }
</script>

<!-- i18n Adapter - å°‡ç¿»è­¯æš´éœ²çµ¦å‚³çµ±è…³æœ¬ -->
<script is:inline define:vars={{ trans, lang }}>
  window.i18n = {
    currentLanguage: lang,
    currentTranslations: trans,
    t: function(key) {
      const keys = key.split('.');
      let value = trans;
      for (const k of keys) {
        if (value && typeof value === 'object' && k in value) {
          value = value[k];
        } else {
          return key; // æ‰¾ä¸åˆ°ç¿»è­¯æ™‚è¿”å› key
        }
      }
      return typeof value === 'string' ? value : key;
    }
  };
  console.log('âœ… [i18n] Adapter åˆå§‹åŒ–å®Œæˆï¼Œèªè¨€:', lang);
</script>

<!-- è¨­ç½®èªè¨€åå¥½ï¼ˆå¿…é ˆåœ¨ i18n-manager.js ä¹‹å‰ï¼‰ -->
<script is:inline define:vars={{ lang }}>
  // å¾ URL è·¯å¾‘è¨­ç½®èªè¨€åå¥½ï¼Œç¢ºä¿ I18nManager ä½¿ç”¨æ­£ç¢ºçš„èªè¨€
  localStorage.setItem('preferred-language', lang);
</script>

<!-- éŠæˆ²ç‹€æ…‹ç®¡ç†ï¼ˆå¿…é ˆæœ€å…ˆè¼‰å…¥ï¼‰ -->
<script src="/scripts/gamestate.js" defer></script>

<!-- i18n ç®¡ç†å™¨ -->
<script src="/scripts/i18n-manager.js" defer></script>
<script src="/scripts/i18n-helper.js" defer></script>

<!-- æŠ€èƒ½æ¨¹ç³»çµ± -->
<script src="/scripts/skill-tree-hierarchical.js" defer></script>

<!-- å¬å–šç³»çµ±è…³æœ¬ï¼ˆå‚³çµ± IIFEï¼Œéœ€é€é script src è¼‰å…¥ï¼‰ -->
<script src="/scripts/summon-state-machine.js" defer></script>
<script src="/scripts/summon-animation-controller.js" defer></script>
<script src="/scripts/summon.js" defer></script>

<!-- æ•…äº‹æ›¸ç³»çµ± -->
<script src="/scripts/book.js" defer></script>

<!-- RPG ç³»çµ±ï¼šæˆå°±ã€ç‰©å“æ¬„ã€å‹•ç•« -->
<script src="/scripts/achievements.js" defer></script>
<script src="/scripts/inventory.js" defer></script>
<script src="/scripts/advanced-animations.js" defer></script>

<!-- éŸ¿æ‡‰å¼é©é… -->
<script src="/scripts/inventory-responsive.js" defer></script>

<!-- æ ¸å¿ƒç³»çµ±ï¼šå®‰å…¨ã€é™¤éŒ¯ã€æ‡¶è¼‰å…¥ã€è¡Œå‹•é¸å–®ã€ä¸»åˆå§‹åŒ– -->
<script src="/scripts/security-utils.js" defer></script>
<script src="/scripts/debug-utils.js" defer></script>
<script src="/scripts/lazy-loader.js" defer></script>
<script src="/scripts/mobile-menu.js" defer></script>
<script src="/scripts/main.js" defer></script>

<!-- Web3 ç³»çµ±ï¼šéŒ¢åŒ…ã€ç¶²è·¯ç›£æ§ã€SGT è³¼è²·ã€è³½åšçµ‚ç«¯ -->
<script src="/scripts/contracts-config.js" defer></script>
<script src="/scripts/unified-wallet-manager.js" defer></script>
<script src="/scripts/simple-network-monitor.js" defer></script>
<script src="/scripts/simple-sgt-balance.js" defer></script>
<script src="/scripts/sgt-purchase-manager.js" defer></script>
<script src="/scripts/cyber-terminal.js" defer></script>
<script src="/scripts/cyber-audio.js" defer></script>

<!-- é–‹ç™¼è€…å·¥å…· -->
<script src="/scripts/cheat.js" defer></script>
