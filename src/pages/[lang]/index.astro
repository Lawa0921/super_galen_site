---
/**
 * RPG é¢¨æ ¼é¦–é 
 * å‹•æ…‹è·¯ç”±ï¼š/zh-TW/, /zh-CN/, /en/, /ja/, /ko/
 */
import BaseLayout from '@components/layout/BaseLayout.astro';
import LanguageSwitcher from '@components/i18n/LanguageSwitcher.astro';
import StatusBar from '@components/rpg/StatusBar.astro';
import GameTabs from '@components/rpg/GameTabs.astro';
import SkillTreePanel from '@components/rpg/SkillTreePanel.astro';
import InventoryPanel from '@components/rpg/InventoryPanel.astro';
import AchievementsPanel from '@components/rpg/AchievementsPanel.astro';
import { languages, type Language, useTranslations } from '@i18n/index';

// æ”¯æ´çš„èªè¨€åˆ—è¡¨
const supportedLangs = Object.keys(languages) as Language[];

export function getStaticPaths() {
  return supportedLangs.map((lang) => ({
    params: { lang },
  }));
}

const { lang } = Astro.params as { lang: Language };
const { t, all: trans } = useTranslations(lang);

// é é¢æ¨™é¡Œ
const pageTitle = trans.site?.title || "SuperGalen's Dungeon";
const pageDescription = trans.site?.description || 'RPG é¢¨æ ¼æŠ€è¡“éƒ¨è½æ ¼';

// å±¬æ€§è³‡æ–™
const attributes = [
  { key: 'STR', name: trans.attributes?.STR?.name || 'åŠ›é‡', value: 75, desc: trans.attributes?.STR?.desc || 'ç¨‹å¼ç¢¼çš„åŸ·è¡ŒåŠ›' },
  { key: 'INT', name: trans.attributes?.INT?.name || 'æ™ºåŠ›', value: 88, desc: trans.attributes?.INT?.desc || 'è§£æ±ºå•é¡Œçš„èƒ½åŠ›' },
  { key: 'BUG', name: trans.attributes?.BUG?.name || 'é™¤éŒ¯', value: 92, desc: trans.attributes?.BUG?.desc || 'ç™¼ç¾ä¸¦ä¿®å¾©éŒ¯èª¤' },
  { key: 'SAN', name: trans.attributes?.SAN?.name || 'ç†æ™º', value: 45, desc: trans.attributes?.SAN?.desc || 'é¢å°éœ€æ±‚è®Šæ›´çš„å¿ƒæ™º' },
  { key: 'STS', name: trans.attributes?.STS?.name || 'è€å£“', value: 78, desc: trans.attributes?.STS?.desc || 'è™•ç†é«˜å£“ç’°å¢ƒ' },
  { key: 'CAF', name: trans.attributes?.CAF?.name || 'å’–å•¡', value: 95, desc: trans.attributes?.CAF?.desc || 'å’–å•¡å› ä¾è³´ç¨‹åº¦' },
  { key: 'OVT', name: trans.attributes?.OVT?.name || 'åŠ ç­', value: 60, desc: trans.attributes?.OVT?.desc || 'åŠ ç­è€å—åŠ›' },
  { key: 'DLN', name: trans.attributes?.DLN?.name || 'æ­»ç·š', value: 85, desc: trans.attributes?.DLN?.desc || 'è¶• Deadline çš„èƒ½åŠ›' },
  { key: 'LUK', name: trans.attributes?.LUK?.name || 'é‹æ°£', value: 50, desc: trans.attributes?.LUK?.desc || 'ä¸€æ¬¡å°±éçš„æ©Ÿç‡' },
];
---

<BaseLayout title={pageTitle} description={pageDescription} lang={lang}>
  <div class="rpg-interface">
    <header class="site-header">
      <div class="header-content">
        <h1 class="site-title">{pageTitle}</h1>
        <LanguageSwitcher currentLang={lang} currentPath={Astro.url.pathname} />
      </div>
    </header>

    <div class="game-container">
      <!-- ç‹€æ…‹åˆ— -->
      <StatusBar lang={lang} />

      <!-- é ç±¤å°èˆª -->
      <GameTabs lang={lang} activeTab="status" />

      <!-- é ç±¤å…§å®¹å€åŸŸ -->
      <div class="tab-content">
        <!-- ç‹€æ…‹é¢æ¿ -->
        <div class="tab-panel active" id="status-tab">
          <div class="status-panel">
            <h3 class="panel-title">
              <i class="fas fa-chart-bar"></i>
              {trans.status?.attributes || 'è§’è‰²å±¬æ€§'}
            </h3>
            <div class="attributes-grid">
              {attributes.map((attr) => (
                <div class="attribute-item">
                  <div class="attr-header">
                    <span class="attr-key">{attr.key}</span>
                    <span class="attr-name">{attr.name}</span>
                    <span class="attr-value">{attr.value}</span>
                  </div>
                  <div class="attr-bar">
                    <div class="attr-fill" style={`width: ${attr.value}%`}></div>
                  </div>
                  <p class="attr-desc">{attr.desc}</p>
                </div>
              ))}
            </div>
          </div>
        </div>

        <!-- æŠ€èƒ½é¢æ¿ -->
        <div class="tab-panel" id="skills-tab">
          <SkillTreePanel lang={lang} />
        </div>

        <!-- æ•…äº‹é¢æ¿ -->
        <div class="tab-panel" id="story-tab">
          <div class="story-panel">
            <h3 class="panel-title">
              <i class="fas fa-book"></i>
              {trans.story?.title || 'å†’éšªæ•…äº‹'}
            </h3>
            <div class="story-content">
              <p>{trans.story?.intro || 'ä¸€ä½å¾æ­¦è¡“é¤¨è½‰è·åˆ°ç¨‹å¼ä¸–ç•Œçš„å†’éšªè€…...'}</p>
            </div>
          </div>
        </div>

        <!-- ç‰©å“æ¬„é¢æ¿ -->
        <div class="tab-panel" id="inventory-tab">
          <InventoryPanel lang={lang} />
        </div>

        <!-- æˆå°±é¢æ¿ -->
        <div class="tab-panel" id="achievements-tab">
          <AchievementsPanel lang={lang} />
        </div>

        <!-- å¤¥ä¼´é¢æ¿ -->
        <div class="tab-panel" id="party-tab">
          <div class="party-panel">
            <h3 class="panel-title">
              <i class="fas fa-users"></i>
              {trans.party?.title || 'å¤¥ä¼´'}
            </h3>
            <div class="party-grid" id="party-grid">
              <p>{trans.party?.empty || 'ç›®å‰æ²’æœ‰å¤¥ä¼´åŠ å…¥éšŠä¼'}</p>
            </div>
          </div>
        </div>

        <!-- è³¼è²·é¢æ¿ -->
        <div class="tab-panel" id="purchase-tab">
          <div class="purchase-panel">
            <h3 class="panel-title">
              <i class="fas fa-shopping-cart"></i>
              {trans.purchase?.title || 'è³¼è²· SGT'}
            </h3>
            <div class="purchase-content">
              <div class="wallet-section">
                <button class="connect-wallet-btn" id="connect-wallet-btn">
                  <i class="fas fa-wallet"></i>
                  {trans.purchase?.connect_wallet || 'é€£æ¥éŒ¢åŒ…'}
                </button>
                <div class="wallet-status" id="wallet-status"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  .rpg-interface {
    min-height: 100vh;
    background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
  }

  .site-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    padding: 0.75rem 2rem;
    background: rgba(10, 14, 39, 0.95);
    border-bottom: 1px solid #ffd700;
    z-index: 100;
  }

  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1400px;
    margin: 0 auto;
  }

  .site-title {
    font-size: 1.3rem;
    color: #ffd700;
    margin: 0;
  }

  .game-container {
    padding-top: 60px;
    max-width: 1400px;
    margin: 0 auto;
  }

  .tab-content {
    min-height: 500px;
  }

  .tab-panel {
    display: none;
    padding: 1.5rem;
    animation: fadeIn 0.3s ease;
  }

  .tab-panel.active {
    display: block;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .panel-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #ffd700;
    font-size: 1.25rem;
    margin: 0 0 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(255, 215, 0, 0.3);
  }

  /* å±¬æ€§é¢æ¿æ¨£å¼ */
  .attributes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }

  .attribute-item {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 8px;
    padding: 1rem;
    transition: all 0.2s ease;
  }

  .attribute-item:hover {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.05);
  }

  .attr-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .attr-key {
    background: #ffd700;
    color: #0a0e27;
    padding: 0.15rem 0.4rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: bold;
  }

  .attr-name {
    color: #e0e0e0;
    font-weight: 500;
  }

  .attr-value {
    margin-left: auto;
    color: #ffd700;
    font-weight: bold;
  }

  .attr-bar {
    height: 8px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 0.5rem;
  }

  .attr-fill {
    height: 100%;
    background: linear-gradient(to right, #ffd700, #ffaa00);
    border-radius: 4px;
    transition: width 0.5s ease;
  }

  .attr-desc {
    margin: 0;
    font-size: 0.8rem;
    color: #888;
  }

  /* æŠ€èƒ½æ¨¹é¢æ¿ */
  .skill-tree-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
  }

  #skill-tree-canvas {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 8px;
    max-width: 100%;
  }

  .skill-tree-hint {
    color: #888;
    font-size: 0.85rem;
  }

  /* å…¶ä»–é¢æ¿é€šç”¨æ¨£å¼ */
  .story-panel,
  .inventory-panel,
  .achievements-panel,
  .party-panel,
  .purchase-panel {
    color: #e0e0e0;
  }

  .story-content {
    line-height: 1.8;
    background: rgba(0, 0, 0, 0.3);
    padding: 1.5rem;
    border-radius: 8px;
  }

  .inventory-grid,
  .achievements-grid,
  .party-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 0.5rem;
  }

  /* è³¼è²·é¢æ¿ */
  .wallet-section {
    text-align: center;
    padding: 2rem;
  }

  .connect-wallet-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 2rem;
    background: linear-gradient(135deg, #6495ed, #4169e1);
    border: none;
    border-radius: 8px;
    color: #fff;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .connect-wallet-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(100, 149, 237, 0.4);
  }

  .wallet-status {
    margin-top: 1rem;
    color: #888;
  }

  @media (max-width: 768px) {
    .game-container {
      padding-top: 50px;
    }

    .tab-panel {
      padding: 1rem;
    }

    .attributes-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  // åˆå§‹åŒ–éŠæˆ²ç³»çµ±
  import { initGameState, getGameState } from '@scripts/core/gamestate';

  document.addEventListener('DOMContentLoaded', () => {
    console.log('ğŸ® SuperGalen Dungeon åˆå§‹åŒ–ä¸­...');

    // åˆå§‹åŒ–éŠæˆ²ç‹€æ…‹
    initGameState();
    console.log('âœ“ éŠæˆ²ç‹€æ…‹å·²åˆå§‹åŒ–');

    // ç›£è½éŠæˆ²äº‹ä»¶
    document.addEventListener('playerDied', () => {
      console.log('ğŸ’€ ç©å®¶æ­»äº¡ï¼Œé–‹å§‹å¾©æ´»å€’æ•¸...');
    });

    document.addEventListener('playerRevived', () => {
      console.log('âœ¨ ç©å®¶å·²å¾©æ´»ï¼');
    });

    document.addEventListener('gameStateUpdated', (e: Event) => {
      const customEvent = e as CustomEvent;
      console.log('ğŸ“Š éŠæˆ²ç‹€æ…‹æ›´æ–°:', customEvent.detail);
    });

    console.log('ğŸ° SuperGalen Dungeon æº–å‚™å°±ç·’ï¼');
  });
</script>
