<!DOCTYPE html>
<html>
<head>
    <title>Simple Network Monitor Tests</title>
    <style>
        body { font-family: monospace; background: #f5f5f5; padding: 20px; }
        .test-result { padding: 10px; margin: 5px 0; border-left: 4px solid; }
        .pass { background: #d4edda; border-color: #28a745; }
        .fail { background: #f8d7da; border-color: #dc3545; }
        .info { background: #d1ecf1; border-color: #17a2b8; }
        #test-output { max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>🧪 Simple Network Monitor Tests</h1>

    <div id="test-output"></div>

    <h2>Manual Test Instructions:</h2>
    <ol>
        <li>Open browser console to see network monitoring logs</li>
        <li>Switch networks in MetaMask</li>
        <li>Verify that network changes are logged correctly</li>
        <li>Check that supported networks (Polygon, Hardhat) are identified</li>
    </ol>

    <!-- Mock window.ethereum for testing -->
    <script>
        // Test framework
        class SimpleTestFramework {
            constructor() {
                this.tests = [];
                this.passed = 0;
                this.failed = 0;
            }

            describe(description, testFunction) {
                this.log(`📋 Testing: ${description}`, 'info');
                testFunction();
            }

            it(description, testFunction) {
                try {
                    testFunction();
                    this.passed++;
                    this.log(`✅ ${description}`, 'pass');
                } catch (error) {
                    this.failed++;
                    this.log(`❌ ${description}: ${error.message}`, 'fail');
                }
            }

            expect(actual) {
                return {
                    toBe: (expected) => {
                        if (actual !== expected) {
                            throw new Error(`Expected ${expected}, got ${actual}`);
                        }
                    },
                    toBeTruthy: () => {
                        if (!actual) {
                            throw new Error(`Expected truthy value, got ${actual}`);
                        }
                    },
                    toBeFalsy: () => {
                        if (actual) {
                            throw new Error(`Expected falsy value, got ${actual}`);
                        }
                    },
                    toContain: (expected) => {
                        if (!actual.includes(expected)) {
                            throw new Error(`Expected ${actual} to contain ${expected}`);
                        }
                    }
                };
            }

            log(message, type = 'info') {
                const output = document.getElementById('test-output');
                const div = document.createElement('div');
                div.className = `test-result ${type}`;
                div.textContent = message;
                output.appendChild(div);
                console.log(message);
            }

            summary() {
                const total = this.passed + this.failed;
                this.log(`\n📊 Test Summary: ${this.passed}/${total} passed`,
                         this.failed === 0 ? 'pass' : 'fail');
            }
        }

        const test = new SimpleTestFramework();

        // Mock MetaMask for testing
        window.ethereum = {
            isConnected: () => true,
            request: async (params) => {
                if (params.method === 'eth_chainId') {
                    return '0x89'; // Mock Polygon
                }
                return null;
            },
            on: (event, callback) => {
                console.log(`Mock: Listening for ${event}`);
            }
        };

        // Load the actual script
        const script = document.createElement('script');
        script.src = '../assets/js/simple-network-monitor.js';
        document.head.appendChild(script);

        // Wait for script to load then run tests
        script.onload = () => {
            setTimeout(() => {
                test.describe('SimpleNetworkMonitor Class', () => {
                    test.it('should be available globally', () => {
                        test.expect(window.networkMonitor).toBeTruthy();
                    });

                    test.it('should have correct supported networks', () => {
                        const state = window.networkMonitor.getState();
                        test.expect(state.supportedNetworks['0x89'].name).toBe('Polygon Mainnet');
                        test.expect(state.supportedNetworks['0x7a69'].name).toBe('Hardhat Local');
                    });

                    test.it('should detect current network', () => {
                        const state = window.networkMonitor.getState();
                        test.expect(state.currentChainId).toBe('0x89');
                        test.expect(state.isNetworkSupported).toBeTruthy();
                    });

                    test.it('should identify unsupported networks', () => {
                        // Simulate unsupported network
                        window.networkMonitor.handleNetworkChange('0x1'); // Ethereum
                        const state = window.networkMonitor.getState();
                        test.expect(state.isNetworkSupported).toBeFalsy();
                    });
                });

                test.describe('Network Detection', () => {
                    test.it('should handle network changes correctly', () => {
                        const oldChainId = window.networkMonitor.currentChainId;
                        window.networkMonitor.handleNetworkChange('0x7a69');
                        test.expect(window.networkMonitor.currentChainId).toBe('0x7a69');
                    });
                });

                test.summary();
            }, 1000);
        };
    </script>
</body>
</html>